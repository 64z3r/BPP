<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>bpp.model.egnn API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../model.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;bpp.model</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="egnn/implicit.html">implicit</a></li>
                    <li><a href="egnn/implicit_backup_1.html">implicit_backup_1</a></li>
                    <li><a href="egnn/implicit_backup_2.html">implicit_backup_2</a></li>
                    <li><a href="egnn/reversible.html">reversible</a></li>
                    <li><a href="egnn/unrecorded.html">unrecorded</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#parameter_init">parameter_init</a>
            </li>
            <li>
                    <a class="function" href="#iter_net_segments">iter_net_segments</a>
            </li>
            <li>
                    <a class="function" href="#init_net_segments">init_net_segments</a>
            </li>
            <li>
                    <a class="function" href="#fourier_encode">fourier_encode</a>
            </li>
            <li>
                    <a class="class" href="#Apply">Apply</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Apply.__init__">Apply</a>
                        </li>
                        <li>
                                <a class="variable" href="#Apply.fn">fn</a>
                        </li>
                        <li>
                                <a class="function" href="#Apply.extra_repr">extra_repr</a>
                        </li>
                        <li>
                                <a class="function" href="#Apply.forward">forward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EGNN">EGNN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EGNN.__init__">EGNN</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.aggr_mean">aggr_mean</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.aggr_sum">aggr_sum</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.dims_node">dims_node</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.dims_edge">dims_edge</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.dims_gate">dims_gate</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.dims_pos">dims_pos</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.num_pos">num_pos</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.num_encode">num_encode</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.update_pos">update_pos</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.gate_msg">gate_msg</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.norm">norm</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.init">init</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.edge_net">edge_net</a>
                        </li>
                        <li>
                                <a class="variable" href="#EGNN.node_net">node_net</a>
                        </li>
                        <li>
                                <a class="function" href="#EGNN.reset_parameters">reset_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#EGNN.forward">forward</a>
                        </li>
                        <li>
                                <a class="function" href="#EGNN.message">message</a>
                        </li>
                        <li>
                                <a class="function" href="#EGNN.aggregate">aggregate</a>
                        </li>
                        <li>
                                <a class="function" href="#EGNN.update">update</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DeepEGNN">DeepEGNN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DeepEGNN.__init__">DeepEGNN</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeepEGNN.residual">residual</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeepEGNN.init">init</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeepEGNN.layers">layers</a>
                        </li>
                        <li>
                                <a class="function" href="#DeepEGNN.reset_parameters">reset_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#DeepEGNN.forward">forward</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../bpp.html">bpp</a><wbr>.<a href="./../model.html">model</a><wbr>.egnn    </h1>

                        <div class="docstring"><p>Module containing implementations of E(n) Equivariant Graph Neural Networks.</p>

<h6 id="references">References:</h6>

<blockquote>
  <p>[^1]: Victor Garcia Satorras, , Emiel Hoogeboom, and Max Welling. "E(n)
         Equivariant Graph Neural Networks." (2022).
         <code>arXiv:2102.09844&lt;https://arxiv.org/abs/2102.09844&gt;</code>.</p>
</blockquote>
</div>

                        <input id="mod-egnn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-egnn-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Module containing implementations of E(n) Equivariant Graph Neural Networks.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">References:</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">    .. [1] Victor Garcia Satorras, , Emiel Hoogeboom, and Max Welling. &quot;E(n)</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">        Equivariant Graph Neural Networks.&quot; (2022).</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">        `arXiv:2102.09844&lt;https://arxiv.org/abs/2102.09844&gt;`.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">torch_geometric</span> <span class="kn">import</span> <span class="n">nn</span> <span class="k">as</span> <span class="n">gnn</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">torch_geometric.typing</span> <span class="kn">import</span> <span class="n">Adj</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">.._arguments</span> <span class="kn">import</span> <span class="n">broadcast_arg</span><span class="p">,</span> <span class="n">Broadcast</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="k">def</span> <span class="nf">parameter_init</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;relu&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize module parameters. Uses kaiming initialization for linear</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    modules and sets parameters of other modules accordingly.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    Arguments:</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        module:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">            Module that parameters should be initialized.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        nonlinearity:</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">            Nonlinearity that should be assumed for linear modules.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="k">match</span> <span class="n">module</span><span class="p">:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">():</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="n">nonlinearity</span><span class="p">)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">():</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">():</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>        <span class="k">case</span> <span class="n">gnn</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">MessageNorm</span><span class="p">():</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="k">def</span> <span class="nf">iter_net_segments</span><span class="p">(</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="o">*</span><span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initializes and yields individual segments for feed-forward networks.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    Arguments:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        dims: Dimensions for input, hidden and output features.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">        norm: Whether to layer-normalize inputs.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        clamp: Threshold for clamping the output (between `-clamp` and</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">            `clamp`).  Unclamped if `clamp &lt;= 0`.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        dropout: Dropout probability in-between layers of network. No</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">            dropout if `0`.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        activation: Activation function that is used in-between network</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">            layers.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        norm_cls: Normalization module class instance.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        dropout_cls: Dropout module class instance.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">    Yields:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        Individual segments of network.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="ow">and</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>        <span class="k">yield</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dropout</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="k">yield</span> <span class="n">dropout_cls</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="k">yield</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">:])):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="k">yield</span> <span class="n">activation</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="k">if</span> <span class="n">norm</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>            <span class="k">yield</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="k">yield</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">clamp</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="k">yield</span> <span class="n">Apply</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="n">clamp</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">clamp</span><span class="p">))</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="k">def</span> <span class="nf">init_net_segments</span><span class="p">(</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="n">sequence</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="n">head_nonlinearity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize sequence of network segments.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">    Arguments:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">        init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">            the module that should be initialized, the second is the</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">            non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">            Default non-linearity must be set.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">        sequence: Sequence of network segments.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        head_nonlinearity: Non-linearity for head of network.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="k">if</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">return</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="k">if</span> <span class="n">head_nonlinearity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="n">sequence</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="k">return</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="n">head</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="n">body</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>            <span class="n">head</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">module</span><span class="p">:</span> <span class="n">init</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">head_nonlinearity</span><span class="p">))</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="n">body</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="k">break</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="n">head</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">module</span><span class="p">:</span> <span class="n">init</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">head_nonlinearity</span><span class="p">))</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="k">def</span> <span class="nf">fourier_encode</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Encodes `x` to be represented by a vector of fourier features.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">    Depending on whether `num` is even or odd, the vector of encoded features</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">    will also contain `x` itself: if even, `x` is not included, if odd `x` is</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">    included.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">    Assuming `num` is odd, the features :math:`y` look as follows:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">    .. math::</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        \begin{aligned}</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        s_k &amp;= x \cdot 0.5^k \\\\</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        \mathbf{y} &amp;= \left[\sin(s_0), \dots, \sin(s_{\lfloor\text{num}/2\rfloor-1}),</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">                            \cos(s_0), \dots, \cos(s_{\lfloor\text{num}/2\rfloor-1}), x\right]</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        \end{aligned}</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">                             </span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">    Arguments:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        x: Value from which the fourier features should be computed.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        num: Number of fourier features that should be computed.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    Returns:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        Fourier features of `x`.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="n">k</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.5</span><span class="o">**</span><span class="n">k</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">sin</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">cos</span><span class="p">()]</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="k">if</span> <span class="n">num</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="k">class</span> <span class="nc">Apply</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply Module.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">    Applies :func:`fn` to an input and returns the result.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        Arguments:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">            fn: Function that should be applied.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the representation of :func:`fn`.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        Returns:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">            Representation of :func:`fn`.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call :func:`fn` on `input` and return result.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">        Arguments:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">            x: Input for :func:`fn`.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        Returns:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">            Result of `fn(input)`.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="k">class</span> <span class="nc">EGNN</span><span class="p">(</span><span class="n">gnn</span><span class="o">.</span><span class="n">MessagePassing</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;E(n) Equivariant Graph Neural Network.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    Implementation of an E(n) Equivariant Graph Neural Network as described in</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">    [1]_ that supports multiple node coordinates. This way we can encode</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    different spatial features as coordinate; e.g., vectors that originate from</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">    a single node.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">    Node features are usually two-dimensional tensors of the size :math:`(N, F)`,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">    with :math:`N` being the number of nodes and :math:`F` the number of</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">    features.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">    Similarly, coordinates have the size :math:`(N, D)` with :math:`D` being the</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">    dimension of the coordinate space. Alternatively, to encode multiple</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">    coordinates per node, the coordinates can be :math:`(N, C, D)` with</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    :math:`C` as the number of individual coordinates per node.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">    Edge features are optional and have the size :math:`(E, G)` with :math:`E`</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">    as the number of edges and :math:`G` as the number of edge features.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    Example:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        EGNN instance with 16 input and 32 output features and two coordinates</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        per node.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        &gt;&gt;&gt; from bpp.model.egnn import EGNN</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">        &gt;&gt;&gt; fn = EGNN(</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        ...     dims_node=(16, 64, 32),</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        ...     dims_edge=(0, 64, 16),</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        ...     dims_pos=(32,),</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        ...     num_pos=2,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        )</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        &gt;&gt;&gt; fn</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        EGNN(</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">          (aggr_mean): MeanAggregation()</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">          (aggr_sum): SumAggregation()</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">          (edge_net): Sequential(</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">            (0): Linear(in_features=34, out_features=64, bias=True)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">            (2): Linear(in_features=64, out_features=16, bias=True)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">            (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">          )</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">          (node_net): Sequential(</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">            (0): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">            (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">          )</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">          (pos_net): Sequential(</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">            (0): Linear(in_features=16, out_features=32, bias=True)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">            (2): Linear(in_features=32, out_features=2, bias=True)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">          )</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        )</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        Arguments:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            dims_node: Dimensions for the node network: `dims_node[0]` is the</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">                number of input features and `dims_node[-1]` is the number of</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">                output features.  At least 2 dimensions are required. All</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">                network.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">            dims_edge: Dimensions for the edge network: `dims_edge[0]` is the</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">                number of edge features (0 if graphs have no edge features),</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">                `dims_edge[-1]` is the number of message features.  All</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">                will be disabled.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">                0, the penultimate layer of the coordinate update network will</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">            dropout: Dropout probability in-between network layers. No dropout</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">                if 0.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">                layers.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_node</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_node must be larger than 0, but one &quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                <span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_gate must be larger than 0, bot one &quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_pos must be larger than 0, bot one &quot;</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_edge, with the exception of the first &quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                    <span class="sa">f</span><span class="s2">&quot;one, must be larger than 0, but one dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                <span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="k">if</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                <span class="sa">f</span><span class="s2">&quot;first dimension in dims_edge cannot be negative, but got &quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_node is 2, but got &quot;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_edge is 2, but got &quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="k">if</span> <span class="n">num_pos</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of positional coordinates is 1, but got </span><span class="si">{</span><span class="n">num_pos</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="k">if</span> <span class="n">num_encode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of fourier-encoded features for positional &quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="sa">f</span><span class="s2">&quot;coordinates is 1, but got </span><span class="si">{</span><span class="n">num_encode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="k">if</span> <span class="n">clamp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clamp value must be positive, but got </span><span class="si">{</span><span class="n">clamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">if</span> <span class="n">dropout</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dropout value must be positive, but got </span><span class="si">{</span><span class="n">dropout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">MeanAggregation</span><span class="p">()</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">SumAggregation</span><span class="p">()</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">update</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">num_pos</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="n">gate</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_gate</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="p">(</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">num_pos</span> <span class="o">*</span> <span class="n">num_encode</span><span class="p">),</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>            <span class="o">*</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>            <span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="n">dims_pos</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="n">dims_gate</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                <span class="mi">1</span><span class="p">,</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_edge</span> <span class="o">=</span> <span class="n">dims_edge</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_gate</span> <span class="o">=</span> <span class="n">dims_gate</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_pos</span> <span class="o">=</span> <span class="n">dims_pos</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_pos</span> <span class="o">=</span> <span class="n">num_pos</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span> <span class="o">=</span> <span class="n">num_encode</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_pos</span> <span class="o">=</span> <span class="n">update</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gate_msg</span> <span class="o">=</span> <span class="n">gate</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">norm</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(</span><span class="n">approximate</span><span class="o">=</span><span class="s2">&quot;tanh&quot;</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">):</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">activation</span><span class="p">]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="o">*</span><span class="n">dims_edge</span><span class="p">,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="p">),</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="o">*</span><span class="n">penultimate_edge_activation</span><span class="p">,</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">,</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="k">if</span> <span class="n">pos_scale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                        <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                        <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                    <span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                <span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                    <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                    <span class="n">clamp</span><span class="o">=</span><span class="n">clamp</span><span class="p">,</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                <span class="p">),</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                <span class="o">*</span><span class="n">penultimate_pos_activation</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                    <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                <span class="p">),</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">MessageNorm</span><span class="p">(</span><span class="n">learn_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calls original :meth:`torch.nn.Module.__repr__`; more informative</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">        than :meth:`torch_geometric.nn.Module.__repr__`.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        Returns:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">            String-representation of the EGNN layer.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">gnn</span><span class="o">.</span><span class="n">MessagePassing</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">,</span> <span class="n">pos_net_nonlinearity</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">,</span> <span class="s2">&quot;sigmoid&quot;</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        Arguments:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        Returns:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            Tuple of updated node features and coordinates.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">():</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="n">edge_index</span><span class="o">=</span><span class="n">edge_index</span><span class="p">,</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="n">edge_attr</span><span class="o">=</span><span class="n">edge_attr</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">-=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="k">if</span> <span class="n">pos_is_unsqueezed</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">x_i</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">x_j</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="n">pos_i</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="n">pos_j</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute messages.</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        Arguments:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">            x_i: Source node features.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">            x_j: Target node features.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">            pos_i: Source node coordinates.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">            pos_j: Target node coordinates.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">            edge_attr: Edge features; between source and target node.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        Returns:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">            Tuple of messages between source and target nodes, and difference</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">            between source and target node coordinates.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="n">msg_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_i</span><span class="p">,</span> <span class="n">x_j</span><span class="p">]</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">pos_i</span> <span class="o">-</span> <span class="n">pos_j</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">dst_ij</span> <span class="o">=</span> <span class="n">vec_ij</span><span class="o">.</span><span class="n">square</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fourier_encode</span><span class="p">(</span><span class="n">dst_ij</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span><span class="p">))</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">if</span> <span class="n">edge_attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_attr</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">msg_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">msg_input</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>            <span class="n">force_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="n">norm_ij</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_ij</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                <span class="n">force_ij</span> <span class="o">=</span> <span class="n">force_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">vec_ij</span> <span class="o">*</span> <span class="p">(</span><span class="n">force_ij</span> <span class="o">/</span> <span class="n">norm_ij</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="n">msg_ij</span> <span class="o">=</span> <span class="n">msg_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">return</span> <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="n">ptr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="n">dim_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate messages.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        Arguments:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">            messages: Tuple of messages and coordinate differences between</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">                nodes.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">            index: Indices of elements for applying the aggregation. Either</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">                `index` or `ptr` must be defined.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">            ptr: Offsets for computing the aggregation based on sorted inputs,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">                if provided. Either `index` or `ptr` must be defined.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">            dim_size: Size of output at dimension `self.node_dim` after</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">                aggregation.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Returns:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">            Tuple of aggregated messages and aggregated coordinate updates.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span><span class="p">(</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span><span class="p">(</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="k">if</span> <span class="n">vec_ij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">vec_ij</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="k">return</span> <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update nodes.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        Arguments:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">            messages: Tuple of aggregated messages and coordinate differences.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">        Returns:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">            Tuple of updated node features and updated node coordinates.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="k">if</span> <span class="n">pos_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">pos_update</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="k">class</span> <span class="nc">DeepEGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deep E(n) Equivariant Neural Network.</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">    Implementation of an E(n) Equivariant Neural Network with :class:`EGNN` as</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">    its layers.</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">    Arguments can be broadcasted to individual layers during initialization. For</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">    example, if `layers = 4` and `dims_node = (64, 32)`, then `dims_node` will</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">    be used for each of the 4 layers to initialize the hidden and output layer</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">    of the node network. If on the other hand `dims_node = [(64, 32), (128, 64),</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">    (128, 64), (64, 32)]`, then the first and last layer will use `(64, 32)` and</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">    the second and third layer will use `(128, 64)` to initialize their hidden</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">    and output layers.</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">    Example:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        DeepEGNN instance with 16 input and 64 output features with 2 EGNN</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        layers each having 64 and 128 hidden node features and 32 and 64</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        intermediate output node features.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        &gt;&gt;&gt; from egnn import DeepEGNN</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        &gt;&gt;&gt; fn = DeepEGNN(</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        ...     dims_node=[(16, 64, 32), (128, 64)],</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        ...     dims_edge=[(0, 64, 32, 64)],</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        ...     layers=2,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        ... )</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        &gt;&gt;&gt; fn</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        DeepEGNN(</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">          (layers): ModuleList(</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            (0): ModuleDict(</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">                  (0): Linear(in_features=33, out_features=64, bias=True)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">                )</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">                  (0): Linear(in_features=80, out_features=64, bias=True)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">                )</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">              )</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">                (x): Identity()</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">              )</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">            )</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">            (1): ModuleDict(</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">                  (0): Linear(in_features=65, out_features=64, bias=True)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">                )</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">                  (0): Linear(in_features=96, out_features=128, bias=True)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">                  (2): Linear(in_features=128, out_features=64, bias=True)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">                )</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">              )</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">                (x): Identity()</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a><span class="sd">              )</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">            )</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">            (2): ModuleDict(</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">                  (0): Linear(in_features=129, out_features=64, bias=True)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">                )</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">                  (0): Linear(in_features=128, out_features=64, bias=True)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">                )</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">              )</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">                (x): Identity()</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">              )</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">            )</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">          )</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        )</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="n">residual</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">        Arguments:</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">                features and `dims_node[-1]` describing the number output</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">                features for the node networks in all layers. Note that the</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">                number of input features is only valid for the first layer; in</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">                all subsequent layers the number of input features is inferred</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">                from the number of output features of the previous layer.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">                Alternatively, `dims_node` can also be a sequence of sequences</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">                of integers, describing the aforementioned properties for each</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">                layer individually. In this case, `dims_node[0][0]` is the</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">                number of input features for the first layer, but for all</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">                subsequent layers the first value represents the dimension of</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">                the first hidden layer of the node networks, since the number of</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">                input features is inferred from the previous number of output</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">                features of the previous layer; e.g., `dims_node[1][0]` is the</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">                dimension of the first hidden layer in the node network of the</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">                second layer in this network.</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">                gating is disabled.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">                update is disabled.</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">            layers: Number of :class:`EGNN` layers.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">            norm: Whether to normalize a given layer and whether to use</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">                normalization after that given layer. If a single boolean or a</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">                list of single booleans, then normalization will be applied</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">                within and after the corresponding layers according to the</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">                normalization after a layer and the second will determine</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">                whether to use normalization within that layer.</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">                omitted if 0.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">            residual: Whether a layer is a residual layer. If `residual` is a</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">                single value, then layers will only be residual layers if their</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">                number of input and output features matches. Coordinates are not</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">                updated through residual connections, independent of this</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">                toggle.</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">                layers.</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="n">residual_is_broadcasted</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>        <span class="n">residual</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;residual&quot;</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="n">dim_in</span> <span class="o">=</span> <span class="n">features_node</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim_in</span><span class="p">,</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">dim_in</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residual</span><span class="p">)):</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                <span class="k">if</span> <span class="n">residual_is_broadcasted</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                    <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                        <span class="sa">f</span><span class="s2">&quot;cannot use residual connections if input and output &quot;</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                        <span class="sa">f</span><span class="s2">&quot;dimensions disagree: number of input features at &quot;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                        <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, number of output &quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                        <span class="sa">f</span><span class="s2">&quot;features is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                    <span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="k">if</span> <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">num_pos</span> <span class="o">*</span> <span class="n">dim_pos</span><span class="p">)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="k">for</span> <span class="n">init</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">        Arguments:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">        Returns:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="n">pos</span><span class="p">,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            </section>
                <section id="parameter_init">
                            <input id="parameter_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parameter_init</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">module</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span>,</span><span class="param">	<span class="n">nonlinearity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="parameter_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parameter_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parameter_init-23"><a href="#parameter_init-23"><span class="linenos">23</span></a><span class="k">def</span> <span class="nf">parameter_init</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;relu&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parameter_init-24"><a href="#parameter_init-24"><span class="linenos">24</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize module parameters. Uses kaiming initialization for linear</span>
</span><span id="parameter_init-25"><a href="#parameter_init-25"><span class="linenos">25</span></a><span class="sd">    modules and sets parameters of other modules accordingly.</span>
</span><span id="parameter_init-26"><a href="#parameter_init-26"><span class="linenos">26</span></a>
</span><span id="parameter_init-27"><a href="#parameter_init-27"><span class="linenos">27</span></a><span class="sd">    Arguments:</span>
</span><span id="parameter_init-28"><a href="#parameter_init-28"><span class="linenos">28</span></a><span class="sd">        module:</span>
</span><span id="parameter_init-29"><a href="#parameter_init-29"><span class="linenos">29</span></a><span class="sd">            Module that parameters should be initialized.</span>
</span><span id="parameter_init-30"><a href="#parameter_init-30"><span class="linenos">30</span></a><span class="sd">        nonlinearity:</span>
</span><span id="parameter_init-31"><a href="#parameter_init-31"><span class="linenos">31</span></a><span class="sd">            Nonlinearity that should be assumed for linear modules.</span>
</span><span id="parameter_init-32"><a href="#parameter_init-32"><span class="linenos">32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parameter_init-33"><a href="#parameter_init-33"><span class="linenos">33</span></a>
</span><span id="parameter_init-34"><a href="#parameter_init-34"><span class="linenos">34</span></a>    <span class="k">match</span> <span class="n">module</span><span class="p">:</span>
</span><span id="parameter_init-35"><a href="#parameter_init-35"><span class="linenos">35</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">():</span>
</span><span id="parameter_init-36"><a href="#parameter_init-36"><span class="linenos">36</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="n">nonlinearity</span><span class="p">)</span>
</span><span id="parameter_init-37"><a href="#parameter_init-37"><span class="linenos">37</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parameter_init-38"><a href="#parameter_init-38"><span class="linenos">38</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="parameter_init-39"><a href="#parameter_init-39"><span class="linenos">39</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">():</span>
</span><span id="parameter_init-40"><a href="#parameter_init-40"><span class="linenos">40</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</span><span id="parameter_init-41"><a href="#parameter_init-41"><span class="linenos">41</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parameter_init-42"><a href="#parameter_init-42"><span class="linenos">42</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="parameter_init-43"><a href="#parameter_init-43"><span class="linenos">43</span></a>        <span class="k">case</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">():</span>
</span><span id="parameter_init-44"><a href="#parameter_init-44"><span class="linenos">44</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</span><span id="parameter_init-45"><a href="#parameter_init-45"><span class="linenos">45</span></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parameter_init-46"><a href="#parameter_init-46"><span class="linenos">46</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
</span><span id="parameter_init-47"><a href="#parameter_init-47"><span class="linenos">47</span></a>        <span class="k">case</span> <span class="n">gnn</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">MessageNorm</span><span class="p">():</span>
</span><span id="parameter_init-48"><a href="#parameter_init-48"><span class="linenos">48</span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">ones_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize module parameters. Uses kaiming initialization for linear
modules and sets parameters of other modules accordingly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>module:</strong>  Module that parameters should be initialized.</li>
<li><strong>nonlinearity:</strong>  Nonlinearity that should be assumed for linear modules.</li>
</ul>
</div>


                </section>
                <section id="iter_net_segments">
                            <input id="iter_net_segments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iter_net_segments</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">dims</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	norm_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;</span><span class="return-annotation">) -> <span class="n">Iterable</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="iter_net_segments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#iter_net_segments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="iter_net_segments-51"><a href="#iter_net_segments-51"><span class="linenos">51</span></a><span class="k">def</span> <span class="nf">iter_net_segments</span><span class="p">(</span>
</span><span id="iter_net_segments-52"><a href="#iter_net_segments-52"><span class="linenos">52</span></a>    <span class="o">*</span><span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="iter_net_segments-53"><a href="#iter_net_segments-53"><span class="linenos">53</span></a>    <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="iter_net_segments-54"><a href="#iter_net_segments-54"><span class="linenos">54</span></a>    <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="iter_net_segments-55"><a href="#iter_net_segments-55"><span class="linenos">55</span></a>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="iter_net_segments-56"><a href="#iter_net_segments-56"><span class="linenos">56</span></a>    <span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="iter_net_segments-57"><a href="#iter_net_segments-57"><span class="linenos">57</span></a>    <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="iter_net_segments-58"><a href="#iter_net_segments-58"><span class="linenos">58</span></a>    <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="iter_net_segments-59"><a href="#iter_net_segments-59"><span class="linenos">59</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]:</span>
</span><span id="iter_net_segments-60"><a href="#iter_net_segments-60"><span class="linenos">60</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initializes and yields individual segments for feed-forward networks.</span>
</span><span id="iter_net_segments-61"><a href="#iter_net_segments-61"><span class="linenos">61</span></a>
</span><span id="iter_net_segments-62"><a href="#iter_net_segments-62"><span class="linenos">62</span></a><span class="sd">    Arguments:</span>
</span><span id="iter_net_segments-63"><a href="#iter_net_segments-63"><span class="linenos">63</span></a><span class="sd">        dims: Dimensions for input, hidden and output features.</span>
</span><span id="iter_net_segments-64"><a href="#iter_net_segments-64"><span class="linenos">64</span></a><span class="sd">        norm: Whether to layer-normalize inputs.</span>
</span><span id="iter_net_segments-65"><a href="#iter_net_segments-65"><span class="linenos">65</span></a><span class="sd">        clamp: Threshold for clamping the output (between `-clamp` and</span>
</span><span id="iter_net_segments-66"><a href="#iter_net_segments-66"><span class="linenos">66</span></a><span class="sd">            `clamp`).  Unclamped if `clamp &lt;= 0`.</span>
</span><span id="iter_net_segments-67"><a href="#iter_net_segments-67"><span class="linenos">67</span></a><span class="sd">        dropout: Dropout probability in-between layers of network. No</span>
</span><span id="iter_net_segments-68"><a href="#iter_net_segments-68"><span class="linenos">68</span></a><span class="sd">            dropout if `0`.</span>
</span><span id="iter_net_segments-69"><a href="#iter_net_segments-69"><span class="linenos">69</span></a><span class="sd">        activation: Activation function that is used in-between network</span>
</span><span id="iter_net_segments-70"><a href="#iter_net_segments-70"><span class="linenos">70</span></a><span class="sd">            layers.</span>
</span><span id="iter_net_segments-71"><a href="#iter_net_segments-71"><span class="linenos">71</span></a><span class="sd">        norm_cls: Normalization module class instance.</span>
</span><span id="iter_net_segments-72"><a href="#iter_net_segments-72"><span class="linenos">72</span></a><span class="sd">        dropout_cls: Dropout module class instance.</span>
</span><span id="iter_net_segments-73"><a href="#iter_net_segments-73"><span class="linenos">73</span></a>
</span><span id="iter_net_segments-74"><a href="#iter_net_segments-74"><span class="linenos">74</span></a><span class="sd">    Yields:</span>
</span><span id="iter_net_segments-75"><a href="#iter_net_segments-75"><span class="linenos">75</span></a><span class="sd">        Individual segments of network.</span>
</span><span id="iter_net_segments-76"><a href="#iter_net_segments-76"><span class="linenos">76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="iter_net_segments-77"><a href="#iter_net_segments-77"><span class="linenos">77</span></a>
</span><span id="iter_net_segments-78"><a href="#iter_net_segments-78"><span class="linenos">78</span></a>    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="ow">and</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="iter_net_segments-79"><a href="#iter_net_segments-79"><span class="linenos">79</span></a>        <span class="k">yield</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="iter_net_segments-80"><a href="#iter_net_segments-80"><span class="linenos">80</span></a>
</span><span id="iter_net_segments-81"><a href="#iter_net_segments-81"><span class="linenos">81</span></a>    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dropout</span><span class="p">:</span>
</span><span id="iter_net_segments-82"><a href="#iter_net_segments-82"><span class="linenos">82</span></a>        <span class="k">yield</span> <span class="n">dropout_cls</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>
</span><span id="iter_net_segments-83"><a href="#iter_net_segments-83"><span class="linenos">83</span></a>
</span><span id="iter_net_segments-84"><a href="#iter_net_segments-84"><span class="linenos">84</span></a>    <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
</span><span id="iter_net_segments-85"><a href="#iter_net_segments-85"><span class="linenos">85</span></a>        <span class="k">yield</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="iter_net_segments-86"><a href="#iter_net_segments-86"><span class="linenos">86</span></a>
</span><span id="iter_net_segments-87"><a href="#iter_net_segments-87"><span class="linenos">87</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">:])):</span>
</span><span id="iter_net_segments-88"><a href="#iter_net_segments-88"><span class="linenos">88</span></a>        <span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="iter_net_segments-89"><a href="#iter_net_segments-89"><span class="linenos">89</span></a>            <span class="k">yield</span> <span class="n">activation</span>
</span><span id="iter_net_segments-90"><a href="#iter_net_segments-90"><span class="linenos">90</span></a>        <span class="k">if</span> <span class="n">norm</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="iter_net_segments-91"><a href="#iter_net_segments-91"><span class="linenos">91</span></a>            <span class="k">yield</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span><span id="iter_net_segments-92"><a href="#iter_net_segments-92"><span class="linenos">92</span></a>        <span class="k">yield</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="iter_net_segments-93"><a href="#iter_net_segments-93"><span class="linenos">93</span></a>
</span><span id="iter_net_segments-94"><a href="#iter_net_segments-94"><span class="linenos">94</span></a>    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">clamp</span><span class="p">:</span>
</span><span id="iter_net_segments-95"><a href="#iter_net_segments-95"><span class="linenos">95</span></a>        <span class="k">yield</span> <span class="n">Apply</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="n">clamp</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">clamp</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Initializes and yields individual segments for feed-forward networks.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims:</strong>  Dimensions for input, hidden and output features.</li>
<li><strong>norm:</strong>  Whether to layer-normalize inputs.</li>
<li><strong>clamp:</strong>  Threshold for clamping the output (between <code>-clamp</code> and
<code>clamp</code>).  Unclamped if <code>clamp &lt;= 0</code>.</li>
<li><strong>dropout:</strong>  Dropout probability in-between layers of network. No
dropout if <code>0</code>.</li>
<li><strong>activation:</strong>  Activation function that is used in-between network
layers.</li>
<li><strong>norm_cls:</strong>  Normalization module class instance.</li>
<li><strong>dropout_cls:</strong>  Dropout module class instance.</li>
</ul>

<h6 id="yields">Yields:</h6>

<blockquote>
  <p>Individual segments of network.</p>
</blockquote>
</div>


                </section>
                <section id="init_net_segments">
                            <input id="init_net_segments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_net_segments</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sequence</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">head_nonlinearity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="init_net_segments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#init_net_segments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="init_net_segments-98"><a href="#init_net_segments-98"><span class="linenos"> 98</span></a><span class="k">def</span> <span class="nf">init_net_segments</span><span class="p">(</span>
</span><span id="init_net_segments-99"><a href="#init_net_segments-99"><span class="linenos"> 99</span></a>    <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="init_net_segments-100"><a href="#init_net_segments-100"><span class="linenos">100</span></a>    <span class="n">sequence</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="init_net_segments-101"><a href="#init_net_segments-101"><span class="linenos">101</span></a>    <span class="n">head_nonlinearity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="init_net_segments-102"><a href="#init_net_segments-102"><span class="linenos">102</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="init_net_segments-103"><a href="#init_net_segments-103"><span class="linenos">103</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize sequence of network segments.</span>
</span><span id="init_net_segments-104"><a href="#init_net_segments-104"><span class="linenos">104</span></a>
</span><span id="init_net_segments-105"><a href="#init_net_segments-105"><span class="linenos">105</span></a><span class="sd">    Arguments:</span>
</span><span id="init_net_segments-106"><a href="#init_net_segments-106"><span class="linenos">106</span></a><span class="sd">        init: Initializer that is used for network layers. First argument is</span>
</span><span id="init_net_segments-107"><a href="#init_net_segments-107"><span class="linenos">107</span></a><span class="sd">            the module that should be initialized, the second is the</span>
</span><span id="init_net_segments-108"><a href="#init_net_segments-108"><span class="linenos">108</span></a><span class="sd">            non-linearity, in case of a linear module, that should be used.</span>
</span><span id="init_net_segments-109"><a href="#init_net_segments-109"><span class="linenos">109</span></a><span class="sd">            Default non-linearity must be set.</span>
</span><span id="init_net_segments-110"><a href="#init_net_segments-110"><span class="linenos">110</span></a><span class="sd">        sequence: Sequence of network segments.</span>
</span><span id="init_net_segments-111"><a href="#init_net_segments-111"><span class="linenos">111</span></a><span class="sd">        head_nonlinearity: Non-linearity for head of network.</span>
</span><span id="init_net_segments-112"><a href="#init_net_segments-112"><span class="linenos">112</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="init_net_segments-113"><a href="#init_net_segments-113"><span class="linenos">113</span></a>
</span><span id="init_net_segments-114"><a href="#init_net_segments-114"><span class="linenos">114</span></a>    <span class="k">if</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="init_net_segments-115"><a href="#init_net_segments-115"><span class="linenos">115</span></a>        <span class="k">return</span>
</span><span id="init_net_segments-116"><a href="#init_net_segments-116"><span class="linenos">116</span></a>
</span><span id="init_net_segments-117"><a href="#init_net_segments-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="n">head_nonlinearity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="init_net_segments-118"><a href="#init_net_segments-118"><span class="linenos">118</span></a>        <span class="n">sequence</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="init_net_segments-119"><a href="#init_net_segments-119"><span class="linenos">119</span></a>        <span class="k">return</span>
</span><span id="init_net_segments-120"><a href="#init_net_segments-120"><span class="linenos">120</span></a>
</span><span id="init_net_segments-121"><a href="#init_net_segments-121"><span class="linenos">121</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))):</span>
</span><span id="init_net_segments-122"><a href="#init_net_segments-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>
</span><span id="init_net_segments-123"><a href="#init_net_segments-123"><span class="linenos">123</span></a>            <span class="n">head</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
</span><span id="init_net_segments-124"><a href="#init_net_segments-124"><span class="linenos">124</span></a>            <span class="n">body</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
</span><span id="init_net_segments-125"><a href="#init_net_segments-125"><span class="linenos">125</span></a>            <span class="n">head</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">module</span><span class="p">:</span> <span class="n">init</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">head_nonlinearity</span><span class="p">))</span>
</span><span id="init_net_segments-126"><a href="#init_net_segments-126"><span class="linenos">126</span></a>            <span class="n">body</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="init_net_segments-127"><a href="#init_net_segments-127"><span class="linenos">127</span></a>            <span class="k">break</span>
</span><span id="init_net_segments-128"><a href="#init_net_segments-128"><span class="linenos">128</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="init_net_segments-129"><a href="#init_net_segments-129"><span class="linenos">129</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="init_net_segments-130"><a href="#init_net_segments-130"><span class="linenos">130</span></a>        <span class="n">head</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">module</span><span class="p">:</span> <span class="n">init</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">head_nonlinearity</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Initialize sequence of network segments.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
Default non-linearity must be set.</li>
<li><strong>sequence:</strong>  Sequence of network segments.</li>
<li><strong>head_nonlinearity:</strong>  Non-linearity for head of network.</li>
</ul>
</div>


                </section>
                <section id="fourier_encode">
                            <input id="fourier_encode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fourier_encode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">num</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="fourier_encode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fourier_encode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fourier_encode-133"><a href="#fourier_encode-133"><span class="linenos">133</span></a><span class="k">def</span> <span class="nf">fourier_encode</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="fourier_encode-134"><a href="#fourier_encode-134"><span class="linenos">134</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Encodes `x` to be represented by a vector of fourier features.</span>
</span><span id="fourier_encode-135"><a href="#fourier_encode-135"><span class="linenos">135</span></a>
</span><span id="fourier_encode-136"><a href="#fourier_encode-136"><span class="linenos">136</span></a><span class="sd">    Depending on whether `num` is even or odd, the vector of encoded features</span>
</span><span id="fourier_encode-137"><a href="#fourier_encode-137"><span class="linenos">137</span></a><span class="sd">    will also contain `x` itself: if even, `x` is not included, if odd `x` is</span>
</span><span id="fourier_encode-138"><a href="#fourier_encode-138"><span class="linenos">138</span></a><span class="sd">    included.</span>
</span><span id="fourier_encode-139"><a href="#fourier_encode-139"><span class="linenos">139</span></a>
</span><span id="fourier_encode-140"><a href="#fourier_encode-140"><span class="linenos">140</span></a><span class="sd">    Assuming `num` is odd, the features :math:`y` look as follows:</span>
</span><span id="fourier_encode-141"><a href="#fourier_encode-141"><span class="linenos">141</span></a>
</span><span id="fourier_encode-142"><a href="#fourier_encode-142"><span class="linenos">142</span></a><span class="sd">    .. math::</span>
</span><span id="fourier_encode-143"><a href="#fourier_encode-143"><span class="linenos">143</span></a>
</span><span id="fourier_encode-144"><a href="#fourier_encode-144"><span class="linenos">144</span></a><span class="sd">        \begin{aligned}</span>
</span><span id="fourier_encode-145"><a href="#fourier_encode-145"><span class="linenos">145</span></a><span class="sd">        s_k &amp;= x \cdot 0.5^k \\\\</span>
</span><span id="fourier_encode-146"><a href="#fourier_encode-146"><span class="linenos">146</span></a><span class="sd">        \mathbf{y} &amp;= \left[\sin(s_0), \dots, \sin(s_{\lfloor\text{num}/2\rfloor-1}),</span>
</span><span id="fourier_encode-147"><a href="#fourier_encode-147"><span class="linenos">147</span></a><span class="sd">                            \cos(s_0), \dots, \cos(s_{\lfloor\text{num}/2\rfloor-1}), x\right]</span>
</span><span id="fourier_encode-148"><a href="#fourier_encode-148"><span class="linenos">148</span></a><span class="sd">        \end{aligned}</span>
</span><span id="fourier_encode-149"><a href="#fourier_encode-149"><span class="linenos">149</span></a><span class="sd">                             </span>
</span><span id="fourier_encode-150"><a href="#fourier_encode-150"><span class="linenos">150</span></a><span class="sd">    Arguments:</span>
</span><span id="fourier_encode-151"><a href="#fourier_encode-151"><span class="linenos">151</span></a><span class="sd">        x: Value from which the fourier features should be computed.</span>
</span><span id="fourier_encode-152"><a href="#fourier_encode-152"><span class="linenos">152</span></a><span class="sd">        num: Number of fourier features that should be computed.</span>
</span><span id="fourier_encode-153"><a href="#fourier_encode-153"><span class="linenos">153</span></a>
</span><span id="fourier_encode-154"><a href="#fourier_encode-154"><span class="linenos">154</span></a><span class="sd">    Returns:</span>
</span><span id="fourier_encode-155"><a href="#fourier_encode-155"><span class="linenos">155</span></a><span class="sd">        Fourier features of `x`.</span>
</span><span id="fourier_encode-156"><a href="#fourier_encode-156"><span class="linenos">156</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fourier_encode-157"><a href="#fourier_encode-157"><span class="linenos">157</span></a>
</span><span id="fourier_encode-158"><a href="#fourier_encode-158"><span class="linenos">158</span></a>    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="fourier_encode-159"><a href="#fourier_encode-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="fourier_encode-160"><a href="#fourier_encode-160"><span class="linenos">160</span></a>
</span><span id="fourier_encode-161"><a href="#fourier_encode-161"><span class="linenos">161</span></a>    <span class="n">k</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="fourier_encode-162"><a href="#fourier_encode-162"><span class="linenos">162</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="fourier_encode-163"><a href="#fourier_encode-163"><span class="linenos">163</span></a>
</span><span id="fourier_encode-164"><a href="#fourier_encode-164"><span class="linenos">164</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.5</span><span class="o">**</span><span class="n">k</span>
</span><span id="fourier_encode-165"><a href="#fourier_encode-165"><span class="linenos">165</span></a>
</span><span id="fourier_encode-166"><a href="#fourier_encode-166"><span class="linenos">166</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">sin</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">cos</span><span class="p">()]</span>
</span><span id="fourier_encode-167"><a href="#fourier_encode-167"><span class="linenos">167</span></a>    <span class="k">if</span> <span class="n">num</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="fourier_encode-168"><a href="#fourier_encode-168"><span class="linenos">168</span></a>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="fourier_encode-169"><a href="#fourier_encode-169"><span class="linenos">169</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="fourier_encode-170"><a href="#fourier_encode-170"><span class="linenos">170</span></a>
</span><span id="fourier_encode-171"><a href="#fourier_encode-171"><span class="linenos">171</span></a>    <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Encodes <code>x</code> to be represented by a vector of fourier features.</p>

<p>Depending on whether <code>num</code> is even or odd, the vector of encoded features
will also contain <code>x</code> itself: if even, <code>x</code> is not included, if odd <code>x</code> is
included.</p>

<p>Assuming <code>num</code> is odd, the features \( y \) look as follows:</p>

<p>$$\begin{aligned}
s_k &amp;= x \cdot 0.5^k \\
\mathbf{y} &amp;= \left[\sin(s_0), \dots, \sin(s_{\lfloor\text{num}/2\rfloor-1}),
                    \cos(s_0), \dots, \cos(s_{\lfloor\text{num}/2\rfloor-1}), x\right]
\end{aligned}$$</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x:</strong>  Value from which the fourier features should be computed.</li>
<li><strong>num:</strong>  Number of fourier features that should be computed.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Fourier features of <code>x</code>.</p>
</blockquote>
</div>


                </section>
                <section id="Apply">
                            <input id="Apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Apply</span><wbr>(<span class="base">torch.nn.modules.module.Module</span>):

                <label class="view-source-button" for="Apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Apply-174"><a href="#Apply-174"><span class="linenos">174</span></a><span class="k">class</span> <span class="nc">Apply</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="Apply-175"><a href="#Apply-175"><span class="linenos">175</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply Module.</span>
</span><span id="Apply-176"><a href="#Apply-176"><span class="linenos">176</span></a>
</span><span id="Apply-177"><a href="#Apply-177"><span class="linenos">177</span></a><span class="sd">    Applies :func:`fn` to an input and returns the result.</span>
</span><span id="Apply-178"><a href="#Apply-178"><span class="linenos">178</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Apply-179"><a href="#Apply-179"><span class="linenos">179</span></a>
</span><span id="Apply-180"><a href="#Apply-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Apply-181"><a href="#Apply-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Apply-182"><a href="#Apply-182"><span class="linenos">182</span></a><span class="sd">        Arguments:</span>
</span><span id="Apply-183"><a href="#Apply-183"><span class="linenos">183</span></a><span class="sd">            fn: Function that should be applied.</span>
</span><span id="Apply-184"><a href="#Apply-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply-185"><a href="#Apply-185"><span class="linenos">185</span></a>
</span><span id="Apply-186"><a href="#Apply-186"><span class="linenos">186</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Apply-187"><a href="#Apply-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
</span><span id="Apply-188"><a href="#Apply-188"><span class="linenos">188</span></a>
</span><span id="Apply-189"><a href="#Apply-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Apply-190"><a href="#Apply-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the representation of :func:`fn`.</span>
</span><span id="Apply-191"><a href="#Apply-191"><span class="linenos">191</span></a>
</span><span id="Apply-192"><a href="#Apply-192"><span class="linenos">192</span></a><span class="sd">        Returns:</span>
</span><span id="Apply-193"><a href="#Apply-193"><span class="linenos">193</span></a><span class="sd">            Representation of :func:`fn`.</span>
</span><span id="Apply-194"><a href="#Apply-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply-195"><a href="#Apply-195"><span class="linenos">195</span></a>
</span><span id="Apply-196"><a href="#Apply-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
</span><span id="Apply-197"><a href="#Apply-197"><span class="linenos">197</span></a>
</span><span id="Apply-198"><a href="#Apply-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Apply-199"><a href="#Apply-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call :func:`fn` on `input` and return result.</span>
</span><span id="Apply-200"><a href="#Apply-200"><span class="linenos">200</span></a>
</span><span id="Apply-201"><a href="#Apply-201"><span class="linenos">201</span></a><span class="sd">        Arguments:</span>
</span><span id="Apply-202"><a href="#Apply-202"><span class="linenos">202</span></a><span class="sd">            x: Input for :func:`fn`.</span>
</span><span id="Apply-203"><a href="#Apply-203"><span class="linenos">203</span></a>
</span><span id="Apply-204"><a href="#Apply-204"><span class="linenos">204</span></a><span class="sd">        Returns:</span>
</span><span id="Apply-205"><a href="#Apply-205"><span class="linenos">205</span></a><span class="sd">            Result of `fn(input)`.</span>
</span><span id="Apply-206"><a href="#Apply-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply-207"><a href="#Apply-207"><span class="linenos">207</span></a>
</span><span id="Apply-208"><a href="#Apply-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply Module.</p>

<p>Applies <code><a href="#Apply.fn">fn()</a></code> to an input and returns the result.</p>
</div>


                            <div id="Apply.__init__" class="classattr">
                                        <input id="Apply.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Apply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="Apply.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Apply.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Apply.__init__-180"><a href="#Apply.__init__-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Apply.__init__-181"><a href="#Apply.__init__-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Apply.__init__-182"><a href="#Apply.__init__-182"><span class="linenos">182</span></a><span class="sd">        Arguments:</span>
</span><span id="Apply.__init__-183"><a href="#Apply.__init__-183"><span class="linenos">183</span></a><span class="sd">            fn: Function that should be applied.</span>
</span><span id="Apply.__init__-184"><a href="#Apply.__init__-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply.__init__-185"><a href="#Apply.__init__-185"><span class="linenos">185</span></a>
</span><span id="Apply.__init__-186"><a href="#Apply.__init__-186"><span class="linenos">186</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Apply.__init__-187"><a href="#Apply.__init__-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fn:</strong>  Function that should be applied.</li>
</ul>
</div>


                            </div>
                            <div id="Apply.fn" class="classattr">
                                <div class="attr variable">
            <span class="name">fn</span>

        
    </div>
    <a class="headerlink" href="#Apply.fn"></a>
    
    

                            </div>
                            <div id="Apply.extra_repr" class="classattr">
                                        <input id="Apply.extra_repr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extra_repr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Apply.extra_repr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Apply.extra_repr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Apply.extra_repr-189"><a href="#Apply.extra_repr-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Apply.extra_repr-190"><a href="#Apply.extra_repr-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the representation of :func:`fn`.</span>
</span><span id="Apply.extra_repr-191"><a href="#Apply.extra_repr-191"><span class="linenos">191</span></a>
</span><span id="Apply.extra_repr-192"><a href="#Apply.extra_repr-192"><span class="linenos">192</span></a><span class="sd">        Returns:</span>
</span><span id="Apply.extra_repr-193"><a href="#Apply.extra_repr-193"><span class="linenos">193</span></a><span class="sd">            Representation of :func:`fn`.</span>
</span><span id="Apply.extra_repr-194"><a href="#Apply.extra_repr-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply.extra_repr-195"><a href="#Apply.extra_repr-195"><span class="linenos">195</span></a>
</span><span id="Apply.extra_repr-196"><a href="#Apply.extra_repr-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the representation of <code><a href="#Apply.fn">fn()</a></code>.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Representation of <code><a href="#Apply.fn">fn()</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="Apply.forward" class="classattr">
                                        <input id="Apply.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">input</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="Apply.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Apply.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Apply.forward-198"><a href="#Apply.forward-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Apply.forward-199"><a href="#Apply.forward-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call :func:`fn` on `input` and return result.</span>
</span><span id="Apply.forward-200"><a href="#Apply.forward-200"><span class="linenos">200</span></a>
</span><span id="Apply.forward-201"><a href="#Apply.forward-201"><span class="linenos">201</span></a><span class="sd">        Arguments:</span>
</span><span id="Apply.forward-202"><a href="#Apply.forward-202"><span class="linenos">202</span></a><span class="sd">            x: Input for :func:`fn`.</span>
</span><span id="Apply.forward-203"><a href="#Apply.forward-203"><span class="linenos">203</span></a>
</span><span id="Apply.forward-204"><a href="#Apply.forward-204"><span class="linenos">204</span></a><span class="sd">        Returns:</span>
</span><span id="Apply.forward-205"><a href="#Apply.forward-205"><span class="linenos">205</span></a><span class="sd">            Result of `fn(input)`.</span>
</span><span id="Apply.forward-206"><a href="#Apply.forward-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Apply.forward-207"><a href="#Apply.forward-207"><span class="linenos">207</span></a>
</span><span id="Apply.forward-208"><a href="#Apply.forward-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Call <code><a href="#Apply.fn">fn()</a></code> on <code>input</code> and return result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x:</strong>  Input for <code><a href="#Apply.fn">fn()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Result of <code>fn(input)</code>.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="Apply.dump_patches" class="variable">dump_patches</dd>
                <dd id="Apply.training" class="variable">training</dd>
                <dd id="Apply.call_super_init" class="variable">call_super_init</dd>
                <dd id="Apply.register_buffer" class="function">register_buffer</dd>
                <dd id="Apply.register_parameter" class="function">register_parameter</dd>
                <dd id="Apply.add_module" class="function">add_module</dd>
                <dd id="Apply.register_module" class="function">register_module</dd>
                <dd id="Apply.get_submodule" class="function">get_submodule</dd>
                <dd id="Apply.get_parameter" class="function">get_parameter</dd>
                <dd id="Apply.get_buffer" class="function">get_buffer</dd>
                <dd id="Apply.get_extra_state" class="function">get_extra_state</dd>
                <dd id="Apply.set_extra_state" class="function">set_extra_state</dd>
                <dd id="Apply.apply" class="function">apply</dd>
                <dd id="Apply.cuda" class="function">cuda</dd>
                <dd id="Apply.ipu" class="function">ipu</dd>
                <dd id="Apply.xpu" class="function">xpu</dd>
                <dd id="Apply.cpu" class="function">cpu</dd>
                <dd id="Apply.type" class="function">type</dd>
                <dd id="Apply.float" class="function">float</dd>
                <dd id="Apply.double" class="function">double</dd>
                <dd id="Apply.half" class="function">half</dd>
                <dd id="Apply.bfloat16" class="function">bfloat16</dd>
                <dd id="Apply.to_empty" class="function">to_empty</dd>
                <dd id="Apply.to" class="function">to</dd>
                <dd id="Apply.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="Apply.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="Apply.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="Apply.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="Apply.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="Apply.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="Apply.state_dict" class="function">state_dict</dd>
                <dd id="Apply.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="Apply.load_state_dict" class="function">load_state_dict</dd>
                <dd id="Apply.parameters" class="function">parameters</dd>
                <dd id="Apply.named_parameters" class="function">named_parameters</dd>
                <dd id="Apply.buffers" class="function">buffers</dd>
                <dd id="Apply.named_buffers" class="function">named_buffers</dd>
                <dd id="Apply.children" class="function">children</dd>
                <dd id="Apply.named_children" class="function">named_children</dd>
                <dd id="Apply.modules" class="function">modules</dd>
                <dd id="Apply.named_modules" class="function">named_modules</dd>
                <dd id="Apply.train" class="function">train</dd>
                <dd id="Apply.eval" class="function">eval</dd>
                <dd id="Apply.requires_grad_" class="function">requires_grad_</dd>
                <dd id="Apply.zero_grad" class="function">zero_grad</dd>
                <dd id="Apply.share_memory" class="function">share_memory</dd>
                <dd id="Apply.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="EGNN">
                            <input id="EGNN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EGNN</span><wbr>(<span class="base">torch_geometric.nn.conv.message_passing.MessagePassing</span>):

                <label class="view-source-button" for="EGNN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN-211"><a href="#EGNN-211"><span class="linenos">211</span></a><span class="k">class</span> <span class="nc">EGNN</span><span class="p">(</span><span class="n">gnn</span><span class="o">.</span><span class="n">MessagePassing</span><span class="p">):</span>
</span><span id="EGNN-212"><a href="#EGNN-212"><span class="linenos">212</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;E(n) Equivariant Graph Neural Network.</span>
</span><span id="EGNN-213"><a href="#EGNN-213"><span class="linenos">213</span></a>
</span><span id="EGNN-214"><a href="#EGNN-214"><span class="linenos">214</span></a><span class="sd">    Implementation of an E(n) Equivariant Graph Neural Network as described in</span>
</span><span id="EGNN-215"><a href="#EGNN-215"><span class="linenos">215</span></a><span class="sd">    [1]_ that supports multiple node coordinates. This way we can encode</span>
</span><span id="EGNN-216"><a href="#EGNN-216"><span class="linenos">216</span></a><span class="sd">    different spatial features as coordinate; e.g., vectors that originate from</span>
</span><span id="EGNN-217"><a href="#EGNN-217"><span class="linenos">217</span></a><span class="sd">    a single node.</span>
</span><span id="EGNN-218"><a href="#EGNN-218"><span class="linenos">218</span></a>
</span><span id="EGNN-219"><a href="#EGNN-219"><span class="linenos">219</span></a><span class="sd">    Node features are usually two-dimensional tensors of the size :math:`(N, F)`,</span>
</span><span id="EGNN-220"><a href="#EGNN-220"><span class="linenos">220</span></a><span class="sd">    with :math:`N` being the number of nodes and :math:`F` the number of</span>
</span><span id="EGNN-221"><a href="#EGNN-221"><span class="linenos">221</span></a><span class="sd">    features.</span>
</span><span id="EGNN-222"><a href="#EGNN-222"><span class="linenos">222</span></a>
</span><span id="EGNN-223"><a href="#EGNN-223"><span class="linenos">223</span></a><span class="sd">    Similarly, coordinates have the size :math:`(N, D)` with :math:`D` being the</span>
</span><span id="EGNN-224"><a href="#EGNN-224"><span class="linenos">224</span></a><span class="sd">    dimension of the coordinate space. Alternatively, to encode multiple</span>
</span><span id="EGNN-225"><a href="#EGNN-225"><span class="linenos">225</span></a><span class="sd">    coordinates per node, the coordinates can be :math:`(N, C, D)` with</span>
</span><span id="EGNN-226"><a href="#EGNN-226"><span class="linenos">226</span></a><span class="sd">    :math:`C` as the number of individual coordinates per node.</span>
</span><span id="EGNN-227"><a href="#EGNN-227"><span class="linenos">227</span></a>
</span><span id="EGNN-228"><a href="#EGNN-228"><span class="linenos">228</span></a><span class="sd">    Edge features are optional and have the size :math:`(E, G)` with :math:`E`</span>
</span><span id="EGNN-229"><a href="#EGNN-229"><span class="linenos">229</span></a><span class="sd">    as the number of edges and :math:`G` as the number of edge features.</span>
</span><span id="EGNN-230"><a href="#EGNN-230"><span class="linenos">230</span></a>
</span><span id="EGNN-231"><a href="#EGNN-231"><span class="linenos">231</span></a><span class="sd">    Example:</span>
</span><span id="EGNN-232"><a href="#EGNN-232"><span class="linenos">232</span></a><span class="sd">        EGNN instance with 16 input and 32 output features and two coordinates</span>
</span><span id="EGNN-233"><a href="#EGNN-233"><span class="linenos">233</span></a><span class="sd">        per node.</span>
</span><span id="EGNN-234"><a href="#EGNN-234"><span class="linenos">234</span></a>
</span><span id="EGNN-235"><a href="#EGNN-235"><span class="linenos">235</span></a><span class="sd">        &gt;&gt;&gt; from bpp.model.egnn import EGNN</span>
</span><span id="EGNN-236"><a href="#EGNN-236"><span class="linenos">236</span></a><span class="sd">        &gt;&gt;&gt; fn = EGNN(</span>
</span><span id="EGNN-237"><a href="#EGNN-237"><span class="linenos">237</span></a><span class="sd">        ...     dims_node=(16, 64, 32),</span>
</span><span id="EGNN-238"><a href="#EGNN-238"><span class="linenos">238</span></a><span class="sd">        ...     dims_edge=(0, 64, 16),</span>
</span><span id="EGNN-239"><a href="#EGNN-239"><span class="linenos">239</span></a><span class="sd">        ...     dims_pos=(32,),</span>
</span><span id="EGNN-240"><a href="#EGNN-240"><span class="linenos">240</span></a><span class="sd">        ...     num_pos=2,</span>
</span><span id="EGNN-241"><a href="#EGNN-241"><span class="linenos">241</span></a><span class="sd">        )</span>
</span><span id="EGNN-242"><a href="#EGNN-242"><span class="linenos">242</span></a><span class="sd">        &gt;&gt;&gt; fn</span>
</span><span id="EGNN-243"><a href="#EGNN-243"><span class="linenos">243</span></a><span class="sd">        EGNN(</span>
</span><span id="EGNN-244"><a href="#EGNN-244"><span class="linenos">244</span></a><span class="sd">          (aggr_mean): MeanAggregation()</span>
</span><span id="EGNN-245"><a href="#EGNN-245"><span class="linenos">245</span></a><span class="sd">          (aggr_sum): SumAggregation()</span>
</span><span id="EGNN-246"><a href="#EGNN-246"><span class="linenos">246</span></a><span class="sd">          (edge_net): Sequential(</span>
</span><span id="EGNN-247"><a href="#EGNN-247"><span class="linenos">247</span></a><span class="sd">            (0): Linear(in_features=34, out_features=64, bias=True)</span>
</span><span id="EGNN-248"><a href="#EGNN-248"><span class="linenos">248</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="EGNN-249"><a href="#EGNN-249"><span class="linenos">249</span></a><span class="sd">            (2): Linear(in_features=64, out_features=16, bias=True)</span>
</span><span id="EGNN-250"><a href="#EGNN-250"><span class="linenos">250</span></a><span class="sd">            (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="EGNN-251"><a href="#EGNN-251"><span class="linenos">251</span></a><span class="sd">          )</span>
</span><span id="EGNN-252"><a href="#EGNN-252"><span class="linenos">252</span></a><span class="sd">          (node_net): Sequential(</span>
</span><span id="EGNN-253"><a href="#EGNN-253"><span class="linenos">253</span></a><span class="sd">            (0): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="EGNN-254"><a href="#EGNN-254"><span class="linenos">254</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="EGNN-255"><a href="#EGNN-255"><span class="linenos">255</span></a><span class="sd">            (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="EGNN-256"><a href="#EGNN-256"><span class="linenos">256</span></a><span class="sd">          )</span>
</span><span id="EGNN-257"><a href="#EGNN-257"><span class="linenos">257</span></a><span class="sd">          (pos_net): Sequential(</span>
</span><span id="EGNN-258"><a href="#EGNN-258"><span class="linenos">258</span></a><span class="sd">            (0): Linear(in_features=16, out_features=32, bias=True)</span>
</span><span id="EGNN-259"><a href="#EGNN-259"><span class="linenos">259</span></a><span class="sd">            (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="EGNN-260"><a href="#EGNN-260"><span class="linenos">260</span></a><span class="sd">            (2): Linear(in_features=32, out_features=2, bias=True)</span>
</span><span id="EGNN-261"><a href="#EGNN-261"><span class="linenos">261</span></a><span class="sd">          )</span>
</span><span id="EGNN-262"><a href="#EGNN-262"><span class="linenos">262</span></a><span class="sd">        )</span>
</span><span id="EGNN-263"><a href="#EGNN-263"><span class="linenos">263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EGNN-264"><a href="#EGNN-264"><span class="linenos">264</span></a>
</span><span id="EGNN-265"><a href="#EGNN-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EGNN-266"><a href="#EGNN-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN-267"><a href="#EGNN-267"><span class="linenos">267</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="EGNN-268"><a href="#EGNN-268"><span class="linenos">268</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="EGNN-269"><a href="#EGNN-269"><span class="linenos">269</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="EGNN-270"><a href="#EGNN-270"><span class="linenos">270</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="EGNN-271"><a href="#EGNN-271"><span class="linenos">271</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN-272"><a href="#EGNN-272"><span class="linenos">272</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN-273"><a href="#EGNN-273"><span class="linenos">273</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="EGNN-274"><a href="#EGNN-274"><span class="linenos">274</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EGNN-275"><a href="#EGNN-275"><span class="linenos">275</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="EGNN-276"><a href="#EGNN-276"><span class="linenos">276</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="EGNN-277"><a href="#EGNN-277"><span class="linenos">277</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-278"><a href="#EGNN-278"><span class="linenos">278</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-279"><a href="#EGNN-279"><span class="linenos">279</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="EGNN-280"><a href="#EGNN-280"><span class="linenos">280</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="EGNN-281"><a href="#EGNN-281"><span class="linenos">281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-282"><a href="#EGNN-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EGNN-283"><a href="#EGNN-283"><span class="linenos">283</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN-284"><a href="#EGNN-284"><span class="linenos">284</span></a><span class="sd">            dims_node: Dimensions for the node network: `dims_node[0]` is the</span>
</span><span id="EGNN-285"><a href="#EGNN-285"><span class="linenos">285</span></a><span class="sd">                number of input features and `dims_node[-1]` is the number of</span>
</span><span id="EGNN-286"><a href="#EGNN-286"><span class="linenos">286</span></a><span class="sd">                output features.  At least 2 dimensions are required. All</span>
</span><span id="EGNN-287"><a href="#EGNN-287"><span class="linenos">287</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the</span>
</span><span id="EGNN-288"><a href="#EGNN-288"><span class="linenos">288</span></a><span class="sd">                network.</span>
</span><span id="EGNN-289"><a href="#EGNN-289"><span class="linenos">289</span></a><span class="sd">            dims_edge: Dimensions for the edge network: `dims_edge[0]` is the</span>
</span><span id="EGNN-290"><a href="#EGNN-290"><span class="linenos">290</span></a><span class="sd">                number of edge features (0 if graphs have no edge features),</span>
</span><span id="EGNN-291"><a href="#EGNN-291"><span class="linenos">291</span></a><span class="sd">                `dims_edge[-1]` is the number of message features.  All</span>
</span><span id="EGNN-292"><a href="#EGNN-292"><span class="linenos">292</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="EGNN-293"><a href="#EGNN-293"><span class="linenos">293</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="EGNN-294"><a href="#EGNN-294"><span class="linenos">294</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="EGNN-295"><a href="#EGNN-295"><span class="linenos">295</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="EGNN-296"><a href="#EGNN-296"><span class="linenos">296</span></a><span class="sd">                will be disabled.</span>
</span><span id="EGNN-297"><a href="#EGNN-297"><span class="linenos">297</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="EGNN-298"><a href="#EGNN-298"><span class="linenos">298</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="EGNN-299"><a href="#EGNN-299"><span class="linenos">299</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="EGNN-300"><a href="#EGNN-300"><span class="linenos">300</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="EGNN-301"><a href="#EGNN-301"><span class="linenos">301</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="EGNN-302"><a href="#EGNN-302"><span class="linenos">302</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="EGNN-303"><a href="#EGNN-303"><span class="linenos">303</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="EGNN-304"><a href="#EGNN-304"><span class="linenos">304</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="EGNN-305"><a href="#EGNN-305"><span class="linenos">305</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="EGNN-306"><a href="#EGNN-306"><span class="linenos">306</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="EGNN-307"><a href="#EGNN-307"><span class="linenos">307</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="EGNN-308"><a href="#EGNN-308"><span class="linenos">308</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="EGNN-309"><a href="#EGNN-309"><span class="linenos">309</span></a><span class="sd">                0, the penultimate layer of the coordinate update network will</span>
</span><span id="EGNN-310"><a href="#EGNN-310"><span class="linenos">310</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="EGNN-311"><a href="#EGNN-311"><span class="linenos">311</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="EGNN-312"><a href="#EGNN-312"><span class="linenos">312</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="EGNN-313"><a href="#EGNN-313"><span class="linenos">313</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="EGNN-314"><a href="#EGNN-314"><span class="linenos">314</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="EGNN-315"><a href="#EGNN-315"><span class="linenos">315</span></a><span class="sd">            dropout: Dropout probability in-between network layers. No dropout</span>
</span><span id="EGNN-316"><a href="#EGNN-316"><span class="linenos">316</span></a><span class="sd">                if 0.</span>
</span><span id="EGNN-317"><a href="#EGNN-317"><span class="linenos">317</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="EGNN-318"><a href="#EGNN-318"><span class="linenos">318</span></a><span class="sd">                layers.</span>
</span><span id="EGNN-319"><a href="#EGNN-319"><span class="linenos">319</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="EGNN-320"><a href="#EGNN-320"><span class="linenos">320</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="EGNN-321"><a href="#EGNN-321"><span class="linenos">321</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="EGNN-322"><a href="#EGNN-322"><span class="linenos">322</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="EGNN-323"><a href="#EGNN-323"><span class="linenos">323</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="EGNN-324"><a href="#EGNN-324"><span class="linenos">324</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="EGNN-325"><a href="#EGNN-325"><span class="linenos">325</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="EGNN-326"><a href="#EGNN-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-327"><a href="#EGNN-327"><span class="linenos">327</span></a>
</span><span id="EGNN-328"><a href="#EGNN-328"><span class="linenos">328</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_node</span><span class="p">:</span>
</span><span id="EGNN-329"><a href="#EGNN-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-330"><a href="#EGNN-330"><span class="linenos">330</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-331"><a href="#EGNN-331"><span class="linenos">331</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_node must be larger than 0, but one &quot;</span>
</span><span id="EGNN-332"><a href="#EGNN-332"><span class="linenos">332</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-333"><a href="#EGNN-333"><span class="linenos">333</span></a>                <span class="p">)</span>
</span><span id="EGNN-334"><a href="#EGNN-334"><span class="linenos">334</span></a>
</span><span id="EGNN-335"><a href="#EGNN-335"><span class="linenos">335</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="EGNN-336"><a href="#EGNN-336"><span class="linenos">336</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-337"><a href="#EGNN-337"><span class="linenos">337</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-338"><a href="#EGNN-338"><span class="linenos">338</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_gate must be larger than 0, bot one &quot;</span>
</span><span id="EGNN-339"><a href="#EGNN-339"><span class="linenos">339</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-340"><a href="#EGNN-340"><span class="linenos">340</span></a>                <span class="p">)</span>
</span><span id="EGNN-341"><a href="#EGNN-341"><span class="linenos">341</span></a>
</span><span id="EGNN-342"><a href="#EGNN-342"><span class="linenos">342</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="EGNN-343"><a href="#EGNN-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-344"><a href="#EGNN-344"><span class="linenos">344</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-345"><a href="#EGNN-345"><span class="linenos">345</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_pos must be larger than 0, bot one &quot;</span>
</span><span id="EGNN-346"><a href="#EGNN-346"><span class="linenos">346</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-347"><a href="#EGNN-347"><span class="linenos">347</span></a>                <span class="p">)</span>
</span><span id="EGNN-348"><a href="#EGNN-348"><span class="linenos">348</span></a>
</span><span id="EGNN-349"><a href="#EGNN-349"><span class="linenos">349</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="EGNN-350"><a href="#EGNN-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-351"><a href="#EGNN-351"><span class="linenos">351</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-352"><a href="#EGNN-352"><span class="linenos">352</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_edge, with the exception of the first &quot;</span>
</span><span id="EGNN-353"><a href="#EGNN-353"><span class="linenos">353</span></a>                    <span class="sa">f</span><span class="s2">&quot;one, must be larger than 0, but one dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-354"><a href="#EGNN-354"><span class="linenos">354</span></a>                <span class="p">)</span>
</span><span id="EGNN-355"><a href="#EGNN-355"><span class="linenos">355</span></a>
</span><span id="EGNN-356"><a href="#EGNN-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN-357"><a href="#EGNN-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-358"><a href="#EGNN-358"><span class="linenos">358</span></a>                <span class="sa">f</span><span class="s2">&quot;first dimension in dims_edge cannot be negative, but got &quot;</span>
</span><span id="EGNN-359"><a href="#EGNN-359"><span class="linenos">359</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-360"><a href="#EGNN-360"><span class="linenos">360</span></a>            <span class="p">)</span>
</span><span id="EGNN-361"><a href="#EGNN-361"><span class="linenos">361</span></a>
</span><span id="EGNN-362"><a href="#EGNN-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EGNN-363"><a href="#EGNN-363"><span class="linenos">363</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-364"><a href="#EGNN-364"><span class="linenos">364</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_node is 2, but got &quot;</span>
</span><span id="EGNN-365"><a href="#EGNN-365"><span class="linenos">365</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-366"><a href="#EGNN-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="EGNN-367"><a href="#EGNN-367"><span class="linenos">367</span></a>
</span><span id="EGNN-368"><a href="#EGNN-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EGNN-369"><a href="#EGNN-369"><span class="linenos">369</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-370"><a href="#EGNN-370"><span class="linenos">370</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_edge is 2, but got &quot;</span>
</span><span id="EGNN-371"><a href="#EGNN-371"><span class="linenos">371</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-372"><a href="#EGNN-372"><span class="linenos">372</span></a>            <span class="p">)</span>
</span><span id="EGNN-373"><a href="#EGNN-373"><span class="linenos">373</span></a>
</span><span id="EGNN-374"><a href="#EGNN-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">num_pos</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-375"><a href="#EGNN-375"><span class="linenos">375</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-376"><a href="#EGNN-376"><span class="linenos">376</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of positional coordinates is 1, but got </span><span class="si">{</span><span class="n">num_pos</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-377"><a href="#EGNN-377"><span class="linenos">377</span></a>            <span class="p">)</span>
</span><span id="EGNN-378"><a href="#EGNN-378"><span class="linenos">378</span></a>
</span><span id="EGNN-379"><a href="#EGNN-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">num_encode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN-380"><a href="#EGNN-380"><span class="linenos">380</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN-381"><a href="#EGNN-381"><span class="linenos">381</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of fourier-encoded features for positional &quot;</span>
</span><span id="EGNN-382"><a href="#EGNN-382"><span class="linenos">382</span></a>                <span class="sa">f</span><span class="s2">&quot;coordinates is 1, but got </span><span class="si">{</span><span class="n">num_encode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN-383"><a href="#EGNN-383"><span class="linenos">383</span></a>            <span class="p">)</span>
</span><span id="EGNN-384"><a href="#EGNN-384"><span class="linenos">384</span></a>
</span><span id="EGNN-385"><a href="#EGNN-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">clamp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN-386"><a href="#EGNN-386"><span class="linenos">386</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clamp value must be positive, but got </span><span class="si">{</span><span class="n">clamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EGNN-387"><a href="#EGNN-387"><span class="linenos">387</span></a>
</span><span id="EGNN-388"><a href="#EGNN-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="n">dropout</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN-389"><a href="#EGNN-389"><span class="linenos">389</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dropout value must be positive, but got </span><span class="si">{</span><span class="n">dropout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EGNN-390"><a href="#EGNN-390"><span class="linenos">390</span></a>
</span><span id="EGNN-391"><a href="#EGNN-391"><span class="linenos">391</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN-392"><a href="#EGNN-392"><span class="linenos">392</span></a>
</span><span id="EGNN-393"><a href="#EGNN-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">MeanAggregation</span><span class="p">()</span>
</span><span id="EGNN-394"><a href="#EGNN-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">SumAggregation</span><span class="p">()</span>
</span><span id="EGNN-395"><a href="#EGNN-395"><span class="linenos">395</span></a>
</span><span id="EGNN-396"><a href="#EGNN-396"><span class="linenos">396</span></a>        <span class="n">update</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">num_pos</span>
</span><span id="EGNN-397"><a href="#EGNN-397"><span class="linenos">397</span></a>        <span class="n">gate</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_gate</span><span class="p">)</span>
</span><span id="EGNN-398"><a href="#EGNN-398"><span class="linenos">398</span></a>
</span><span id="EGNN-399"><a href="#EGNN-399"><span class="linenos">399</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN-400"><a href="#EGNN-400"><span class="linenos">400</span></a>            <span class="p">(</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">num_pos</span> <span class="o">*</span> <span class="n">num_encode</span><span class="p">),</span>
</span><span id="EGNN-401"><a href="#EGNN-401"><span class="linenos">401</span></a>            <span class="o">*</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="EGNN-402"><a href="#EGNN-402"><span class="linenos">402</span></a>        <span class="p">)</span>
</span><span id="EGNN-403"><a href="#EGNN-403"><span class="linenos">403</span></a>
</span><span id="EGNN-404"><a href="#EGNN-404"><span class="linenos">404</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN-405"><a href="#EGNN-405"><span class="linenos">405</span></a>            <span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="EGNN-406"><a href="#EGNN-406"><span class="linenos">406</span></a>            <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="EGNN-407"><a href="#EGNN-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span><span id="EGNN-408"><a href="#EGNN-408"><span class="linenos">408</span></a>
</span><span id="EGNN-409"><a href="#EGNN-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="EGNN-410"><a href="#EGNN-410"><span class="linenos">410</span></a>            <span class="n">dims_pos</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN-411"><a href="#EGNN-411"><span class="linenos">411</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="EGNN-412"><a href="#EGNN-412"><span class="linenos">412</span></a>                <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="EGNN-413"><a href="#EGNN-413"><span class="linenos">413</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="EGNN-414"><a href="#EGNN-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="EGNN-415"><a href="#EGNN-415"><span class="linenos">415</span></a>
</span><span id="EGNN-416"><a href="#EGNN-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="EGNN-417"><a href="#EGNN-417"><span class="linenos">417</span></a>            <span class="n">dims_gate</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN-418"><a href="#EGNN-418"><span class="linenos">418</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="EGNN-419"><a href="#EGNN-419"><span class="linenos">419</span></a>                <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="EGNN-420"><a href="#EGNN-420"><span class="linenos">420</span></a>                <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN-421"><a href="#EGNN-421"><span class="linenos">421</span></a>            <span class="p">)</span>
</span><span id="EGNN-422"><a href="#EGNN-422"><span class="linenos">422</span></a>
</span><span id="EGNN-423"><a href="#EGNN-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span>
</span><span id="EGNN-424"><a href="#EGNN-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_edge</span> <span class="o">=</span> <span class="n">dims_edge</span>
</span><span id="EGNN-425"><a href="#EGNN-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_gate</span> <span class="o">=</span> <span class="n">dims_gate</span>
</span><span id="EGNN-426"><a href="#EGNN-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_pos</span> <span class="o">=</span> <span class="n">dims_pos</span>
</span><span id="EGNN-427"><a href="#EGNN-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_pos</span> <span class="o">=</span> <span class="n">num_pos</span>
</span><span id="EGNN-428"><a href="#EGNN-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span> <span class="o">=</span> <span class="n">num_encode</span>
</span><span id="EGNN-429"><a href="#EGNN-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_pos</span> <span class="o">=</span> <span class="n">update</span>
</span><span id="EGNN-430"><a href="#EGNN-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gate_msg</span> <span class="o">=</span> <span class="n">gate</span>
</span><span id="EGNN-431"><a href="#EGNN-431"><span class="linenos">431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">norm</span>
</span><span id="EGNN-432"><a href="#EGNN-432"><span class="linenos">432</span></a>
</span><span id="EGNN-433"><a href="#EGNN-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-434"><a href="#EGNN-434"><span class="linenos">434</span></a>            <span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(</span><span class="n">approximate</span><span class="o">=</span><span class="s2">&quot;tanh&quot;</span><span class="p">)</span>
</span><span id="EGNN-435"><a href="#EGNN-435"><span class="linenos">435</span></a>
</span><span id="EGNN-436"><a href="#EGNN-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-437"><a href="#EGNN-437"><span class="linenos">437</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="EGNN-438"><a href="#EGNN-438"><span class="linenos">438</span></a>
</span><span id="EGNN-439"><a href="#EGNN-439"><span class="linenos">439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="EGNN-440"><a href="#EGNN-440"><span class="linenos">440</span></a>
</span><span id="EGNN-441"><a href="#EGNN-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">):</span>
</span><span id="EGNN-442"><a href="#EGNN-442"><span class="linenos">442</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">activation</span><span class="p">]</span>
</span><span id="EGNN-443"><a href="#EGNN-443"><span class="linenos">443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-444"><a href="#EGNN-444"><span class="linenos">444</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EGNN-445"><a href="#EGNN-445"><span class="linenos">445</span></a>
</span><span id="EGNN-446"><a href="#EGNN-446"><span class="linenos">446</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN-447"><a href="#EGNN-447"><span class="linenos">447</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN-448"><a href="#EGNN-448"><span class="linenos">448</span></a>                <span class="o">*</span><span class="n">dims_edge</span><span class="p">,</span>
</span><span id="EGNN-449"><a href="#EGNN-449"><span class="linenos">449</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN-450"><a href="#EGNN-450"><span class="linenos">450</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN-451"><a href="#EGNN-451"><span class="linenos">451</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN-452"><a href="#EGNN-452"><span class="linenos">452</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN-453"><a href="#EGNN-453"><span class="linenos">453</span></a>            <span class="p">),</span>
</span><span id="EGNN-454"><a href="#EGNN-454"><span class="linenos">454</span></a>            <span class="o">*</span><span class="n">penultimate_edge_activation</span><span class="p">,</span>
</span><span id="EGNN-455"><a href="#EGNN-455"><span class="linenos">455</span></a>        <span class="p">)</span>
</span><span id="EGNN-456"><a href="#EGNN-456"><span class="linenos">456</span></a>
</span><span id="EGNN-457"><a href="#EGNN-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN-458"><a href="#EGNN-458"><span class="linenos">458</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN-459"><a href="#EGNN-459"><span class="linenos">459</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">,</span>
</span><span id="EGNN-460"><a href="#EGNN-460"><span class="linenos">460</span></a>                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN-461"><a href="#EGNN-461"><span class="linenos">461</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN-462"><a href="#EGNN-462"><span class="linenos">462</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN-463"><a href="#EGNN-463"><span class="linenos">463</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN-464"><a href="#EGNN-464"><span class="linenos">464</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN-465"><a href="#EGNN-465"><span class="linenos">465</span></a>            <span class="p">)</span>
</span><span id="EGNN-466"><a href="#EGNN-466"><span class="linenos">466</span></a>        <span class="p">)</span>
</span><span id="EGNN-467"><a href="#EGNN-467"><span class="linenos">467</span></a>
</span><span id="EGNN-468"><a href="#EGNN-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="EGNN-469"><a href="#EGNN-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="n">pos_scale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN-470"><a href="#EGNN-470"><span class="linenos">470</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EGNN-471"><a href="#EGNN-471"><span class="linenos">471</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-472"><a href="#EGNN-472"><span class="linenos">472</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-473"><a href="#EGNN-473"><span class="linenos">473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
</span><span id="EGNN-474"><a href="#EGNN-474"><span class="linenos">474</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="EGNN-475"><a href="#EGNN-475"><span class="linenos">475</span></a>                        <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="EGNN-476"><a href="#EGNN-476"><span class="linenos">476</span></a>                        <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="EGNN-477"><a href="#EGNN-477"><span class="linenos">477</span></a>                    <span class="p">)</span>
</span><span id="EGNN-478"><a href="#EGNN-478"><span class="linenos">478</span></a>                <span class="p">)</span>
</span><span id="EGNN-479"><a href="#EGNN-479"><span class="linenos">479</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()]</span>
</span><span id="EGNN-480"><a href="#EGNN-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN-481"><a href="#EGNN-481"><span class="linenos">481</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN-482"><a href="#EGNN-482"><span class="linenos">482</span></a>                    <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="EGNN-483"><a href="#EGNN-483"><span class="linenos">483</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN-484"><a href="#EGNN-484"><span class="linenos">484</span></a>                    <span class="n">clamp</span><span class="o">=</span><span class="n">clamp</span><span class="p">,</span>
</span><span id="EGNN-485"><a href="#EGNN-485"><span class="linenos">485</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN-486"><a href="#EGNN-486"><span class="linenos">486</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN-487"><a href="#EGNN-487"><span class="linenos">487</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN-488"><a href="#EGNN-488"><span class="linenos">488</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN-489"><a href="#EGNN-489"><span class="linenos">489</span></a>                <span class="p">),</span>
</span><span id="EGNN-490"><a href="#EGNN-490"><span class="linenos">490</span></a>                <span class="o">*</span><span class="n">penultimate_pos_activation</span><span class="p">,</span>
</span><span id="EGNN-491"><a href="#EGNN-491"><span class="linenos">491</span></a>            <span class="p">)</span>
</span><span id="EGNN-492"><a href="#EGNN-492"><span class="linenos">492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-493"><a href="#EGNN-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-494"><a href="#EGNN-494"><span class="linenos">494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-495"><a href="#EGNN-495"><span class="linenos">495</span></a>
</span><span id="EGNN-496"><a href="#EGNN-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="EGNN-497"><a href="#EGNN-497"><span class="linenos">497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN-498"><a href="#EGNN-498"><span class="linenos">498</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN-499"><a href="#EGNN-499"><span class="linenos">499</span></a>                    <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="EGNN-500"><a href="#EGNN-500"><span class="linenos">500</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN-501"><a href="#EGNN-501"><span class="linenos">501</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN-502"><a href="#EGNN-502"><span class="linenos">502</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN-503"><a href="#EGNN-503"><span class="linenos">503</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN-504"><a href="#EGNN-504"><span class="linenos">504</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN-505"><a href="#EGNN-505"><span class="linenos">505</span></a>                <span class="p">),</span>
</span><span id="EGNN-506"><a href="#EGNN-506"><span class="linenos">506</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
</span><span id="EGNN-507"><a href="#EGNN-507"><span class="linenos">507</span></a>            <span class="p">)</span>
</span><span id="EGNN-508"><a href="#EGNN-508"><span class="linenos">508</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-509"><a href="#EGNN-509"><span class="linenos">509</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-510"><a href="#EGNN-510"><span class="linenos">510</span></a>
</span><span id="EGNN-511"><a href="#EGNN-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="EGNN-512"><a href="#EGNN-512"><span class="linenos">512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">MessageNorm</span><span class="p">(</span><span class="n">learn_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="EGNN-513"><a href="#EGNN-513"><span class="linenos">513</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-514"><a href="#EGNN-514"><span class="linenos">514</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-515"><a href="#EGNN-515"><span class="linenos">515</span></a>
</span><span id="EGNN-516"><a href="#EGNN-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="EGNN-517"><a href="#EGNN-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calls original :meth:`torch.nn.Module.__repr__`; more informative</span>
</span><span id="EGNN-518"><a href="#EGNN-518"><span class="linenos">518</span></a><span class="sd">        than :meth:`torch_geometric.nn.Module.__repr__`.</span>
</span><span id="EGNN-519"><a href="#EGNN-519"><span class="linenos">519</span></a>
</span><span id="EGNN-520"><a href="#EGNN-520"><span class="linenos">520</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN-521"><a href="#EGNN-521"><span class="linenos">521</span></a><span class="sd">            String-representation of the EGNN layer.</span>
</span><span id="EGNN-522"><a href="#EGNN-522"><span class="linenos">522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-523"><a href="#EGNN-523"><span class="linenos">523</span></a>
</span><span id="EGNN-524"><a href="#EGNN-524"><span class="linenos">524</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">gnn</span><span class="o">.</span><span class="n">MessagePassing</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</span><span id="EGNN-525"><a href="#EGNN-525"><span class="linenos">525</span></a>
</span><span id="EGNN-526"><a href="#EGNN-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EGNN-527"><a href="#EGNN-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="EGNN-528"><a href="#EGNN-528"><span class="linenos">528</span></a>
</span><span id="EGNN-529"><a href="#EGNN-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-530"><a href="#EGNN-530"><span class="linenos">530</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
</span><span id="EGNN-531"><a href="#EGNN-531"><span class="linenos">531</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-532"><a href="#EGNN-532"><span class="linenos">532</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
</span><span id="EGNN-533"><a href="#EGNN-533"><span class="linenos">533</span></a>
</span><span id="EGNN-534"><a href="#EGNN-534"><span class="linenos">534</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">)</span>
</span><span id="EGNN-535"><a href="#EGNN-535"><span class="linenos">535</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="EGNN-536"><a href="#EGNN-536"><span class="linenos">536</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">,</span> <span class="n">pos_net_nonlinearity</span><span class="p">)</span>
</span><span id="EGNN-537"><a href="#EGNN-537"><span class="linenos">537</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">,</span> <span class="s2">&quot;sigmoid&quot;</span><span class="p">)</span>
</span><span id="EGNN-538"><a href="#EGNN-538"><span class="linenos">538</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">)</span>
</span><span id="EGNN-539"><a href="#EGNN-539"><span class="linenos">539</span></a>
</span><span id="EGNN-540"><a href="#EGNN-540"><span class="linenos">540</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="EGNN-541"><a href="#EGNN-541"><span class="linenos">541</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN-542"><a href="#EGNN-542"><span class="linenos">542</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN-543"><a href="#EGNN-543"><span class="linenos">543</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN-544"><a href="#EGNN-544"><span class="linenos">544</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="EGNN-545"><a href="#EGNN-545"><span class="linenos">545</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-546"><a href="#EGNN-546"><span class="linenos">546</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-547"><a href="#EGNN-547"><span class="linenos">547</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="EGNN-548"><a href="#EGNN-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="EGNN-549"><a href="#EGNN-549"><span class="linenos">549</span></a>
</span><span id="EGNN-550"><a href="#EGNN-550"><span class="linenos">550</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN-551"><a href="#EGNN-551"><span class="linenos">551</span></a><span class="sd">            x: Node features.</span>
</span><span id="EGNN-552"><a href="#EGNN-552"><span class="linenos">552</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="EGNN-553"><a href="#EGNN-553"><span class="linenos">553</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="EGNN-554"><a href="#EGNN-554"><span class="linenos">554</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="EGNN-555"><a href="#EGNN-555"><span class="linenos">555</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="EGNN-556"><a href="#EGNN-556"><span class="linenos">556</span></a>
</span><span id="EGNN-557"><a href="#EGNN-557"><span class="linenos">557</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN-558"><a href="#EGNN-558"><span class="linenos">558</span></a><span class="sd">            Tuple of updated node features and coordinates.</span>
</span><span id="EGNN-559"><a href="#EGNN-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-560"><a href="#EGNN-560"><span class="linenos">560</span></a>
</span><span id="EGNN-561"><a href="#EGNN-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">():</span>
</span><span id="EGNN-562"><a href="#EGNN-562"><span class="linenos">562</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN-563"><a href="#EGNN-563"><span class="linenos">563</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EGNN-564"><a href="#EGNN-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-565"><a href="#EGNN-565"><span class="linenos">565</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EGNN-566"><a href="#EGNN-566"><span class="linenos">566</span></a>
</span><span id="EGNN-567"><a href="#EGNN-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="EGNN-568"><a href="#EGNN-568"><span class="linenos">568</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span>
</span><span id="EGNN-569"><a href="#EGNN-569"><span class="linenos">569</span></a>            <span class="n">edge_index</span><span class="o">=</span><span class="n">edge_index</span><span class="p">,</span>
</span><span id="EGNN-570"><a href="#EGNN-570"><span class="linenos">570</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="EGNN-571"><a href="#EGNN-571"><span class="linenos">571</span></a>            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
</span><span id="EGNN-572"><a href="#EGNN-572"><span class="linenos">572</span></a>            <span class="n">edge_attr</span><span class="o">=</span><span class="n">edge_attr</span><span class="p">,</span>
</span><span id="EGNN-573"><a href="#EGNN-573"><span class="linenos">573</span></a>            <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span>
</span><span id="EGNN-574"><a href="#EGNN-574"><span class="linenos">574</span></a>        <span class="p">)</span>
</span><span id="EGNN-575"><a href="#EGNN-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">-=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="EGNN-576"><a href="#EGNN-576"><span class="linenos">576</span></a>
</span><span id="EGNN-577"><a href="#EGNN-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="n">pos_is_unsqueezed</span><span class="p">:</span>
</span><span id="EGNN-578"><a href="#EGNN-578"><span class="linenos">578</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN-579"><a href="#EGNN-579"><span class="linenos">579</span></a>
</span><span id="EGNN-580"><a href="#EGNN-580"><span class="linenos">580</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span><span id="EGNN-581"><a href="#EGNN-581"><span class="linenos">581</span></a>
</span><span id="EGNN-582"><a href="#EGNN-582"><span class="linenos">582</span></a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span>
</span><span id="EGNN-583"><a href="#EGNN-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN-584"><a href="#EGNN-584"><span class="linenos">584</span></a>        <span class="n">x_i</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN-585"><a href="#EGNN-585"><span class="linenos">585</span></a>        <span class="n">x_j</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN-586"><a href="#EGNN-586"><span class="linenos">586</span></a>        <span class="n">pos_i</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="EGNN-587"><a href="#EGNN-587"><span class="linenos">587</span></a>        <span class="n">pos_j</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="EGNN-588"><a href="#EGNN-588"><span class="linenos">588</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-589"><a href="#EGNN-589"><span class="linenos">589</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN-590"><a href="#EGNN-590"><span class="linenos">590</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute messages.</span>
</span><span id="EGNN-591"><a href="#EGNN-591"><span class="linenos">591</span></a>
</span><span id="EGNN-592"><a href="#EGNN-592"><span class="linenos">592</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN-593"><a href="#EGNN-593"><span class="linenos">593</span></a><span class="sd">            x_i: Source node features.</span>
</span><span id="EGNN-594"><a href="#EGNN-594"><span class="linenos">594</span></a><span class="sd">            x_j: Target node features.</span>
</span><span id="EGNN-595"><a href="#EGNN-595"><span class="linenos">595</span></a><span class="sd">            pos_i: Source node coordinates.</span>
</span><span id="EGNN-596"><a href="#EGNN-596"><span class="linenos">596</span></a><span class="sd">            pos_j: Target node coordinates.</span>
</span><span id="EGNN-597"><a href="#EGNN-597"><span class="linenos">597</span></a><span class="sd">            edge_attr: Edge features; between source and target node.</span>
</span><span id="EGNN-598"><a href="#EGNN-598"><span class="linenos">598</span></a>
</span><span id="EGNN-599"><a href="#EGNN-599"><span class="linenos">599</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN-600"><a href="#EGNN-600"><span class="linenos">600</span></a><span class="sd">            Tuple of messages between source and target nodes, and difference</span>
</span><span id="EGNN-601"><a href="#EGNN-601"><span class="linenos">601</span></a><span class="sd">            between source and target node coordinates.</span>
</span><span id="EGNN-602"><a href="#EGNN-602"><span class="linenos">602</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-603"><a href="#EGNN-603"><span class="linenos">603</span></a>
</span><span id="EGNN-604"><a href="#EGNN-604"><span class="linenos">604</span></a>        <span class="n">msg_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_i</span><span class="p">,</span> <span class="n">x_j</span><span class="p">]</span>
</span><span id="EGNN-605"><a href="#EGNN-605"><span class="linenos">605</span></a>
</span><span id="EGNN-606"><a href="#EGNN-606"><span class="linenos">606</span></a>        <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">pos_i</span> <span class="o">-</span> <span class="n">pos_j</span>
</span><span id="EGNN-607"><a href="#EGNN-607"><span class="linenos">607</span></a>        <span class="n">dst_ij</span> <span class="o">=</span> <span class="n">vec_ij</span><span class="o">.</span><span class="n">square</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EGNN-608"><a href="#EGNN-608"><span class="linenos">608</span></a>        <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fourier_encode</span><span class="p">(</span><span class="n">dst_ij</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span><span class="p">))</span>
</span><span id="EGNN-609"><a href="#EGNN-609"><span class="linenos">609</span></a>
</span><span id="EGNN-610"><a href="#EGNN-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">edge_attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-611"><a href="#EGNN-611"><span class="linenos">611</span></a>            <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_attr</span><span class="p">)</span>
</span><span id="EGNN-612"><a href="#EGNN-612"><span class="linenos">612</span></a>
</span><span id="EGNN-613"><a href="#EGNN-613"><span class="linenos">613</span></a>        <span class="n">msg_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">msg_input</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="EGNN-614"><a href="#EGNN-614"><span class="linenos">614</span></a>
</span><span id="EGNN-615"><a href="#EGNN-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-616"><a href="#EGNN-616"><span class="linenos">616</span></a>            <span class="n">force_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN-617"><a href="#EGNN-617"><span class="linenos">617</span></a>            <span class="n">norm_ij</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_ij</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</span><span id="EGNN-618"><a href="#EGNN-618"><span class="linenos">618</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-619"><a href="#EGNN-619"><span class="linenos">619</span></a>                <span class="n">force_ij</span> <span class="o">=</span> <span class="n">force_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span>
</span><span id="EGNN-620"><a href="#EGNN-620"><span class="linenos">620</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">vec_ij</span> <span class="o">*</span> <span class="p">(</span><span class="n">force_ij</span> <span class="o">/</span> <span class="n">norm_ij</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EGNN-621"><a href="#EGNN-621"><span class="linenos">621</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-622"><a href="#EGNN-622"><span class="linenos">622</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-623"><a href="#EGNN-623"><span class="linenos">623</span></a>
</span><span id="EGNN-624"><a href="#EGNN-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-625"><a href="#EGNN-625"><span class="linenos">625</span></a>            <span class="n">msg_ij</span> <span class="o">=</span> <span class="n">msg_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN-626"><a href="#EGNN-626"><span class="linenos">626</span></a>
</span><span id="EGNN-627"><a href="#EGNN-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span>
</span><span id="EGNN-628"><a href="#EGNN-628"><span class="linenos">628</span></a>
</span><span id="EGNN-629"><a href="#EGNN-629"><span class="linenos">629</span></a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span>
</span><span id="EGNN-630"><a href="#EGNN-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN-631"><a href="#EGNN-631"><span class="linenos">631</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="EGNN-632"><a href="#EGNN-632"><span class="linenos">632</span></a>        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-633"><a href="#EGNN-633"><span class="linenos">633</span></a>        <span class="n">ptr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-634"><a href="#EGNN-634"><span class="linenos">634</span></a>        <span class="n">dim_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-635"><a href="#EGNN-635"><span class="linenos">635</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN-636"><a href="#EGNN-636"><span class="linenos">636</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate messages.</span>
</span><span id="EGNN-637"><a href="#EGNN-637"><span class="linenos">637</span></a>
</span><span id="EGNN-638"><a href="#EGNN-638"><span class="linenos">638</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN-639"><a href="#EGNN-639"><span class="linenos">639</span></a><span class="sd">            messages: Tuple of messages and coordinate differences between</span>
</span><span id="EGNN-640"><a href="#EGNN-640"><span class="linenos">640</span></a><span class="sd">                nodes.</span>
</span><span id="EGNN-641"><a href="#EGNN-641"><span class="linenos">641</span></a><span class="sd">            index: Indices of elements for applying the aggregation. Either</span>
</span><span id="EGNN-642"><a href="#EGNN-642"><span class="linenos">642</span></a><span class="sd">                `index` or `ptr` must be defined.</span>
</span><span id="EGNN-643"><a href="#EGNN-643"><span class="linenos">643</span></a><span class="sd">            ptr: Offsets for computing the aggregation based on sorted inputs,</span>
</span><span id="EGNN-644"><a href="#EGNN-644"><span class="linenos">644</span></a><span class="sd">                if provided. Either `index` or `ptr` must be defined.</span>
</span><span id="EGNN-645"><a href="#EGNN-645"><span class="linenos">645</span></a><span class="sd">            dim_size: Size of output at dimension `self.node_dim` after</span>
</span><span id="EGNN-646"><a href="#EGNN-646"><span class="linenos">646</span></a><span class="sd">                aggregation.</span>
</span><span id="EGNN-647"><a href="#EGNN-647"><span class="linenos">647</span></a>
</span><span id="EGNN-648"><a href="#EGNN-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN-649"><a href="#EGNN-649"><span class="linenos">649</span></a><span class="sd">            Tuple of aggregated messages and aggregated coordinate updates.</span>
</span><span id="EGNN-650"><a href="#EGNN-650"><span class="linenos">650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-651"><a href="#EGNN-651"><span class="linenos">651</span></a>
</span><span id="EGNN-652"><a href="#EGNN-652"><span class="linenos">652</span></a>        <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="EGNN-653"><a href="#EGNN-653"><span class="linenos">653</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span><span class="p">(</span>
</span><span id="EGNN-654"><a href="#EGNN-654"><span class="linenos">654</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="EGNN-655"><a href="#EGNN-655"><span class="linenos">655</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="EGNN-656"><a href="#EGNN-656"><span class="linenos">656</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="EGNN-657"><a href="#EGNN-657"><span class="linenos">657</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="EGNN-658"><a href="#EGNN-658"><span class="linenos">658</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="EGNN-659"><a href="#EGNN-659"><span class="linenos">659</span></a>            <span class="p">)</span>
</span><span id="EGNN-660"><a href="#EGNN-660"><span class="linenos">660</span></a>
</span><span id="EGNN-661"><a href="#EGNN-661"><span class="linenos">661</span></a>        <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="EGNN-662"><a href="#EGNN-662"><span class="linenos">662</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span><span class="p">(</span>
</span><span id="EGNN-663"><a href="#EGNN-663"><span class="linenos">663</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="EGNN-664"><a href="#EGNN-664"><span class="linenos">664</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="EGNN-665"><a href="#EGNN-665"><span class="linenos">665</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="EGNN-666"><a href="#EGNN-666"><span class="linenos">666</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="EGNN-667"><a href="#EGNN-667"><span class="linenos">667</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="EGNN-668"><a href="#EGNN-668"><span class="linenos">668</span></a>            <span class="p">)</span>
</span><span id="EGNN-669"><a href="#EGNN-669"><span class="linenos">669</span></a>
</span><span id="EGNN-670"><a href="#EGNN-670"><span class="linenos">670</span></a>        <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="EGNN-671"><a href="#EGNN-671"><span class="linenos">671</span></a>
</span><span id="EGNN-672"><a href="#EGNN-672"><span class="linenos">672</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN-673"><a href="#EGNN-673"><span class="linenos">673</span></a>
</span><span id="EGNN-674"><a href="#EGNN-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="n">vec_ij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-675"><a href="#EGNN-675"><span class="linenos">675</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">vec_ij</span><span class="p">)</span>
</span><span id="EGNN-676"><a href="#EGNN-676"><span class="linenos">676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN-677"><a href="#EGNN-677"><span class="linenos">677</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN-678"><a href="#EGNN-678"><span class="linenos">678</span></a>
</span><span id="EGNN-679"><a href="#EGNN-679"><span class="linenos">679</span></a>        <span class="k">return</span> <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span>
</span><span id="EGNN-680"><a href="#EGNN-680"><span class="linenos">680</span></a>
</span><span id="EGNN-681"><a href="#EGNN-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
</span><span id="EGNN-682"><a href="#EGNN-682"><span class="linenos">682</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN-683"><a href="#EGNN-683"><span class="linenos">683</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="EGNN-684"><a href="#EGNN-684"><span class="linenos">684</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN-685"><a href="#EGNN-685"><span class="linenos">685</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN-686"><a href="#EGNN-686"><span class="linenos">686</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN-687"><a href="#EGNN-687"><span class="linenos">687</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update nodes.</span>
</span><span id="EGNN-688"><a href="#EGNN-688"><span class="linenos">688</span></a>
</span><span id="EGNN-689"><a href="#EGNN-689"><span class="linenos">689</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN-690"><a href="#EGNN-690"><span class="linenos">690</span></a><span class="sd">            messages: Tuple of aggregated messages and coordinate differences.</span>
</span><span id="EGNN-691"><a href="#EGNN-691"><span class="linenos">691</span></a><span class="sd">            x: Node features.</span>
</span><span id="EGNN-692"><a href="#EGNN-692"><span class="linenos">692</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="EGNN-693"><a href="#EGNN-693"><span class="linenos">693</span></a>
</span><span id="EGNN-694"><a href="#EGNN-694"><span class="linenos">694</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN-695"><a href="#EGNN-695"><span class="linenos">695</span></a><span class="sd">            Tuple of updated node features and updated node coordinates.</span>
</span><span id="EGNN-696"><a href="#EGNN-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN-697"><a href="#EGNN-697"><span class="linenos">697</span></a>
</span><span id="EGNN-698"><a href="#EGNN-698"><span class="linenos">698</span></a>        <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="EGNN-699"><a href="#EGNN-699"><span class="linenos">699</span></a>
</span><span id="EGNN-700"><a href="#EGNN-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">:</span>
</span><span id="EGNN-701"><a href="#EGNN-701"><span class="linenos">701</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="EGNN-702"><a href="#EGNN-702"><span class="linenos">702</span></a>
</span><span id="EGNN-703"><a href="#EGNN-703"><span class="linenos">703</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="EGNN-704"><a href="#EGNN-704"><span class="linenos">704</span></a>
</span><span id="EGNN-705"><a href="#EGNN-705"><span class="linenos">705</span></a>        <span class="k">if</span> <span class="n">pos_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN-706"><a href="#EGNN-706"><span class="linenos">706</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">pos_update</span>
</span><span id="EGNN-707"><a href="#EGNN-707"><span class="linenos">707</span></a>
</span><span id="EGNN-708"><a href="#EGNN-708"><span class="linenos">708</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            <div class="docstring"><p>E(n) Equivariant Graph Neural Network.</p>

<p>Implementation of an E(n) Equivariant Graph Neural Network as described in
[1]_ that supports multiple node coordinates. This way we can encode
different spatial features as coordinate; e.g., vectors that originate from
a single node.</p>

<p>Node features are usually two-dimensional tensors of the size \( (N, F) \),
with \( N \) being the number of nodes and \( F \) the number of
features.</p>

<p>Similarly, coordinates have the size \( (N, D) \) with \( D \) being the
dimension of the coordinate space. Alternatively, to encode multiple
coordinates per node, the coordinates can be \( (N, C, D) \) with
\( C \) as the number of individual coordinates per node.</p>

<p>Edge features are optional and have the size \( (E, G) \) with \( E \)
as the number of edges and \( G \) as the number of edge features.</p>

<h6 id="example">Example:</h6>

<blockquote>
  <p>EGNN instance with 16 input and 32 output features and two coordinates
  per node.</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn"><a href="">bpp.model.egnn</a></span> <span class="kn">import</span> <span class="n">EGNN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dims_node</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">dims_edge</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">dims_pos</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,),</span>
<span class="gp">... </span>    <span class="n">num_pos</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fn</span>
<span class="go">EGNN(</span>
<span class="go">  (aggr_mean): MeanAggregation()</span>
<span class="go">  (aggr_sum): SumAggregation()</span>
<span class="go">  (edge_net): Sequential(</span>
<span class="go">    (0): Linear(in_features=34, out_features=64, bias=True)</span>
<span class="go">    (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">    (2): Linear(in_features=64, out_features=16, bias=True)</span>
<span class="go">    (3): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">  )</span>
<span class="go">  (node_net): Sequential(</span>
<span class="go">    (0): Linear(in_features=32, out_features=64, bias=True)</span>
<span class="go">    (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">    (2): Linear(in_features=64, out_features=32, bias=True)</span>
<span class="go">  )</span>
<span class="go">  (pos_net): Sequential(</span>
<span class="go">    (0): Linear(in_features=16, out_features=32, bias=True)</span>
<span class="go">    (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">    (2): Linear(in_features=32, out_features=2, bias=True)</span>
<span class="go">  )</span>
<span class="go">)</span>
</code></pre>
  </div>
</blockquote>
</div>


                            <div id="EGNN.__init__" class="classattr">
                                        <input id="EGNN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EGNN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	norm_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;</span>)</span>

                <label class="view-source-button" for="EGNN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.__init__-265"><a href="#EGNN.__init__-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EGNN.__init__-266"><a href="#EGNN.__init__-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN.__init__-267"><a href="#EGNN.__init__-267"><span class="linenos">267</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="EGNN.__init__-268"><a href="#EGNN.__init__-268"><span class="linenos">268</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="EGNN.__init__-269"><a href="#EGNN.__init__-269"><span class="linenos">269</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="EGNN.__init__-270"><a href="#EGNN.__init__-270"><span class="linenos">270</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="EGNN.__init__-271"><a href="#EGNN.__init__-271"><span class="linenos">271</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN.__init__-272"><a href="#EGNN.__init__-272"><span class="linenos">272</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN.__init__-273"><a href="#EGNN.__init__-273"><span class="linenos">273</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="EGNN.__init__-274"><a href="#EGNN.__init__-274"><span class="linenos">274</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EGNN.__init__-275"><a href="#EGNN.__init__-275"><span class="linenos">275</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="EGNN.__init__-276"><a href="#EGNN.__init__-276"><span class="linenos">276</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="EGNN.__init__-277"><a href="#EGNN.__init__-277"><span class="linenos">277</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.__init__-278"><a href="#EGNN.__init__-278"><span class="linenos">278</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.__init__-279"><a href="#EGNN.__init__-279"><span class="linenos">279</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="EGNN.__init__-280"><a href="#EGNN.__init__-280"><span class="linenos">280</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="EGNN.__init__-281"><a href="#EGNN.__init__-281"><span class="linenos">281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.__init__-282"><a href="#EGNN.__init__-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EGNN.__init__-283"><a href="#EGNN.__init__-283"><span class="linenos">283</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN.__init__-284"><a href="#EGNN.__init__-284"><span class="linenos">284</span></a><span class="sd">            dims_node: Dimensions for the node network: `dims_node[0]` is the</span>
</span><span id="EGNN.__init__-285"><a href="#EGNN.__init__-285"><span class="linenos">285</span></a><span class="sd">                number of input features and `dims_node[-1]` is the number of</span>
</span><span id="EGNN.__init__-286"><a href="#EGNN.__init__-286"><span class="linenos">286</span></a><span class="sd">                output features.  At least 2 dimensions are required. All</span>
</span><span id="EGNN.__init__-287"><a href="#EGNN.__init__-287"><span class="linenos">287</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the</span>
</span><span id="EGNN.__init__-288"><a href="#EGNN.__init__-288"><span class="linenos">288</span></a><span class="sd">                network.</span>
</span><span id="EGNN.__init__-289"><a href="#EGNN.__init__-289"><span class="linenos">289</span></a><span class="sd">            dims_edge: Dimensions for the edge network: `dims_edge[0]` is the</span>
</span><span id="EGNN.__init__-290"><a href="#EGNN.__init__-290"><span class="linenos">290</span></a><span class="sd">                number of edge features (0 if graphs have no edge features),</span>
</span><span id="EGNN.__init__-291"><a href="#EGNN.__init__-291"><span class="linenos">291</span></a><span class="sd">                `dims_edge[-1]` is the number of message features.  All</span>
</span><span id="EGNN.__init__-292"><a href="#EGNN.__init__-292"><span class="linenos">292</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="EGNN.__init__-293"><a href="#EGNN.__init__-293"><span class="linenos">293</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="EGNN.__init__-294"><a href="#EGNN.__init__-294"><span class="linenos">294</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="EGNN.__init__-295"><a href="#EGNN.__init__-295"><span class="linenos">295</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="EGNN.__init__-296"><a href="#EGNN.__init__-296"><span class="linenos">296</span></a><span class="sd">                will be disabled.</span>
</span><span id="EGNN.__init__-297"><a href="#EGNN.__init__-297"><span class="linenos">297</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="EGNN.__init__-298"><a href="#EGNN.__init__-298"><span class="linenos">298</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="EGNN.__init__-299"><a href="#EGNN.__init__-299"><span class="linenos">299</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="EGNN.__init__-300"><a href="#EGNN.__init__-300"><span class="linenos">300</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="EGNN.__init__-301"><a href="#EGNN.__init__-301"><span class="linenos">301</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="EGNN.__init__-302"><a href="#EGNN.__init__-302"><span class="linenos">302</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="EGNN.__init__-303"><a href="#EGNN.__init__-303"><span class="linenos">303</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="EGNN.__init__-304"><a href="#EGNN.__init__-304"><span class="linenos">304</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="EGNN.__init__-305"><a href="#EGNN.__init__-305"><span class="linenos">305</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="EGNN.__init__-306"><a href="#EGNN.__init__-306"><span class="linenos">306</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="EGNN.__init__-307"><a href="#EGNN.__init__-307"><span class="linenos">307</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="EGNN.__init__-308"><a href="#EGNN.__init__-308"><span class="linenos">308</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="EGNN.__init__-309"><a href="#EGNN.__init__-309"><span class="linenos">309</span></a><span class="sd">                0, the penultimate layer of the coordinate update network will</span>
</span><span id="EGNN.__init__-310"><a href="#EGNN.__init__-310"><span class="linenos">310</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="EGNN.__init__-311"><a href="#EGNN.__init__-311"><span class="linenos">311</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="EGNN.__init__-312"><a href="#EGNN.__init__-312"><span class="linenos">312</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="EGNN.__init__-313"><a href="#EGNN.__init__-313"><span class="linenos">313</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="EGNN.__init__-314"><a href="#EGNN.__init__-314"><span class="linenos">314</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="EGNN.__init__-315"><a href="#EGNN.__init__-315"><span class="linenos">315</span></a><span class="sd">            dropout: Dropout probability in-between network layers. No dropout</span>
</span><span id="EGNN.__init__-316"><a href="#EGNN.__init__-316"><span class="linenos">316</span></a><span class="sd">                if 0.</span>
</span><span id="EGNN.__init__-317"><a href="#EGNN.__init__-317"><span class="linenos">317</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="EGNN.__init__-318"><a href="#EGNN.__init__-318"><span class="linenos">318</span></a><span class="sd">                layers.</span>
</span><span id="EGNN.__init__-319"><a href="#EGNN.__init__-319"><span class="linenos">319</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="EGNN.__init__-320"><a href="#EGNN.__init__-320"><span class="linenos">320</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="EGNN.__init__-321"><a href="#EGNN.__init__-321"><span class="linenos">321</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="EGNN.__init__-322"><a href="#EGNN.__init__-322"><span class="linenos">322</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="EGNN.__init__-323"><a href="#EGNN.__init__-323"><span class="linenos">323</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="EGNN.__init__-324"><a href="#EGNN.__init__-324"><span class="linenos">324</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="EGNN.__init__-325"><a href="#EGNN.__init__-325"><span class="linenos">325</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="EGNN.__init__-326"><a href="#EGNN.__init__-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN.__init__-327"><a href="#EGNN.__init__-327"><span class="linenos">327</span></a>
</span><span id="EGNN.__init__-328"><a href="#EGNN.__init__-328"><span class="linenos">328</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_node</span><span class="p">:</span>
</span><span id="EGNN.__init__-329"><a href="#EGNN.__init__-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-330"><a href="#EGNN.__init__-330"><span class="linenos">330</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-331"><a href="#EGNN.__init__-331"><span class="linenos">331</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_node must be larger than 0, but one &quot;</span>
</span><span id="EGNN.__init__-332"><a href="#EGNN.__init__-332"><span class="linenos">332</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-333"><a href="#EGNN.__init__-333"><span class="linenos">333</span></a>                <span class="p">)</span>
</span><span id="EGNN.__init__-334"><a href="#EGNN.__init__-334"><span class="linenos">334</span></a>
</span><span id="EGNN.__init__-335"><a href="#EGNN.__init__-335"><span class="linenos">335</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="EGNN.__init__-336"><a href="#EGNN.__init__-336"><span class="linenos">336</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-337"><a href="#EGNN.__init__-337"><span class="linenos">337</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-338"><a href="#EGNN.__init__-338"><span class="linenos">338</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_gate must be larger than 0, bot one &quot;</span>
</span><span id="EGNN.__init__-339"><a href="#EGNN.__init__-339"><span class="linenos">339</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-340"><a href="#EGNN.__init__-340"><span class="linenos">340</span></a>                <span class="p">)</span>
</span><span id="EGNN.__init__-341"><a href="#EGNN.__init__-341"><span class="linenos">341</span></a>
</span><span id="EGNN.__init__-342"><a href="#EGNN.__init__-342"><span class="linenos">342</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_gate</span><span class="p">:</span>
</span><span id="EGNN.__init__-343"><a href="#EGNN.__init__-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-344"><a href="#EGNN.__init__-344"><span class="linenos">344</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-345"><a href="#EGNN.__init__-345"><span class="linenos">345</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_pos must be larger than 0, bot one &quot;</span>
</span><span id="EGNN.__init__-346"><a href="#EGNN.__init__-346"><span class="linenos">346</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-347"><a href="#EGNN.__init__-347"><span class="linenos">347</span></a>                <span class="p">)</span>
</span><span id="EGNN.__init__-348"><a href="#EGNN.__init__-348"><span class="linenos">348</span></a>
</span><span id="EGNN.__init__-349"><a href="#EGNN.__init__-349"><span class="linenos">349</span></a>        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="EGNN.__init__-350"><a href="#EGNN.__init__-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-351"><a href="#EGNN.__init__-351"><span class="linenos">351</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-352"><a href="#EGNN.__init__-352"><span class="linenos">352</span></a>                    <span class="sa">f</span><span class="s2">&quot;dimensions in dims_edge, with the exception of the first &quot;</span>
</span><span id="EGNN.__init__-353"><a href="#EGNN.__init__-353"><span class="linenos">353</span></a>                    <span class="sa">f</span><span class="s2">&quot;one, must be larger than 0, but one dimension is </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-354"><a href="#EGNN.__init__-354"><span class="linenos">354</span></a>                <span class="p">)</span>
</span><span id="EGNN.__init__-355"><a href="#EGNN.__init__-355"><span class="linenos">355</span></a>
</span><span id="EGNN.__init__-356"><a href="#EGNN.__init__-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN.__init__-357"><a href="#EGNN.__init__-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-358"><a href="#EGNN.__init__-358"><span class="linenos">358</span></a>                <span class="sa">f</span><span class="s2">&quot;first dimension in dims_edge cannot be negative, but got &quot;</span>
</span><span id="EGNN.__init__-359"><a href="#EGNN.__init__-359"><span class="linenos">359</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-360"><a href="#EGNN.__init__-360"><span class="linenos">360</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-361"><a href="#EGNN.__init__-361"><span class="linenos">361</span></a>
</span><span id="EGNN.__init__-362"><a href="#EGNN.__init__-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EGNN.__init__-363"><a href="#EGNN.__init__-363"><span class="linenos">363</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-364"><a href="#EGNN.__init__-364"><span class="linenos">364</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_node is 2, but got &quot;</span>
</span><span id="EGNN.__init__-365"><a href="#EGNN.__init__-365"><span class="linenos">365</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-366"><a href="#EGNN.__init__-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-367"><a href="#EGNN.__init__-367"><span class="linenos">367</span></a>
</span><span id="EGNN.__init__-368"><a href="#EGNN.__init__-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EGNN.__init__-369"><a href="#EGNN.__init__-369"><span class="linenos">369</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-370"><a href="#EGNN.__init__-370"><span class="linenos">370</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of dimensions for dims_edge is 2, but got &quot;</span>
</span><span id="EGNN.__init__-371"><a href="#EGNN.__init__-371"><span class="linenos">371</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-372"><a href="#EGNN.__init__-372"><span class="linenos">372</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-373"><a href="#EGNN.__init__-373"><span class="linenos">373</span></a>
</span><span id="EGNN.__init__-374"><a href="#EGNN.__init__-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">num_pos</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-375"><a href="#EGNN.__init__-375"><span class="linenos">375</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-376"><a href="#EGNN.__init__-376"><span class="linenos">376</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of positional coordinates is 1, but got </span><span class="si">{</span><span class="n">num_pos</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-377"><a href="#EGNN.__init__-377"><span class="linenos">377</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-378"><a href="#EGNN.__init__-378"><span class="linenos">378</span></a>
</span><span id="EGNN.__init__-379"><a href="#EGNN.__init__-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">num_encode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EGNN.__init__-380"><a href="#EGNN.__init__-380"><span class="linenos">380</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EGNN.__init__-381"><a href="#EGNN.__init__-381"><span class="linenos">381</span></a>                <span class="sa">f</span><span class="s2">&quot;minimum number of fourier-encoded features for positional &quot;</span>
</span><span id="EGNN.__init__-382"><a href="#EGNN.__init__-382"><span class="linenos">382</span></a>                <span class="sa">f</span><span class="s2">&quot;coordinates is 1, but got </span><span class="si">{</span><span class="n">num_encode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EGNN.__init__-383"><a href="#EGNN.__init__-383"><span class="linenos">383</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-384"><a href="#EGNN.__init__-384"><span class="linenos">384</span></a>
</span><span id="EGNN.__init__-385"><a href="#EGNN.__init__-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">clamp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN.__init__-386"><a href="#EGNN.__init__-386"><span class="linenos">386</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clamp value must be positive, but got </span><span class="si">{</span><span class="n">clamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EGNN.__init__-387"><a href="#EGNN.__init__-387"><span class="linenos">387</span></a>
</span><span id="EGNN.__init__-388"><a href="#EGNN.__init__-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="n">dropout</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN.__init__-389"><a href="#EGNN.__init__-389"><span class="linenos">389</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dropout value must be positive, but got </span><span class="si">{</span><span class="n">dropout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EGNN.__init__-390"><a href="#EGNN.__init__-390"><span class="linenos">390</span></a>
</span><span id="EGNN.__init__-391"><a href="#EGNN.__init__-391"><span class="linenos">391</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN.__init__-392"><a href="#EGNN.__init__-392"><span class="linenos">392</span></a>
</span><span id="EGNN.__init__-393"><a href="#EGNN.__init__-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">MeanAggregation</span><span class="p">()</span>
</span><span id="EGNN.__init__-394"><a href="#EGNN.__init__-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">SumAggregation</span><span class="p">()</span>
</span><span id="EGNN.__init__-395"><a href="#EGNN.__init__-395"><span class="linenos">395</span></a>
</span><span id="EGNN.__init__-396"><a href="#EGNN.__init__-396"><span class="linenos">396</span></a>        <span class="n">update</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">num_pos</span>
</span><span id="EGNN.__init__-397"><a href="#EGNN.__init__-397"><span class="linenos">397</span></a>        <span class="n">gate</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_gate</span><span class="p">)</span>
</span><span id="EGNN.__init__-398"><a href="#EGNN.__init__-398"><span class="linenos">398</span></a>
</span><span id="EGNN.__init__-399"><a href="#EGNN.__init__-399"><span class="linenos">399</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN.__init__-400"><a href="#EGNN.__init__-400"><span class="linenos">400</span></a>            <span class="p">(</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">num_pos</span> <span class="o">*</span> <span class="n">num_encode</span><span class="p">),</span>
</span><span id="EGNN.__init__-401"><a href="#EGNN.__init__-401"><span class="linenos">401</span></a>            <span class="o">*</span><span class="n">dims_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="EGNN.__init__-402"><a href="#EGNN.__init__-402"><span class="linenos">402</span></a>        <span class="p">)</span>
</span><span id="EGNN.__init__-403"><a href="#EGNN.__init__-403"><span class="linenos">403</span></a>
</span><span id="EGNN.__init__-404"><a href="#EGNN.__init__-404"><span class="linenos">404</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN.__init__-405"><a href="#EGNN.__init__-405"><span class="linenos">405</span></a>            <span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="EGNN.__init__-406"><a href="#EGNN.__init__-406"><span class="linenos">406</span></a>            <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="EGNN.__init__-407"><a href="#EGNN.__init__-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span><span id="EGNN.__init__-408"><a href="#EGNN.__init__-408"><span class="linenos">408</span></a>
</span><span id="EGNN.__init__-409"><a href="#EGNN.__init__-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="EGNN.__init__-410"><a href="#EGNN.__init__-410"><span class="linenos">410</span></a>            <span class="n">dims_pos</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN.__init__-411"><a href="#EGNN.__init__-411"><span class="linenos">411</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="EGNN.__init__-412"><a href="#EGNN.__init__-412"><span class="linenos">412</span></a>                <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="EGNN.__init__-413"><a href="#EGNN.__init__-413"><span class="linenos">413</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="EGNN.__init__-414"><a href="#EGNN.__init__-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-415"><a href="#EGNN.__init__-415"><span class="linenos">415</span></a>
</span><span id="EGNN.__init__-416"><a href="#EGNN.__init__-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="EGNN.__init__-417"><a href="#EGNN.__init__-417"><span class="linenos">417</span></a>            <span class="n">dims_gate</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EGNN.__init__-418"><a href="#EGNN.__init__-418"><span class="linenos">418</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="EGNN.__init__-419"><a href="#EGNN.__init__-419"><span class="linenos">419</span></a>                <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="EGNN.__init__-420"><a href="#EGNN.__init__-420"><span class="linenos">420</span></a>                <span class="mi">1</span><span class="p">,</span>
</span><span id="EGNN.__init__-421"><a href="#EGNN.__init__-421"><span class="linenos">421</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-422"><a href="#EGNN.__init__-422"><span class="linenos">422</span></a>
</span><span id="EGNN.__init__-423"><a href="#EGNN.__init__-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span>
</span><span id="EGNN.__init__-424"><a href="#EGNN.__init__-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_edge</span> <span class="o">=</span> <span class="n">dims_edge</span>
</span><span id="EGNN.__init__-425"><a href="#EGNN.__init__-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_gate</span> <span class="o">=</span> <span class="n">dims_gate</span>
</span><span id="EGNN.__init__-426"><a href="#EGNN.__init__-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims_pos</span> <span class="o">=</span> <span class="n">dims_pos</span>
</span><span id="EGNN.__init__-427"><a href="#EGNN.__init__-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_pos</span> <span class="o">=</span> <span class="n">num_pos</span>
</span><span id="EGNN.__init__-428"><a href="#EGNN.__init__-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span> <span class="o">=</span> <span class="n">num_encode</span>
</span><span id="EGNN.__init__-429"><a href="#EGNN.__init__-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_pos</span> <span class="o">=</span> <span class="n">update</span>
</span><span id="EGNN.__init__-430"><a href="#EGNN.__init__-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gate_msg</span> <span class="o">=</span> <span class="n">gate</span>
</span><span id="EGNN.__init__-431"><a href="#EGNN.__init__-431"><span class="linenos">431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">norm</span>
</span><span id="EGNN.__init__-432"><a href="#EGNN.__init__-432"><span class="linenos">432</span></a>
</span><span id="EGNN.__init__-433"><a href="#EGNN.__init__-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="n">activation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.__init__-434"><a href="#EGNN.__init__-434"><span class="linenos">434</span></a>            <span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(</span><span class="n">approximate</span><span class="o">=</span><span class="s2">&quot;tanh&quot;</span><span class="p">)</span>
</span><span id="EGNN.__init__-435"><a href="#EGNN.__init__-435"><span class="linenos">435</span></a>
</span><span id="EGNN.__init__-436"><a href="#EGNN.__init__-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.__init__-437"><a href="#EGNN.__init__-437"><span class="linenos">437</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="EGNN.__init__-438"><a href="#EGNN.__init__-438"><span class="linenos">438</span></a>
</span><span id="EGNN.__init__-439"><a href="#EGNN.__init__-439"><span class="linenos">439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="EGNN.__init__-440"><a href="#EGNN.__init__-440"><span class="linenos">440</span></a>
</span><span id="EGNN.__init__-441"><a href="#EGNN.__init__-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_edge</span><span class="p">):</span>
</span><span id="EGNN.__init__-442"><a href="#EGNN.__init__-442"><span class="linenos">442</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">activation</span><span class="p">]</span>
</span><span id="EGNN.__init__-443"><a href="#EGNN.__init__-443"><span class="linenos">443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.__init__-444"><a href="#EGNN.__init__-444"><span class="linenos">444</span></a>            <span class="n">penultimate_edge_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EGNN.__init__-445"><a href="#EGNN.__init__-445"><span class="linenos">445</span></a>
</span><span id="EGNN.__init__-446"><a href="#EGNN.__init__-446"><span class="linenos">446</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN.__init__-447"><a href="#EGNN.__init__-447"><span class="linenos">447</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN.__init__-448"><a href="#EGNN.__init__-448"><span class="linenos">448</span></a>                <span class="o">*</span><span class="n">dims_edge</span><span class="p">,</span>
</span><span id="EGNN.__init__-449"><a href="#EGNN.__init__-449"><span class="linenos">449</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN.__init__-450"><a href="#EGNN.__init__-450"><span class="linenos">450</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-451"><a href="#EGNN.__init__-451"><span class="linenos">451</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-452"><a href="#EGNN.__init__-452"><span class="linenos">452</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-453"><a href="#EGNN.__init__-453"><span class="linenos">453</span></a>            <span class="p">),</span>
</span><span id="EGNN.__init__-454"><a href="#EGNN.__init__-454"><span class="linenos">454</span></a>            <span class="o">*</span><span class="n">penultimate_edge_activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-455"><a href="#EGNN.__init__-455"><span class="linenos">455</span></a>        <span class="p">)</span>
</span><span id="EGNN.__init__-456"><a href="#EGNN.__init__-456"><span class="linenos">456</span></a>
</span><span id="EGNN.__init__-457"><a href="#EGNN.__init__-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN.__init__-458"><a href="#EGNN.__init__-458"><span class="linenos">458</span></a>            <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN.__init__-459"><a href="#EGNN.__init__-459"><span class="linenos">459</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">,</span>
</span><span id="EGNN.__init__-460"><a href="#EGNN.__init__-460"><span class="linenos">460</span></a>                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN.__init__-461"><a href="#EGNN.__init__-461"><span class="linenos">461</span></a>                <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN.__init__-462"><a href="#EGNN.__init__-462"><span class="linenos">462</span></a>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-463"><a href="#EGNN.__init__-463"><span class="linenos">463</span></a>                <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-464"><a href="#EGNN.__init__-464"><span class="linenos">464</span></a>                <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-465"><a href="#EGNN.__init__-465"><span class="linenos">465</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-466"><a href="#EGNN.__init__-466"><span class="linenos">466</span></a>        <span class="p">)</span>
</span><span id="EGNN.__init__-467"><a href="#EGNN.__init__-467"><span class="linenos">467</span></a>
</span><span id="EGNN.__init__-468"><a href="#EGNN.__init__-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
</span><span id="EGNN.__init__-469"><a href="#EGNN.__init__-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="n">pos_scale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EGNN.__init__-470"><a href="#EGNN.__init__-470"><span class="linenos">470</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EGNN.__init__-471"><a href="#EGNN.__init__-471"><span class="linenos">471</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.__init__-472"><a href="#EGNN.__init__-472"><span class="linenos">472</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.__init__-473"><a href="#EGNN.__init__-473"><span class="linenos">473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
</span><span id="EGNN.__init__-474"><a href="#EGNN.__init__-474"><span class="linenos">474</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="EGNN.__init__-475"><a href="#EGNN.__init__-475"><span class="linenos">475</span></a>                        <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="EGNN.__init__-476"><a href="#EGNN.__init__-476"><span class="linenos">476</span></a>                        <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="EGNN.__init__-477"><a href="#EGNN.__init__-477"><span class="linenos">477</span></a>                    <span class="p">)</span>
</span><span id="EGNN.__init__-478"><a href="#EGNN.__init__-478"><span class="linenos">478</span></a>                <span class="p">)</span>
</span><span id="EGNN.__init__-479"><a href="#EGNN.__init__-479"><span class="linenos">479</span></a>                <span class="n">penultimate_pos_activation</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()]</span>
</span><span id="EGNN.__init__-480"><a href="#EGNN.__init__-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN.__init__-481"><a href="#EGNN.__init__-481"><span class="linenos">481</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN.__init__-482"><a href="#EGNN.__init__-482"><span class="linenos">482</span></a>                    <span class="o">*</span><span class="n">dims_pos</span><span class="p">,</span>
</span><span id="EGNN.__init__-483"><a href="#EGNN.__init__-483"><span class="linenos">483</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN.__init__-484"><a href="#EGNN.__init__-484"><span class="linenos">484</span></a>                    <span class="n">clamp</span><span class="o">=</span><span class="n">clamp</span><span class="p">,</span>
</span><span id="EGNN.__init__-485"><a href="#EGNN.__init__-485"><span class="linenos">485</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN.__init__-486"><a href="#EGNN.__init__-486"><span class="linenos">486</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-487"><a href="#EGNN.__init__-487"><span class="linenos">487</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-488"><a href="#EGNN.__init__-488"><span class="linenos">488</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-489"><a href="#EGNN.__init__-489"><span class="linenos">489</span></a>                <span class="p">),</span>
</span><span id="EGNN.__init__-490"><a href="#EGNN.__init__-490"><span class="linenos">490</span></a>                <span class="o">*</span><span class="n">penultimate_pos_activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-491"><a href="#EGNN.__init__-491"><span class="linenos">491</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-492"><a href="#EGNN.__init__-492"><span class="linenos">492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.__init__-493"><a href="#EGNN.__init__-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.__init__-494"><a href="#EGNN.__init__-494"><span class="linenos">494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.__init__-495"><a href="#EGNN.__init__-495"><span class="linenos">495</span></a>
</span><span id="EGNN.__init__-496"><a href="#EGNN.__init__-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">gate</span><span class="p">:</span>
</span><span id="EGNN.__init__-497"><a href="#EGNN.__init__-497"><span class="linenos">497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="EGNN.__init__-498"><a href="#EGNN.__init__-498"><span class="linenos">498</span></a>                <span class="o">*</span><span class="n">iter_net_segments</span><span class="p">(</span>
</span><span id="EGNN.__init__-499"><a href="#EGNN.__init__-499"><span class="linenos">499</span></a>                    <span class="o">*</span><span class="n">dims_gate</span><span class="p">,</span>
</span><span id="EGNN.__init__-500"><a href="#EGNN.__init__-500"><span class="linenos">500</span></a>                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span id="EGNN.__init__-501"><a href="#EGNN.__init__-501"><span class="linenos">501</span></a>                    <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="EGNN.__init__-502"><a href="#EGNN.__init__-502"><span class="linenos">502</span></a>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="EGNN.__init__-503"><a href="#EGNN.__init__-503"><span class="linenos">503</span></a>                    <span class="n">norm_cls</span><span class="o">=</span><span class="n">norm_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-504"><a href="#EGNN.__init__-504"><span class="linenos">504</span></a>                    <span class="n">dropout_cls</span><span class="o">=</span><span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="EGNN.__init__-505"><a href="#EGNN.__init__-505"><span class="linenos">505</span></a>                <span class="p">),</span>
</span><span id="EGNN.__init__-506"><a href="#EGNN.__init__-506"><span class="linenos">506</span></a>                <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
</span><span id="EGNN.__init__-507"><a href="#EGNN.__init__-507"><span class="linenos">507</span></a>            <span class="p">)</span>
</span><span id="EGNN.__init__-508"><a href="#EGNN.__init__-508"><span class="linenos">508</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.__init__-509"><a href="#EGNN.__init__-509"><span class="linenos">509</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.__init__-510"><a href="#EGNN.__init__-510"><span class="linenos">510</span></a>
</span><span id="EGNN.__init__-511"><a href="#EGNN.__init__-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="EGNN.__init__-512"><a href="#EGNN.__init__-512"><span class="linenos">512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="n">gnn</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">MessageNorm</span><span class="p">(</span><span class="n">learn_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="EGNN.__init__-513"><a href="#EGNN.__init__-513"><span class="linenos">513</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.__init__-514"><a href="#EGNN.__init__-514"><span class="linenos">514</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims_node:</strong>  Dimensions for the node network: <code>dims_node[0]</code> is the
number of input features and <code>dims_node[-1]</code> is the number of
output features.  At least 2 dimensions are required. All
remaining dimensions are used for the hidden-layers of the
network.</li>
<li><strong>dims_edge:</strong>  Dimensions for the edge network: <code>dims_edge[0]</code> is the
number of edge features (0 if graphs have no edge features),
<code>dims_edge[-1]</code> is the number of message features.  All
remaining dimensions are used for the hidden-layers of the edge
network that computes the messages.</li>
<li><strong>dims_gate:</strong>  Dimensions for the message gating network. If empty,
no message gating network will be created and message gating
will be disabled.</li>
<li><strong>dims_pos:</strong>  Dimensions for the coordinate update network. If empty,
no coordinate update network will be created and coordinate
updates will be disabled.</li>
<li><strong>num_pos:</strong>  Number of node positions. Each node can be assigned to one
position, but can also be assigned to multiple positions.</li>
<li><strong>num_encode:</strong>  Number of fourier-encoded features that are computed
from the distances between node coordinates. If <code><a href="#EGNN.num_encode">num_encode</a></code> is
even, only the fourier-encoded features will be used. If odd,
the original distances will also be used alongside the
fourier-encoded features.  Default is 1, which means that only
the original distances are used, without any fourier features.</li>
<li><strong>pos_scale:</strong>  Initial scaler for coordinate updates. If pos_scale is
0, the penultimate layer of the coordinate update network will
use a linear activation and omit the scaling factor.</li>
<li><strong>norm:</strong>  Whether to use layer and message normalization while computing
and aggregating messages.</li>
<li><strong>clamp:</strong>  Threshold for clamping coordinate updates (between <code>-clamp</code>
and <code>clamp</code>). Unclamped if 0.</li>
<li><strong>dropout:</strong>  Dropout probability in-between network layers. No dropout
if 0.</li>
<li><strong>activation:</strong>  Activation function that is used in-between network
layers.</li>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
The default non-linearity should adhere to whatever is used for
<code>activation</code>. See <code><a href="#parameter_init">parameter_init()</a></code>.</li>
<li><strong>norm_cls:</strong>  Class instance of normalization module.</li>
<li><strong>dropout_cls:</strong>  Class instance of dropout module.</li>
</ul>
</div>


                            </div>
                            <div id="EGNN.aggr_mean" class="classattr">
                                <div class="attr variable">
            <span class="name">aggr_mean</span>

        
    </div>
    <a class="headerlink" href="#EGNN.aggr_mean"></a>
    
    

                            </div>
                            <div id="EGNN.aggr_sum" class="classattr">
                                <div class="attr variable">
            <span class="name">aggr_sum</span>

        
    </div>
    <a class="headerlink" href="#EGNN.aggr_sum"></a>
    
    

                            </div>
                            <div id="EGNN.dims_node" class="classattr">
                                <div class="attr variable">
            <span class="name">dims_node</span>

        
    </div>
    <a class="headerlink" href="#EGNN.dims_node"></a>
    
    

                            </div>
                            <div id="EGNN.dims_edge" class="classattr">
                                <div class="attr variable">
            <span class="name">dims_edge</span>

        
    </div>
    <a class="headerlink" href="#EGNN.dims_edge"></a>
    
    

                            </div>
                            <div id="EGNN.dims_gate" class="classattr">
                                <div class="attr variable">
            <span class="name">dims_gate</span>

        
    </div>
    <a class="headerlink" href="#EGNN.dims_gate"></a>
    
    

                            </div>
                            <div id="EGNN.dims_pos" class="classattr">
                                <div class="attr variable">
            <span class="name">dims_pos</span>

        
    </div>
    <a class="headerlink" href="#EGNN.dims_pos"></a>
    
    

                            </div>
                            <div id="EGNN.num_pos" class="classattr">
                                <div class="attr variable">
            <span class="name">num_pos</span>

        
    </div>
    <a class="headerlink" href="#EGNN.num_pos"></a>
    
    

                            </div>
                            <div id="EGNN.num_encode" class="classattr">
                                <div class="attr variable">
            <span class="name">num_encode</span>

        
    </div>
    <a class="headerlink" href="#EGNN.num_encode"></a>
    
    

                            </div>
                            <div id="EGNN.update_pos" class="classattr">
                                <div class="attr variable">
            <span class="name">update_pos</span>

        
    </div>
    <a class="headerlink" href="#EGNN.update_pos"></a>
    
    

                            </div>
                            <div id="EGNN.gate_msg" class="classattr">
                                <div class="attr variable">
            <span class="name">gate_msg</span>

        
    </div>
    <a class="headerlink" href="#EGNN.gate_msg"></a>
    
    

                            </div>
                            <div id="EGNN.norm" class="classattr">
                                <div class="attr variable">
            <span class="name">norm</span>

        
    </div>
    <a class="headerlink" href="#EGNN.norm"></a>
    
    

                            </div>
                            <div id="EGNN.init" class="classattr">
                                <div class="attr variable">
            <span class="name">init</span>

        
    </div>
    <a class="headerlink" href="#EGNN.init"></a>
    
    

                            </div>
                            <div id="EGNN.edge_net" class="classattr">
                                <div class="attr variable">
            <span class="name">edge_net</span>

        
    </div>
    <a class="headerlink" href="#EGNN.edge_net"></a>
    
    

                            </div>
                            <div id="EGNN.node_net" class="classattr">
                                <div class="attr variable">
            <span class="name">node_net</span>

        
    </div>
    <a class="headerlink" href="#EGNN.node_net"></a>
    
    

                            </div>
                            <div id="EGNN.reset_parameters" class="classattr">
                                        <input id="EGNN.reset_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EGNN.reset_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.reset_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.reset_parameters-526"><a href="#EGNN.reset_parameters-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EGNN.reset_parameters-527"><a href="#EGNN.reset_parameters-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="EGNN.reset_parameters-528"><a href="#EGNN.reset_parameters-528"><span class="linenos">528</span></a>
</span><span id="EGNN.reset_parameters-529"><a href="#EGNN.reset_parameters-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.reset_parameters-530"><a href="#EGNN.reset_parameters-530"><span class="linenos">530</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
</span><span id="EGNN.reset_parameters-531"><a href="#EGNN.reset_parameters-531"><span class="linenos">531</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.reset_parameters-532"><a href="#EGNN.reset_parameters-532"><span class="linenos">532</span></a>            <span class="n">pos_net_nonlinearity</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
</span><span id="EGNN.reset_parameters-533"><a href="#EGNN.reset_parameters-533"><span class="linenos">533</span></a>
</span><span id="EGNN.reset_parameters-534"><a href="#EGNN.reset_parameters-534"><span class="linenos">534</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">)</span>
</span><span id="EGNN.reset_parameters-535"><a href="#EGNN.reset_parameters-535"><span class="linenos">535</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="EGNN.reset_parameters-536"><a href="#EGNN.reset_parameters-536"><span class="linenos">536</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">,</span> <span class="n">pos_net_nonlinearity</span><span class="p">)</span>
</span><span id="EGNN.reset_parameters-537"><a href="#EGNN.reset_parameters-537"><span class="linenos">537</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">,</span> <span class="s2">&quot;sigmoid&quot;</span><span class="p">)</span>
</span><span id="EGNN.reset_parameters-538"><a href="#EGNN.reset_parameters-538"><span class="linenos">538</span></a>        <span class="n">init_net_segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset parameters.</p>
</div>


                            </div>
                            <div id="EGNN.forward" class="classattr">
                                        <input id="EGNN.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">pos</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">edge_index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="EGNN.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.forward-540"><a href="#EGNN.forward-540"><span class="linenos">540</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="EGNN.forward-541"><a href="#EGNN.forward-541"><span class="linenos">541</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN.forward-542"><a href="#EGNN.forward-542"><span class="linenos">542</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN.forward-543"><a href="#EGNN.forward-543"><span class="linenos">543</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN.forward-544"><a href="#EGNN.forward-544"><span class="linenos">544</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="EGNN.forward-545"><a href="#EGNN.forward-545"><span class="linenos">545</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.forward-546"><a href="#EGNN.forward-546"><span class="linenos">546</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.forward-547"><a href="#EGNN.forward-547"><span class="linenos">547</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="EGNN.forward-548"><a href="#EGNN.forward-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="EGNN.forward-549"><a href="#EGNN.forward-549"><span class="linenos">549</span></a>
</span><span id="EGNN.forward-550"><a href="#EGNN.forward-550"><span class="linenos">550</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN.forward-551"><a href="#EGNN.forward-551"><span class="linenos">551</span></a><span class="sd">            x: Node features.</span>
</span><span id="EGNN.forward-552"><a href="#EGNN.forward-552"><span class="linenos">552</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="EGNN.forward-553"><a href="#EGNN.forward-553"><span class="linenos">553</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="EGNN.forward-554"><a href="#EGNN.forward-554"><span class="linenos">554</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="EGNN.forward-555"><a href="#EGNN.forward-555"><span class="linenos">555</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="EGNN.forward-556"><a href="#EGNN.forward-556"><span class="linenos">556</span></a>
</span><span id="EGNN.forward-557"><a href="#EGNN.forward-557"><span class="linenos">557</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN.forward-558"><a href="#EGNN.forward-558"><span class="linenos">558</span></a><span class="sd">            Tuple of updated node features and coordinates.</span>
</span><span id="EGNN.forward-559"><a href="#EGNN.forward-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN.forward-560"><a href="#EGNN.forward-560"><span class="linenos">560</span></a>
</span><span id="EGNN.forward-561"><a href="#EGNN.forward-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">():</span>
</span><span id="EGNN.forward-562"><a href="#EGNN.forward-562"><span class="linenos">562</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN.forward-563"><a href="#EGNN.forward-563"><span class="linenos">563</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EGNN.forward-564"><a href="#EGNN.forward-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.forward-565"><a href="#EGNN.forward-565"><span class="linenos">565</span></a>            <span class="n">pos_is_unsqueezed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EGNN.forward-566"><a href="#EGNN.forward-566"><span class="linenos">566</span></a>
</span><span id="EGNN.forward-567"><a href="#EGNN.forward-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="EGNN.forward-568"><a href="#EGNN.forward-568"><span class="linenos">568</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span>
</span><span id="EGNN.forward-569"><a href="#EGNN.forward-569"><span class="linenos">569</span></a>            <span class="n">edge_index</span><span class="o">=</span><span class="n">edge_index</span><span class="p">,</span>
</span><span id="EGNN.forward-570"><a href="#EGNN.forward-570"><span class="linenos">570</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="EGNN.forward-571"><a href="#EGNN.forward-571"><span class="linenos">571</span></a>            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
</span><span id="EGNN.forward-572"><a href="#EGNN.forward-572"><span class="linenos">572</span></a>            <span class="n">edge_attr</span><span class="o">=</span><span class="n">edge_attr</span><span class="p">,</span>
</span><span id="EGNN.forward-573"><a href="#EGNN.forward-573"><span class="linenos">573</span></a>            <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span>
</span><span id="EGNN.forward-574"><a href="#EGNN.forward-574"><span class="linenos">574</span></a>        <span class="p">)</span>
</span><span id="EGNN.forward-575"><a href="#EGNN.forward-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span> <span class="o">-=</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span>
</span><span id="EGNN.forward-576"><a href="#EGNN.forward-576"><span class="linenos">576</span></a>
</span><span id="EGNN.forward-577"><a href="#EGNN.forward-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="n">pos_is_unsqueezed</span><span class="p">:</span>
</span><span id="EGNN.forward-578"><a href="#EGNN.forward-578"><span class="linenos">578</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="EGNN.forward-579"><a href="#EGNN.forward-579"><span class="linenos">579</span></a>
</span><span id="EGNN.forward-580"><a href="#EGNN.forward-580"><span class="linenos">580</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            <div class="docstring"><p>Compute forward pass.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x:</strong>  Node features.</li>
<li><strong>pos:</strong>  Node coordinates.</li>
<li><strong>edge_index:</strong>  Graph connectivity.</li>
<li><strong>edge_attr:</strong>  Edge features.</li>
<li><strong>batch:</strong>  Node to batch mapping.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of updated node features and coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div id="EGNN.message" class="classattr">
                                        <input id="EGNN.message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">message</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x_i</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">x_j</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">pos_i</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">pos_j</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="EGNN.message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.message-582"><a href="#EGNN.message-582"><span class="linenos">582</span></a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span>
</span><span id="EGNN.message-583"><a href="#EGNN.message-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN.message-584"><a href="#EGNN.message-584"><span class="linenos">584</span></a>        <span class="n">x_i</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN.message-585"><a href="#EGNN.message-585"><span class="linenos">585</span></a>        <span class="n">x_j</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN.message-586"><a href="#EGNN.message-586"><span class="linenos">586</span></a>        <span class="n">pos_i</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="EGNN.message-587"><a href="#EGNN.message-587"><span class="linenos">587</span></a>        <span class="n">pos_j</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="EGNN.message-588"><a href="#EGNN.message-588"><span class="linenos">588</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.message-589"><a href="#EGNN.message-589"><span class="linenos">589</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN.message-590"><a href="#EGNN.message-590"><span class="linenos">590</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute messages.</span>
</span><span id="EGNN.message-591"><a href="#EGNN.message-591"><span class="linenos">591</span></a>
</span><span id="EGNN.message-592"><a href="#EGNN.message-592"><span class="linenos">592</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN.message-593"><a href="#EGNN.message-593"><span class="linenos">593</span></a><span class="sd">            x_i: Source node features.</span>
</span><span id="EGNN.message-594"><a href="#EGNN.message-594"><span class="linenos">594</span></a><span class="sd">            x_j: Target node features.</span>
</span><span id="EGNN.message-595"><a href="#EGNN.message-595"><span class="linenos">595</span></a><span class="sd">            pos_i: Source node coordinates.</span>
</span><span id="EGNN.message-596"><a href="#EGNN.message-596"><span class="linenos">596</span></a><span class="sd">            pos_j: Target node coordinates.</span>
</span><span id="EGNN.message-597"><a href="#EGNN.message-597"><span class="linenos">597</span></a><span class="sd">            edge_attr: Edge features; between source and target node.</span>
</span><span id="EGNN.message-598"><a href="#EGNN.message-598"><span class="linenos">598</span></a>
</span><span id="EGNN.message-599"><a href="#EGNN.message-599"><span class="linenos">599</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN.message-600"><a href="#EGNN.message-600"><span class="linenos">600</span></a><span class="sd">            Tuple of messages between source and target nodes, and difference</span>
</span><span id="EGNN.message-601"><a href="#EGNN.message-601"><span class="linenos">601</span></a><span class="sd">            between source and target node coordinates.</span>
</span><span id="EGNN.message-602"><a href="#EGNN.message-602"><span class="linenos">602</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN.message-603"><a href="#EGNN.message-603"><span class="linenos">603</span></a>
</span><span id="EGNN.message-604"><a href="#EGNN.message-604"><span class="linenos">604</span></a>        <span class="n">msg_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_i</span><span class="p">,</span> <span class="n">x_j</span><span class="p">]</span>
</span><span id="EGNN.message-605"><a href="#EGNN.message-605"><span class="linenos">605</span></a>
</span><span id="EGNN.message-606"><a href="#EGNN.message-606"><span class="linenos">606</span></a>        <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">pos_i</span> <span class="o">-</span> <span class="n">pos_j</span>
</span><span id="EGNN.message-607"><a href="#EGNN.message-607"><span class="linenos">607</span></a>        <span class="n">dst_ij</span> <span class="o">=</span> <span class="n">vec_ij</span><span class="o">.</span><span class="n">square</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EGNN.message-608"><a href="#EGNN.message-608"><span class="linenos">608</span></a>        <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fourier_encode</span><span class="p">(</span><span class="n">dst_ij</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_encode</span><span class="p">))</span>
</span><span id="EGNN.message-609"><a href="#EGNN.message-609"><span class="linenos">609</span></a>
</span><span id="EGNN.message-610"><a href="#EGNN.message-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">edge_attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.message-611"><a href="#EGNN.message-611"><span class="linenos">611</span></a>            <span class="n">msg_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_attr</span><span class="p">)</span>
</span><span id="EGNN.message-612"><a href="#EGNN.message-612"><span class="linenos">612</span></a>
</span><span id="EGNN.message-613"><a href="#EGNN.message-613"><span class="linenos">613</span></a>        <span class="n">msg_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">msg_input</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="EGNN.message-614"><a href="#EGNN.message-614"><span class="linenos">614</span></a>
</span><span id="EGNN.message-615"><a href="#EGNN.message-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.message-616"><a href="#EGNN.message-616"><span class="linenos">616</span></a>            <span class="n">force_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN.message-617"><a href="#EGNN.message-617"><span class="linenos">617</span></a>            <span class="n">norm_ij</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_ij</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</span><span id="EGNN.message-618"><a href="#EGNN.message-618"><span class="linenos">618</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.message-619"><a href="#EGNN.message-619"><span class="linenos">619</span></a>                <span class="n">force_ij</span> <span class="o">=</span> <span class="n">force_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span>
</span><span id="EGNN.message-620"><a href="#EGNN.message-620"><span class="linenos">620</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">vec_ij</span> <span class="o">*</span> <span class="p">(</span><span class="n">force_ij</span> <span class="o">/</span> <span class="n">norm_ij</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EGNN.message-621"><a href="#EGNN.message-621"><span class="linenos">621</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.message-622"><a href="#EGNN.message-622"><span class="linenos">622</span></a>            <span class="n">vec_ij</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.message-623"><a href="#EGNN.message-623"><span class="linenos">623</span></a>
</span><span id="EGNN.message-624"><a href="#EGNN.message-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.message-625"><a href="#EGNN.message-625"><span class="linenos">625</span></a>            <span class="n">msg_ij</span> <span class="o">=</span> <span class="n">msg_ij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_net</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN.message-626"><a href="#EGNN.message-626"><span class="linenos">626</span></a>
</span><span id="EGNN.message-627"><a href="#EGNN.message-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span>
</span></pre></div>


            <div class="docstring"><p>Compute messages.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x_i:</strong>  Source node features.</li>
<li><strong>x_j:</strong>  Target node features.</li>
<li><strong>pos_i:</strong>  Source node coordinates.</li>
<li><strong>pos_j:</strong>  Target node coordinates.</li>
<li><strong>edge_attr:</strong>  Edge features; between source and target node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of messages between source and target nodes, and difference
  between source and target node coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div id="EGNN.aggregate" class="classattr">
                                        <input id="EGNN.aggregate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">aggregate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>,</span><span class="param">	<span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ptr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dim_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="EGNN.aggregate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.aggregate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.aggregate-629"><a href="#EGNN.aggregate-629"><span class="linenos">629</span></a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span>
</span><span id="EGNN.aggregate-630"><a href="#EGNN.aggregate-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN.aggregate-631"><a href="#EGNN.aggregate-631"><span class="linenos">631</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="EGNN.aggregate-632"><a href="#EGNN.aggregate-632"><span class="linenos">632</span></a>        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.aggregate-633"><a href="#EGNN.aggregate-633"><span class="linenos">633</span></a>        <span class="n">ptr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.aggregate-634"><a href="#EGNN.aggregate-634"><span class="linenos">634</span></a>        <span class="n">dim_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.aggregate-635"><a href="#EGNN.aggregate-635"><span class="linenos">635</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN.aggregate-636"><a href="#EGNN.aggregate-636"><span class="linenos">636</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate messages.</span>
</span><span id="EGNN.aggregate-637"><a href="#EGNN.aggregate-637"><span class="linenos">637</span></a>
</span><span id="EGNN.aggregate-638"><a href="#EGNN.aggregate-638"><span class="linenos">638</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN.aggregate-639"><a href="#EGNN.aggregate-639"><span class="linenos">639</span></a><span class="sd">            messages: Tuple of messages and coordinate differences between</span>
</span><span id="EGNN.aggregate-640"><a href="#EGNN.aggregate-640"><span class="linenos">640</span></a><span class="sd">                nodes.</span>
</span><span id="EGNN.aggregate-641"><a href="#EGNN.aggregate-641"><span class="linenos">641</span></a><span class="sd">            index: Indices of elements for applying the aggregation. Either</span>
</span><span id="EGNN.aggregate-642"><a href="#EGNN.aggregate-642"><span class="linenos">642</span></a><span class="sd">                `index` or `ptr` must be defined.</span>
</span><span id="EGNN.aggregate-643"><a href="#EGNN.aggregate-643"><span class="linenos">643</span></a><span class="sd">            ptr: Offsets for computing the aggregation based on sorted inputs,</span>
</span><span id="EGNN.aggregate-644"><a href="#EGNN.aggregate-644"><span class="linenos">644</span></a><span class="sd">                if provided. Either `index` or `ptr` must be defined.</span>
</span><span id="EGNN.aggregate-645"><a href="#EGNN.aggregate-645"><span class="linenos">645</span></a><span class="sd">            dim_size: Size of output at dimension `self.node_dim` after</span>
</span><span id="EGNN.aggregate-646"><a href="#EGNN.aggregate-646"><span class="linenos">646</span></a><span class="sd">                aggregation.</span>
</span><span id="EGNN.aggregate-647"><a href="#EGNN.aggregate-647"><span class="linenos">647</span></a>
</span><span id="EGNN.aggregate-648"><a href="#EGNN.aggregate-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN.aggregate-649"><a href="#EGNN.aggregate-649"><span class="linenos">649</span></a><span class="sd">            Tuple of aggregated messages and aggregated coordinate updates.</span>
</span><span id="EGNN.aggregate-650"><a href="#EGNN.aggregate-650"><span class="linenos">650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN.aggregate-651"><a href="#EGNN.aggregate-651"><span class="linenos">651</span></a>
</span><span id="EGNN.aggregate-652"><a href="#EGNN.aggregate-652"><span class="linenos">652</span></a>        <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="EGNN.aggregate-653"><a href="#EGNN.aggregate-653"><span class="linenos">653</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_mean</span><span class="p">(</span>
</span><span id="EGNN.aggregate-654"><a href="#EGNN.aggregate-654"><span class="linenos">654</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="EGNN.aggregate-655"><a href="#EGNN.aggregate-655"><span class="linenos">655</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="EGNN.aggregate-656"><a href="#EGNN.aggregate-656"><span class="linenos">656</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="EGNN.aggregate-657"><a href="#EGNN.aggregate-657"><span class="linenos">657</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="EGNN.aggregate-658"><a href="#EGNN.aggregate-658"><span class="linenos">658</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="EGNN.aggregate-659"><a href="#EGNN.aggregate-659"><span class="linenos">659</span></a>            <span class="p">)</span>
</span><span id="EGNN.aggregate-660"><a href="#EGNN.aggregate-660"><span class="linenos">660</span></a>
</span><span id="EGNN.aggregate-661"><a href="#EGNN.aggregate-661"><span class="linenos">661</span></a>        <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="EGNN.aggregate-662"><a href="#EGNN.aggregate-662"><span class="linenos">662</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggr_sum</span><span class="p">(</span>
</span><span id="EGNN.aggregate-663"><a href="#EGNN.aggregate-663"><span class="linenos">663</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="EGNN.aggregate-664"><a href="#EGNN.aggregate-664"><span class="linenos">664</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="EGNN.aggregate-665"><a href="#EGNN.aggregate-665"><span class="linenos">665</span></a>                <span class="n">ptr</span><span class="p">,</span>
</span><span id="EGNN.aggregate-666"><a href="#EGNN.aggregate-666"><span class="linenos">666</span></a>                <span class="n">dim_size</span><span class="p">,</span>
</span><span id="EGNN.aggregate-667"><a href="#EGNN.aggregate-667"><span class="linenos">667</span></a>                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dim</span><span class="p">,</span>
</span><span id="EGNN.aggregate-668"><a href="#EGNN.aggregate-668"><span class="linenos">668</span></a>            <span class="p">)</span>
</span><span id="EGNN.aggregate-669"><a href="#EGNN.aggregate-669"><span class="linenos">669</span></a>
</span><span id="EGNN.aggregate-670"><a href="#EGNN.aggregate-670"><span class="linenos">670</span></a>        <span class="n">msg_ij</span><span class="p">,</span> <span class="n">vec_ij</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="EGNN.aggregate-671"><a href="#EGNN.aggregate-671"><span class="linenos">671</span></a>
</span><span id="EGNN.aggregate-672"><a href="#EGNN.aggregate-672"><span class="linenos">672</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">msg_ij</span><span class="p">)</span>
</span><span id="EGNN.aggregate-673"><a href="#EGNN.aggregate-673"><span class="linenos">673</span></a>
</span><span id="EGNN.aggregate-674"><a href="#EGNN.aggregate-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="n">vec_ij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.aggregate-675"><a href="#EGNN.aggregate-675"><span class="linenos">675</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">vec_ij</span><span class="p">)</span>
</span><span id="EGNN.aggregate-676"><a href="#EGNN.aggregate-676"><span class="linenos">676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EGNN.aggregate-677"><a href="#EGNN.aggregate-677"><span class="linenos">677</span></a>            <span class="n">pos_update</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EGNN.aggregate-678"><a href="#EGNN.aggregate-678"><span class="linenos">678</span></a>
</span><span id="EGNN.aggregate-679"><a href="#EGNN.aggregate-679"><span class="linenos">679</span></a>        <span class="k">return</span> <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span>
</span></pre></div>


            <div class="docstring"><p>Aggregate messages.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>messages:</strong>  Tuple of messages and coordinate differences between
nodes.</li>
<li><strong>index:</strong>  Indices of elements for applying the aggregation. Either
<code>index</code> or <code>ptr</code> must be defined.</li>
<li><strong>ptr:</strong>  Offsets for computing the aggregation based on sorted inputs,
if provided. Either <code>index</code> or <code>ptr</code> must be defined.</li>
<li><strong>dim_size:</strong>  Size of output at dimension <code>self.node_dim</code> after
aggregation.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of aggregated messages and aggregated coordinate updates.</p>
</blockquote>
</div>


                            </div>
                            <div id="EGNN.update" class="classattr">
                                        <input id="EGNN.update-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="EGNN.update-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EGNN.update"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EGNN.update-681"><a href="#EGNN.update-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
</span><span id="EGNN.update-682"><a href="#EGNN.update-682"><span class="linenos">682</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EGNN.update-683"><a href="#EGNN.update-683"><span class="linenos">683</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="EGNN.update-684"><a href="#EGNN.update-684"><span class="linenos">684</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="EGNN.update-685"><a href="#EGNN.update-685"><span class="linenos">685</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EGNN.update-686"><a href="#EGNN.update-686"><span class="linenos">686</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
</span><span id="EGNN.update-687"><a href="#EGNN.update-687"><span class="linenos">687</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update nodes.</span>
</span><span id="EGNN.update-688"><a href="#EGNN.update-688"><span class="linenos">688</span></a>
</span><span id="EGNN.update-689"><a href="#EGNN.update-689"><span class="linenos">689</span></a><span class="sd">        Arguments:</span>
</span><span id="EGNN.update-690"><a href="#EGNN.update-690"><span class="linenos">690</span></a><span class="sd">            messages: Tuple of aggregated messages and coordinate differences.</span>
</span><span id="EGNN.update-691"><a href="#EGNN.update-691"><span class="linenos">691</span></a><span class="sd">            x: Node features.</span>
</span><span id="EGNN.update-692"><a href="#EGNN.update-692"><span class="linenos">692</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="EGNN.update-693"><a href="#EGNN.update-693"><span class="linenos">693</span></a>
</span><span id="EGNN.update-694"><a href="#EGNN.update-694"><span class="linenos">694</span></a><span class="sd">        Returns:</span>
</span><span id="EGNN.update-695"><a href="#EGNN.update-695"><span class="linenos">695</span></a><span class="sd">            Tuple of updated node features and updated node coordinates.</span>
</span><span id="EGNN.update-696"><a href="#EGNN.update-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EGNN.update-697"><a href="#EGNN.update-697"><span class="linenos">697</span></a>
</span><span id="EGNN.update-698"><a href="#EGNN.update-698"><span class="linenos">698</span></a>        <span class="n">msg</span><span class="p">,</span> <span class="n">pos_update</span> <span class="o">=</span> <span class="n">messages</span>
</span><span id="EGNN.update-699"><a href="#EGNN.update-699"><span class="linenos">699</span></a>
</span><span id="EGNN.update-700"><a href="#EGNN.update-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">:</span>
</span><span id="EGNN.update-701"><a href="#EGNN.update-701"><span class="linenos">701</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="EGNN.update-702"><a href="#EGNN.update-702"><span class="linenos">702</span></a>
</span><span id="EGNN.update-703"><a href="#EGNN.update-703"><span class="linenos">703</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_net</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">msg</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="EGNN.update-704"><a href="#EGNN.update-704"><span class="linenos">704</span></a>
</span><span id="EGNN.update-705"><a href="#EGNN.update-705"><span class="linenos">705</span></a>        <span class="k">if</span> <span class="n">pos_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EGNN.update-706"><a href="#EGNN.update-706"><span class="linenos">706</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">pos_update</span>
</span><span id="EGNN.update-707"><a href="#EGNN.update-707"><span class="linenos">707</span></a>
</span><span id="EGNN.update-708"><a href="#EGNN.update-708"><span class="linenos">708</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            <div class="docstring"><p>Update nodes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>messages:</strong>  Tuple of aggregated messages and coordinate differences.</li>
<li><strong>x:</strong>  Node features.</li>
<li><strong>pos:</strong>  Node coordinates.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of updated node features and updated node coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>torch_geometric.nn.conv.message_passing.MessagePassing</dt>
                                <dd id="EGNN.special_args" class="variable">special_args</dd>
                <dd id="EGNN.aggr" class="variable">aggr</dd>
                <dd id="EGNN.aggr_module" class="variable">aggr_module</dd>
                <dd id="EGNN.flow" class="variable">flow</dd>
                <dd id="EGNN.node_dim" class="variable">node_dim</dd>
                <dd id="EGNN.inspector" class="variable">inspector</dd>
                <dd id="EGNN.fuse" class="variable">fuse</dd>
                <dd id="EGNN.decomposed_layers" class="variable">decomposed_layers</dd>
                <dd id="EGNN.propagate" class="function">propagate</dd>
                <dd id="EGNN.message_and_aggregate" class="function">message_and_aggregate</dd>
                <dd id="EGNN.edge_updater" class="function">edge_updater</dd>
                <dd id="EGNN.edge_update" class="function">edge_update</dd>
                <dd id="EGNN.explain" class="variable">explain</dd>
                <dd id="EGNN.explain_message" class="function">explain_message</dd>
                <dd id="EGNN.register_propagate_forward_pre_hook" class="function">register_propagate_forward_pre_hook</dd>
                <dd id="EGNN.register_propagate_forward_hook" class="function">register_propagate_forward_hook</dd>
                <dd id="EGNN.register_message_forward_pre_hook" class="function">register_message_forward_pre_hook</dd>
                <dd id="EGNN.register_message_forward_hook" class="function">register_message_forward_hook</dd>
                <dd id="EGNN.register_aggregate_forward_pre_hook" class="function">register_aggregate_forward_pre_hook</dd>
                <dd id="EGNN.register_aggregate_forward_hook" class="function">register_aggregate_forward_hook</dd>
                <dd id="EGNN.register_message_and_aggregate_forward_pre_hook" class="function">register_message_and_aggregate_forward_pre_hook</dd>
                <dd id="EGNN.register_message_and_aggregate_forward_hook" class="function">register_message_and_aggregate_forward_hook</dd>
                <dd id="EGNN.register_edge_update_forward_pre_hook" class="function">register_edge_update_forward_pre_hook</dd>
                <dd id="EGNN.register_edge_update_forward_hook" class="function">register_edge_update_forward_hook</dd>
                <dd id="EGNN.jittable" class="function">jittable</dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="EGNN.dump_patches" class="variable">dump_patches</dd>
                <dd id="EGNN.training" class="variable">training</dd>
                <dd id="EGNN.call_super_init" class="variable">call_super_init</dd>
                <dd id="EGNN.register_buffer" class="function">register_buffer</dd>
                <dd id="EGNN.register_parameter" class="function">register_parameter</dd>
                <dd id="EGNN.add_module" class="function">add_module</dd>
                <dd id="EGNN.register_module" class="function">register_module</dd>
                <dd id="EGNN.get_submodule" class="function">get_submodule</dd>
                <dd id="EGNN.get_parameter" class="function">get_parameter</dd>
                <dd id="EGNN.get_buffer" class="function">get_buffer</dd>
                <dd id="EGNN.get_extra_state" class="function">get_extra_state</dd>
                <dd id="EGNN.set_extra_state" class="function">set_extra_state</dd>
                <dd id="EGNN.apply" class="function">apply</dd>
                <dd id="EGNN.cuda" class="function">cuda</dd>
                <dd id="EGNN.ipu" class="function">ipu</dd>
                <dd id="EGNN.xpu" class="function">xpu</dd>
                <dd id="EGNN.cpu" class="function">cpu</dd>
                <dd id="EGNN.type" class="function">type</dd>
                <dd id="EGNN.float" class="function">float</dd>
                <dd id="EGNN.double" class="function">double</dd>
                <dd id="EGNN.half" class="function">half</dd>
                <dd id="EGNN.bfloat16" class="function">bfloat16</dd>
                <dd id="EGNN.to_empty" class="function">to_empty</dd>
                <dd id="EGNN.to" class="function">to</dd>
                <dd id="EGNN.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="EGNN.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="EGNN.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="EGNN.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="EGNN.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="EGNN.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="EGNN.state_dict" class="function">state_dict</dd>
                <dd id="EGNN.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="EGNN.load_state_dict" class="function">load_state_dict</dd>
                <dd id="EGNN.parameters" class="function">parameters</dd>
                <dd id="EGNN.named_parameters" class="function">named_parameters</dd>
                <dd id="EGNN.buffers" class="function">buffers</dd>
                <dd id="EGNN.named_buffers" class="function">named_buffers</dd>
                <dd id="EGNN.children" class="function">children</dd>
                <dd id="EGNN.named_children" class="function">named_children</dd>
                <dd id="EGNN.modules" class="function">modules</dd>
                <dd id="EGNN.named_modules" class="function">named_modules</dd>
                <dd id="EGNN.train" class="function">train</dd>
                <dd id="EGNN.eval" class="function">eval</dd>
                <dd id="EGNN.requires_grad_" class="function">requires_grad_</dd>
                <dd id="EGNN.zero_grad" class="function">zero_grad</dd>
                <dd id="EGNN.share_memory" class="function">share_memory</dd>
                <dd id="EGNN.extra_repr" class="function">extra_repr</dd>
                <dd id="EGNN.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DeepEGNN">
                            <input id="DeepEGNN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DeepEGNN</span><wbr>(<span class="base">torch.nn.modules.module.Module</span>):

                <label class="view-source-button" for="DeepEGNN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepEGNN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepEGNN-711"><a href="#DeepEGNN-711"><span class="linenos"> 711</span></a><span class="k">class</span> <span class="nc">DeepEGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="DeepEGNN-712"><a href="#DeepEGNN-712"><span class="linenos"> 712</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deep E(n) Equivariant Neural Network.</span>
</span><span id="DeepEGNN-713"><a href="#DeepEGNN-713"><span class="linenos"> 713</span></a>
</span><span id="DeepEGNN-714"><a href="#DeepEGNN-714"><span class="linenos"> 714</span></a><span class="sd">    Implementation of an E(n) Equivariant Neural Network with :class:`EGNN` as</span>
</span><span id="DeepEGNN-715"><a href="#DeepEGNN-715"><span class="linenos"> 715</span></a><span class="sd">    its layers.</span>
</span><span id="DeepEGNN-716"><a href="#DeepEGNN-716"><span class="linenos"> 716</span></a>
</span><span id="DeepEGNN-717"><a href="#DeepEGNN-717"><span class="linenos"> 717</span></a><span class="sd">    Arguments can be broadcasted to individual layers during initialization. For</span>
</span><span id="DeepEGNN-718"><a href="#DeepEGNN-718"><span class="linenos"> 718</span></a><span class="sd">    example, if `layers = 4` and `dims_node = (64, 32)`, then `dims_node` will</span>
</span><span id="DeepEGNN-719"><a href="#DeepEGNN-719"><span class="linenos"> 719</span></a><span class="sd">    be used for each of the 4 layers to initialize the hidden and output layer</span>
</span><span id="DeepEGNN-720"><a href="#DeepEGNN-720"><span class="linenos"> 720</span></a><span class="sd">    of the node network. If on the other hand `dims_node = [(64, 32), (128, 64),</span>
</span><span id="DeepEGNN-721"><a href="#DeepEGNN-721"><span class="linenos"> 721</span></a><span class="sd">    (128, 64), (64, 32)]`, then the first and last layer will use `(64, 32)` and</span>
</span><span id="DeepEGNN-722"><a href="#DeepEGNN-722"><span class="linenos"> 722</span></a><span class="sd">    the second and third layer will use `(128, 64)` to initialize their hidden</span>
</span><span id="DeepEGNN-723"><a href="#DeepEGNN-723"><span class="linenos"> 723</span></a><span class="sd">    and output layers.</span>
</span><span id="DeepEGNN-724"><a href="#DeepEGNN-724"><span class="linenos"> 724</span></a>
</span><span id="DeepEGNN-725"><a href="#DeepEGNN-725"><span class="linenos"> 725</span></a><span class="sd">    Example:</span>
</span><span id="DeepEGNN-726"><a href="#DeepEGNN-726"><span class="linenos"> 726</span></a><span class="sd">        DeepEGNN instance with 16 input and 64 output features with 2 EGNN</span>
</span><span id="DeepEGNN-727"><a href="#DeepEGNN-727"><span class="linenos"> 727</span></a><span class="sd">        layers each having 64 and 128 hidden node features and 32 and 64</span>
</span><span id="DeepEGNN-728"><a href="#DeepEGNN-728"><span class="linenos"> 728</span></a><span class="sd">        intermediate output node features.</span>
</span><span id="DeepEGNN-729"><a href="#DeepEGNN-729"><span class="linenos"> 729</span></a>
</span><span id="DeepEGNN-730"><a href="#DeepEGNN-730"><span class="linenos"> 730</span></a><span class="sd">        &gt;&gt;&gt; from egnn import DeepEGNN</span>
</span><span id="DeepEGNN-731"><a href="#DeepEGNN-731"><span class="linenos"> 731</span></a><span class="sd">        &gt;&gt;&gt; fn = DeepEGNN(</span>
</span><span id="DeepEGNN-732"><a href="#DeepEGNN-732"><span class="linenos"> 732</span></a><span class="sd">        ...     dims_node=[(16, 64, 32), (128, 64)],</span>
</span><span id="DeepEGNN-733"><a href="#DeepEGNN-733"><span class="linenos"> 733</span></a><span class="sd">        ...     dims_edge=[(0, 64, 32, 64)],</span>
</span><span id="DeepEGNN-734"><a href="#DeepEGNN-734"><span class="linenos"> 734</span></a><span class="sd">        ...     layers=2,</span>
</span><span id="DeepEGNN-735"><a href="#DeepEGNN-735"><span class="linenos"> 735</span></a><span class="sd">        ... )</span>
</span><span id="DeepEGNN-736"><a href="#DeepEGNN-736"><span class="linenos"> 736</span></a><span class="sd">        &gt;&gt;&gt; fn</span>
</span><span id="DeepEGNN-737"><a href="#DeepEGNN-737"><span class="linenos"> 737</span></a><span class="sd">        DeepEGNN(</span>
</span><span id="DeepEGNN-738"><a href="#DeepEGNN-738"><span class="linenos"> 738</span></a><span class="sd">          (layers): ModuleList(</span>
</span><span id="DeepEGNN-739"><a href="#DeepEGNN-739"><span class="linenos"> 739</span></a><span class="sd">            (0): ModuleDict(</span>
</span><span id="DeepEGNN-740"><a href="#DeepEGNN-740"><span class="linenos"> 740</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="DeepEGNN-741"><a href="#DeepEGNN-741"><span class="linenos"> 741</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="DeepEGNN-742"><a href="#DeepEGNN-742"><span class="linenos"> 742</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="DeepEGNN-743"><a href="#DeepEGNN-743"><span class="linenos"> 743</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="DeepEGNN-744"><a href="#DeepEGNN-744"><span class="linenos"> 744</span></a><span class="sd">                  (0): Linear(in_features=33, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-745"><a href="#DeepEGNN-745"><span class="linenos"> 745</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-746"><a href="#DeepEGNN-746"><span class="linenos"> 746</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="DeepEGNN-747"><a href="#DeepEGNN-747"><span class="linenos"> 747</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-748"><a href="#DeepEGNN-748"><span class="linenos"> 748</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-749"><a href="#DeepEGNN-749"><span class="linenos"> 749</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-750"><a href="#DeepEGNN-750"><span class="linenos"> 750</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-751"><a href="#DeepEGNN-751"><span class="linenos"> 751</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="DeepEGNN-752"><a href="#DeepEGNN-752"><span class="linenos"> 752</span></a><span class="sd">                  (0): Linear(in_features=80, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-753"><a href="#DeepEGNN-753"><span class="linenos"> 753</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-754"><a href="#DeepEGNN-754"><span class="linenos"> 754</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="DeepEGNN-755"><a href="#DeepEGNN-755"><span class="linenos"> 755</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-756"><a href="#DeepEGNN-756"><span class="linenos"> 756</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-757"><a href="#DeepEGNN-757"><span class="linenos"> 757</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="DeepEGNN-758"><a href="#DeepEGNN-758"><span class="linenos"> 758</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="DeepEGNN-759"><a href="#DeepEGNN-759"><span class="linenos"> 759</span></a><span class="sd">                (x): Identity()</span>
</span><span id="DeepEGNN-760"><a href="#DeepEGNN-760"><span class="linenos"> 760</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="DeepEGNN-761"><a href="#DeepEGNN-761"><span class="linenos"> 761</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-762"><a href="#DeepEGNN-762"><span class="linenos"> 762</span></a><span class="sd">            )</span>
</span><span id="DeepEGNN-763"><a href="#DeepEGNN-763"><span class="linenos"> 763</span></a><span class="sd">            (1): ModuleDict(</span>
</span><span id="DeepEGNN-764"><a href="#DeepEGNN-764"><span class="linenos"> 764</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="DeepEGNN-765"><a href="#DeepEGNN-765"><span class="linenos"> 765</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="DeepEGNN-766"><a href="#DeepEGNN-766"><span class="linenos"> 766</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="DeepEGNN-767"><a href="#DeepEGNN-767"><span class="linenos"> 767</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="DeepEGNN-768"><a href="#DeepEGNN-768"><span class="linenos"> 768</span></a><span class="sd">                  (0): Linear(in_features=65, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-769"><a href="#DeepEGNN-769"><span class="linenos"> 769</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-770"><a href="#DeepEGNN-770"><span class="linenos"> 770</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="DeepEGNN-771"><a href="#DeepEGNN-771"><span class="linenos"> 771</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-772"><a href="#DeepEGNN-772"><span class="linenos"> 772</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-773"><a href="#DeepEGNN-773"><span class="linenos"> 773</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-774"><a href="#DeepEGNN-774"><span class="linenos"> 774</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-775"><a href="#DeepEGNN-775"><span class="linenos"> 775</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="DeepEGNN-776"><a href="#DeepEGNN-776"><span class="linenos"> 776</span></a><span class="sd">                  (0): Linear(in_features=96, out_features=128, bias=True)</span>
</span><span id="DeepEGNN-777"><a href="#DeepEGNN-777"><span class="linenos"> 777</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-778"><a href="#DeepEGNN-778"><span class="linenos"> 778</span></a><span class="sd">                  (2): Linear(in_features=128, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-779"><a href="#DeepEGNN-779"><span class="linenos"> 779</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-780"><a href="#DeepEGNN-780"><span class="linenos"> 780</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-781"><a href="#DeepEGNN-781"><span class="linenos"> 781</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="DeepEGNN-782"><a href="#DeepEGNN-782"><span class="linenos"> 782</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="DeepEGNN-783"><a href="#DeepEGNN-783"><span class="linenos"> 783</span></a><span class="sd">                (x): Identity()</span>
</span><span id="DeepEGNN-784"><a href="#DeepEGNN-784"><span class="linenos"> 784</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="DeepEGNN-785"><a href="#DeepEGNN-785"><span class="linenos"> 785</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-786"><a href="#DeepEGNN-786"><span class="linenos"> 786</span></a><span class="sd">            )</span>
</span><span id="DeepEGNN-787"><a href="#DeepEGNN-787"><span class="linenos"> 787</span></a><span class="sd">            (2): ModuleDict(</span>
</span><span id="DeepEGNN-788"><a href="#DeepEGNN-788"><span class="linenos"> 788</span></a><span class="sd">              (egnn): EGNN(</span>
</span><span id="DeepEGNN-789"><a href="#DeepEGNN-789"><span class="linenos"> 789</span></a><span class="sd">                (aggr_mean): MeanAggregation()</span>
</span><span id="DeepEGNN-790"><a href="#DeepEGNN-790"><span class="linenos"> 790</span></a><span class="sd">                (aggr_sum): SumAggregation()</span>
</span><span id="DeepEGNN-791"><a href="#DeepEGNN-791"><span class="linenos"> 791</span></a><span class="sd">                (edge_net): Sequential(</span>
</span><span id="DeepEGNN-792"><a href="#DeepEGNN-792"><span class="linenos"> 792</span></a><span class="sd">                  (0): Linear(in_features=129, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-793"><a href="#DeepEGNN-793"><span class="linenos"> 793</span></a><span class="sd">                  (1): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-794"><a href="#DeepEGNN-794"><span class="linenos"> 794</span></a><span class="sd">                  (2): Linear(in_features=64, out_features=32, bias=True)</span>
</span><span id="DeepEGNN-795"><a href="#DeepEGNN-795"><span class="linenos"> 795</span></a><span class="sd">                  (3): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-796"><a href="#DeepEGNN-796"><span class="linenos"> 796</span></a><span class="sd">                  (4): Linear(in_features=32, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-797"><a href="#DeepEGNN-797"><span class="linenos"> 797</span></a><span class="sd">                  (5): GELU(approximate=&#39;tanh&#39;)</span>
</span><span id="DeepEGNN-798"><a href="#DeepEGNN-798"><span class="linenos"> 798</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-799"><a href="#DeepEGNN-799"><span class="linenos"> 799</span></a><span class="sd">                (node_net): Sequential(</span>
</span><span id="DeepEGNN-800"><a href="#DeepEGNN-800"><span class="linenos"> 800</span></a><span class="sd">                  (0): Linear(in_features=128, out_features=64, bias=True)</span>
</span><span id="DeepEGNN-801"><a href="#DeepEGNN-801"><span class="linenos"> 801</span></a><span class="sd">                )</span>
</span><span id="DeepEGNN-802"><a href="#DeepEGNN-802"><span class="linenos"> 802</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-803"><a href="#DeepEGNN-803"><span class="linenos"> 803</span></a><span class="sd">              (drop): Identity()</span>
</span><span id="DeepEGNN-804"><a href="#DeepEGNN-804"><span class="linenos"> 804</span></a><span class="sd">              (norm): ModuleDict(</span>
</span><span id="DeepEGNN-805"><a href="#DeepEGNN-805"><span class="linenos"> 805</span></a><span class="sd">                (x): Identity()</span>
</span><span id="DeepEGNN-806"><a href="#DeepEGNN-806"><span class="linenos"> 806</span></a><span class="sd">                (pos): Identity()</span>
</span><span id="DeepEGNN-807"><a href="#DeepEGNN-807"><span class="linenos"> 807</span></a><span class="sd">              )</span>
</span><span id="DeepEGNN-808"><a href="#DeepEGNN-808"><span class="linenos"> 808</span></a><span class="sd">            )</span>
</span><span id="DeepEGNN-809"><a href="#DeepEGNN-809"><span class="linenos"> 809</span></a><span class="sd">          )</span>
</span><span id="DeepEGNN-810"><a href="#DeepEGNN-810"><span class="linenos"> 810</span></a><span class="sd">        )</span>
</span><span id="DeepEGNN-811"><a href="#DeepEGNN-811"><span class="linenos"> 811</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DeepEGNN-812"><a href="#DeepEGNN-812"><span class="linenos"> 812</span></a>
</span><span id="DeepEGNN-813"><a href="#DeepEGNN-813"><span class="linenos"> 813</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DeepEGNN-814"><a href="#DeepEGNN-814"><span class="linenos"> 814</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepEGNN-815"><a href="#DeepEGNN-815"><span class="linenos"> 815</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="DeepEGNN-816"><a href="#DeepEGNN-816"><span class="linenos"> 816</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="DeepEGNN-817"><a href="#DeepEGNN-817"><span class="linenos"> 817</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="DeepEGNN-818"><a href="#DeepEGNN-818"><span class="linenos"> 818</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="DeepEGNN-819"><a href="#DeepEGNN-819"><span class="linenos"> 819</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepEGNN-820"><a href="#DeepEGNN-820"><span class="linenos"> 820</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepEGNN-821"><a href="#DeepEGNN-821"><span class="linenos"> 821</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepEGNN-822"><a href="#DeepEGNN-822"><span class="linenos"> 822</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepEGNN-823"><a href="#DeepEGNN-823"><span class="linenos"> 823</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="DeepEGNN-824"><a href="#DeepEGNN-824"><span class="linenos"> 824</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepEGNN-825"><a href="#DeepEGNN-825"><span class="linenos"> 825</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepEGNN-826"><a href="#DeepEGNN-826"><span class="linenos"> 826</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepEGNN-827"><a href="#DeepEGNN-827"><span class="linenos"> 827</span></a>        <span class="n">residual</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepEGNN-828"><a href="#DeepEGNN-828"><span class="linenos"> 828</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN-829"><a href="#DeepEGNN-829"><span class="linenos"> 829</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN-830"><a href="#DeepEGNN-830"><span class="linenos"> 830</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="DeepEGNN-831"><a href="#DeepEGNN-831"><span class="linenos"> 831</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="DeepEGNN-832"><a href="#DeepEGNN-832"><span class="linenos"> 832</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepEGNN-833"><a href="#DeepEGNN-833"><span class="linenos"> 833</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DeepEGNN-834"><a href="#DeepEGNN-834"><span class="linenos"> 834</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepEGNN-835"><a href="#DeepEGNN-835"><span class="linenos"> 835</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="DeepEGNN-836"><a href="#DeepEGNN-836"><span class="linenos"> 836</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="DeepEGNN-837"><a href="#DeepEGNN-837"><span class="linenos"> 837</span></a><span class="sd">                features and `dims_node[-1]` describing the number output</span>
</span><span id="DeepEGNN-838"><a href="#DeepEGNN-838"><span class="linenos"> 838</span></a><span class="sd">                features for the node networks in all layers. Note that the</span>
</span><span id="DeepEGNN-839"><a href="#DeepEGNN-839"><span class="linenos"> 839</span></a><span class="sd">                number of input features is only valid for the first layer; in</span>
</span><span id="DeepEGNN-840"><a href="#DeepEGNN-840"><span class="linenos"> 840</span></a><span class="sd">                all subsequent layers the number of input features is inferred</span>
</span><span id="DeepEGNN-841"><a href="#DeepEGNN-841"><span class="linenos"> 841</span></a><span class="sd">                from the number of output features of the previous layer.</span>
</span><span id="DeepEGNN-842"><a href="#DeepEGNN-842"><span class="linenos"> 842</span></a><span class="sd">                Alternatively, `dims_node` can also be a sequence of sequences</span>
</span><span id="DeepEGNN-843"><a href="#DeepEGNN-843"><span class="linenos"> 843</span></a><span class="sd">                of integers, describing the aforementioned properties for each</span>
</span><span id="DeepEGNN-844"><a href="#DeepEGNN-844"><span class="linenos"> 844</span></a><span class="sd">                layer individually. In this case, `dims_node[0][0]` is the</span>
</span><span id="DeepEGNN-845"><a href="#DeepEGNN-845"><span class="linenos"> 845</span></a><span class="sd">                number of input features for the first layer, but for all</span>
</span><span id="DeepEGNN-846"><a href="#DeepEGNN-846"><span class="linenos"> 846</span></a><span class="sd">                subsequent layers the first value represents the dimension of</span>
</span><span id="DeepEGNN-847"><a href="#DeepEGNN-847"><span class="linenos"> 847</span></a><span class="sd">                the first hidden layer of the node networks, since the number of</span>
</span><span id="DeepEGNN-848"><a href="#DeepEGNN-848"><span class="linenos"> 848</span></a><span class="sd">                input features is inferred from the previous number of output</span>
</span><span id="DeepEGNN-849"><a href="#DeepEGNN-849"><span class="linenos"> 849</span></a><span class="sd">                features of the previous layer; e.g., `dims_node[1][0]` is the</span>
</span><span id="DeepEGNN-850"><a href="#DeepEGNN-850"><span class="linenos"> 850</span></a><span class="sd">                dimension of the first hidden layer in the node network of the</span>
</span><span id="DeepEGNN-851"><a href="#DeepEGNN-851"><span class="linenos"> 851</span></a><span class="sd">                second layer in this network.</span>
</span><span id="DeepEGNN-852"><a href="#DeepEGNN-852"><span class="linenos"> 852</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="DeepEGNN-853"><a href="#DeepEGNN-853"><span class="linenos"> 853</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="DeepEGNN-854"><a href="#DeepEGNN-854"><span class="linenos"> 854</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="DeepEGNN-855"><a href="#DeepEGNN-855"><span class="linenos"> 855</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="DeepEGNN-856"><a href="#DeepEGNN-856"><span class="linenos"> 856</span></a><span class="sd">                gating is disabled.</span>
</span><span id="DeepEGNN-857"><a href="#DeepEGNN-857"><span class="linenos"> 857</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="DeepEGNN-858"><a href="#DeepEGNN-858"><span class="linenos"> 858</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="DeepEGNN-859"><a href="#DeepEGNN-859"><span class="linenos"> 859</span></a><span class="sd">                update is disabled.</span>
</span><span id="DeepEGNN-860"><a href="#DeepEGNN-860"><span class="linenos"> 860</span></a><span class="sd">            layers: Number of :class:`EGNN` layers.</span>
</span><span id="DeepEGNN-861"><a href="#DeepEGNN-861"><span class="linenos"> 861</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="DeepEGNN-862"><a href="#DeepEGNN-862"><span class="linenos"> 862</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="DeepEGNN-863"><a href="#DeepEGNN-863"><span class="linenos"> 863</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="DeepEGNN-864"><a href="#DeepEGNN-864"><span class="linenos"> 864</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="DeepEGNN-865"><a href="#DeepEGNN-865"><span class="linenos"> 865</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="DeepEGNN-866"><a href="#DeepEGNN-866"><span class="linenos"> 866</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="DeepEGNN-867"><a href="#DeepEGNN-867"><span class="linenos"> 867</span></a><span class="sd">            norm: Whether to normalize a given layer and whether to use</span>
</span><span id="DeepEGNN-868"><a href="#DeepEGNN-868"><span class="linenos"> 868</span></a><span class="sd">                normalization after that given layer. If a single boolean or a</span>
</span><span id="DeepEGNN-869"><a href="#DeepEGNN-869"><span class="linenos"> 869</span></a><span class="sd">                list of single booleans, then normalization will be applied</span>
</span><span id="DeepEGNN-870"><a href="#DeepEGNN-870"><span class="linenos"> 870</span></a><span class="sd">                within and after the corresponding layers according to the</span>
</span><span id="DeepEGNN-871"><a href="#DeepEGNN-871"><span class="linenos"> 871</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="DeepEGNN-872"><a href="#DeepEGNN-872"><span class="linenos"> 872</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="DeepEGNN-873"><a href="#DeepEGNN-873"><span class="linenos"> 873</span></a><span class="sd">                normalization after a layer and the second will determine</span>
</span><span id="DeepEGNN-874"><a href="#DeepEGNN-874"><span class="linenos"> 874</span></a><span class="sd">                whether to use normalization within that layer.</span>
</span><span id="DeepEGNN-875"><a href="#DeepEGNN-875"><span class="linenos"> 875</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="DeepEGNN-876"><a href="#DeepEGNN-876"><span class="linenos"> 876</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="DeepEGNN-877"><a href="#DeepEGNN-877"><span class="linenos"> 877</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="DeepEGNN-878"><a href="#DeepEGNN-878"><span class="linenos"> 878</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="DeepEGNN-879"><a href="#DeepEGNN-879"><span class="linenos"> 879</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="DeepEGNN-880"><a href="#DeepEGNN-880"><span class="linenos"> 880</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="DeepEGNN-881"><a href="#DeepEGNN-881"><span class="linenos"> 881</span></a><span class="sd">                omitted if 0.</span>
</span><span id="DeepEGNN-882"><a href="#DeepEGNN-882"><span class="linenos"> 882</span></a><span class="sd">            residual: Whether a layer is a residual layer. If `residual` is a</span>
</span><span id="DeepEGNN-883"><a href="#DeepEGNN-883"><span class="linenos"> 883</span></a><span class="sd">                single value, then layers will only be residual layers if their</span>
</span><span id="DeepEGNN-884"><a href="#DeepEGNN-884"><span class="linenos"> 884</span></a><span class="sd">                number of input and output features matches. Coordinates are not</span>
</span><span id="DeepEGNN-885"><a href="#DeepEGNN-885"><span class="linenos"> 885</span></a><span class="sd">                updated through residual connections, independent of this</span>
</span><span id="DeepEGNN-886"><a href="#DeepEGNN-886"><span class="linenos"> 886</span></a><span class="sd">                toggle.</span>
</span><span id="DeepEGNN-887"><a href="#DeepEGNN-887"><span class="linenos"> 887</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="DeepEGNN-888"><a href="#DeepEGNN-888"><span class="linenos"> 888</span></a><span class="sd">                layers.</span>
</span><span id="DeepEGNN-889"><a href="#DeepEGNN-889"><span class="linenos"> 889</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="DeepEGNN-890"><a href="#DeepEGNN-890"><span class="linenos"> 890</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="DeepEGNN-891"><a href="#DeepEGNN-891"><span class="linenos"> 891</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="DeepEGNN-892"><a href="#DeepEGNN-892"><span class="linenos"> 892</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="DeepEGNN-893"><a href="#DeepEGNN-893"><span class="linenos"> 893</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="DeepEGNN-894"><a href="#DeepEGNN-894"><span class="linenos"> 894</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="DeepEGNN-895"><a href="#DeepEGNN-895"><span class="linenos"> 895</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="DeepEGNN-896"><a href="#DeepEGNN-896"><span class="linenos"> 896</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepEGNN-897"><a href="#DeepEGNN-897"><span class="linenos"> 897</span></a>
</span><span id="DeepEGNN-898"><a href="#DeepEGNN-898"><span class="linenos"> 898</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepEGNN-899"><a href="#DeepEGNN-899"><span class="linenos"> 899</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="DeepEGNN-900"><a href="#DeepEGNN-900"><span class="linenos"> 900</span></a>
</span><span id="DeepEGNN-901"><a href="#DeepEGNN-901"><span class="linenos"> 901</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="DeepEGNN-902"><a href="#DeepEGNN-902"><span class="linenos"> 902</span></a>
</span><span id="DeepEGNN-903"><a href="#DeepEGNN-903"><span class="linenos"> 903</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="DeepEGNN-904"><a href="#DeepEGNN-904"><span class="linenos"> 904</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepEGNN-905"><a href="#DeepEGNN-905"><span class="linenos"> 905</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="DeepEGNN-906"><a href="#DeepEGNN-906"><span class="linenos"> 906</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-907"><a href="#DeepEGNN-907"><span class="linenos"> 907</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepEGNN-908"><a href="#DeepEGNN-908"><span class="linenos"> 908</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="DeepEGNN-909"><a href="#DeepEGNN-909"><span class="linenos"> 909</span></a>
</span><span id="DeepEGNN-910"><a href="#DeepEGNN-910"><span class="linenos"> 910</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="DeepEGNN-911"><a href="#DeepEGNN-911"><span class="linenos"> 911</span></a>        <span class="n">residual_is_broadcasted</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span id="DeepEGNN-912"><a href="#DeepEGNN-912"><span class="linenos"> 912</span></a>
</span><span id="DeepEGNN-913"><a href="#DeepEGNN-913"><span class="linenos"> 913</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN-914"><a href="#DeepEGNN-914"><span class="linenos"> 914</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN-915"><a href="#DeepEGNN-915"><span class="linenos"> 915</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN-916"><a href="#DeepEGNN-916"><span class="linenos"> 916</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN-917"><a href="#DeepEGNN-917"><span class="linenos"> 917</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-918"><a href="#DeepEGNN-918"><span class="linenos"> 918</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-919"><a href="#DeepEGNN-919"><span class="linenos"> 919</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepEGNN-920"><a href="#DeepEGNN-920"><span class="linenos"> 920</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-921"><a href="#DeepEGNN-921"><span class="linenos"> 921</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepEGNN-922"><a href="#DeepEGNN-922"><span class="linenos"> 922</span></a>        <span class="n">residual</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;residual&quot;</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-923"><a href="#DeepEGNN-923"><span class="linenos"> 923</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-924"><a href="#DeepEGNN-924"><span class="linenos"> 924</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-925"><a href="#DeepEGNN-925"><span class="linenos"> 925</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-926"><a href="#DeepEGNN-926"><span class="linenos"> 926</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN-927"><a href="#DeepEGNN-927"><span class="linenos"> 927</span></a>
</span><span id="DeepEGNN-928"><a href="#DeepEGNN-928"><span class="linenos"> 928</span></a>        <span class="n">dim_in</span> <span class="o">=</span> <span class="n">features_node</span>
</span><span id="DeepEGNN-929"><a href="#DeepEGNN-929"><span class="linenos"> 929</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepEGNN-930"><a href="#DeepEGNN-930"><span class="linenos"> 930</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim_in</span><span class="p">,</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="DeepEGNN-931"><a href="#DeepEGNN-931"><span class="linenos"> 931</span></a>            <span class="n">dim_in</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DeepEGNN-932"><a href="#DeepEGNN-932"><span class="linenos"> 932</span></a>
</span><span id="DeepEGNN-933"><a href="#DeepEGNN-933"><span class="linenos"> 933</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepEGNN-934"><a href="#DeepEGNN-934"><span class="linenos"> 934</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="DeepEGNN-935"><a href="#DeepEGNN-935"><span class="linenos"> 935</span></a>
</span><span id="DeepEGNN-936"><a href="#DeepEGNN-936"><span class="linenos"> 936</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residual</span><span class="p">)):</span>
</span><span id="DeepEGNN-937"><a href="#DeepEGNN-937"><span class="linenos"> 937</span></a>            <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="DeepEGNN-938"><a href="#DeepEGNN-938"><span class="linenos"> 938</span></a>                <span class="k">if</span> <span class="n">residual_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepEGNN-939"><a href="#DeepEGNN-939"><span class="linenos"> 939</span></a>                    <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DeepEGNN-940"><a href="#DeepEGNN-940"><span class="linenos"> 940</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-941"><a href="#DeepEGNN-941"><span class="linenos"> 941</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepEGNN-942"><a href="#DeepEGNN-942"><span class="linenos"> 942</span></a>                        <span class="sa">f</span><span class="s2">&quot;cannot use residual connections if input and output &quot;</span>
</span><span id="DeepEGNN-943"><a href="#DeepEGNN-943"><span class="linenos"> 943</span></a>                        <span class="sa">f</span><span class="s2">&quot;dimensions disagree: number of input features at &quot;</span>
</span><span id="DeepEGNN-944"><a href="#DeepEGNN-944"><span class="linenos"> 944</span></a>                        <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, number of output &quot;</span>
</span><span id="DeepEGNN-945"><a href="#DeepEGNN-945"><span class="linenos"> 945</span></a>                        <span class="sa">f</span><span class="s2">&quot;features is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DeepEGNN-946"><a href="#DeepEGNN-946"><span class="linenos"> 946</span></a>                    <span class="p">)</span>
</span><span id="DeepEGNN-947"><a href="#DeepEGNN-947"><span class="linenos"> 947</span></a>
</span><span id="DeepEGNN-948"><a href="#DeepEGNN-948"><span class="linenos"> 948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span>
</span><span id="DeepEGNN-949"><a href="#DeepEGNN-949"><span class="linenos"> 949</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="DeepEGNN-950"><a href="#DeepEGNN-950"><span class="linenos"> 950</span></a>
</span><span id="DeepEGNN-951"><a href="#DeepEGNN-951"><span class="linenos"> 951</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="DeepEGNN-952"><a href="#DeepEGNN-952"><span class="linenos"> 952</span></a>
</span><span id="DeepEGNN-953"><a href="#DeepEGNN-953"><span class="linenos"> 953</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepEGNN-954"><a href="#DeepEGNN-954"><span class="linenos"> 954</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN-955"><a href="#DeepEGNN-955"><span class="linenos"> 955</span></a>
</span><span id="DeepEGNN-956"><a href="#DeepEGNN-956"><span class="linenos"> 956</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="DeepEGNN-957"><a href="#DeepEGNN-957"><span class="linenos"> 957</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-958"><a href="#DeepEGNN-958"><span class="linenos"> 958</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-959"><a href="#DeepEGNN-959"><span class="linenos"> 959</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-960"><a href="#DeepEGNN-960"><span class="linenos"> 960</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-961"><a href="#DeepEGNN-961"><span class="linenos"> 961</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="DeepEGNN-962"><a href="#DeepEGNN-962"><span class="linenos"> 962</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-963"><a href="#DeepEGNN-963"><span class="linenos"> 963</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-964"><a href="#DeepEGNN-964"><span class="linenos"> 964</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="DeepEGNN-965"><a href="#DeepEGNN-965"><span class="linenos"> 965</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-966"><a href="#DeepEGNN-966"><span class="linenos"> 966</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="DeepEGNN-967"><a href="#DeepEGNN-967"><span class="linenos"> 967</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-968"><a href="#DeepEGNN-968"><span class="linenos"> 968</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-969"><a href="#DeepEGNN-969"><span class="linenos"> 969</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-970"><a href="#DeepEGNN-970"><span class="linenos"> 970</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN-971"><a href="#DeepEGNN-971"><span class="linenos"> 971</span></a>            <span class="p">)</span>
</span><span id="DeepEGNN-972"><a href="#DeepEGNN-972"><span class="linenos"> 972</span></a>
</span><span id="DeepEGNN-973"><a href="#DeepEGNN-973"><span class="linenos"> 973</span></a>            <span class="k">if</span> <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DeepEGNN-974"><a href="#DeepEGNN-974"><span class="linenos"> 974</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DeepEGNN-975"><a href="#DeepEGNN-975"><span class="linenos"> 975</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-976"><a href="#DeepEGNN-976"><span class="linenos"> 976</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN-977"><a href="#DeepEGNN-977"><span class="linenos"> 977</span></a>
</span><span id="DeepEGNN-978"><a href="#DeepEGNN-978"><span class="linenos"> 978</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DeepEGNN-979"><a href="#DeepEGNN-979"><span class="linenos"> 979</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN-980"><a href="#DeepEGNN-980"><span class="linenos"> 980</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DeepEGNN-981"><a href="#DeepEGNN-981"><span class="linenos"> 981</span></a>                <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN-982"><a href="#DeepEGNN-982"><span class="linenos"> 982</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DeepEGNN-983"><a href="#DeepEGNN-983"><span class="linenos"> 983</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-984"><a href="#DeepEGNN-984"><span class="linenos"> 984</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN-985"><a href="#DeepEGNN-985"><span class="linenos"> 985</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="DeepEGNN-986"><a href="#DeepEGNN-986"><span class="linenos"> 986</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">num_pos</span> <span class="o">*</span> <span class="n">dim_pos</span><span class="p">)</span>
</span><span id="DeepEGNN-987"><a href="#DeepEGNN-987"><span class="linenos"> 987</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-988"><a href="#DeepEGNN-988"><span class="linenos"> 988</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN-989"><a href="#DeepEGNN-989"><span class="linenos"> 989</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-990"><a href="#DeepEGNN-990"><span class="linenos"> 990</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN-991"><a href="#DeepEGNN-991"><span class="linenos"> 991</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN-992"><a href="#DeepEGNN-992"><span class="linenos"> 992</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN-993"><a href="#DeepEGNN-993"><span class="linenos"> 993</span></a>
</span><span id="DeepEGNN-994"><a href="#DeepEGNN-994"><span class="linenos"> 994</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span><span id="DeepEGNN-995"><a href="#DeepEGNN-995"><span class="linenos"> 995</span></a>
</span><span id="DeepEGNN-996"><a href="#DeepEGNN-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DeepEGNN-997"><a href="#DeepEGNN-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="DeepEGNN-998"><a href="#DeepEGNN-998"><span class="linenos"> 998</span></a>
</span><span id="DeepEGNN-999"><a href="#DeepEGNN-999"><span class="linenos"> 999</span></a>        <span class="k">for</span> <span class="n">init</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepEGNN-1000"><a href="#DeepEGNN-1000"><span class="linenos">1000</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="DeepEGNN-1001"><a href="#DeepEGNN-1001"><span class="linenos">1001</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="DeepEGNN-1002"><a href="#DeepEGNN-1002"><span class="linenos">1002</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="DeepEGNN-1003"><a href="#DeepEGNN-1003"><span class="linenos">1003</span></a>
</span><span id="DeepEGNN-1004"><a href="#DeepEGNN-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="DeepEGNN-1005"><a href="#DeepEGNN-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepEGNN-1006"><a href="#DeepEGNN-1006"><span class="linenos">1006</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepEGNN-1007"><a href="#DeepEGNN-1007"><span class="linenos">1007</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepEGNN-1008"><a href="#DeepEGNN-1008"><span class="linenos">1008</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="DeepEGNN-1009"><a href="#DeepEGNN-1009"><span class="linenos">1009</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN-1010"><a href="#DeepEGNN-1010"><span class="linenos">1010</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN-1011"><a href="#DeepEGNN-1011"><span class="linenos">1011</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="DeepEGNN-1012"><a href="#DeepEGNN-1012"><span class="linenos">1012</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="DeepEGNN-1013"><a href="#DeepEGNN-1013"><span class="linenos">1013</span></a>
</span><span id="DeepEGNN-1014"><a href="#DeepEGNN-1014"><span class="linenos">1014</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepEGNN-1015"><a href="#DeepEGNN-1015"><span class="linenos">1015</span></a><span class="sd">            x: Node features.</span>
</span><span id="DeepEGNN-1016"><a href="#DeepEGNN-1016"><span class="linenos">1016</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="DeepEGNN-1017"><a href="#DeepEGNN-1017"><span class="linenos">1017</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="DeepEGNN-1018"><a href="#DeepEGNN-1018"><span class="linenos">1018</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="DeepEGNN-1019"><a href="#DeepEGNN-1019"><span class="linenos">1019</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="DeepEGNN-1020"><a href="#DeepEGNN-1020"><span class="linenos">1020</span></a>
</span><span id="DeepEGNN-1021"><a href="#DeepEGNN-1021"><span class="linenos">1021</span></a><span class="sd">        Returns:</span>
</span><span id="DeepEGNN-1022"><a href="#DeepEGNN-1022"><span class="linenos">1022</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="DeepEGNN-1023"><a href="#DeepEGNN-1023"><span class="linenos">1023</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepEGNN-1024"><a href="#DeepEGNN-1024"><span class="linenos">1024</span></a>
</span><span id="DeepEGNN-1025"><a href="#DeepEGNN-1025"><span class="linenos">1025</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepEGNN-1026"><a href="#DeepEGNN-1026"><span class="linenos">1026</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span>
</span><span id="DeepEGNN-1027"><a href="#DeepEGNN-1027"><span class="linenos">1027</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="DeepEGNN-1028"><a href="#DeepEGNN-1028"><span class="linenos">1028</span></a>                <span class="n">pos</span><span class="p">,</span>
</span><span id="DeepEGNN-1029"><a href="#DeepEGNN-1029"><span class="linenos">1029</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="DeepEGNN-1030"><a href="#DeepEGNN-1030"><span class="linenos">1030</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="DeepEGNN-1031"><a href="#DeepEGNN-1031"><span class="linenos">1031</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="DeepEGNN-1032"><a href="#DeepEGNN-1032"><span class="linenos">1032</span></a>            <span class="p">)</span>
</span><span id="DeepEGNN-1033"><a href="#DeepEGNN-1033"><span class="linenos">1033</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN-1034"><a href="#DeepEGNN-1034"><span class="linenos">1034</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN-1035"><a href="#DeepEGNN-1035"><span class="linenos">1035</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN-1036"><a href="#DeepEGNN-1036"><span class="linenos">1036</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="DeepEGNN-1037"><a href="#DeepEGNN-1037"><span class="linenos">1037</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-1038"><a href="#DeepEGNN-1038"><span class="linenos">1038</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN-1039"><a href="#DeepEGNN-1039"><span class="linenos">1039</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="DeepEGNN-1040"><a href="#DeepEGNN-1040"><span class="linenos">1040</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN-1041"><a href="#DeepEGNN-1041"><span class="linenos">1041</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="DeepEGNN-1042"><a href="#DeepEGNN-1042"><span class="linenos">1042</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN-1043"><a href="#DeepEGNN-1043"><span class="linenos">1043</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="DeepEGNN-1044"><a href="#DeepEGNN-1044"><span class="linenos">1044</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DeepEGNN-1045"><a href="#DeepEGNN-1045"><span class="linenos">1045</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="DeepEGNN-1046"><a href="#DeepEGNN-1046"><span class="linenos">1046</span></a>
</span><span id="DeepEGNN-1047"><a href="#DeepEGNN-1047"><span class="linenos">1047</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            <div class="docstring"><p>Deep E(n) Equivariant Neural Network.</p>

<p>Implementation of an E(n) Equivariant Neural Network with <code><a href="#EGNN">EGNN</a></code> as
its layers.</p>

<p>Arguments can be broadcasted to individual layers during initialization. For
example, if <code>layers = 4</code> and <code>dims_node = (64, 32)</code>, then <code>dims_node</code> will
be used for each of the 4 layers to initialize the hidden and output layer
of the node network. If on the other hand <code>dims_node = [(64, 32), (128, 64),
(128, 64), (64, 32)]</code>, then the first and last layer will use <code>(64, 32)</code> and
the second and third layer will use <code>(128, 64)</code> to initialize their hidden
and output layers.</p>

<h6 id="example">Example:</h6>

<blockquote>
  <p>DeepEGNN instance with 16 input and 64 output features with 2 EGNN
  layers each having 64 and 128 hidden node features and 32 and 64
  intermediate output node features.</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">egnn</span> <span class="kn">import</span> <span class="n">DeepEGNN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fn</span> <span class="o">=</span> <span class="n">DeepEGNN</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dims_node</span><span class="o">=</span><span class="p">[(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">dims_edge</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fn</span>
<span class="go">DeepEGNN(</span>
<span class="go">  (layers): ModuleList(</span>
<span class="go">    (0): ModuleDict(</span>
<span class="go">      (egnn): EGNN(</span>
<span class="go">        (aggr_mean): MeanAggregation()</span>
<span class="go">        (aggr_sum): SumAggregation()</span>
<span class="go">        (edge_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=33, out_features=64, bias=True)</span>
<span class="go">          (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (2): Linear(in_features=64, out_features=32, bias=True)</span>
<span class="go">          (3): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (4): Linear(in_features=32, out_features=64, bias=True)</span>
<span class="go">          (5): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">        )</span>
<span class="go">        (node_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=80, out_features=64, bias=True)</span>
<span class="go">          (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (2): Linear(in_features=64, out_features=32, bias=True)</span>
<span class="go">        )</span>
<span class="go">      )</span>
<span class="go">      (drop): Identity()</span>
<span class="go">      (norm): ModuleDict(</span>
<span class="go">        (x): Identity()</span>
<span class="go">        (pos): Identity()</span>
<span class="go">      )</span>
<span class="go">    )</span>
<span class="go">    (1): ModuleDict(</span>
<span class="go">      (egnn): EGNN(</span>
<span class="go">        (aggr_mean): MeanAggregation()</span>
<span class="go">        (aggr_sum): SumAggregation()</span>
<span class="go">        (edge_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=65, out_features=64, bias=True)</span>
<span class="go">          (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (2): Linear(in_features=64, out_features=32, bias=True)</span>
<span class="go">          (3): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (4): Linear(in_features=32, out_features=64, bias=True)</span>
<span class="go">          (5): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">        )</span>
<span class="go">        (node_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=96, out_features=128, bias=True)</span>
<span class="go">          (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (2): Linear(in_features=128, out_features=64, bias=True)</span>
<span class="go">        )</span>
<span class="go">      )</span>
<span class="go">      (drop): Identity()</span>
<span class="go">      (norm): ModuleDict(</span>
<span class="go">        (x): Identity()</span>
<span class="go">        (pos): Identity()</span>
<span class="go">      )</span>
<span class="go">    )</span>
<span class="go">    (2): ModuleDict(</span>
<span class="go">      (egnn): EGNN(</span>
<span class="go">        (aggr_mean): MeanAggregation()</span>
<span class="go">        (aggr_sum): SumAggregation()</span>
<span class="go">        (edge_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=129, out_features=64, bias=True)</span>
<span class="go">          (1): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (2): Linear(in_features=64, out_features=32, bias=True)</span>
<span class="go">          (3): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">          (4): Linear(in_features=32, out_features=64, bias=True)</span>
<span class="go">          (5): GELU(approximate=&#39;tanh&#39;)</span>
<span class="go">        )</span>
<span class="go">        (node_net): Sequential(</span>
<span class="go">          (0): Linear(in_features=128, out_features=64, bias=True)</span>
<span class="go">        )</span>
<span class="go">      )</span>
<span class="go">      (drop): Identity()</span>
<span class="go">      (norm): ModuleDict(</span>
<span class="go">        (x): Identity()</span>
<span class="go">        (pos): Identity()</span>
<span class="go">      )</span>
<span class="go">    )</span>
<span class="go">  )</span>
<span class="go">)</span>
</code></pre>
  </div>
</blockquote>
</div>


                            <div id="DeepEGNN.__init__" class="classattr">
                                        <input id="DeepEGNN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DeepEGNN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dims_node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">dims_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">dims_gate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()]</span>,</span><span class="param">	<span class="n">dims_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()]</span>,</span><span class="param">	<span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_encode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pos_scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">residual</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]],</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]],</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	norm_cls: Union[Sequence[type[torch.nn.modules.module.Module]], type[torch.nn.modules.module.Module]] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: Union[Sequence[type[torch.nn.modules.module.Module]], type[torch.nn.modules.module.Module]] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;</span>)</span>

                <label class="view-source-button" for="DeepEGNN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepEGNN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepEGNN.__init__-813"><a href="#DeepEGNN.__init__-813"><span class="linenos">813</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DeepEGNN.__init__-814"><a href="#DeepEGNN.__init__-814"><span class="linenos">814</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-815"><a href="#DeepEGNN.__init__-815"><span class="linenos">815</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="DeepEGNN.__init__-816"><a href="#DeepEGNN.__init__-816"><span class="linenos">816</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="DeepEGNN.__init__-817"><a href="#DeepEGNN.__init__-817"><span class="linenos">817</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="DeepEGNN.__init__-818"><a href="#DeepEGNN.__init__-818"><span class="linenos">818</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[()],</span>
</span><span id="DeepEGNN.__init__-819"><a href="#DeepEGNN.__init__-819"><span class="linenos">819</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-820"><a href="#DeepEGNN.__init__-820"><span class="linenos">820</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-821"><a href="#DeepEGNN.__init__-821"><span class="linenos">821</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-822"><a href="#DeepEGNN.__init__-822"><span class="linenos">822</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-823"><a href="#DeepEGNN.__init__-823"><span class="linenos">823</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-824"><a href="#DeepEGNN.__init__-824"><span class="linenos">824</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-825"><a href="#DeepEGNN.__init__-825"><span class="linenos">825</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-826"><a href="#DeepEGNN.__init__-826"><span class="linenos">826</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-827"><a href="#DeepEGNN.__init__-827"><span class="linenos">827</span></a>        <span class="n">residual</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-828"><a href="#DeepEGNN.__init__-828"><span class="linenos">828</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-829"><a href="#DeepEGNN.__init__-829"><span class="linenos">829</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-830"><a href="#DeepEGNN.__init__-830"><span class="linenos">830</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-831"><a href="#DeepEGNN.__init__-831"><span class="linenos">831</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-832"><a href="#DeepEGNN.__init__-832"><span class="linenos">832</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-833"><a href="#DeepEGNN.__init__-833"><span class="linenos">833</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DeepEGNN.__init__-834"><a href="#DeepEGNN.__init__-834"><span class="linenos">834</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepEGNN.__init__-835"><a href="#DeepEGNN.__init__-835"><span class="linenos">835</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="DeepEGNN.__init__-836"><a href="#DeepEGNN.__init__-836"><span class="linenos">836</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="DeepEGNN.__init__-837"><a href="#DeepEGNN.__init__-837"><span class="linenos">837</span></a><span class="sd">                features and `dims_node[-1]` describing the number output</span>
</span><span id="DeepEGNN.__init__-838"><a href="#DeepEGNN.__init__-838"><span class="linenos">838</span></a><span class="sd">                features for the node networks in all layers. Note that the</span>
</span><span id="DeepEGNN.__init__-839"><a href="#DeepEGNN.__init__-839"><span class="linenos">839</span></a><span class="sd">                number of input features is only valid for the first layer; in</span>
</span><span id="DeepEGNN.__init__-840"><a href="#DeepEGNN.__init__-840"><span class="linenos">840</span></a><span class="sd">                all subsequent layers the number of input features is inferred</span>
</span><span id="DeepEGNN.__init__-841"><a href="#DeepEGNN.__init__-841"><span class="linenos">841</span></a><span class="sd">                from the number of output features of the previous layer.</span>
</span><span id="DeepEGNN.__init__-842"><a href="#DeepEGNN.__init__-842"><span class="linenos">842</span></a><span class="sd">                Alternatively, `dims_node` can also be a sequence of sequences</span>
</span><span id="DeepEGNN.__init__-843"><a href="#DeepEGNN.__init__-843"><span class="linenos">843</span></a><span class="sd">                of integers, describing the aforementioned properties for each</span>
</span><span id="DeepEGNN.__init__-844"><a href="#DeepEGNN.__init__-844"><span class="linenos">844</span></a><span class="sd">                layer individually. In this case, `dims_node[0][0]` is the</span>
</span><span id="DeepEGNN.__init__-845"><a href="#DeepEGNN.__init__-845"><span class="linenos">845</span></a><span class="sd">                number of input features for the first layer, but for all</span>
</span><span id="DeepEGNN.__init__-846"><a href="#DeepEGNN.__init__-846"><span class="linenos">846</span></a><span class="sd">                subsequent layers the first value represents the dimension of</span>
</span><span id="DeepEGNN.__init__-847"><a href="#DeepEGNN.__init__-847"><span class="linenos">847</span></a><span class="sd">                the first hidden layer of the node networks, since the number of</span>
</span><span id="DeepEGNN.__init__-848"><a href="#DeepEGNN.__init__-848"><span class="linenos">848</span></a><span class="sd">                input features is inferred from the previous number of output</span>
</span><span id="DeepEGNN.__init__-849"><a href="#DeepEGNN.__init__-849"><span class="linenos">849</span></a><span class="sd">                features of the previous layer; e.g., `dims_node[1][0]` is the</span>
</span><span id="DeepEGNN.__init__-850"><a href="#DeepEGNN.__init__-850"><span class="linenos">850</span></a><span class="sd">                dimension of the first hidden layer in the node network of the</span>
</span><span id="DeepEGNN.__init__-851"><a href="#DeepEGNN.__init__-851"><span class="linenos">851</span></a><span class="sd">                second layer in this network.</span>
</span><span id="DeepEGNN.__init__-852"><a href="#DeepEGNN.__init__-852"><span class="linenos">852</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="DeepEGNN.__init__-853"><a href="#DeepEGNN.__init__-853"><span class="linenos">853</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="DeepEGNN.__init__-854"><a href="#DeepEGNN.__init__-854"><span class="linenos">854</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="DeepEGNN.__init__-855"><a href="#DeepEGNN.__init__-855"><span class="linenos">855</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="DeepEGNN.__init__-856"><a href="#DeepEGNN.__init__-856"><span class="linenos">856</span></a><span class="sd">                gating is disabled.</span>
</span><span id="DeepEGNN.__init__-857"><a href="#DeepEGNN.__init__-857"><span class="linenos">857</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="DeepEGNN.__init__-858"><a href="#DeepEGNN.__init__-858"><span class="linenos">858</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="DeepEGNN.__init__-859"><a href="#DeepEGNN.__init__-859"><span class="linenos">859</span></a><span class="sd">                update is disabled.</span>
</span><span id="DeepEGNN.__init__-860"><a href="#DeepEGNN.__init__-860"><span class="linenos">860</span></a><span class="sd">            layers: Number of :class:`EGNN` layers.</span>
</span><span id="DeepEGNN.__init__-861"><a href="#DeepEGNN.__init__-861"><span class="linenos">861</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="DeepEGNN.__init__-862"><a href="#DeepEGNN.__init__-862"><span class="linenos">862</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="DeepEGNN.__init__-863"><a href="#DeepEGNN.__init__-863"><span class="linenos">863</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="DeepEGNN.__init__-864"><a href="#DeepEGNN.__init__-864"><span class="linenos">864</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="DeepEGNN.__init__-865"><a href="#DeepEGNN.__init__-865"><span class="linenos">865</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="DeepEGNN.__init__-866"><a href="#DeepEGNN.__init__-866"><span class="linenos">866</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="DeepEGNN.__init__-867"><a href="#DeepEGNN.__init__-867"><span class="linenos">867</span></a><span class="sd">            norm: Whether to normalize a given layer and whether to use</span>
</span><span id="DeepEGNN.__init__-868"><a href="#DeepEGNN.__init__-868"><span class="linenos">868</span></a><span class="sd">                normalization after that given layer. If a single boolean or a</span>
</span><span id="DeepEGNN.__init__-869"><a href="#DeepEGNN.__init__-869"><span class="linenos">869</span></a><span class="sd">                list of single booleans, then normalization will be applied</span>
</span><span id="DeepEGNN.__init__-870"><a href="#DeepEGNN.__init__-870"><span class="linenos">870</span></a><span class="sd">                within and after the corresponding layers according to the</span>
</span><span id="DeepEGNN.__init__-871"><a href="#DeepEGNN.__init__-871"><span class="linenos">871</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="DeepEGNN.__init__-872"><a href="#DeepEGNN.__init__-872"><span class="linenos">872</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="DeepEGNN.__init__-873"><a href="#DeepEGNN.__init__-873"><span class="linenos">873</span></a><span class="sd">                normalization after a layer and the second will determine</span>
</span><span id="DeepEGNN.__init__-874"><a href="#DeepEGNN.__init__-874"><span class="linenos">874</span></a><span class="sd">                whether to use normalization within that layer.</span>
</span><span id="DeepEGNN.__init__-875"><a href="#DeepEGNN.__init__-875"><span class="linenos">875</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="DeepEGNN.__init__-876"><a href="#DeepEGNN.__init__-876"><span class="linenos">876</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="DeepEGNN.__init__-877"><a href="#DeepEGNN.__init__-877"><span class="linenos">877</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="DeepEGNN.__init__-878"><a href="#DeepEGNN.__init__-878"><span class="linenos">878</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="DeepEGNN.__init__-879"><a href="#DeepEGNN.__init__-879"><span class="linenos">879</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="DeepEGNN.__init__-880"><a href="#DeepEGNN.__init__-880"><span class="linenos">880</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="DeepEGNN.__init__-881"><a href="#DeepEGNN.__init__-881"><span class="linenos">881</span></a><span class="sd">                omitted if 0.</span>
</span><span id="DeepEGNN.__init__-882"><a href="#DeepEGNN.__init__-882"><span class="linenos">882</span></a><span class="sd">            residual: Whether a layer is a residual layer. If `residual` is a</span>
</span><span id="DeepEGNN.__init__-883"><a href="#DeepEGNN.__init__-883"><span class="linenos">883</span></a><span class="sd">                single value, then layers will only be residual layers if their</span>
</span><span id="DeepEGNN.__init__-884"><a href="#DeepEGNN.__init__-884"><span class="linenos">884</span></a><span class="sd">                number of input and output features matches. Coordinates are not</span>
</span><span id="DeepEGNN.__init__-885"><a href="#DeepEGNN.__init__-885"><span class="linenos">885</span></a><span class="sd">                updated through residual connections, independent of this</span>
</span><span id="DeepEGNN.__init__-886"><a href="#DeepEGNN.__init__-886"><span class="linenos">886</span></a><span class="sd">                toggle.</span>
</span><span id="DeepEGNN.__init__-887"><a href="#DeepEGNN.__init__-887"><span class="linenos">887</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="DeepEGNN.__init__-888"><a href="#DeepEGNN.__init__-888"><span class="linenos">888</span></a><span class="sd">                layers.</span>
</span><span id="DeepEGNN.__init__-889"><a href="#DeepEGNN.__init__-889"><span class="linenos">889</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="DeepEGNN.__init__-890"><a href="#DeepEGNN.__init__-890"><span class="linenos">890</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="DeepEGNN.__init__-891"><a href="#DeepEGNN.__init__-891"><span class="linenos">891</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="DeepEGNN.__init__-892"><a href="#DeepEGNN.__init__-892"><span class="linenos">892</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="DeepEGNN.__init__-893"><a href="#DeepEGNN.__init__-893"><span class="linenos">893</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="DeepEGNN.__init__-894"><a href="#DeepEGNN.__init__-894"><span class="linenos">894</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="DeepEGNN.__init__-895"><a href="#DeepEGNN.__init__-895"><span class="linenos">895</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="DeepEGNN.__init__-896"><a href="#DeepEGNN.__init__-896"><span class="linenos">896</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepEGNN.__init__-897"><a href="#DeepEGNN.__init__-897"><span class="linenos">897</span></a>
</span><span id="DeepEGNN.__init__-898"><a href="#DeepEGNN.__init__-898"><span class="linenos">898</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-899"><a href="#DeepEGNN.__init__-899"><span class="linenos">899</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="DeepEGNN.__init__-900"><a href="#DeepEGNN.__init__-900"><span class="linenos">900</span></a>
</span><span id="DeepEGNN.__init__-901"><a href="#DeepEGNN.__init__-901"><span class="linenos">901</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-902"><a href="#DeepEGNN.__init__-902"><span class="linenos">902</span></a>
</span><span id="DeepEGNN.__init__-903"><a href="#DeepEGNN.__init__-903"><span class="linenos">903</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="DeepEGNN.__init__-904"><a href="#DeepEGNN.__init__-904"><span class="linenos">904</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepEGNN.__init__-905"><a href="#DeepEGNN.__init__-905"><span class="linenos">905</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="DeepEGNN.__init__-906"><a href="#DeepEGNN.__init__-906"><span class="linenos">906</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-907"><a href="#DeepEGNN.__init__-907"><span class="linenos">907</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepEGNN.__init__-908"><a href="#DeepEGNN.__init__-908"><span class="linenos">908</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="DeepEGNN.__init__-909"><a href="#DeepEGNN.__init__-909"><span class="linenos">909</span></a>
</span><span id="DeepEGNN.__init__-910"><a href="#DeepEGNN.__init__-910"><span class="linenos">910</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="DeepEGNN.__init__-911"><a href="#DeepEGNN.__init__-911"><span class="linenos">911</span></a>        <span class="n">residual_is_broadcasted</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span id="DeepEGNN.__init__-912"><a href="#DeepEGNN.__init__-912"><span class="linenos">912</span></a>
</span><span id="DeepEGNN.__init__-913"><a href="#DeepEGNN.__init__-913"><span class="linenos">913</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-914"><a href="#DeepEGNN.__init__-914"><span class="linenos">914</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-915"><a href="#DeepEGNN.__init__-915"><span class="linenos">915</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-916"><a href="#DeepEGNN.__init__-916"><span class="linenos">916</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-917"><a href="#DeepEGNN.__init__-917"><span class="linenos">917</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-918"><a href="#DeepEGNN.__init__-918"><span class="linenos">918</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-919"><a href="#DeepEGNN.__init__-919"><span class="linenos">919</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-920"><a href="#DeepEGNN.__init__-920"><span class="linenos">920</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-921"><a href="#DeepEGNN.__init__-921"><span class="linenos">921</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-922"><a href="#DeepEGNN.__init__-922"><span class="linenos">922</span></a>        <span class="n">residual</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;residual&quot;</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-923"><a href="#DeepEGNN.__init__-923"><span class="linenos">923</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-924"><a href="#DeepEGNN.__init__-924"><span class="linenos">924</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-925"><a href="#DeepEGNN.__init__-925"><span class="linenos">925</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-926"><a href="#DeepEGNN.__init__-926"><span class="linenos">926</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-927"><a href="#DeepEGNN.__init__-927"><span class="linenos">927</span></a>
</span><span id="DeepEGNN.__init__-928"><a href="#DeepEGNN.__init__-928"><span class="linenos">928</span></a>        <span class="n">dim_in</span> <span class="o">=</span> <span class="n">features_node</span>
</span><span id="DeepEGNN.__init__-929"><a href="#DeepEGNN.__init__-929"><span class="linenos">929</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepEGNN.__init__-930"><a href="#DeepEGNN.__init__-930"><span class="linenos">930</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim_in</span><span class="p">,</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-931"><a href="#DeepEGNN.__init__-931"><span class="linenos">931</span></a>            <span class="n">dim_in</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DeepEGNN.__init__-932"><a href="#DeepEGNN.__init__-932"><span class="linenos">932</span></a>
</span><span id="DeepEGNN.__init__-933"><a href="#DeepEGNN.__init__-933"><span class="linenos">933</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-934"><a href="#DeepEGNN.__init__-934"><span class="linenos">934</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="DeepEGNN.__init__-935"><a href="#DeepEGNN.__init__-935"><span class="linenos">935</span></a>
</span><span id="DeepEGNN.__init__-936"><a href="#DeepEGNN.__init__-936"><span class="linenos">936</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residual</span><span class="p">)):</span>
</span><span id="DeepEGNN.__init__-937"><a href="#DeepEGNN.__init__-937"><span class="linenos">937</span></a>            <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="DeepEGNN.__init__-938"><a href="#DeepEGNN.__init__-938"><span class="linenos">938</span></a>                <span class="k">if</span> <span class="n">residual_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-939"><a href="#DeepEGNN.__init__-939"><span class="linenos">939</span></a>                    <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DeepEGNN.__init__-940"><a href="#DeepEGNN.__init__-940"><span class="linenos">940</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-941"><a href="#DeepEGNN.__init__-941"><span class="linenos">941</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepEGNN.__init__-942"><a href="#DeepEGNN.__init__-942"><span class="linenos">942</span></a>                        <span class="sa">f</span><span class="s2">&quot;cannot use residual connections if input and output &quot;</span>
</span><span id="DeepEGNN.__init__-943"><a href="#DeepEGNN.__init__-943"><span class="linenos">943</span></a>                        <span class="sa">f</span><span class="s2">&quot;dimensions disagree: number of input features at &quot;</span>
</span><span id="DeepEGNN.__init__-944"><a href="#DeepEGNN.__init__-944"><span class="linenos">944</span></a>                        <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, number of output &quot;</span>
</span><span id="DeepEGNN.__init__-945"><a href="#DeepEGNN.__init__-945"><span class="linenos">945</span></a>                        <span class="sa">f</span><span class="s2">&quot;features is </span><span class="si">{</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DeepEGNN.__init__-946"><a href="#DeepEGNN.__init__-946"><span class="linenos">946</span></a>                    <span class="p">)</span>
</span><span id="DeepEGNN.__init__-947"><a href="#DeepEGNN.__init__-947"><span class="linenos">947</span></a>
</span><span id="DeepEGNN.__init__-948"><a href="#DeepEGNN.__init__-948"><span class="linenos">948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span>
</span><span id="DeepEGNN.__init__-949"><a href="#DeepEGNN.__init__-949"><span class="linenos">949</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="DeepEGNN.__init__-950"><a href="#DeepEGNN.__init__-950"><span class="linenos">950</span></a>
</span><span id="DeepEGNN.__init__-951"><a href="#DeepEGNN.__init__-951"><span class="linenos">951</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-952"><a href="#DeepEGNN.__init__-952"><span class="linenos">952</span></a>
</span><span id="DeepEGNN.__init__-953"><a href="#DeepEGNN.__init__-953"><span class="linenos">953</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepEGNN.__init__-954"><a href="#DeepEGNN.__init__-954"><span class="linenos">954</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-955"><a href="#DeepEGNN.__init__-955"><span class="linenos">955</span></a>
</span><span id="DeepEGNN.__init__-956"><a href="#DeepEGNN.__init__-956"><span class="linenos">956</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="DeepEGNN.__init__-957"><a href="#DeepEGNN.__init__-957"><span class="linenos">957</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-958"><a href="#DeepEGNN.__init__-958"><span class="linenos">958</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-959"><a href="#DeepEGNN.__init__-959"><span class="linenos">959</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-960"><a href="#DeepEGNN.__init__-960"><span class="linenos">960</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-961"><a href="#DeepEGNN.__init__-961"><span class="linenos">961</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="DeepEGNN.__init__-962"><a href="#DeepEGNN.__init__-962"><span class="linenos">962</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-963"><a href="#DeepEGNN.__init__-963"><span class="linenos">963</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-964"><a href="#DeepEGNN.__init__-964"><span class="linenos">964</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-965"><a href="#DeepEGNN.__init__-965"><span class="linenos">965</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-966"><a href="#DeepEGNN.__init__-966"><span class="linenos">966</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-967"><a href="#DeepEGNN.__init__-967"><span class="linenos">967</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-968"><a href="#DeepEGNN.__init__-968"><span class="linenos">968</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-969"><a href="#DeepEGNN.__init__-969"><span class="linenos">969</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-970"><a href="#DeepEGNN.__init__-970"><span class="linenos">970</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepEGNN.__init__-971"><a href="#DeepEGNN.__init__-971"><span class="linenos">971</span></a>            <span class="p">)</span>
</span><span id="DeepEGNN.__init__-972"><a href="#DeepEGNN.__init__-972"><span class="linenos">972</span></a>
</span><span id="DeepEGNN.__init__-973"><a href="#DeepEGNN.__init__-973"><span class="linenos">973</span></a>            <span class="k">if</span> <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DeepEGNN.__init__-974"><a href="#DeepEGNN.__init__-974"><span class="linenos">974</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-975"><a href="#DeepEGNN.__init__-975"><span class="linenos">975</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-976"><a href="#DeepEGNN.__init__-976"><span class="linenos">976</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-977"><a href="#DeepEGNN.__init__-977"><span class="linenos">977</span></a>
</span><span id="DeepEGNN.__init__-978"><a href="#DeepEGNN.__init__-978"><span class="linenos">978</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DeepEGNN.__init__-979"><a href="#DeepEGNN.__init__-979"><span class="linenos">979</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-980"><a href="#DeepEGNN.__init__-980"><span class="linenos">980</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-981"><a href="#DeepEGNN.__init__-981"><span class="linenos">981</span></a>                <span class="k">if</span> <span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN.__init__-982"><a href="#DeepEGNN.__init__-982"><span class="linenos">982</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DeepEGNN.__init__-983"><a href="#DeepEGNN.__init__-983"><span class="linenos">983</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-984"><a href="#DeepEGNN.__init__-984"><span class="linenos">984</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-985"><a href="#DeepEGNN.__init__-985"><span class="linenos">985</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="DeepEGNN.__init__-986"><a href="#DeepEGNN.__init__-986"><span class="linenos">986</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">num_pos</span> <span class="o">*</span> <span class="n">dim_pos</span><span class="p">)</span>
</span><span id="DeepEGNN.__init__-987"><a href="#DeepEGNN.__init__-987"><span class="linenos">987</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-988"><a href="#DeepEGNN.__init__-988"><span class="linenos">988</span></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-989"><a href="#DeepEGNN.__init__-989"><span class="linenos">989</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.__init__-990"><a href="#DeepEGNN.__init__-990"><span class="linenos">990</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-991"><a href="#DeepEGNN.__init__-991"><span class="linenos">991</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-992"><a href="#DeepEGNN.__init__-992"><span class="linenos">992</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="DeepEGNN.__init__-993"><a href="#DeepEGNN.__init__-993"><span class="linenos">993</span></a>
</span><span id="DeepEGNN.__init__-994"><a href="#DeepEGNN.__init__-994"><span class="linenos">994</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims_node:</strong>  Dimensions for the node networks. This can be a sequence
of integers with <code>dims_node[0]</code> describing the number of input
features and <code>dims_node[-1]</code> describing the number output
features for the node networks in all layers. Note that the
number of input features is only valid for the first layer; in
all subsequent layers the number of input features is inferred
from the number of output features of the previous layer.
Alternatively, <code>dims_node</code> can also be a sequence of sequences
of integers, describing the aforementioned properties for each
layer individually. In this case, <code>dims_node[0][0]</code> is the
number of input features for the first layer, but for all
subsequent layers the first value represents the dimension of
the first hidden layer of the node networks, since the number of
input features is inferred from the previous number of output
features of the previous layer; e.g., <code>dims_node[1][0]</code> is the
dimension of the first hidden layer in the node network of the
second layer in this network.</li>
<li><strong>dims_edge:</strong>  Dimensions for the edge networks. Follows the same
broadcasting scheme as <code>dims_node</code>.</li>
<li><strong>dims_gate:</strong>  Dimensions for the message gating network. Follows the
same broadcasting scheme as <code>dims_node</code>. If empty, message
gating is disabled.</li>
<li><strong>dims_pos:</strong>  Dimensions for the coordinate update network. Follows the
same broadcasting scheme as <code>dims_node</code>. If empty, coordinate
update is disabled.</li>
<li><strong>layers:</strong>  Number of <code><a href="#EGNN">EGNN</a></code> layers.</li>
<li><strong>num_pos:</strong>  Number of node positions.</li>
<li><strong>dim_pos:</strong>  Number of coordinate dimensions.</li>
<li><strong>num_encode:</strong>  Number of fourier-encoded features.</li>
<li><strong>pos_scale:</strong>  Initial scaler for coordinate updates. If pos_scale is
0, the penultimate layer of a coordinate update network will
use a linear activation and omit the scaling factor.</li>
<li><strong>norm:</strong>  Whether to normalize a given layer and whether to use
normalization after that given layer. If a single boolean or a
list of single booleans, then normalization will be applied
within and after the corresponding layers according to the
boolean value. If a tuple of booleans or a list of tuples of
booleans, then the first boolean will determine whether to use
normalization after a layer and the second will determine
whether to use normalization within that layer.</li>
<li><strong>clamp:</strong>  Threshold for clamping coordinate updates (between <code>-clamp</code>
and <code>clamp</code>). Unclamped if 0.</li>
<li><strong>dropout:</strong>  Dropout probabilities for in-between layers and within
layers. Values will be broadcasted to all layers, if only two
probabilities are given, or to all layers and in-between and
within layers, if only one probability is given. Dropout is
omitted if 0.</li>
<li><strong>residual:</strong>  Whether a layer is a residual layer. If <code><a href="#DeepEGNN.residual">residual</a></code> is a
single value, then layers will only be residual layers if their
number of input and output features matches. Coordinates are not
updated through residual connections, independent of this
toggle.</li>
<li><strong>activation:</strong>  Activation function that is used for the <code><a href="#EGNN">EGNN</a></code>
layers.</li>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
The default non-linearity should adhere to whatever is used for
<code>activation</code>. See <code><a href="#parameter_init">parameter_init()</a></code>.</li>
<li><strong>norm_cls:</strong>  Class instance of normalization module.</li>
<li><strong>dropout_cls:</strong>  Class instance of dropout module.</li>
</ul>
</div>


                            </div>
                            <div id="DeepEGNN.residual" class="classattr">
                                <div class="attr variable">
            <span class="name">residual</span>

        
    </div>
    <a class="headerlink" href="#DeepEGNN.residual"></a>
    
    

                            </div>
                            <div id="DeepEGNN.init" class="classattr">
                                <div class="attr variable">
            <span class="name">init</span>

        
    </div>
    <a class="headerlink" href="#DeepEGNN.init"></a>
    
    

                            </div>
                            <div id="DeepEGNN.layers" class="classattr">
                                <div class="attr variable">
            <span class="name">layers</span>

        
    </div>
    <a class="headerlink" href="#DeepEGNN.layers"></a>
    
    

                            </div>
                            <div id="DeepEGNN.reset_parameters" class="classattr">
                                        <input id="DeepEGNN.reset_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DeepEGNN.reset_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepEGNN.reset_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepEGNN.reset_parameters-996"><a href="#DeepEGNN.reset_parameters-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DeepEGNN.reset_parameters-997"><a href="#DeepEGNN.reset_parameters-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="DeepEGNN.reset_parameters-998"><a href="#DeepEGNN.reset_parameters-998"><span class="linenos"> 998</span></a>
</span><span id="DeepEGNN.reset_parameters-999"><a href="#DeepEGNN.reset_parameters-999"><span class="linenos"> 999</span></a>        <span class="k">for</span> <span class="n">init</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepEGNN.reset_parameters-1000"><a href="#DeepEGNN.reset_parameters-1000"><span class="linenos">1000</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="DeepEGNN.reset_parameters-1001"><a href="#DeepEGNN.reset_parameters-1001"><span class="linenos">1001</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span><span id="DeepEGNN.reset_parameters-1002"><a href="#DeepEGNN.reset_parameters-1002"><span class="linenos">1002</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset parameters.</p>
</div>


                            </div>
                            <div id="DeepEGNN.forward" class="classattr">
                                        <input id="DeepEGNN.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">pos</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">edge_index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DeepEGNN.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepEGNN.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepEGNN.forward-1004"><a href="#DeepEGNN.forward-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="DeepEGNN.forward-1005"><a href="#DeepEGNN.forward-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1006"><a href="#DeepEGNN.forward-1006"><span class="linenos">1006</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1007"><a href="#DeepEGNN.forward-1007"><span class="linenos">1007</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1008"><a href="#DeepEGNN.forward-1008"><span class="linenos">1008</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1009"><a href="#DeepEGNN.forward-1009"><span class="linenos">1009</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1010"><a href="#DeepEGNN.forward-1010"><span class="linenos">1010</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1011"><a href="#DeepEGNN.forward-1011"><span class="linenos">1011</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="DeepEGNN.forward-1012"><a href="#DeepEGNN.forward-1012"><span class="linenos">1012</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="DeepEGNN.forward-1013"><a href="#DeepEGNN.forward-1013"><span class="linenos">1013</span></a>
</span><span id="DeepEGNN.forward-1014"><a href="#DeepEGNN.forward-1014"><span class="linenos">1014</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepEGNN.forward-1015"><a href="#DeepEGNN.forward-1015"><span class="linenos">1015</span></a><span class="sd">            x: Node features.</span>
</span><span id="DeepEGNN.forward-1016"><a href="#DeepEGNN.forward-1016"><span class="linenos">1016</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="DeepEGNN.forward-1017"><a href="#DeepEGNN.forward-1017"><span class="linenos">1017</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="DeepEGNN.forward-1018"><a href="#DeepEGNN.forward-1018"><span class="linenos">1018</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="DeepEGNN.forward-1019"><a href="#DeepEGNN.forward-1019"><span class="linenos">1019</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="DeepEGNN.forward-1020"><a href="#DeepEGNN.forward-1020"><span class="linenos">1020</span></a>
</span><span id="DeepEGNN.forward-1021"><a href="#DeepEGNN.forward-1021"><span class="linenos">1021</span></a><span class="sd">        Returns:</span>
</span><span id="DeepEGNN.forward-1022"><a href="#DeepEGNN.forward-1022"><span class="linenos">1022</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="DeepEGNN.forward-1023"><a href="#DeepEGNN.forward-1023"><span class="linenos">1023</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepEGNN.forward-1024"><a href="#DeepEGNN.forward-1024"><span class="linenos">1024</span></a>
</span><span id="DeepEGNN.forward-1025"><a href="#DeepEGNN.forward-1025"><span class="linenos">1025</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepEGNN.forward-1026"><a href="#DeepEGNN.forward-1026"><span class="linenos">1026</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span>
</span><span id="DeepEGNN.forward-1027"><a href="#DeepEGNN.forward-1027"><span class="linenos">1027</span></a>                <span class="n">x</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1028"><a href="#DeepEGNN.forward-1028"><span class="linenos">1028</span></a>                <span class="n">pos</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1029"><a href="#DeepEGNN.forward-1029"><span class="linenos">1029</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1030"><a href="#DeepEGNN.forward-1030"><span class="linenos">1030</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1031"><a href="#DeepEGNN.forward-1031"><span class="linenos">1031</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="DeepEGNN.forward-1032"><a href="#DeepEGNN.forward-1032"><span class="linenos">1032</span></a>            <span class="p">)</span>
</span><span id="DeepEGNN.forward-1033"><a href="#DeepEGNN.forward-1033"><span class="linenos">1033</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN.forward-1034"><a href="#DeepEGNN.forward-1034"><span class="linenos">1034</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN.forward-1035"><a href="#DeepEGNN.forward-1035"><span class="linenos">1035</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN.forward-1036"><a href="#DeepEGNN.forward-1036"><span class="linenos">1036</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="DeepEGNN.forward-1037"><a href="#DeepEGNN.forward-1037"><span class="linenos">1037</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.forward-1038"><a href="#DeepEGNN.forward-1038"><span class="linenos">1038</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="DeepEGNN.forward-1039"><a href="#DeepEGNN.forward-1039"><span class="linenos">1039</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="DeepEGNN.forward-1040"><a href="#DeepEGNN.forward-1040"><span class="linenos">1040</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="DeepEGNN.forward-1041"><a href="#DeepEGNN.forward-1041"><span class="linenos">1041</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="DeepEGNN.forward-1042"><a href="#DeepEGNN.forward-1042"><span class="linenos">1042</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DeepEGNN.forward-1043"><a href="#DeepEGNN.forward-1043"><span class="linenos">1043</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="DeepEGNN.forward-1044"><a href="#DeepEGNN.forward-1044"><span class="linenos">1044</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DeepEGNN.forward-1045"><a href="#DeepEGNN.forward-1045"><span class="linenos">1045</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="DeepEGNN.forward-1046"><a href="#DeepEGNN.forward-1046"><span class="linenos">1046</span></a>
</span><span id="DeepEGNN.forward-1047"><a href="#DeepEGNN.forward-1047"><span class="linenos">1047</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span>
</span></pre></div>


            <div class="docstring"><p>Compute forward pass.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x:</strong>  Node features.</li>
<li><strong>pos:</strong>  Node coordinates.</li>
<li><strong>edge_index:</strong>  Graph connectivity.</li>
<li><strong>edge_attr:</strong>  Edge features.</li>
<li><strong>batch:</strong>  Node to batch mapping.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of updated node features and updated coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="DeepEGNN.dump_patches" class="variable">dump_patches</dd>
                <dd id="DeepEGNN.training" class="variable">training</dd>
                <dd id="DeepEGNN.call_super_init" class="variable">call_super_init</dd>
                <dd id="DeepEGNN.register_buffer" class="function">register_buffer</dd>
                <dd id="DeepEGNN.register_parameter" class="function">register_parameter</dd>
                <dd id="DeepEGNN.add_module" class="function">add_module</dd>
                <dd id="DeepEGNN.register_module" class="function">register_module</dd>
                <dd id="DeepEGNN.get_submodule" class="function">get_submodule</dd>
                <dd id="DeepEGNN.get_parameter" class="function">get_parameter</dd>
                <dd id="DeepEGNN.get_buffer" class="function">get_buffer</dd>
                <dd id="DeepEGNN.get_extra_state" class="function">get_extra_state</dd>
                <dd id="DeepEGNN.set_extra_state" class="function">set_extra_state</dd>
                <dd id="DeepEGNN.apply" class="function">apply</dd>
                <dd id="DeepEGNN.cuda" class="function">cuda</dd>
                <dd id="DeepEGNN.ipu" class="function">ipu</dd>
                <dd id="DeepEGNN.xpu" class="function">xpu</dd>
                <dd id="DeepEGNN.cpu" class="function">cpu</dd>
                <dd id="DeepEGNN.type" class="function">type</dd>
                <dd id="DeepEGNN.float" class="function">float</dd>
                <dd id="DeepEGNN.double" class="function">double</dd>
                <dd id="DeepEGNN.half" class="function">half</dd>
                <dd id="DeepEGNN.bfloat16" class="function">bfloat16</dd>
                <dd id="DeepEGNN.to_empty" class="function">to_empty</dd>
                <dd id="DeepEGNN.to" class="function">to</dd>
                <dd id="DeepEGNN.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="DeepEGNN.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="DeepEGNN.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="DeepEGNN.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="DeepEGNN.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="DeepEGNN.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="DeepEGNN.state_dict" class="function">state_dict</dd>
                <dd id="DeepEGNN.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="DeepEGNN.load_state_dict" class="function">load_state_dict</dd>
                <dd id="DeepEGNN.parameters" class="function">parameters</dd>
                <dd id="DeepEGNN.named_parameters" class="function">named_parameters</dd>
                <dd id="DeepEGNN.buffers" class="function">buffers</dd>
                <dd id="DeepEGNN.named_buffers" class="function">named_buffers</dd>
                <dd id="DeepEGNN.children" class="function">children</dd>
                <dd id="DeepEGNN.named_children" class="function">named_children</dd>
                <dd id="DeepEGNN.modules" class="function">modules</dd>
                <dd id="DeepEGNN.named_modules" class="function">named_modules</dd>
                <dd id="DeepEGNN.train" class="function">train</dd>
                <dd id="DeepEGNN.eval" class="function">eval</dd>
                <dd id="DeepEGNN.requires_grad_" class="function">requires_grad_</dd>
                <dd id="DeepEGNN.zero_grad" class="function">zero_grad</dd>
                <dd id="DeepEGNN.share_memory" class="function">share_memory</dd>
                <dd id="DeepEGNN.extra_repr" class="function">extra_repr</dd>
                <dd id="DeepEGNN.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>