<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>bpp.model.egnn.reversible API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../egnn.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;bpp.model.egnn</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ReversibleEGNN">ReversibleEGNN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ReversibleEGNN.__init__">ReversibleEGNN</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReversibleEGNN.init">init</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReversibleEGNN.deterministic_contexts">deterministic_contexts</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReversibleEGNN.blocks">blocks</a>
                        </li>
                        <li>
                                <a class="function" href="#ReversibleEGNN.reset_parameters">reset_parameters</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SimplifiedReversibleEGNN">SimplifiedReversibleEGNN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SimplifiedReversibleEGNN.__init__">SimplifiedReversibleEGNN</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DeepReversibleEGNN">DeepReversibleEGNN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DeepReversibleEGNN.__init__">DeepReversibleEGNN</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeepReversibleEGNN.layers">layers</a>
                        </li>
                        <li>
                                <a class="function" href="#DeepReversibleEGNN.reset_parameters">reset_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#DeepReversibleEGNN.forward">forward</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../bpp.html">bpp</a><wbr>.<a href="./../../model.html">model</a><wbr>.<a href="./../egnn.html">egnn</a><wbr>.reversible    </h1>

                        <div class="docstring"><p>Module containing implementation of reversible E(n) Equivariant Graph Neural
Networks.</p>

<p>These variants are primarily used for saving memory by not storing any
intermediate values and recomputing the inputs and required intermediate values
in an auto-regressive scheme from the outputs of a given layer during
back-propagation.</p>

<p><strong>Note</strong>: PyTorch does not provide a feasible solution on how to pass the
outputs to the backwards function without storing them as intermediate results,
meaning that we would need to free and reallocate the memory of a given value
manually. However, this often causes memory leaks, invalid accesses' or only
copies of a value to be freed. If we however manage to make an architecture
work, we often end up with numerical issues; e.g., normalization modules. This
is why, by default, the outputs of each layer will be stored as intermediate
values during the forward pass.</p>

<h6 id="references">References:</h6>

<blockquote>
  <p>[^1]: Li, G., Müller, M., Ghanem, B., &amp; Koltun, V. (2022). Training Graph
         Neural Networks with 1000 Layers.
  [^2]: Rezende, D. J., &amp; Mohamed, S. (2016). Variational Inference with
         Normalizing Flows.</p>
</blockquote>
</div>

                        <input id="mod-reversible-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-reversible-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Module containing implementation of reversible E(n) Equivariant Graph Neural</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Networks.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">These variants are primarily used for saving memory by not storing any</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">intermediate values and recomputing the inputs and required intermediate values</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">in an auto-regressive scheme from the outputs of a given layer during</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">back-propagation.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">**Note**: PyTorch does not provide a feasible solution on how to pass the</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">outputs to the backwards function without storing them as intermediate results,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">meaning that we would need to free and reallocate the memory of a given value</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">manually. However, this often causes memory leaks, invalid accesses&#39; or only</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">copies of a value to be freed. If we however manage to make an architecture</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">work, we often end up with numerical issues; e.g., normalization modules. This</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">is why, by default, the outputs of each layer will be stored as intermediate</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">values during the forward pass.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    </span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">References:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    .. [1] Li, G., Müller, M., Ghanem, B., &amp; Koltun, V. (2022). Training Graph</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        Neural Networks with 1000 Layers.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    .. [2] Rezende, D. J., &amp; Mohamed, S. (2016). Variational Inference with</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        Normalizing Flows.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span> <span class="nn">torch_geometric.typing</span> <span class="kn">import</span> <span class="n">Adj</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">EGNN</span><span class="p">,</span> <span class="n">parameter_init</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="kn">from</span> <span class="nn">.._reversible</span> <span class="kn">import</span> <span class="n">ReversibleModule</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="kn">from</span> <span class="nn">.._deterministic</span> <span class="kn">import</span> <span class="n">deterministic_context</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="kn">from</span> <span class="nn">.._arguments</span> <span class="kn">import</span> <span class="n">broadcast_arg</span><span class="p">,</span> <span class="n">Broadcast</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="k">class</span> <span class="nc">ReversibleEGNN</span><span class="p">(</span><span class="n">ReversibleModule</span><span class="p">):</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reversible E(n) Equivariant Graph Neural Network.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    Implementation of an E(n) Equivariant Graph Neural Network with reversible</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    layers to omit storing any intermediate values during the forward pass when</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    computing the differentials. Inputs of each layer are computed in reverse</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    from the outputs to compute the differentials of a given layer.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.EGNN` for further details on how to</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    use this module.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Arguments:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">                no edge features), `dims_edge[-2]` is the number of message</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">                features and `dims_edge[-1]` is the number of hidden-layer</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">                features for the coordinate update and message gating networks</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">                (ignored if neither `update` nor `gate` are enabled). All</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">                least 2 are necessary.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">            update: Whether to update node coordinates.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            gate: Whether to gate messages before aggregation.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">                0.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">                layers.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">                debugging.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">                numerical issues.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">                numerical issues.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="n">dropout</span> <span class="o">=</span> <span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">dropout</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="n">preserve_rng_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="n">forward_has_only_one_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">blocks</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                <span class="n">dims_node</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="n">num_encode</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="n">clamp</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="n">activation</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                <span class="n">init</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">dim_pos</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">pos_b</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        Arguments:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">            pos_a: Node coordinates. Used as inputs in EGNN blocks.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">            pos_b: Node coordinates. Used for auto-regressive update of</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">                coordinates.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        Returns:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">            Tuple of updated node features, updated coordinates and original</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">            coordinates `pos_a`.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="n">y_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deterministic_context</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_i</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_i</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">pos_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_b</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">pos_c</span><span class="p">,</span> <span class="n">pos_a</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">pos_c</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute reverse pass.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        Arguments:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            pos_c: Node coordinates. Updated coordinates from forward pass.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">            pos_a: Node coordinates. Original coordinates used to compute the</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">                updated coordinates in the forward pass.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        Returns:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">            Tuple of node features and original coordinates `pos_a` and `pos_b`</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">            that were used as inputs for the forward pass.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">))):</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                <span class="n">y_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                <span class="n">y_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]():</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>                <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">x_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_i</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">x_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos_c</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">pos_s</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="k">class</span> <span class="nc">SimplifiedReversibleEGNN</span><span class="p">(</span><span class="n">ReversibleEGNN</span><span class="p">):</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Simplified variant of the Reversible E(n) Equivariant Graph Neural</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    Network.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">    This variant uses an auto-regressive update scheme that is more in line</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    with [2]_.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.EGNN` for further details on how to</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    use this module.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        Arguments:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">                no edge features), `dims_edge[-1]` is the number of message</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">                features.  All remaining dimensions are used for the</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">                hidden-layers of the edge network that computes the messages.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">                least one block is required.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">                will be disabled.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">                normalization after a block. If only one value is given, then</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">                normalization within and after a block will be applied</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">                accordingly. If two values are given, then the first determines</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">                whether to apply normalization after a block and the second</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">                whether to apply normalization within a block.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">                0.</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">                layers.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">                debugging.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">                numerical issues.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">                numerical issues.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="n">dims_node</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="n">blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="n">num_pos</span><span class="p">,</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="n">num_encode</span><span class="p">,</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="n">norm</span><span class="p">,</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="n">clamp</span><span class="p">,</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="n">dropout</span><span class="p">,</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">activation</span><span class="p">,</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">init</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">pos_b</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        Arguments:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">            pos_a: Node coordinates. Used as inputs in EGNN blocks.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">            pos_b: Node coordinates. Used for auto-regressive update of</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">                coordinates.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        Returns:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">            Tuple of updated node features, updated coordinates and original</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">            coordinates `pos_a`.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_blocks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deterministic_context</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_i</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_i</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">pos_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_b</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">pos_c</span><span class="p">,</span> <span class="n">pos_a</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="n">pos_c</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute reverse pass.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        Arguments:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">            pos_c: Node coordinates. Updated coordinates from forward pass.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">            pos_a: Node coordinates. Original coordinates used to compute the</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">                updated coordinates in the forward pass.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        Returns:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">            Tuple of node features and original coordinates `pos_a` and `pos_b`</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">            that were used as inputs for the forward pass.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">num_blocks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]():</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>                <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>                <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="n">x_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_i</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="n">x_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">num_blocks</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos_c</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">pos_s</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="k">class</span> <span class="nc">DeepReversibleEGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deep Reversible E(n) Equivariant Graph Neural Network.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">    Implementation of a Deep Reversible E(n) Equivariant Graph Neural Network</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">    that utilizes reversible layers for saving memory during back-propagation.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.DeepEGNN` for further details on how</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">    to use this module.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">layer_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReversibleEGNN</span><span class="p">,</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        Arguments:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">                features and all remaining dimensions describing the number of</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">                features in the hidden layers. Note that the number of output</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">                features will always be the same as the number of input features</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">                for this variant of an EGNN model. Alternatively, `dims_node`</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">                can also be a sequence of sequences of integers, describing the</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">                aforementioned properties for each layer individually. In this</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">                case, only the number of input features in the definition of the</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">                first layer must be provided and for all other layers the number</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">                of input features is omitted, since it is derived from the</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">                the previous layer.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">                gating is disabled.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">                update is disabled.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">                least two blocks are required and the number of node input</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">                features must be divisible by the number of blocks.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">            layers: Number of layers.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If `pos_scale` is</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">                normalization after a block. If a single boolean or a list of</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">                single booleans, then normalization will be applied within and</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">                after the corresponding blocks of a layer according to the</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">                normalization after a block and the second will determine</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">                whether to use normalization within that block.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">                omitted if 0.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">                layers.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">            layer_cls: Class instance of the reversible layer.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">                debugging.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="n">blocks</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="n">layer_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;layer_cls&quot;</span><span class="p">,</span> <span class="n">layer_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">disable</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;disable&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>            <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                    <span class="sa">f</span><span class="s2">&quot;minimum number of blocks is 2, but got </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s2"> for number &quot;</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>                    <span class="sa">f</span><span class="s2">&quot;of blocks&quot;</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                <span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>            <span class="k">if</span> <span class="n">features_node</span> <span class="o">%</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>                    <span class="sa">f</span><span class="s2">&quot;number of input features for a node must be divisible by &quot;</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                    <span class="sa">f</span><span class="s2">&quot;the number of blocks, but got </span><span class="si">{</span><span class="n">features_node</span><span class="si">}</span><span class="s2"> for input &quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                    <span class="sa">f</span><span class="s2">&quot;features and </span><span class="si">{</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> for the number of blocks in &quot;</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                    <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                <span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>            <span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layers</span><span class="p">):</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">layer_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>                <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>                <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>                <span class="n">disable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>                <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>                <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">        Arguments:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a><span class="sd">            x: Node features.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">        Returns:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>        <span class="n">pos_a</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>                <span class="n">s</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>                <span class="n">pos_a</span><span class="p">,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>                <span class="n">pos_b</span><span class="p">,</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>            <span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span>
</span></pre></div>


            </section>
                <section id="ReversibleEGNN">
                            <input id="ReversibleEGNN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReversibleEGNN</span><wbr>(<span class="base"><a href="../_reversible.html#ReversibleModule">bpp.model._reversible.ReversibleModule</a></span>):

                <label class="view-source-button" for="ReversibleEGNN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReversibleEGNN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReversibleEGNN-39"><a href="#ReversibleEGNN-39"><span class="linenos"> 39</span></a><span class="k">class</span> <span class="nc">ReversibleEGNN</span><span class="p">(</span><span class="n">ReversibleModule</span><span class="p">):</span>
</span><span id="ReversibleEGNN-40"><a href="#ReversibleEGNN-40"><span class="linenos"> 40</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reversible E(n) Equivariant Graph Neural Network.</span>
</span><span id="ReversibleEGNN-41"><a href="#ReversibleEGNN-41"><span class="linenos"> 41</span></a>
</span><span id="ReversibleEGNN-42"><a href="#ReversibleEGNN-42"><span class="linenos"> 42</span></a><span class="sd">    Implementation of an E(n) Equivariant Graph Neural Network with reversible</span>
</span><span id="ReversibleEGNN-43"><a href="#ReversibleEGNN-43"><span class="linenos"> 43</span></a><span class="sd">    layers to omit storing any intermediate values during the forward pass when</span>
</span><span id="ReversibleEGNN-44"><a href="#ReversibleEGNN-44"><span class="linenos"> 44</span></a><span class="sd">    computing the differentials. Inputs of each layer are computed in reverse</span>
</span><span id="ReversibleEGNN-45"><a href="#ReversibleEGNN-45"><span class="linenos"> 45</span></a><span class="sd">    from the outputs to compute the differentials of a given layer.</span>
</span><span id="ReversibleEGNN-46"><a href="#ReversibleEGNN-46"><span class="linenos"> 46</span></a>
</span><span id="ReversibleEGNN-47"><a href="#ReversibleEGNN-47"><span class="linenos"> 47</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.EGNN` for further details on how to</span>
</span><span id="ReversibleEGNN-48"><a href="#ReversibleEGNN-48"><span class="linenos"> 48</span></a><span class="sd">    use this module.</span>
</span><span id="ReversibleEGNN-49"><a href="#ReversibleEGNN-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-50"><a href="#ReversibleEGNN-50"><span class="linenos"> 50</span></a>
</span><span id="ReversibleEGNN-51"><a href="#ReversibleEGNN-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReversibleEGNN-52"><a href="#ReversibleEGNN-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReversibleEGNN-53"><a href="#ReversibleEGNN-53"><span class="linenos"> 53</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ReversibleEGNN-54"><a href="#ReversibleEGNN-54"><span class="linenos"> 54</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ReversibleEGNN-55"><a href="#ReversibleEGNN-55"><span class="linenos"> 55</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="ReversibleEGNN-56"><a href="#ReversibleEGNN-56"><span class="linenos"> 56</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="ReversibleEGNN-57"><a href="#ReversibleEGNN-57"><span class="linenos"> 57</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ReversibleEGNN-58"><a href="#ReversibleEGNN-58"><span class="linenos"> 58</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ReversibleEGNN-59"><a href="#ReversibleEGNN-59"><span class="linenos"> 59</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="ReversibleEGNN-60"><a href="#ReversibleEGNN-60"><span class="linenos"> 60</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ReversibleEGNN-61"><a href="#ReversibleEGNN-61"><span class="linenos"> 61</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN-62"><a href="#ReversibleEGNN-62"><span class="linenos"> 62</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-63"><a href="#ReversibleEGNN-63"><span class="linenos"> 63</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN-64"><a href="#ReversibleEGNN-64"><span class="linenos"> 64</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN-65"><a href="#ReversibleEGNN-65"><span class="linenos"> 65</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-66"><a href="#ReversibleEGNN-66"><span class="linenos"> 66</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-67"><a href="#ReversibleEGNN-67"><span class="linenos"> 67</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="ReversibleEGNN-68"><a href="#ReversibleEGNN-68"><span class="linenos"> 68</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="ReversibleEGNN-69"><a href="#ReversibleEGNN-69"><span class="linenos"> 69</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-70"><a href="#ReversibleEGNN-70"><span class="linenos"> 70</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-71"><a href="#ReversibleEGNN-71"><span class="linenos"> 71</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-72"><a href="#ReversibleEGNN-72"><span class="linenos"> 72</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReversibleEGNN-73"><a href="#ReversibleEGNN-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-74"><a href="#ReversibleEGNN-74"><span class="linenos"> 74</span></a><span class="sd">        Arguments:</span>
</span><span id="ReversibleEGNN-75"><a href="#ReversibleEGNN-75"><span class="linenos"> 75</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="ReversibleEGNN-76"><a href="#ReversibleEGNN-76"><span class="linenos"> 76</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="ReversibleEGNN-77"><a href="#ReversibleEGNN-77"><span class="linenos"> 77</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="ReversibleEGNN-78"><a href="#ReversibleEGNN-78"><span class="linenos"> 78</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="ReversibleEGNN-79"><a href="#ReversibleEGNN-79"><span class="linenos"> 79</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="ReversibleEGNN-80"><a href="#ReversibleEGNN-80"><span class="linenos"> 80</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="ReversibleEGNN-81"><a href="#ReversibleEGNN-81"><span class="linenos"> 81</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="ReversibleEGNN-82"><a href="#ReversibleEGNN-82"><span class="linenos"> 82</span></a><span class="sd">                no edge features), `dims_edge[-2]` is the number of message</span>
</span><span id="ReversibleEGNN-83"><a href="#ReversibleEGNN-83"><span class="linenos"> 83</span></a><span class="sd">                features and `dims_edge[-1]` is the number of hidden-layer</span>
</span><span id="ReversibleEGNN-84"><a href="#ReversibleEGNN-84"><span class="linenos"> 84</span></a><span class="sd">                features for the coordinate update and message gating networks</span>
</span><span id="ReversibleEGNN-85"><a href="#ReversibleEGNN-85"><span class="linenos"> 85</span></a><span class="sd">                (ignored if neither `update` nor `gate` are enabled). All</span>
</span><span id="ReversibleEGNN-86"><a href="#ReversibleEGNN-86"><span class="linenos"> 86</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="ReversibleEGNN-87"><a href="#ReversibleEGNN-87"><span class="linenos"> 87</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="ReversibleEGNN-88"><a href="#ReversibleEGNN-88"><span class="linenos"> 88</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="ReversibleEGNN-89"><a href="#ReversibleEGNN-89"><span class="linenos"> 89</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="ReversibleEGNN-90"><a href="#ReversibleEGNN-90"><span class="linenos"> 90</span></a><span class="sd">                least 2 are necessary.</span>
</span><span id="ReversibleEGNN-91"><a href="#ReversibleEGNN-91"><span class="linenos"> 91</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="ReversibleEGNN-92"><a href="#ReversibleEGNN-92"><span class="linenos"> 92</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="ReversibleEGNN-93"><a href="#ReversibleEGNN-93"><span class="linenos"> 93</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="ReversibleEGNN-94"><a href="#ReversibleEGNN-94"><span class="linenos"> 94</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="ReversibleEGNN-95"><a href="#ReversibleEGNN-95"><span class="linenos"> 95</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="ReversibleEGNN-96"><a href="#ReversibleEGNN-96"><span class="linenos"> 96</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="ReversibleEGNN-97"><a href="#ReversibleEGNN-97"><span class="linenos"> 97</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="ReversibleEGNN-98"><a href="#ReversibleEGNN-98"><span class="linenos"> 98</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="ReversibleEGNN-99"><a href="#ReversibleEGNN-99"><span class="linenos"> 99</span></a><span class="sd">            update: Whether to update node coordinates.</span>
</span><span id="ReversibleEGNN-100"><a href="#ReversibleEGNN-100"><span class="linenos">100</span></a><span class="sd">            gate: Whether to gate messages before aggregation.</span>
</span><span id="ReversibleEGNN-101"><a href="#ReversibleEGNN-101"><span class="linenos">101</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="ReversibleEGNN-102"><a href="#ReversibleEGNN-102"><span class="linenos">102</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="ReversibleEGNN-103"><a href="#ReversibleEGNN-103"><span class="linenos">103</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="ReversibleEGNN-104"><a href="#ReversibleEGNN-104"><span class="linenos">104</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="ReversibleEGNN-105"><a href="#ReversibleEGNN-105"><span class="linenos">105</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="ReversibleEGNN-106"><a href="#ReversibleEGNN-106"><span class="linenos">106</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="ReversibleEGNN-107"><a href="#ReversibleEGNN-107"><span class="linenos">107</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="ReversibleEGNN-108"><a href="#ReversibleEGNN-108"><span class="linenos">108</span></a><span class="sd">                0.</span>
</span><span id="ReversibleEGNN-109"><a href="#ReversibleEGNN-109"><span class="linenos">109</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="ReversibleEGNN-110"><a href="#ReversibleEGNN-110"><span class="linenos">110</span></a><span class="sd">                layers.</span>
</span><span id="ReversibleEGNN-111"><a href="#ReversibleEGNN-111"><span class="linenos">111</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="ReversibleEGNN-112"><a href="#ReversibleEGNN-112"><span class="linenos">112</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="ReversibleEGNN-113"><a href="#ReversibleEGNN-113"><span class="linenos">113</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="ReversibleEGNN-114"><a href="#ReversibleEGNN-114"><span class="linenos">114</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="ReversibleEGNN-115"><a href="#ReversibleEGNN-115"><span class="linenos">115</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="ReversibleEGNN-116"><a href="#ReversibleEGNN-116"><span class="linenos">116</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="ReversibleEGNN-117"><a href="#ReversibleEGNN-117"><span class="linenos">117</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="ReversibleEGNN-118"><a href="#ReversibleEGNN-118"><span class="linenos">118</span></a><span class="sd">                debugging.</span>
</span><span id="ReversibleEGNN-119"><a href="#ReversibleEGNN-119"><span class="linenos">119</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="ReversibleEGNN-120"><a href="#ReversibleEGNN-120"><span class="linenos">120</span></a><span class="sd">                numerical issues.</span>
</span><span id="ReversibleEGNN-121"><a href="#ReversibleEGNN-121"><span class="linenos">121</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="ReversibleEGNN-122"><a href="#ReversibleEGNN-122"><span class="linenos">122</span></a><span class="sd">                numerical issues.</span>
</span><span id="ReversibleEGNN-123"><a href="#ReversibleEGNN-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-124"><a href="#ReversibleEGNN-124"><span class="linenos">124</span></a>
</span><span id="ReversibleEGNN-125"><a href="#ReversibleEGNN-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReversibleEGNN-126"><a href="#ReversibleEGNN-126"><span class="linenos">126</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="ReversibleEGNN-127"><a href="#ReversibleEGNN-127"><span class="linenos">127</span></a>
</span><span id="ReversibleEGNN-128"><a href="#ReversibleEGNN-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="ReversibleEGNN-129"><a href="#ReversibleEGNN-129"><span class="linenos">129</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
</span><span id="ReversibleEGNN-130"><a href="#ReversibleEGNN-130"><span class="linenos">130</span></a>
</span><span id="ReversibleEGNN-131"><a href="#ReversibleEGNN-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="ReversibleEGNN-132"><a href="#ReversibleEGNN-132"><span class="linenos">132</span></a>            <span class="n">dropout</span> <span class="o">=</span> <span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">dropout</span><span class="p">)</span>
</span><span id="ReversibleEGNN-133"><a href="#ReversibleEGNN-133"><span class="linenos">133</span></a>
</span><span id="ReversibleEGNN-134"><a href="#ReversibleEGNN-134"><span class="linenos">134</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReversibleEGNN-135"><a href="#ReversibleEGNN-135"><span class="linenos">135</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="ReversibleEGNN-136"><a href="#ReversibleEGNN-136"><span class="linenos">136</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="ReversibleEGNN-137"><a href="#ReversibleEGNN-137"><span class="linenos">137</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="ReversibleEGNN-138"><a href="#ReversibleEGNN-138"><span class="linenos">138</span></a>            <span class="n">preserve_rng_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-139"><a href="#ReversibleEGNN-139"><span class="linenos">139</span></a>            <span class="n">forward_has_only_one_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN-140"><a href="#ReversibleEGNN-140"><span class="linenos">140</span></a>        <span class="p">)</span>
</span><span id="ReversibleEGNN-141"><a href="#ReversibleEGNN-141"><span class="linenos">141</span></a>
</span><span id="ReversibleEGNN-142"><a href="#ReversibleEGNN-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="ReversibleEGNN-143"><a href="#ReversibleEGNN-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">blocks</span>
</span><span id="ReversibleEGNN-144"><a href="#ReversibleEGNN-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="ReversibleEGNN-145"><a href="#ReversibleEGNN-145"><span class="linenos">145</span></a>
</span><span id="ReversibleEGNN-146"><a href="#ReversibleEGNN-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="ReversibleEGNN-147"><a href="#ReversibleEGNN-147"><span class="linenos">147</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN-148"><a href="#ReversibleEGNN-148"><span class="linenos">148</span></a>
</span><span id="ReversibleEGNN-149"><a href="#ReversibleEGNN-149"><span class="linenos">149</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="ReversibleEGNN-150"><a href="#ReversibleEGNN-150"><span class="linenos">150</span></a>                <span class="n">dims_node</span><span class="p">,</span>
</span><span id="ReversibleEGNN-151"><a href="#ReversibleEGNN-151"><span class="linenos">151</span></a>                <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="ReversibleEGNN-152"><a href="#ReversibleEGNN-152"><span class="linenos">152</span></a>                <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="ReversibleEGNN-153"><a href="#ReversibleEGNN-153"><span class="linenos">153</span></a>                <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="ReversibleEGNN-154"><a href="#ReversibleEGNN-154"><span class="linenos">154</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="ReversibleEGNN-155"><a href="#ReversibleEGNN-155"><span class="linenos">155</span></a>                <span class="n">num_encode</span><span class="p">,</span>
</span><span id="ReversibleEGNN-156"><a href="#ReversibleEGNN-156"><span class="linenos">156</span></a>                <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="ReversibleEGNN-157"><a href="#ReversibleEGNN-157"><span class="linenos">157</span></a>                <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ReversibleEGNN-158"><a href="#ReversibleEGNN-158"><span class="linenos">158</span></a>                <span class="n">clamp</span><span class="p">,</span>
</span><span id="ReversibleEGNN-159"><a href="#ReversibleEGNN-159"><span class="linenos">159</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ReversibleEGNN-160"><a href="#ReversibleEGNN-160"><span class="linenos">160</span></a>                <span class="n">activation</span><span class="p">,</span>
</span><span id="ReversibleEGNN-161"><a href="#ReversibleEGNN-161"><span class="linenos">161</span></a>                <span class="n">init</span><span class="p">,</span>
</span><span id="ReversibleEGNN-162"><a href="#ReversibleEGNN-162"><span class="linenos">162</span></a>                <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="ReversibleEGNN-163"><a href="#ReversibleEGNN-163"><span class="linenos">163</span></a>                <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="ReversibleEGNN-164"><a href="#ReversibleEGNN-164"><span class="linenos">164</span></a>            <span class="p">)</span>
</span><span id="ReversibleEGNN-165"><a href="#ReversibleEGNN-165"><span class="linenos">165</span></a>
</span><span id="ReversibleEGNN-166"><a href="#ReversibleEGNN-166"><span class="linenos">166</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="ReversibleEGNN-167"><a href="#ReversibleEGNN-167"><span class="linenos">167</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN-168"><a href="#ReversibleEGNN-168"><span class="linenos">168</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ReversibleEGNN-169"><a href="#ReversibleEGNN-169"><span class="linenos">169</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">):</span>
</span><span id="ReversibleEGNN-170"><a href="#ReversibleEGNN-170"><span class="linenos">170</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">dim_pos</span><span class="p">)</span>
</span><span id="ReversibleEGNN-171"><a href="#ReversibleEGNN-171"><span class="linenos">171</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN-172"><a href="#ReversibleEGNN-172"><span class="linenos">172</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN-173"><a href="#ReversibleEGNN-173"><span class="linenos">173</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN-174"><a href="#ReversibleEGNN-174"><span class="linenos">174</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN-175"><a href="#ReversibleEGNN-175"><span class="linenos">175</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN-176"><a href="#ReversibleEGNN-176"><span class="linenos">176</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN-177"><a href="#ReversibleEGNN-177"><span class="linenos">177</span></a>
</span><span id="ReversibleEGNN-178"><a href="#ReversibleEGNN-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="ReversibleEGNN-179"><a href="#ReversibleEGNN-179"><span class="linenos">179</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ReversibleEGNN-180"><a href="#ReversibleEGNN-180"><span class="linenos">180</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN-181"><a href="#ReversibleEGNN-181"><span class="linenos">181</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN-182"><a href="#ReversibleEGNN-182"><span class="linenos">182</span></a>            
</span><span id="ReversibleEGNN-183"><a href="#ReversibleEGNN-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span id="ReversibleEGNN-184"><a href="#ReversibleEGNN-184"><span class="linenos">184</span></a>
</span><span id="ReversibleEGNN-185"><a href="#ReversibleEGNN-185"><span class="linenos">185</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span>
</span><span id="ReversibleEGNN-186"><a href="#ReversibleEGNN-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReversibleEGNN-187"><a href="#ReversibleEGNN-187"><span class="linenos">187</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-188"><a href="#ReversibleEGNN-188"><span class="linenos">188</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-189"><a href="#ReversibleEGNN-189"><span class="linenos">189</span></a>        <span class="n">pos_b</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-190"><a href="#ReversibleEGNN-190"><span class="linenos">190</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="ReversibleEGNN-191"><a href="#ReversibleEGNN-191"><span class="linenos">191</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-192"><a href="#ReversibleEGNN-192"><span class="linenos">192</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-193"><a href="#ReversibleEGNN-193"><span class="linenos">193</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ReversibleEGNN-194"><a href="#ReversibleEGNN-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="ReversibleEGNN-195"><a href="#ReversibleEGNN-195"><span class="linenos">195</span></a>
</span><span id="ReversibleEGNN-196"><a href="#ReversibleEGNN-196"><span class="linenos">196</span></a><span class="sd">        Arguments:</span>
</span><span id="ReversibleEGNN-197"><a href="#ReversibleEGNN-197"><span class="linenos">197</span></a><span class="sd">            x: Node features.</span>
</span><span id="ReversibleEGNN-198"><a href="#ReversibleEGNN-198"><span class="linenos">198</span></a><span class="sd">            pos_a: Node coordinates. Used as inputs in EGNN blocks.</span>
</span><span id="ReversibleEGNN-199"><a href="#ReversibleEGNN-199"><span class="linenos">199</span></a><span class="sd">            pos_b: Node coordinates. Used for auto-regressive update of</span>
</span><span id="ReversibleEGNN-200"><a href="#ReversibleEGNN-200"><span class="linenos">200</span></a><span class="sd">                coordinates.</span>
</span><span id="ReversibleEGNN-201"><a href="#ReversibleEGNN-201"><span class="linenos">201</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="ReversibleEGNN-202"><a href="#ReversibleEGNN-202"><span class="linenos">202</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="ReversibleEGNN-203"><a href="#ReversibleEGNN-203"><span class="linenos">203</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="ReversibleEGNN-204"><a href="#ReversibleEGNN-204"><span class="linenos">204</span></a>
</span><span id="ReversibleEGNN-205"><a href="#ReversibleEGNN-205"><span class="linenos">205</span></a><span class="sd">        Returns:</span>
</span><span id="ReversibleEGNN-206"><a href="#ReversibleEGNN-206"><span class="linenos">206</span></a><span class="sd">            Tuple of updated node features, updated coordinates and original</span>
</span><span id="ReversibleEGNN-207"><a href="#ReversibleEGNN-207"><span class="linenos">207</span></a><span class="sd">            coordinates `pos_a`.</span>
</span><span id="ReversibleEGNN-208"><a href="#ReversibleEGNN-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-209"><a href="#ReversibleEGNN-209"><span class="linenos">209</span></a>
</span><span id="ReversibleEGNN-210"><a href="#ReversibleEGNN-210"><span class="linenos">210</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="ReversibleEGNN-211"><a href="#ReversibleEGNN-211"><span class="linenos">211</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-212"><a href="#ReversibleEGNN-212"><span class="linenos">212</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReversibleEGNN-213"><a href="#ReversibleEGNN-213"><span class="linenos">213</span></a>        <span class="n">y_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-214"><a href="#ReversibleEGNN-214"><span class="linenos">214</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ReversibleEGNN-215"><a href="#ReversibleEGNN-215"><span class="linenos">215</span></a>
</span><span id="ReversibleEGNN-216"><a href="#ReversibleEGNN-216"><span class="linenos">216</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="ReversibleEGNN-217"><a href="#ReversibleEGNN-217"><span class="linenos">217</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="ReversibleEGNN-218"><a href="#ReversibleEGNN-218"><span class="linenos">218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deterministic_context</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="ReversibleEGNN-219"><a href="#ReversibleEGNN-219"><span class="linenos">219</span></a>            <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="ReversibleEGNN-220"><a href="#ReversibleEGNN-220"><span class="linenos">220</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-221"><a href="#ReversibleEGNN-221"><span class="linenos">221</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-222"><a href="#ReversibleEGNN-222"><span class="linenos">222</span></a>            <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-223"><a href="#ReversibleEGNN-223"><span class="linenos">223</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_i</span>
</span><span id="ReversibleEGNN-224"><a href="#ReversibleEGNN-224"><span class="linenos">224</span></a>            <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-225"><a href="#ReversibleEGNN-225"><span class="linenos">225</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="ReversibleEGNN-226"><a href="#ReversibleEGNN-226"><span class="linenos">226</span></a>
</span><span id="ReversibleEGNN-227"><a href="#ReversibleEGNN-227"><span class="linenos">227</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-228"><a href="#ReversibleEGNN-228"><span class="linenos">228</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="ReversibleEGNN-229"><a href="#ReversibleEGNN-229"><span class="linenos">229</span></a>        <span class="n">pos_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_b</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="ReversibleEGNN-230"><a href="#ReversibleEGNN-230"><span class="linenos">230</span></a>
</span><span id="ReversibleEGNN-231"><a href="#ReversibleEGNN-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">pos_c</span><span class="p">,</span> <span class="n">pos_a</span>
</span><span id="ReversibleEGNN-232"><a href="#ReversibleEGNN-232"><span class="linenos">232</span></a>
</span><span id="ReversibleEGNN-233"><a href="#ReversibleEGNN-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span>
</span><span id="ReversibleEGNN-234"><a href="#ReversibleEGNN-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReversibleEGNN-235"><a href="#ReversibleEGNN-235"><span class="linenos">235</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-236"><a href="#ReversibleEGNN-236"><span class="linenos">236</span></a>        <span class="n">pos_c</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-237"><a href="#ReversibleEGNN-237"><span class="linenos">237</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="ReversibleEGNN-238"><a href="#ReversibleEGNN-238"><span class="linenos">238</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="ReversibleEGNN-239"><a href="#ReversibleEGNN-239"><span class="linenos">239</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-240"><a href="#ReversibleEGNN-240"><span class="linenos">240</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN-241"><a href="#ReversibleEGNN-241"><span class="linenos">241</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ReversibleEGNN-242"><a href="#ReversibleEGNN-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute reverse pass.</span>
</span><span id="ReversibleEGNN-243"><a href="#ReversibleEGNN-243"><span class="linenos">243</span></a>
</span><span id="ReversibleEGNN-244"><a href="#ReversibleEGNN-244"><span class="linenos">244</span></a><span class="sd">        Arguments:</span>
</span><span id="ReversibleEGNN-245"><a href="#ReversibleEGNN-245"><span class="linenos">245</span></a><span class="sd">            x: Node features.</span>
</span><span id="ReversibleEGNN-246"><a href="#ReversibleEGNN-246"><span class="linenos">246</span></a><span class="sd">            pos_c: Node coordinates. Updated coordinates from forward pass.</span>
</span><span id="ReversibleEGNN-247"><a href="#ReversibleEGNN-247"><span class="linenos">247</span></a><span class="sd">            pos_a: Node coordinates. Original coordinates used to compute the</span>
</span><span id="ReversibleEGNN-248"><a href="#ReversibleEGNN-248"><span class="linenos">248</span></a><span class="sd">                updated coordinates in the forward pass.</span>
</span><span id="ReversibleEGNN-249"><a href="#ReversibleEGNN-249"><span class="linenos">249</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="ReversibleEGNN-250"><a href="#ReversibleEGNN-250"><span class="linenos">250</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="ReversibleEGNN-251"><a href="#ReversibleEGNN-251"><span class="linenos">251</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="ReversibleEGNN-252"><a href="#ReversibleEGNN-252"><span class="linenos">252</span></a>
</span><span id="ReversibleEGNN-253"><a href="#ReversibleEGNN-253"><span class="linenos">253</span></a><span class="sd">        Returns:</span>
</span><span id="ReversibleEGNN-254"><a href="#ReversibleEGNN-254"><span class="linenos">254</span></a><span class="sd">            Tuple of node features and original coordinates `pos_a` and `pos_b`</span>
</span><span id="ReversibleEGNN-255"><a href="#ReversibleEGNN-255"><span class="linenos">255</span></a><span class="sd">            that were used as inputs for the forward pass.</span>
</span><span id="ReversibleEGNN-256"><a href="#ReversibleEGNN-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-257"><a href="#ReversibleEGNN-257"><span class="linenos">257</span></a>
</span><span id="ReversibleEGNN-258"><a href="#ReversibleEGNN-258"><span class="linenos">258</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="ReversibleEGNN-259"><a href="#ReversibleEGNN-259"><span class="linenos">259</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-260"><a href="#ReversibleEGNN-260"><span class="linenos">260</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReversibleEGNN-261"><a href="#ReversibleEGNN-261"><span class="linenos">261</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ReversibleEGNN-262"><a href="#ReversibleEGNN-262"><span class="linenos">262</span></a>
</span><span id="ReversibleEGNN-263"><a href="#ReversibleEGNN-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">))):</span>
</span><span id="ReversibleEGNN-264"><a href="#ReversibleEGNN-264"><span class="linenos">264</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ReversibleEGNN-265"><a href="#ReversibleEGNN-265"><span class="linenos">265</span></a>                <span class="n">y_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-266"><a href="#ReversibleEGNN-266"><span class="linenos">266</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN-267"><a href="#ReversibleEGNN-267"><span class="linenos">267</span></a>                <span class="n">y_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ReversibleEGNN-268"><a href="#ReversibleEGNN-268"><span class="linenos">268</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]():</span>
</span><span id="ReversibleEGNN-269"><a href="#ReversibleEGNN-269"><span class="linenos">269</span></a>                <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="ReversibleEGNN-270"><a href="#ReversibleEGNN-270"><span class="linenos">270</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-271"><a href="#ReversibleEGNN-271"><span class="linenos">271</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-272"><a href="#ReversibleEGNN-272"><span class="linenos">272</span></a>                <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-273"><a href="#ReversibleEGNN-273"><span class="linenos">273</span></a>            <span class="n">x_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_i</span>
</span><span id="ReversibleEGNN-274"><a href="#ReversibleEGNN-274"><span class="linenos">274</span></a>            <span class="n">x_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
</span><span id="ReversibleEGNN-275"><a href="#ReversibleEGNN-275"><span class="linenos">275</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="ReversibleEGNN-276"><a href="#ReversibleEGNN-276"><span class="linenos">276</span></a>
</span><span id="ReversibleEGNN-277"><a href="#ReversibleEGNN-277"><span class="linenos">277</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ReversibleEGNN-278"><a href="#ReversibleEGNN-278"><span class="linenos">278</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="ReversibleEGNN-279"><a href="#ReversibleEGNN-279"><span class="linenos">279</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos_c</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">pos_s</span>
</span><span id="ReversibleEGNN-280"><a href="#ReversibleEGNN-280"><span class="linenos">280</span></a>
</span><span id="ReversibleEGNN-281"><a href="#ReversibleEGNN-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span>
</span><span id="ReversibleEGNN-282"><a href="#ReversibleEGNN-282"><span class="linenos">282</span></a>
</span><span id="ReversibleEGNN-283"><a href="#ReversibleEGNN-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ReversibleEGNN-284"><a href="#ReversibleEGNN-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN-285"><a href="#ReversibleEGNN-285"><span class="linenos">285</span></a>
</span><span id="ReversibleEGNN-286"><a href="#ReversibleEGNN-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
</span><span id="ReversibleEGNN-287"><a href="#ReversibleEGNN-287"><span class="linenos">287</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="ReversibleEGNN-288"><a href="#ReversibleEGNN-288"><span class="linenos">288</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span><span id="ReversibleEGNN-289"><a href="#ReversibleEGNN-289"><span class="linenos">289</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reversible E(n) Equivariant Graph Neural Network.</p>

<p>Implementation of an E(n) Equivariant Graph Neural Network with reversible
layers to omit storing any intermediate values during the forward pass when
computing the differentials. Inputs of each layer are computed in reverse
from the outputs to compute the differentials of a given layer.</p>

<p>Please refer to <code><a href="../egnn.html#EGNN">bpp.model.egnn.EGNN</a></code> for further details on how to
use this module.</p>
</div>


                            <div id="ReversibleEGNN.__init__" class="classattr">
                                        <input id="ReversibleEGNN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ReversibleEGNN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	norm_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;,</span><span class="param">	<span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="ReversibleEGNN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReversibleEGNN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReversibleEGNN.__init__-51"><a href="#ReversibleEGNN.__init__-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReversibleEGNN.__init__-52"><a href="#ReversibleEGNN.__init__-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-53"><a href="#ReversibleEGNN.__init__-53"><span class="linenos"> 53</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ReversibleEGNN.__init__-54"><a href="#ReversibleEGNN.__init__-54"><span class="linenos"> 54</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ReversibleEGNN.__init__-55"><a href="#ReversibleEGNN.__init__-55"><span class="linenos"> 55</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="ReversibleEGNN.__init__-56"><a href="#ReversibleEGNN.__init__-56"><span class="linenos"> 56</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="ReversibleEGNN.__init__-57"><a href="#ReversibleEGNN.__init__-57"><span class="linenos"> 57</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-58"><a href="#ReversibleEGNN.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-59"><a href="#ReversibleEGNN.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-60"><a href="#ReversibleEGNN.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-61"><a href="#ReversibleEGNN.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-62"><a href="#ReversibleEGNN.__init__-62"><span class="linenos"> 62</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-63"><a href="#ReversibleEGNN.__init__-63"><span class="linenos"> 63</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-64"><a href="#ReversibleEGNN.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-65"><a href="#ReversibleEGNN.__init__-65"><span class="linenos"> 65</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-66"><a href="#ReversibleEGNN.__init__-66"><span class="linenos"> 66</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-67"><a href="#ReversibleEGNN.__init__-67"><span class="linenos"> 67</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-68"><a href="#ReversibleEGNN.__init__-68"><span class="linenos"> 68</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-69"><a href="#ReversibleEGNN.__init__-69"><span class="linenos"> 69</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-70"><a href="#ReversibleEGNN.__init__-70"><span class="linenos"> 70</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-71"><a href="#ReversibleEGNN.__init__-71"><span class="linenos"> 71</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-72"><a href="#ReversibleEGNN.__init__-72"><span class="linenos"> 72</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReversibleEGNN.__init__-73"><a href="#ReversibleEGNN.__init__-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN.__init__-74"><a href="#ReversibleEGNN.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        Arguments:</span>
</span><span id="ReversibleEGNN.__init__-75"><a href="#ReversibleEGNN.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="ReversibleEGNN.__init__-76"><a href="#ReversibleEGNN.__init__-76"><span class="linenos"> 76</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="ReversibleEGNN.__init__-77"><a href="#ReversibleEGNN.__init__-77"><span class="linenos"> 77</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="ReversibleEGNN.__init__-78"><a href="#ReversibleEGNN.__init__-78"><span class="linenos"> 78</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="ReversibleEGNN.__init__-79"><a href="#ReversibleEGNN.__init__-79"><span class="linenos"> 79</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="ReversibleEGNN.__init__-80"><a href="#ReversibleEGNN.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="ReversibleEGNN.__init__-81"><a href="#ReversibleEGNN.__init__-81"><span class="linenos"> 81</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="ReversibleEGNN.__init__-82"><a href="#ReversibleEGNN.__init__-82"><span class="linenos"> 82</span></a><span class="sd">                no edge features), `dims_edge[-2]` is the number of message</span>
</span><span id="ReversibleEGNN.__init__-83"><a href="#ReversibleEGNN.__init__-83"><span class="linenos"> 83</span></a><span class="sd">                features and `dims_edge[-1]` is the number of hidden-layer</span>
</span><span id="ReversibleEGNN.__init__-84"><a href="#ReversibleEGNN.__init__-84"><span class="linenos"> 84</span></a><span class="sd">                features for the coordinate update and message gating networks</span>
</span><span id="ReversibleEGNN.__init__-85"><a href="#ReversibleEGNN.__init__-85"><span class="linenos"> 85</span></a><span class="sd">                (ignored if neither `update` nor `gate` are enabled). All</span>
</span><span id="ReversibleEGNN.__init__-86"><a href="#ReversibleEGNN.__init__-86"><span class="linenos"> 86</span></a><span class="sd">                remaining dimensions are used for the hidden-layers of the edge</span>
</span><span id="ReversibleEGNN.__init__-87"><a href="#ReversibleEGNN.__init__-87"><span class="linenos"> 87</span></a><span class="sd">                network that computes the messages.</span>
</span><span id="ReversibleEGNN.__init__-88"><a href="#ReversibleEGNN.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="ReversibleEGNN.__init__-89"><a href="#ReversibleEGNN.__init__-89"><span class="linenos"> 89</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="ReversibleEGNN.__init__-90"><a href="#ReversibleEGNN.__init__-90"><span class="linenos"> 90</span></a><span class="sd">                least 2 are necessary.</span>
</span><span id="ReversibleEGNN.__init__-91"><a href="#ReversibleEGNN.__init__-91"><span class="linenos"> 91</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="ReversibleEGNN.__init__-92"><a href="#ReversibleEGNN.__init__-92"><span class="linenos"> 92</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="ReversibleEGNN.__init__-93"><a href="#ReversibleEGNN.__init__-93"><span class="linenos"> 93</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="ReversibleEGNN.__init__-94"><a href="#ReversibleEGNN.__init__-94"><span class="linenos"> 94</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="ReversibleEGNN.__init__-95"><a href="#ReversibleEGNN.__init__-95"><span class="linenos"> 95</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="ReversibleEGNN.__init__-96"><a href="#ReversibleEGNN.__init__-96"><span class="linenos"> 96</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="ReversibleEGNN.__init__-97"><a href="#ReversibleEGNN.__init__-97"><span class="linenos"> 97</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="ReversibleEGNN.__init__-98"><a href="#ReversibleEGNN.__init__-98"><span class="linenos"> 98</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="ReversibleEGNN.__init__-99"><a href="#ReversibleEGNN.__init__-99"><span class="linenos"> 99</span></a><span class="sd">            update: Whether to update node coordinates.</span>
</span><span id="ReversibleEGNN.__init__-100"><a href="#ReversibleEGNN.__init__-100"><span class="linenos">100</span></a><span class="sd">            gate: Whether to gate messages before aggregation.</span>
</span><span id="ReversibleEGNN.__init__-101"><a href="#ReversibleEGNN.__init__-101"><span class="linenos">101</span></a><span class="sd">            norm: Whether to use layer and message normalization while computing</span>
</span><span id="ReversibleEGNN.__init__-102"><a href="#ReversibleEGNN.__init__-102"><span class="linenos">102</span></a><span class="sd">                and aggregating messages.</span>
</span><span id="ReversibleEGNN.__init__-103"><a href="#ReversibleEGNN.__init__-103"><span class="linenos">103</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="ReversibleEGNN.__init__-104"><a href="#ReversibleEGNN.__init__-104"><span class="linenos">104</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="ReversibleEGNN.__init__-105"><a href="#ReversibleEGNN.__init__-105"><span class="linenos">105</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="ReversibleEGNN.__init__-106"><a href="#ReversibleEGNN.__init__-106"><span class="linenos">106</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="ReversibleEGNN.__init__-107"><a href="#ReversibleEGNN.__init__-107"><span class="linenos">107</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="ReversibleEGNN.__init__-108"><a href="#ReversibleEGNN.__init__-108"><span class="linenos">108</span></a><span class="sd">                0.</span>
</span><span id="ReversibleEGNN.__init__-109"><a href="#ReversibleEGNN.__init__-109"><span class="linenos">109</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="ReversibleEGNN.__init__-110"><a href="#ReversibleEGNN.__init__-110"><span class="linenos">110</span></a><span class="sd">                layers.</span>
</span><span id="ReversibleEGNN.__init__-111"><a href="#ReversibleEGNN.__init__-111"><span class="linenos">111</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="ReversibleEGNN.__init__-112"><a href="#ReversibleEGNN.__init__-112"><span class="linenos">112</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="ReversibleEGNN.__init__-113"><a href="#ReversibleEGNN.__init__-113"><span class="linenos">113</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="ReversibleEGNN.__init__-114"><a href="#ReversibleEGNN.__init__-114"><span class="linenos">114</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="ReversibleEGNN.__init__-115"><a href="#ReversibleEGNN.__init__-115"><span class="linenos">115</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="ReversibleEGNN.__init__-116"><a href="#ReversibleEGNN.__init__-116"><span class="linenos">116</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="ReversibleEGNN.__init__-117"><a href="#ReversibleEGNN.__init__-117"><span class="linenos">117</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="ReversibleEGNN.__init__-118"><a href="#ReversibleEGNN.__init__-118"><span class="linenos">118</span></a><span class="sd">                debugging.</span>
</span><span id="ReversibleEGNN.__init__-119"><a href="#ReversibleEGNN.__init__-119"><span class="linenos">119</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="ReversibleEGNN.__init__-120"><a href="#ReversibleEGNN.__init__-120"><span class="linenos">120</span></a><span class="sd">                numerical issues.</span>
</span><span id="ReversibleEGNN.__init__-121"><a href="#ReversibleEGNN.__init__-121"><span class="linenos">121</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="ReversibleEGNN.__init__-122"><a href="#ReversibleEGNN.__init__-122"><span class="linenos">122</span></a><span class="sd">                numerical issues.</span>
</span><span id="ReversibleEGNN.__init__-123"><a href="#ReversibleEGNN.__init__-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN.__init__-124"><a href="#ReversibleEGNN.__init__-124"><span class="linenos">124</span></a>
</span><span id="ReversibleEGNN.__init__-125"><a href="#ReversibleEGNN.__init__-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReversibleEGNN.__init__-126"><a href="#ReversibleEGNN.__init__-126"><span class="linenos">126</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">parameter_init</span>
</span><span id="ReversibleEGNN.__init__-127"><a href="#ReversibleEGNN.__init__-127"><span class="linenos">127</span></a>
</span><span id="ReversibleEGNN.__init__-128"><a href="#ReversibleEGNN.__init__-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="ReversibleEGNN.__init__-129"><a href="#ReversibleEGNN.__init__-129"><span class="linenos">129</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
</span><span id="ReversibleEGNN.__init__-130"><a href="#ReversibleEGNN.__init__-130"><span class="linenos">130</span></a>
</span><span id="ReversibleEGNN.__init__-131"><a href="#ReversibleEGNN.__init__-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="ReversibleEGNN.__init__-132"><a href="#ReversibleEGNN.__init__-132"><span class="linenos">132</span></a>            <span class="n">dropout</span> <span class="o">=</span> <span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">dropout</span><span class="p">)</span>
</span><span id="ReversibleEGNN.__init__-133"><a href="#ReversibleEGNN.__init__-133"><span class="linenos">133</span></a>
</span><span id="ReversibleEGNN.__init__-134"><a href="#ReversibleEGNN.__init__-134"><span class="linenos">134</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReversibleEGNN.__init__-135"><a href="#ReversibleEGNN.__init__-135"><span class="linenos">135</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-136"><a href="#ReversibleEGNN.__init__-136"><span class="linenos">136</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-137"><a href="#ReversibleEGNN.__init__-137"><span class="linenos">137</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-138"><a href="#ReversibleEGNN.__init__-138"><span class="linenos">138</span></a>            <span class="n">preserve_rng_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-139"><a href="#ReversibleEGNN.__init__-139"><span class="linenos">139</span></a>            <span class="n">forward_has_only_one_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-140"><a href="#ReversibleEGNN.__init__-140"><span class="linenos">140</span></a>        <span class="p">)</span>
</span><span id="ReversibleEGNN.__init__-141"><a href="#ReversibleEGNN.__init__-141"><span class="linenos">141</span></a>
</span><span id="ReversibleEGNN.__init__-142"><a href="#ReversibleEGNN.__init__-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="ReversibleEGNN.__init__-143"><a href="#ReversibleEGNN.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">blocks</span>
</span><span id="ReversibleEGNN.__init__-144"><a href="#ReversibleEGNN.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-145"><a href="#ReversibleEGNN.__init__-145"><span class="linenos">145</span></a>
</span><span id="ReversibleEGNN.__init__-146"><a href="#ReversibleEGNN.__init__-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="ReversibleEGNN.__init__-147"><a href="#ReversibleEGNN.__init__-147"><span class="linenos">147</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-148"><a href="#ReversibleEGNN.__init__-148"><span class="linenos">148</span></a>
</span><span id="ReversibleEGNN.__init__-149"><a href="#ReversibleEGNN.__init__-149"><span class="linenos">149</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span> <span class="o">=</span> <span class="n">EGNN</span><span class="p">(</span>
</span><span id="ReversibleEGNN.__init__-150"><a href="#ReversibleEGNN.__init__-150"><span class="linenos">150</span></a>                <span class="n">dims_node</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-151"><a href="#ReversibleEGNN.__init__-151"><span class="linenos">151</span></a>                <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-152"><a href="#ReversibleEGNN.__init__-152"><span class="linenos">152</span></a>                <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-153"><a href="#ReversibleEGNN.__init__-153"><span class="linenos">153</span></a>                <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-154"><a href="#ReversibleEGNN.__init__-154"><span class="linenos">154</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-155"><a href="#ReversibleEGNN.__init__-155"><span class="linenos">155</span></a>                <span class="n">num_encode</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-156"><a href="#ReversibleEGNN.__init__-156"><span class="linenos">156</span></a>                <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-157"><a href="#ReversibleEGNN.__init__-157"><span class="linenos">157</span></a>                <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ReversibleEGNN.__init__-158"><a href="#ReversibleEGNN.__init__-158"><span class="linenos">158</span></a>                <span class="n">clamp</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-159"><a href="#ReversibleEGNN.__init__-159"><span class="linenos">159</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ReversibleEGNN.__init__-160"><a href="#ReversibleEGNN.__init__-160"><span class="linenos">160</span></a>                <span class="n">activation</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-161"><a href="#ReversibleEGNN.__init__-161"><span class="linenos">161</span></a>                <span class="n">init</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-162"><a href="#ReversibleEGNN.__init__-162"><span class="linenos">162</span></a>                <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-163"><a href="#ReversibleEGNN.__init__-163"><span class="linenos">163</span></a>                <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="ReversibleEGNN.__init__-164"><a href="#ReversibleEGNN.__init__-164"><span class="linenos">164</span></a>            <span class="p">)</span>
</span><span id="ReversibleEGNN.__init__-165"><a href="#ReversibleEGNN.__init__-165"><span class="linenos">165</span></a>
</span><span id="ReversibleEGNN.__init__-166"><a href="#ReversibleEGNN.__init__-166"><span class="linenos">166</span></a>            <span class="k">if</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="ReversibleEGNN.__init__-167"><a href="#ReversibleEGNN.__init__-167"><span class="linenos">167</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-168"><a href="#ReversibleEGNN.__init__-168"><span class="linenos">168</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm_cls</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ReversibleEGNN.__init__-169"><a href="#ReversibleEGNN.__init__-169"><span class="linenos">169</span></a>                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims_pos</span><span class="p">):</span>
</span><span id="ReversibleEGNN.__init__-170"><a href="#ReversibleEGNN.__init__-170"><span class="linenos">170</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">dim_pos</span><span class="p">)</span>
</span><span id="ReversibleEGNN.__init__-171"><a href="#ReversibleEGNN.__init__-171"><span class="linenos">171</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN.__init__-172"><a href="#ReversibleEGNN.__init__-172"><span class="linenos">172</span></a>                    <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-173"><a href="#ReversibleEGNN.__init__-173"><span class="linenos">173</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN.__init__-174"><a href="#ReversibleEGNN.__init__-174"><span class="linenos">174</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-175"><a href="#ReversibleEGNN.__init__-175"><span class="linenos">175</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-176"><a href="#ReversibleEGNN.__init__-176"><span class="linenos">176</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-177"><a href="#ReversibleEGNN.__init__-177"><span class="linenos">177</span></a>
</span><span id="ReversibleEGNN.__init__-178"><a href="#ReversibleEGNN.__init__-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="ReversibleEGNN.__init__-179"><a href="#ReversibleEGNN.__init__-179"><span class="linenos">179</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ReversibleEGNN.__init__-180"><a href="#ReversibleEGNN.__init__-180"><span class="linenos">180</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReversibleEGNN.__init__-181"><a href="#ReversibleEGNN.__init__-181"><span class="linenos">181</span></a>                <span class="n">block</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</span><span id="ReversibleEGNN.__init__-182"><a href="#ReversibleEGNN.__init__-182"><span class="linenos">182</span></a>            
</span><span id="ReversibleEGNN.__init__-183"><a href="#ReversibleEGNN.__init__-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims_node:</strong>  Dimensions for the node network of a block:
<code>dims_node[0]</code> is the number of input features and
<code>dims_node[-1]</code> is the number of output features. At least 2
dimensions are required. All remaining dimensions are used for
the hidden-layers of the network.</li>
<li><strong>dims_edge:</strong>  Dimensions for the edge network of a block:
<code>dims_edge[0]</code> is the number of edge features (0 if graphs have
no edge features), <code>dims_edge[-2]</code> is the number of message
features and <code>dims_edge[-1]</code> is the number of hidden-layer
features for the coordinate update and message gating networks
(ignored if neither <code>update</code> nor <code>gate</code> are enabled). All
remaining dimensions are used for the hidden-layers of the edge
network that computes the messages.</li>
<li><strong>blocks:</strong>  Number of blocks in the auto-regressive reversible layer;
i.e., individual instances of <code><a href="../egnn.html#EGNN">bpp.model.egnn.EGNN</a></code>. At
least 2 are necessary.</li>
<li><strong>num_pos:</strong>  Number of node positions. Each node can be assigned to one
position, but can also be assigned to multiple positions.</li>
<li><strong>num_encode:</strong>  Number of fourier-encoded features that are computed
from the distances between node coordinates. If <code>num_encode</code> is
even, only the fourier-encoded features will be used. If odd,
the original distances will also be used alongside the
fourier-encoded features.  Default is 1, which means that only
the original distances are used, without any fourier features.</li>
<li><strong>update:</strong>  Whether to update node coordinates.</li>
<li><strong>gate:</strong>  Whether to gate messages before aggregation.</li>
<li><strong>norm:</strong>  Whether to use layer and message normalization while computing
and aggregating messages.</li>
<li><strong>clamp:</strong>  Threshold for clamping coordinate updates (between <code>-clamp</code>
and <code>clamp</code>). Unclamped if 0.</li>
<li><strong>dropout:</strong>  Dropout probabilities for inputs and within network layers
of a block. If only one probability is given, then this will be
used for the inputs and in-between layers. Dropout is omitted if
0.</li>
<li><strong>activation:</strong>  Activation function that is used in-between network
layers.</li>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
The default non-linearity should adhere to whatever is used for
<code>activation</code>. See <code><a href="../egnn.html#parameter_init">bpp.model.egnn.parameter_init()</a></code>.</li>
<li><strong>disable:</strong>  Whether to disable reversible computations and use
conventional back-propagation method. Used primarily for
debugging.</li>
<li><strong>free_inputs:</strong>  Whether to free inputs. Disabled by default due to
numerical issues.</li>
<li><strong>free_outputs:</strong>  Whether to free outputs. Disabled by default due to
numerical issues.</li>
</ul>
</div>


                            </div>
                            <div id="ReversibleEGNN.init" class="classattr">
                                <div class="attr variable">
            <span class="name">init</span>

        
    </div>
    <a class="headerlink" href="#ReversibleEGNN.init"></a>
    
    

                            </div>
                            <div id="ReversibleEGNN.deterministic_contexts" class="classattr">
                                <div class="attr variable">
            <span class="name">deterministic_contexts</span>

        
    </div>
    <a class="headerlink" href="#ReversibleEGNN.deterministic_contexts"></a>
    
    

                            </div>
                            <div id="ReversibleEGNN.blocks" class="classattr">
                                <div class="attr variable">
            <span class="name">blocks</span>

        
    </div>
    <a class="headerlink" href="#ReversibleEGNN.blocks"></a>
    
    

                            </div>
                            <div id="ReversibleEGNN.reset_parameters" class="classattr">
                                        <input id="ReversibleEGNN.reset_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ReversibleEGNN.reset_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReversibleEGNN.reset_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReversibleEGNN.reset_parameters-283"><a href="#ReversibleEGNN.reset_parameters-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ReversibleEGNN.reset_parameters-284"><a href="#ReversibleEGNN.reset_parameters-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="ReversibleEGNN.reset_parameters-285"><a href="#ReversibleEGNN.reset_parameters-285"><span class="linenos">285</span></a>
</span><span id="ReversibleEGNN.reset_parameters-286"><a href="#ReversibleEGNN.reset_parameters-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
</span><span id="ReversibleEGNN.reset_parameters-287"><a href="#ReversibleEGNN.reset_parameters-287"><span class="linenos">287</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="ReversibleEGNN.reset_parameters-288"><a href="#ReversibleEGNN.reset_parameters-288"><span class="linenos">288</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span><span id="ReversibleEGNN.reset_parameters-289"><a href="#ReversibleEGNN.reset_parameters-289"><span class="linenos">289</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset parameters.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../_reversible.html#ReversibleModule">bpp.model._reversible.ReversibleModule</a></dt>
                                <dd id="ReversibleEGNN.disable" class="variable"><a href="../_reversible.html#ReversibleModule.disable">disable</a></dd>
                <dd id="ReversibleEGNN.free_inputs" class="variable"><a href="../_reversible.html#ReversibleModule.free_inputs">free_inputs</a></dd>
                <dd id="ReversibleEGNN.free_outputs" class="variable"><a href="../_reversible.html#ReversibleModule.free_outputs">free_outputs</a></dd>
                <dd id="ReversibleEGNN.preserve_rng_state" class="variable"><a href="../_reversible.html#ReversibleModule.preserve_rng_state">preserve_rng_state</a></dd>
                <dd id="ReversibleEGNN.forward_has_only_one_output" class="variable"><a href="../_reversible.html#ReversibleModule.forward_has_only_one_output">forward_has_only_one_output</a></dd>
                <dd id="ReversibleEGNN.forward" class="function"><a href="../_reversible.html#ReversibleModule.forward">forward</a></dd>
                <dd id="ReversibleEGNN.reverse" class="function"><a href="../_reversible.html#ReversibleModule.reverse">reverse</a></dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="ReversibleEGNN.dump_patches" class="variable">dump_patches</dd>
                <dd id="ReversibleEGNN.training" class="variable">training</dd>
                <dd id="ReversibleEGNN.call_super_init" class="variable">call_super_init</dd>
                <dd id="ReversibleEGNN.register_buffer" class="function">register_buffer</dd>
                <dd id="ReversibleEGNN.register_parameter" class="function">register_parameter</dd>
                <dd id="ReversibleEGNN.add_module" class="function">add_module</dd>
                <dd id="ReversibleEGNN.register_module" class="function">register_module</dd>
                <dd id="ReversibleEGNN.get_submodule" class="function">get_submodule</dd>
                <dd id="ReversibleEGNN.get_parameter" class="function">get_parameter</dd>
                <dd id="ReversibleEGNN.get_buffer" class="function">get_buffer</dd>
                <dd id="ReversibleEGNN.get_extra_state" class="function">get_extra_state</dd>
                <dd id="ReversibleEGNN.set_extra_state" class="function">set_extra_state</dd>
                <dd id="ReversibleEGNN.apply" class="function">apply</dd>
                <dd id="ReversibleEGNN.cuda" class="function">cuda</dd>
                <dd id="ReversibleEGNN.ipu" class="function">ipu</dd>
                <dd id="ReversibleEGNN.xpu" class="function">xpu</dd>
                <dd id="ReversibleEGNN.cpu" class="function">cpu</dd>
                <dd id="ReversibleEGNN.type" class="function">type</dd>
                <dd id="ReversibleEGNN.float" class="function">float</dd>
                <dd id="ReversibleEGNN.double" class="function">double</dd>
                <dd id="ReversibleEGNN.half" class="function">half</dd>
                <dd id="ReversibleEGNN.bfloat16" class="function">bfloat16</dd>
                <dd id="ReversibleEGNN.to_empty" class="function">to_empty</dd>
                <dd id="ReversibleEGNN.to" class="function">to</dd>
                <dd id="ReversibleEGNN.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="ReversibleEGNN.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="ReversibleEGNN.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="ReversibleEGNN.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="ReversibleEGNN.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="ReversibleEGNN.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="ReversibleEGNN.state_dict" class="function">state_dict</dd>
                <dd id="ReversibleEGNN.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="ReversibleEGNN.load_state_dict" class="function">load_state_dict</dd>
                <dd id="ReversibleEGNN.parameters" class="function">parameters</dd>
                <dd id="ReversibleEGNN.named_parameters" class="function">named_parameters</dd>
                <dd id="ReversibleEGNN.buffers" class="function">buffers</dd>
                <dd id="ReversibleEGNN.named_buffers" class="function">named_buffers</dd>
                <dd id="ReversibleEGNN.children" class="function">children</dd>
                <dd id="ReversibleEGNN.named_children" class="function">named_children</dd>
                <dd id="ReversibleEGNN.modules" class="function">modules</dd>
                <dd id="ReversibleEGNN.named_modules" class="function">named_modules</dd>
                <dd id="ReversibleEGNN.train" class="function">train</dd>
                <dd id="ReversibleEGNN.eval" class="function">eval</dd>
                <dd id="ReversibleEGNN.requires_grad_" class="function">requires_grad_</dd>
                <dd id="ReversibleEGNN.zero_grad" class="function">zero_grad</dd>
                <dd id="ReversibleEGNN.share_memory" class="function">share_memory</dd>
                <dd id="ReversibleEGNN.extra_repr" class="function">extra_repr</dd>
                <dd id="ReversibleEGNN.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SimplifiedReversibleEGNN">
                            <input id="SimplifiedReversibleEGNN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SimplifiedReversibleEGNN</span><wbr>(<span class="base"><a href="#ReversibleEGNN">ReversibleEGNN</a></span>):

                <label class="view-source-button" for="SimplifiedReversibleEGNN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimplifiedReversibleEGNN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimplifiedReversibleEGNN-292"><a href="#SimplifiedReversibleEGNN-292"><span class="linenos">292</span></a><span class="k">class</span> <span class="nc">SimplifiedReversibleEGNN</span><span class="p">(</span><span class="n">ReversibleEGNN</span><span class="p">):</span>
</span><span id="SimplifiedReversibleEGNN-293"><a href="#SimplifiedReversibleEGNN-293"><span class="linenos">293</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Simplified variant of the Reversible E(n) Equivariant Graph Neural</span>
</span><span id="SimplifiedReversibleEGNN-294"><a href="#SimplifiedReversibleEGNN-294"><span class="linenos">294</span></a><span class="sd">    Network.</span>
</span><span id="SimplifiedReversibleEGNN-295"><a href="#SimplifiedReversibleEGNN-295"><span class="linenos">295</span></a>
</span><span id="SimplifiedReversibleEGNN-296"><a href="#SimplifiedReversibleEGNN-296"><span class="linenos">296</span></a><span class="sd">    This variant uses an auto-regressive update scheme that is more in line</span>
</span><span id="SimplifiedReversibleEGNN-297"><a href="#SimplifiedReversibleEGNN-297"><span class="linenos">297</span></a><span class="sd">    with [2]_.</span>
</span><span id="SimplifiedReversibleEGNN-298"><a href="#SimplifiedReversibleEGNN-298"><span class="linenos">298</span></a>
</span><span id="SimplifiedReversibleEGNN-299"><a href="#SimplifiedReversibleEGNN-299"><span class="linenos">299</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.EGNN` for further details on how to</span>
</span><span id="SimplifiedReversibleEGNN-300"><a href="#SimplifiedReversibleEGNN-300"><span class="linenos">300</span></a><span class="sd">    use this module.</span>
</span><span id="SimplifiedReversibleEGNN-301"><a href="#SimplifiedReversibleEGNN-301"><span class="linenos">301</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN-302"><a href="#SimplifiedReversibleEGNN-302"><span class="linenos">302</span></a>
</span><span id="SimplifiedReversibleEGNN-303"><a href="#SimplifiedReversibleEGNN-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN-304"><a href="#SimplifiedReversibleEGNN-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-305"><a href="#SimplifiedReversibleEGNN-305"><span class="linenos">305</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="SimplifiedReversibleEGNN-306"><a href="#SimplifiedReversibleEGNN-306"><span class="linenos">306</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="SimplifiedReversibleEGNN-307"><a href="#SimplifiedReversibleEGNN-307"><span class="linenos">307</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SimplifiedReversibleEGNN-308"><a href="#SimplifiedReversibleEGNN-308"><span class="linenos">308</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SimplifiedReversibleEGNN-309"><a href="#SimplifiedReversibleEGNN-309"><span class="linenos">309</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-310"><a href="#SimplifiedReversibleEGNN-310"><span class="linenos">310</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-311"><a href="#SimplifiedReversibleEGNN-311"><span class="linenos">311</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-312"><a href="#SimplifiedReversibleEGNN-312"><span class="linenos">312</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-313"><a href="#SimplifiedReversibleEGNN-313"><span class="linenos">313</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-314"><a href="#SimplifiedReversibleEGNN-314"><span class="linenos">314</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-315"><a href="#SimplifiedReversibleEGNN-315"><span class="linenos">315</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-316"><a href="#SimplifiedReversibleEGNN-316"><span class="linenos">316</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-317"><a href="#SimplifiedReversibleEGNN-317"><span class="linenos">317</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-318"><a href="#SimplifiedReversibleEGNN-318"><span class="linenos">318</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-319"><a href="#SimplifiedReversibleEGNN-319"><span class="linenos">319</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-320"><a href="#SimplifiedReversibleEGNN-320"><span class="linenos">320</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-321"><a href="#SimplifiedReversibleEGNN-321"><span class="linenos">321</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-322"><a href="#SimplifiedReversibleEGNN-322"><span class="linenos">322</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-323"><a href="#SimplifiedReversibleEGNN-323"><span class="linenos">323</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-324"><a href="#SimplifiedReversibleEGNN-324"><span class="linenos">324</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SimplifiedReversibleEGNN-325"><a href="#SimplifiedReversibleEGNN-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN-326"><a href="#SimplifiedReversibleEGNN-326"><span class="linenos">326</span></a><span class="sd">        Arguments:</span>
</span><span id="SimplifiedReversibleEGNN-327"><a href="#SimplifiedReversibleEGNN-327"><span class="linenos">327</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="SimplifiedReversibleEGNN-328"><a href="#SimplifiedReversibleEGNN-328"><span class="linenos">328</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="SimplifiedReversibleEGNN-329"><a href="#SimplifiedReversibleEGNN-329"><span class="linenos">329</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="SimplifiedReversibleEGNN-330"><a href="#SimplifiedReversibleEGNN-330"><span class="linenos">330</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="SimplifiedReversibleEGNN-331"><a href="#SimplifiedReversibleEGNN-331"><span class="linenos">331</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="SimplifiedReversibleEGNN-332"><a href="#SimplifiedReversibleEGNN-332"><span class="linenos">332</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="SimplifiedReversibleEGNN-333"><a href="#SimplifiedReversibleEGNN-333"><span class="linenos">333</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="SimplifiedReversibleEGNN-334"><a href="#SimplifiedReversibleEGNN-334"><span class="linenos">334</span></a><span class="sd">                no edge features), `dims_edge[-1]` is the number of message</span>
</span><span id="SimplifiedReversibleEGNN-335"><a href="#SimplifiedReversibleEGNN-335"><span class="linenos">335</span></a><span class="sd">                features.  All remaining dimensions are used for the</span>
</span><span id="SimplifiedReversibleEGNN-336"><a href="#SimplifiedReversibleEGNN-336"><span class="linenos">336</span></a><span class="sd">                hidden-layers of the edge network that computes the messages.</span>
</span><span id="SimplifiedReversibleEGNN-337"><a href="#SimplifiedReversibleEGNN-337"><span class="linenos">337</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="SimplifiedReversibleEGNN-338"><a href="#SimplifiedReversibleEGNN-338"><span class="linenos">338</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="SimplifiedReversibleEGNN-339"><a href="#SimplifiedReversibleEGNN-339"><span class="linenos">339</span></a><span class="sd">                least one block is required.</span>
</span><span id="SimplifiedReversibleEGNN-340"><a href="#SimplifiedReversibleEGNN-340"><span class="linenos">340</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="SimplifiedReversibleEGNN-341"><a href="#SimplifiedReversibleEGNN-341"><span class="linenos">341</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="SimplifiedReversibleEGNN-342"><a href="#SimplifiedReversibleEGNN-342"><span class="linenos">342</span></a><span class="sd">                will be disabled.</span>
</span><span id="SimplifiedReversibleEGNN-343"><a href="#SimplifiedReversibleEGNN-343"><span class="linenos">343</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="SimplifiedReversibleEGNN-344"><a href="#SimplifiedReversibleEGNN-344"><span class="linenos">344</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="SimplifiedReversibleEGNN-345"><a href="#SimplifiedReversibleEGNN-345"><span class="linenos">345</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="SimplifiedReversibleEGNN-346"><a href="#SimplifiedReversibleEGNN-346"><span class="linenos">346</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="SimplifiedReversibleEGNN-347"><a href="#SimplifiedReversibleEGNN-347"><span class="linenos">347</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="SimplifiedReversibleEGNN-348"><a href="#SimplifiedReversibleEGNN-348"><span class="linenos">348</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="SimplifiedReversibleEGNN-349"><a href="#SimplifiedReversibleEGNN-349"><span class="linenos">349</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="SimplifiedReversibleEGNN-350"><a href="#SimplifiedReversibleEGNN-350"><span class="linenos">350</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="SimplifiedReversibleEGNN-351"><a href="#SimplifiedReversibleEGNN-351"><span class="linenos">351</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="SimplifiedReversibleEGNN-352"><a href="#SimplifiedReversibleEGNN-352"><span class="linenos">352</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="SimplifiedReversibleEGNN-353"><a href="#SimplifiedReversibleEGNN-353"><span class="linenos">353</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="SimplifiedReversibleEGNN-354"><a href="#SimplifiedReversibleEGNN-354"><span class="linenos">354</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="SimplifiedReversibleEGNN-355"><a href="#SimplifiedReversibleEGNN-355"><span class="linenos">355</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="SimplifiedReversibleEGNN-356"><a href="#SimplifiedReversibleEGNN-356"><span class="linenos">356</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="SimplifiedReversibleEGNN-357"><a href="#SimplifiedReversibleEGNN-357"><span class="linenos">357</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="SimplifiedReversibleEGNN-358"><a href="#SimplifiedReversibleEGNN-358"><span class="linenos">358</span></a><span class="sd">                normalization after a block. If only one value is given, then</span>
</span><span id="SimplifiedReversibleEGNN-359"><a href="#SimplifiedReversibleEGNN-359"><span class="linenos">359</span></a><span class="sd">                normalization within and after a block will be applied</span>
</span><span id="SimplifiedReversibleEGNN-360"><a href="#SimplifiedReversibleEGNN-360"><span class="linenos">360</span></a><span class="sd">                accordingly. If two values are given, then the first determines</span>
</span><span id="SimplifiedReversibleEGNN-361"><a href="#SimplifiedReversibleEGNN-361"><span class="linenos">361</span></a><span class="sd">                whether to apply normalization after a block and the second</span>
</span><span id="SimplifiedReversibleEGNN-362"><a href="#SimplifiedReversibleEGNN-362"><span class="linenos">362</span></a><span class="sd">                whether to apply normalization within a block.</span>
</span><span id="SimplifiedReversibleEGNN-363"><a href="#SimplifiedReversibleEGNN-363"><span class="linenos">363</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="SimplifiedReversibleEGNN-364"><a href="#SimplifiedReversibleEGNN-364"><span class="linenos">364</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="SimplifiedReversibleEGNN-365"><a href="#SimplifiedReversibleEGNN-365"><span class="linenos">365</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="SimplifiedReversibleEGNN-366"><a href="#SimplifiedReversibleEGNN-366"><span class="linenos">366</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="SimplifiedReversibleEGNN-367"><a href="#SimplifiedReversibleEGNN-367"><span class="linenos">367</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="SimplifiedReversibleEGNN-368"><a href="#SimplifiedReversibleEGNN-368"><span class="linenos">368</span></a><span class="sd">                0.</span>
</span><span id="SimplifiedReversibleEGNN-369"><a href="#SimplifiedReversibleEGNN-369"><span class="linenos">369</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="SimplifiedReversibleEGNN-370"><a href="#SimplifiedReversibleEGNN-370"><span class="linenos">370</span></a><span class="sd">                layers.</span>
</span><span id="SimplifiedReversibleEGNN-371"><a href="#SimplifiedReversibleEGNN-371"><span class="linenos">371</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="SimplifiedReversibleEGNN-372"><a href="#SimplifiedReversibleEGNN-372"><span class="linenos">372</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="SimplifiedReversibleEGNN-373"><a href="#SimplifiedReversibleEGNN-373"><span class="linenos">373</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="SimplifiedReversibleEGNN-374"><a href="#SimplifiedReversibleEGNN-374"><span class="linenos">374</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="SimplifiedReversibleEGNN-375"><a href="#SimplifiedReversibleEGNN-375"><span class="linenos">375</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="SimplifiedReversibleEGNN-376"><a href="#SimplifiedReversibleEGNN-376"><span class="linenos">376</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="SimplifiedReversibleEGNN-377"><a href="#SimplifiedReversibleEGNN-377"><span class="linenos">377</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="SimplifiedReversibleEGNN-378"><a href="#SimplifiedReversibleEGNN-378"><span class="linenos">378</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="SimplifiedReversibleEGNN-379"><a href="#SimplifiedReversibleEGNN-379"><span class="linenos">379</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="SimplifiedReversibleEGNN-380"><a href="#SimplifiedReversibleEGNN-380"><span class="linenos">380</span></a><span class="sd">                debugging.</span>
</span><span id="SimplifiedReversibleEGNN-381"><a href="#SimplifiedReversibleEGNN-381"><span class="linenos">381</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="SimplifiedReversibleEGNN-382"><a href="#SimplifiedReversibleEGNN-382"><span class="linenos">382</span></a><span class="sd">                numerical issues.</span>
</span><span id="SimplifiedReversibleEGNN-383"><a href="#SimplifiedReversibleEGNN-383"><span class="linenos">383</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="SimplifiedReversibleEGNN-384"><a href="#SimplifiedReversibleEGNN-384"><span class="linenos">384</span></a><span class="sd">                numerical issues.</span>
</span><span id="SimplifiedReversibleEGNN-385"><a href="#SimplifiedReversibleEGNN-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN-386"><a href="#SimplifiedReversibleEGNN-386"><span class="linenos">386</span></a>
</span><span id="SimplifiedReversibleEGNN-387"><a href="#SimplifiedReversibleEGNN-387"><span class="linenos">387</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN-388"><a href="#SimplifiedReversibleEGNN-388"><span class="linenos">388</span></a>            <span class="n">dims_node</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-389"><a href="#SimplifiedReversibleEGNN-389"><span class="linenos">389</span></a>            <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-390"><a href="#SimplifiedReversibleEGNN-390"><span class="linenos">390</span></a>            <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-391"><a href="#SimplifiedReversibleEGNN-391"><span class="linenos">391</span></a>            <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-392"><a href="#SimplifiedReversibleEGNN-392"><span class="linenos">392</span></a>            <span class="n">blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-393"><a href="#SimplifiedReversibleEGNN-393"><span class="linenos">393</span></a>            <span class="n">num_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-394"><a href="#SimplifiedReversibleEGNN-394"><span class="linenos">394</span></a>            <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-395"><a href="#SimplifiedReversibleEGNN-395"><span class="linenos">395</span></a>            <span class="n">num_encode</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-396"><a href="#SimplifiedReversibleEGNN-396"><span class="linenos">396</span></a>            <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-397"><a href="#SimplifiedReversibleEGNN-397"><span class="linenos">397</span></a>            <span class="n">norm</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-398"><a href="#SimplifiedReversibleEGNN-398"><span class="linenos">398</span></a>            <span class="n">clamp</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-399"><a href="#SimplifiedReversibleEGNN-399"><span class="linenos">399</span></a>            <span class="n">dropout</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-400"><a href="#SimplifiedReversibleEGNN-400"><span class="linenos">400</span></a>            <span class="n">activation</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-401"><a href="#SimplifiedReversibleEGNN-401"><span class="linenos">401</span></a>            <span class="n">init</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-402"><a href="#SimplifiedReversibleEGNN-402"><span class="linenos">402</span></a>            <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-403"><a href="#SimplifiedReversibleEGNN-403"><span class="linenos">403</span></a>            <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-404"><a href="#SimplifiedReversibleEGNN-404"><span class="linenos">404</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-405"><a href="#SimplifiedReversibleEGNN-405"><span class="linenos">405</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-406"><a href="#SimplifiedReversibleEGNN-406"><span class="linenos">406</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-407"><a href="#SimplifiedReversibleEGNN-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-408"><a href="#SimplifiedReversibleEGNN-408"><span class="linenos">408</span></a>
</span><span id="SimplifiedReversibleEGNN-409"><a href="#SimplifiedReversibleEGNN-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN-410"><a href="#SimplifiedReversibleEGNN-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-411"><a href="#SimplifiedReversibleEGNN-411"><span class="linenos">411</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-412"><a href="#SimplifiedReversibleEGNN-412"><span class="linenos">412</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-413"><a href="#SimplifiedReversibleEGNN-413"><span class="linenos">413</span></a>        <span class="n">pos_b</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-414"><a href="#SimplifiedReversibleEGNN-414"><span class="linenos">414</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-415"><a href="#SimplifiedReversibleEGNN-415"><span class="linenos">415</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-416"><a href="#SimplifiedReversibleEGNN-416"><span class="linenos">416</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-417"><a href="#SimplifiedReversibleEGNN-417"><span class="linenos">417</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="SimplifiedReversibleEGNN-418"><a href="#SimplifiedReversibleEGNN-418"><span class="linenos">418</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="SimplifiedReversibleEGNN-419"><a href="#SimplifiedReversibleEGNN-419"><span class="linenos">419</span></a>
</span><span id="SimplifiedReversibleEGNN-420"><a href="#SimplifiedReversibleEGNN-420"><span class="linenos">420</span></a><span class="sd">        Arguments:</span>
</span><span id="SimplifiedReversibleEGNN-421"><a href="#SimplifiedReversibleEGNN-421"><span class="linenos">421</span></a><span class="sd">            x: Node features.</span>
</span><span id="SimplifiedReversibleEGNN-422"><a href="#SimplifiedReversibleEGNN-422"><span class="linenos">422</span></a><span class="sd">            pos_a: Node coordinates. Used as inputs in EGNN blocks.</span>
</span><span id="SimplifiedReversibleEGNN-423"><a href="#SimplifiedReversibleEGNN-423"><span class="linenos">423</span></a><span class="sd">            pos_b: Node coordinates. Used for auto-regressive update of</span>
</span><span id="SimplifiedReversibleEGNN-424"><a href="#SimplifiedReversibleEGNN-424"><span class="linenos">424</span></a><span class="sd">                coordinates.</span>
</span><span id="SimplifiedReversibleEGNN-425"><a href="#SimplifiedReversibleEGNN-425"><span class="linenos">425</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="SimplifiedReversibleEGNN-426"><a href="#SimplifiedReversibleEGNN-426"><span class="linenos">426</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="SimplifiedReversibleEGNN-427"><a href="#SimplifiedReversibleEGNN-427"><span class="linenos">427</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="SimplifiedReversibleEGNN-428"><a href="#SimplifiedReversibleEGNN-428"><span class="linenos">428</span></a>
</span><span id="SimplifiedReversibleEGNN-429"><a href="#SimplifiedReversibleEGNN-429"><span class="linenos">429</span></a><span class="sd">        Returns:</span>
</span><span id="SimplifiedReversibleEGNN-430"><a href="#SimplifiedReversibleEGNN-430"><span class="linenos">430</span></a><span class="sd">            Tuple of updated node features, updated coordinates and original</span>
</span><span id="SimplifiedReversibleEGNN-431"><a href="#SimplifiedReversibleEGNN-431"><span class="linenos">431</span></a><span class="sd">            coordinates `pos_a`.</span>
</span><span id="SimplifiedReversibleEGNN-432"><a href="#SimplifiedReversibleEGNN-432"><span class="linenos">432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN-433"><a href="#SimplifiedReversibleEGNN-433"><span class="linenos">433</span></a>
</span><span id="SimplifiedReversibleEGNN-434"><a href="#SimplifiedReversibleEGNN-434"><span class="linenos">434</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-435"><a href="#SimplifiedReversibleEGNN-435"><span class="linenos">435</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_blocks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-436"><a href="#SimplifiedReversibleEGNN-436"><span class="linenos">436</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SimplifiedReversibleEGNN-437"><a href="#SimplifiedReversibleEGNN-437"><span class="linenos">437</span></a>        <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SimplifiedReversibleEGNN-438"><a href="#SimplifiedReversibleEGNN-438"><span class="linenos">438</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SimplifiedReversibleEGNN-439"><a href="#SimplifiedReversibleEGNN-439"><span class="linenos">439</span></a>
</span><span id="SimplifiedReversibleEGNN-440"><a href="#SimplifiedReversibleEGNN-440"><span class="linenos">440</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="SimplifiedReversibleEGNN-441"><a href="#SimplifiedReversibleEGNN-441"><span class="linenos">441</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-442"><a href="#SimplifiedReversibleEGNN-442"><span class="linenos">442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deterministic_context</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-443"><a href="#SimplifiedReversibleEGNN-443"><span class="linenos">443</span></a>            <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-444"><a href="#SimplifiedReversibleEGNN-444"><span class="linenos">444</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-445"><a href="#SimplifiedReversibleEGNN-445"><span class="linenos">445</span></a>            <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-446"><a href="#SimplifiedReversibleEGNN-446"><span class="linenos">446</span></a>            <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-447"><a href="#SimplifiedReversibleEGNN-447"><span class="linenos">447</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">x_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_i</span>
</span><span id="SimplifiedReversibleEGNN-448"><a href="#SimplifiedReversibleEGNN-448"><span class="linenos">448</span></a>            <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-449"><a href="#SimplifiedReversibleEGNN-449"><span class="linenos">449</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="SimplifiedReversibleEGNN-450"><a href="#SimplifiedReversibleEGNN-450"><span class="linenos">450</span></a>
</span><span id="SimplifiedReversibleEGNN-451"><a href="#SimplifiedReversibleEGNN-451"><span class="linenos">451</span></a>        <span class="n">y_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SimplifiedReversibleEGNN-452"><a href="#SimplifiedReversibleEGNN-452"><span class="linenos">452</span></a>
</span><span id="SimplifiedReversibleEGNN-453"><a href="#SimplifiedReversibleEGNN-453"><span class="linenos">453</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-454"><a href="#SimplifiedReversibleEGNN-454"><span class="linenos">454</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">/</span> <span class="n">num_blocks</span>
</span><span id="SimplifiedReversibleEGNN-455"><a href="#SimplifiedReversibleEGNN-455"><span class="linenos">455</span></a>        <span class="n">pos_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_b</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="SimplifiedReversibleEGNN-456"><a href="#SimplifiedReversibleEGNN-456"><span class="linenos">456</span></a>
</span><span id="SimplifiedReversibleEGNN-457"><a href="#SimplifiedReversibleEGNN-457"><span class="linenos">457</span></a>        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">pos_c</span><span class="p">,</span> <span class="n">pos_a</span>
</span><span id="SimplifiedReversibleEGNN-458"><a href="#SimplifiedReversibleEGNN-458"><span class="linenos">458</span></a>
</span><span id="SimplifiedReversibleEGNN-459"><a href="#SimplifiedReversibleEGNN-459"><span class="linenos">459</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN-460"><a href="#SimplifiedReversibleEGNN-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-461"><a href="#SimplifiedReversibleEGNN-461"><span class="linenos">461</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-462"><a href="#SimplifiedReversibleEGNN-462"><span class="linenos">462</span></a>        <span class="n">pos_c</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-463"><a href="#SimplifiedReversibleEGNN-463"><span class="linenos">463</span></a>        <span class="n">pos_a</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-464"><a href="#SimplifiedReversibleEGNN-464"><span class="linenos">464</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-465"><a href="#SimplifiedReversibleEGNN-465"><span class="linenos">465</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-466"><a href="#SimplifiedReversibleEGNN-466"><span class="linenos">466</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN-467"><a href="#SimplifiedReversibleEGNN-467"><span class="linenos">467</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="SimplifiedReversibleEGNN-468"><a href="#SimplifiedReversibleEGNN-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute reverse pass.</span>
</span><span id="SimplifiedReversibleEGNN-469"><a href="#SimplifiedReversibleEGNN-469"><span class="linenos">469</span></a>
</span><span id="SimplifiedReversibleEGNN-470"><a href="#SimplifiedReversibleEGNN-470"><span class="linenos">470</span></a><span class="sd">        Arguments:</span>
</span><span id="SimplifiedReversibleEGNN-471"><a href="#SimplifiedReversibleEGNN-471"><span class="linenos">471</span></a><span class="sd">            x: Node features.</span>
</span><span id="SimplifiedReversibleEGNN-472"><a href="#SimplifiedReversibleEGNN-472"><span class="linenos">472</span></a><span class="sd">            pos_c: Node coordinates. Updated coordinates from forward pass.</span>
</span><span id="SimplifiedReversibleEGNN-473"><a href="#SimplifiedReversibleEGNN-473"><span class="linenos">473</span></a><span class="sd">            pos_a: Node coordinates. Original coordinates used to compute the</span>
</span><span id="SimplifiedReversibleEGNN-474"><a href="#SimplifiedReversibleEGNN-474"><span class="linenos">474</span></a><span class="sd">                updated coordinates in the forward pass.</span>
</span><span id="SimplifiedReversibleEGNN-475"><a href="#SimplifiedReversibleEGNN-475"><span class="linenos">475</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="SimplifiedReversibleEGNN-476"><a href="#SimplifiedReversibleEGNN-476"><span class="linenos">476</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="SimplifiedReversibleEGNN-477"><a href="#SimplifiedReversibleEGNN-477"><span class="linenos">477</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="SimplifiedReversibleEGNN-478"><a href="#SimplifiedReversibleEGNN-478"><span class="linenos">478</span></a>
</span><span id="SimplifiedReversibleEGNN-479"><a href="#SimplifiedReversibleEGNN-479"><span class="linenos">479</span></a><span class="sd">        Returns:</span>
</span><span id="SimplifiedReversibleEGNN-480"><a href="#SimplifiedReversibleEGNN-480"><span class="linenos">480</span></a><span class="sd">            Tuple of node features and original coordinates `pos_a` and `pos_b`</span>
</span><span id="SimplifiedReversibleEGNN-481"><a href="#SimplifiedReversibleEGNN-481"><span class="linenos">481</span></a><span class="sd">            that were used as inputs for the forward pass.</span>
</span><span id="SimplifiedReversibleEGNN-482"><a href="#SimplifiedReversibleEGNN-482"><span class="linenos">482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN-483"><a href="#SimplifiedReversibleEGNN-483"><span class="linenos">483</span></a>
</span><span id="SimplifiedReversibleEGNN-484"><a href="#SimplifiedReversibleEGNN-484"><span class="linenos">484</span></a>        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-485"><a href="#SimplifiedReversibleEGNN-485"><span class="linenos">485</span></a>        <span class="n">y_chunks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">num_blocks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-486"><a href="#SimplifiedReversibleEGNN-486"><span class="linenos">486</span></a>        <span class="n">x_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="SimplifiedReversibleEGNN-487"><a href="#SimplifiedReversibleEGNN-487"><span class="linenos">487</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SimplifiedReversibleEGNN-488"><a href="#SimplifiedReversibleEGNN-488"><span class="linenos">488</span></a>
</span><span id="SimplifiedReversibleEGNN-489"><a href="#SimplifiedReversibleEGNN-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
</span><span id="SimplifiedReversibleEGNN-490"><a href="#SimplifiedReversibleEGNN-490"><span class="linenos">490</span></a>            <span class="n">y_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SimplifiedReversibleEGNN-491"><a href="#SimplifiedReversibleEGNN-491"><span class="linenos">491</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_contexts</span><span class="p">[</span><span class="n">i</span><span class="p">]():</span>
</span><span id="SimplifiedReversibleEGNN-492"><a href="#SimplifiedReversibleEGNN-492"><span class="linenos">492</span></a>                <span class="n">d_i</span><span class="p">,</span> <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">egnn</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-493"><a href="#SimplifiedReversibleEGNN-493"><span class="linenos">493</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-494"><a href="#SimplifiedReversibleEGNN-494"><span class="linenos">494</span></a>                <span class="n">d_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">d_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-495"><a href="#SimplifiedReversibleEGNN-495"><span class="linenos">495</span></a>                <span class="n">pos_i</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-496"><a href="#SimplifiedReversibleEGNN-496"><span class="linenos">496</span></a>            <span class="n">x_i</span> <span class="o">=</span> <span class="n">y_chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_i</span>
</span><span id="SimplifiedReversibleEGNN-497"><a href="#SimplifiedReversibleEGNN-497"><span class="linenos">497</span></a>            <span class="n">x_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-498"><a href="#SimplifiedReversibleEGNN-498"><span class="linenos">498</span></a>            <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">pos_i</span>
</span><span id="SimplifiedReversibleEGNN-499"><a href="#SimplifiedReversibleEGNN-499"><span class="linenos">499</span></a>
</span><span id="SimplifiedReversibleEGNN-500"><a href="#SimplifiedReversibleEGNN-500"><span class="linenos">500</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x_chunks</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimplifiedReversibleEGNN-501"><a href="#SimplifiedReversibleEGNN-501"><span class="linenos">501</span></a>        <span class="n">pos_s</span> <span class="o">=</span> <span class="n">pos_s</span> <span class="o">+</span> <span class="n">num_blocks</span>
</span><span id="SimplifiedReversibleEGNN-502"><a href="#SimplifiedReversibleEGNN-502"><span class="linenos">502</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos_c</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">pos_s</span>
</span><span id="SimplifiedReversibleEGNN-503"><a href="#SimplifiedReversibleEGNN-503"><span class="linenos">503</span></a>
</span><span id="SimplifiedReversibleEGNN-504"><a href="#SimplifiedReversibleEGNN-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span>
</span></pre></div>


            <div class="docstring"><p>Simplified variant of the Reversible E(n) Equivariant Graph Neural
Network.</p>

<p>This variant uses an auto-regressive update scheme that is more in line
with [2]_.</p>

<p>Please refer to <code><a href="../egnn.html#EGNN">bpp.model.egnn.EGNN</a></code> for further details on how to
use this module.</p>
</div>


                            <div id="SimplifiedReversibleEGNN.__init__" class="classattr">
                                        <input id="SimplifiedReversibleEGNN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SimplifiedReversibleEGNN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	norm_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: type[torch.nn.modules.module.Module] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;,</span><span class="param">	<span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SimplifiedReversibleEGNN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimplifiedReversibleEGNN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimplifiedReversibleEGNN.__init__-303"><a href="#SimplifiedReversibleEGNN.__init__-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN.__init__-304"><a href="#SimplifiedReversibleEGNN.__init__-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-305"><a href="#SimplifiedReversibleEGNN.__init__-305"><span class="linenos">305</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="SimplifiedReversibleEGNN.__init__-306"><a href="#SimplifiedReversibleEGNN.__init__-306"><span class="linenos">306</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="SimplifiedReversibleEGNN.__init__-307"><a href="#SimplifiedReversibleEGNN.__init__-307"><span class="linenos">307</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SimplifiedReversibleEGNN.__init__-308"><a href="#SimplifiedReversibleEGNN.__init__-308"><span class="linenos">308</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="SimplifiedReversibleEGNN.__init__-309"><a href="#SimplifiedReversibleEGNN.__init__-309"><span class="linenos">309</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-310"><a href="#SimplifiedReversibleEGNN.__init__-310"><span class="linenos">310</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-311"><a href="#SimplifiedReversibleEGNN.__init__-311"><span class="linenos">311</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-312"><a href="#SimplifiedReversibleEGNN.__init__-312"><span class="linenos">312</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-313"><a href="#SimplifiedReversibleEGNN.__init__-313"><span class="linenos">313</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-314"><a href="#SimplifiedReversibleEGNN.__init__-314"><span class="linenos">314</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-315"><a href="#SimplifiedReversibleEGNN.__init__-315"><span class="linenos">315</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-316"><a href="#SimplifiedReversibleEGNN.__init__-316"><span class="linenos">316</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-317"><a href="#SimplifiedReversibleEGNN.__init__-317"><span class="linenos">317</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-318"><a href="#SimplifiedReversibleEGNN.__init__-318"><span class="linenos">318</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-319"><a href="#SimplifiedReversibleEGNN.__init__-319"><span class="linenos">319</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-320"><a href="#SimplifiedReversibleEGNN.__init__-320"><span class="linenos">320</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-321"><a href="#SimplifiedReversibleEGNN.__init__-321"><span class="linenos">321</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-322"><a href="#SimplifiedReversibleEGNN.__init__-322"><span class="linenos">322</span></a>        <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-323"><a href="#SimplifiedReversibleEGNN.__init__-323"><span class="linenos">323</span></a>        <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-324"><a href="#SimplifiedReversibleEGNN.__init__-324"><span class="linenos">324</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SimplifiedReversibleEGNN.__init__-325"><a href="#SimplifiedReversibleEGNN.__init__-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN.__init__-326"><a href="#SimplifiedReversibleEGNN.__init__-326"><span class="linenos">326</span></a><span class="sd">        Arguments:</span>
</span><span id="SimplifiedReversibleEGNN.__init__-327"><a href="#SimplifiedReversibleEGNN.__init__-327"><span class="linenos">327</span></a><span class="sd">            dims_node: Dimensions for the node network of a block:</span>
</span><span id="SimplifiedReversibleEGNN.__init__-328"><a href="#SimplifiedReversibleEGNN.__init__-328"><span class="linenos">328</span></a><span class="sd">                `dims_node[0]` is the number of input features and</span>
</span><span id="SimplifiedReversibleEGNN.__init__-329"><a href="#SimplifiedReversibleEGNN.__init__-329"><span class="linenos">329</span></a><span class="sd">                `dims_node[-1]` is the number of output features. At least 2</span>
</span><span id="SimplifiedReversibleEGNN.__init__-330"><a href="#SimplifiedReversibleEGNN.__init__-330"><span class="linenos">330</span></a><span class="sd">                dimensions are required. All remaining dimensions are used for</span>
</span><span id="SimplifiedReversibleEGNN.__init__-331"><a href="#SimplifiedReversibleEGNN.__init__-331"><span class="linenos">331</span></a><span class="sd">                the hidden-layers of the network.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-332"><a href="#SimplifiedReversibleEGNN.__init__-332"><span class="linenos">332</span></a><span class="sd">            dims_edge: Dimensions for the edge network of a block:</span>
</span><span id="SimplifiedReversibleEGNN.__init__-333"><a href="#SimplifiedReversibleEGNN.__init__-333"><span class="linenos">333</span></a><span class="sd">                `dims_edge[0]` is the number of edge features (0 if graphs have</span>
</span><span id="SimplifiedReversibleEGNN.__init__-334"><a href="#SimplifiedReversibleEGNN.__init__-334"><span class="linenos">334</span></a><span class="sd">                no edge features), `dims_edge[-1]` is the number of message</span>
</span><span id="SimplifiedReversibleEGNN.__init__-335"><a href="#SimplifiedReversibleEGNN.__init__-335"><span class="linenos">335</span></a><span class="sd">                features.  All remaining dimensions are used for the</span>
</span><span id="SimplifiedReversibleEGNN.__init__-336"><a href="#SimplifiedReversibleEGNN.__init__-336"><span class="linenos">336</span></a><span class="sd">                hidden-layers of the edge network that computes the messages.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-337"><a href="#SimplifiedReversibleEGNN.__init__-337"><span class="linenos">337</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="SimplifiedReversibleEGNN.__init__-338"><a href="#SimplifiedReversibleEGNN.__init__-338"><span class="linenos">338</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="SimplifiedReversibleEGNN.__init__-339"><a href="#SimplifiedReversibleEGNN.__init__-339"><span class="linenos">339</span></a><span class="sd">                least one block is required.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-340"><a href="#SimplifiedReversibleEGNN.__init__-340"><span class="linenos">340</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. If empty,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-341"><a href="#SimplifiedReversibleEGNN.__init__-341"><span class="linenos">341</span></a><span class="sd">                no message gating network will be created and message gating</span>
</span><span id="SimplifiedReversibleEGNN.__init__-342"><a href="#SimplifiedReversibleEGNN.__init__-342"><span class="linenos">342</span></a><span class="sd">                will be disabled.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-343"><a href="#SimplifiedReversibleEGNN.__init__-343"><span class="linenos">343</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. If empty,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-344"><a href="#SimplifiedReversibleEGNN.__init__-344"><span class="linenos">344</span></a><span class="sd">                no coordinate update network will be created and coordinate</span>
</span><span id="SimplifiedReversibleEGNN.__init__-345"><a href="#SimplifiedReversibleEGNN.__init__-345"><span class="linenos">345</span></a><span class="sd">                updates will be disabled.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-346"><a href="#SimplifiedReversibleEGNN.__init__-346"><span class="linenos">346</span></a><span class="sd">            num_pos: Number of node positions. Each node can be assigned to one</span>
</span><span id="SimplifiedReversibleEGNN.__init__-347"><a href="#SimplifiedReversibleEGNN.__init__-347"><span class="linenos">347</span></a><span class="sd">                position, but can also be assigned to multiple positions.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-348"><a href="#SimplifiedReversibleEGNN.__init__-348"><span class="linenos">348</span></a><span class="sd">            num_encode: Number of fourier-encoded features that are computed</span>
</span><span id="SimplifiedReversibleEGNN.__init__-349"><a href="#SimplifiedReversibleEGNN.__init__-349"><span class="linenos">349</span></a><span class="sd">                from the distances between node coordinates. If `num_encode` is</span>
</span><span id="SimplifiedReversibleEGNN.__init__-350"><a href="#SimplifiedReversibleEGNN.__init__-350"><span class="linenos">350</span></a><span class="sd">                even, only the fourier-encoded features will be used. If odd,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-351"><a href="#SimplifiedReversibleEGNN.__init__-351"><span class="linenos">351</span></a><span class="sd">                the original distances will also be used alongside the</span>
</span><span id="SimplifiedReversibleEGNN.__init__-352"><a href="#SimplifiedReversibleEGNN.__init__-352"><span class="linenos">352</span></a><span class="sd">                fourier-encoded features.  Default is 1, which means that only</span>
</span><span id="SimplifiedReversibleEGNN.__init__-353"><a href="#SimplifiedReversibleEGNN.__init__-353"><span class="linenos">353</span></a><span class="sd">                the original distances are used, without any fourier features.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-354"><a href="#SimplifiedReversibleEGNN.__init__-354"><span class="linenos">354</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If pos_scale is</span>
</span><span id="SimplifiedReversibleEGNN.__init__-355"><a href="#SimplifiedReversibleEGNN.__init__-355"><span class="linenos">355</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="SimplifiedReversibleEGNN.__init__-356"><a href="#SimplifiedReversibleEGNN.__init__-356"><span class="linenos">356</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-357"><a href="#SimplifiedReversibleEGNN.__init__-357"><span class="linenos">357</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="SimplifiedReversibleEGNN.__init__-358"><a href="#SimplifiedReversibleEGNN.__init__-358"><span class="linenos">358</span></a><span class="sd">                normalization after a block. If only one value is given, then</span>
</span><span id="SimplifiedReversibleEGNN.__init__-359"><a href="#SimplifiedReversibleEGNN.__init__-359"><span class="linenos">359</span></a><span class="sd">                normalization within and after a block will be applied</span>
</span><span id="SimplifiedReversibleEGNN.__init__-360"><a href="#SimplifiedReversibleEGNN.__init__-360"><span class="linenos">360</span></a><span class="sd">                accordingly. If two values are given, then the first determines</span>
</span><span id="SimplifiedReversibleEGNN.__init__-361"><a href="#SimplifiedReversibleEGNN.__init__-361"><span class="linenos">361</span></a><span class="sd">                whether to apply normalization after a block and the second</span>
</span><span id="SimplifiedReversibleEGNN.__init__-362"><a href="#SimplifiedReversibleEGNN.__init__-362"><span class="linenos">362</span></a><span class="sd">                whether to apply normalization within a block.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-363"><a href="#SimplifiedReversibleEGNN.__init__-363"><span class="linenos">363</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="SimplifiedReversibleEGNN.__init__-364"><a href="#SimplifiedReversibleEGNN.__init__-364"><span class="linenos">364</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-365"><a href="#SimplifiedReversibleEGNN.__init__-365"><span class="linenos">365</span></a><span class="sd">            dropout: Dropout probabilities for inputs and within network layers</span>
</span><span id="SimplifiedReversibleEGNN.__init__-366"><a href="#SimplifiedReversibleEGNN.__init__-366"><span class="linenos">366</span></a><span class="sd">                of a block. If only one probability is given, then this will be</span>
</span><span id="SimplifiedReversibleEGNN.__init__-367"><a href="#SimplifiedReversibleEGNN.__init__-367"><span class="linenos">367</span></a><span class="sd">                used for the inputs and in-between layers. Dropout is omitted if</span>
</span><span id="SimplifiedReversibleEGNN.__init__-368"><a href="#SimplifiedReversibleEGNN.__init__-368"><span class="linenos">368</span></a><span class="sd">                0.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-369"><a href="#SimplifiedReversibleEGNN.__init__-369"><span class="linenos">369</span></a><span class="sd">            activation: Activation function that is used in-between network</span>
</span><span id="SimplifiedReversibleEGNN.__init__-370"><a href="#SimplifiedReversibleEGNN.__init__-370"><span class="linenos">370</span></a><span class="sd">                layers.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-371"><a href="#SimplifiedReversibleEGNN.__init__-371"><span class="linenos">371</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="SimplifiedReversibleEGNN.__init__-372"><a href="#SimplifiedReversibleEGNN.__init__-372"><span class="linenos">372</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="SimplifiedReversibleEGNN.__init__-373"><a href="#SimplifiedReversibleEGNN.__init__-373"><span class="linenos">373</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-374"><a href="#SimplifiedReversibleEGNN.__init__-374"><span class="linenos">374</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="SimplifiedReversibleEGNN.__init__-375"><a href="#SimplifiedReversibleEGNN.__init__-375"><span class="linenos">375</span></a><span class="sd">                `activation`. See :func:`bpp.model.egnn.parameter_init`.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-376"><a href="#SimplifiedReversibleEGNN.__init__-376"><span class="linenos">376</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-377"><a href="#SimplifiedReversibleEGNN.__init__-377"><span class="linenos">377</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-378"><a href="#SimplifiedReversibleEGNN.__init__-378"><span class="linenos">378</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="SimplifiedReversibleEGNN.__init__-379"><a href="#SimplifiedReversibleEGNN.__init__-379"><span class="linenos">379</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="SimplifiedReversibleEGNN.__init__-380"><a href="#SimplifiedReversibleEGNN.__init__-380"><span class="linenos">380</span></a><span class="sd">                debugging.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-381"><a href="#SimplifiedReversibleEGNN.__init__-381"><span class="linenos">381</span></a><span class="sd">            free_inputs: Whether to free inputs. Disabled by default due to</span>
</span><span id="SimplifiedReversibleEGNN.__init__-382"><a href="#SimplifiedReversibleEGNN.__init__-382"><span class="linenos">382</span></a><span class="sd">                numerical issues.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-383"><a href="#SimplifiedReversibleEGNN.__init__-383"><span class="linenos">383</span></a><span class="sd">            free_outputs: Whether to free outputs. Disabled by default due to</span>
</span><span id="SimplifiedReversibleEGNN.__init__-384"><a href="#SimplifiedReversibleEGNN.__init__-384"><span class="linenos">384</span></a><span class="sd">                numerical issues.</span>
</span><span id="SimplifiedReversibleEGNN.__init__-385"><a href="#SimplifiedReversibleEGNN.__init__-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SimplifiedReversibleEGNN.__init__-386"><a href="#SimplifiedReversibleEGNN.__init__-386"><span class="linenos">386</span></a>
</span><span id="SimplifiedReversibleEGNN.__init__-387"><a href="#SimplifiedReversibleEGNN.__init__-387"><span class="linenos">387</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SimplifiedReversibleEGNN.__init__-388"><a href="#SimplifiedReversibleEGNN.__init__-388"><span class="linenos">388</span></a>            <span class="n">dims_node</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-389"><a href="#SimplifiedReversibleEGNN.__init__-389"><span class="linenos">389</span></a>            <span class="n">dims_edge</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-390"><a href="#SimplifiedReversibleEGNN.__init__-390"><span class="linenos">390</span></a>            <span class="n">dims_gate</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-391"><a href="#SimplifiedReversibleEGNN.__init__-391"><span class="linenos">391</span></a>            <span class="n">dims_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-392"><a href="#SimplifiedReversibleEGNN.__init__-392"><span class="linenos">392</span></a>            <span class="n">blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-393"><a href="#SimplifiedReversibleEGNN.__init__-393"><span class="linenos">393</span></a>            <span class="n">num_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-394"><a href="#SimplifiedReversibleEGNN.__init__-394"><span class="linenos">394</span></a>            <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-395"><a href="#SimplifiedReversibleEGNN.__init__-395"><span class="linenos">395</span></a>            <span class="n">num_encode</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-396"><a href="#SimplifiedReversibleEGNN.__init__-396"><span class="linenos">396</span></a>            <span class="n">pos_scale</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-397"><a href="#SimplifiedReversibleEGNN.__init__-397"><span class="linenos">397</span></a>            <span class="n">norm</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-398"><a href="#SimplifiedReversibleEGNN.__init__-398"><span class="linenos">398</span></a>            <span class="n">clamp</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-399"><a href="#SimplifiedReversibleEGNN.__init__-399"><span class="linenos">399</span></a>            <span class="n">dropout</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-400"><a href="#SimplifiedReversibleEGNN.__init__-400"><span class="linenos">400</span></a>            <span class="n">activation</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-401"><a href="#SimplifiedReversibleEGNN.__init__-401"><span class="linenos">401</span></a>            <span class="n">init</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-402"><a href="#SimplifiedReversibleEGNN.__init__-402"><span class="linenos">402</span></a>            <span class="n">norm_cls</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-403"><a href="#SimplifiedReversibleEGNN.__init__-403"><span class="linenos">403</span></a>            <span class="n">dropout_cls</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-404"><a href="#SimplifiedReversibleEGNN.__init__-404"><span class="linenos">404</span></a>            <span class="n">disable</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-405"><a href="#SimplifiedReversibleEGNN.__init__-405"><span class="linenos">405</span></a>            <span class="n">free_inputs</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-406"><a href="#SimplifiedReversibleEGNN.__init__-406"><span class="linenos">406</span></a>            <span class="n">free_outputs</span><span class="p">,</span>
</span><span id="SimplifiedReversibleEGNN.__init__-407"><a href="#SimplifiedReversibleEGNN.__init__-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims_node:</strong>  Dimensions for the node network of a block:
<code>dims_node[0]</code> is the number of input features and
<code>dims_node[-1]</code> is the number of output features. At least 2
dimensions are required. All remaining dimensions are used for
the hidden-layers of the network.</li>
<li><strong>dims_edge:</strong>  Dimensions for the edge network of a block:
<code>dims_edge[0]</code> is the number of edge features (0 if graphs have
no edge features), <code>dims_edge[-1]</code> is the number of message
features.  All remaining dimensions are used for the
hidden-layers of the edge network that computes the messages.</li>
<li><strong>blocks:</strong>  Number of blocks in the auto-regressive reversible layer;
i.e., individual instances of <code><a href="../egnn.html#EGNN">bpp.model.egnn.EGNN</a></code>. At
least one block is required.</li>
<li><strong>dims_gate:</strong>  Dimensions for the message gating network. If empty,
no message gating network will be created and message gating
will be disabled.</li>
<li><strong>dims_pos:</strong>  Dimensions for the coordinate update network. If empty,
no coordinate update network will be created and coordinate
updates will be disabled.</li>
<li><strong>num_pos:</strong>  Number of node positions. Each node can be assigned to one
position, but can also be assigned to multiple positions.</li>
<li><strong>num_encode:</strong>  Number of fourier-encoded features that are computed
from the distances between node coordinates. If <code>num_encode</code> is
even, only the fourier-encoded features will be used. If odd,
the original distances will also be used alongside the
fourier-encoded features.  Default is 1, which means that only
the original distances are used, without any fourier features.</li>
<li><strong>pos_scale:</strong>  Initial scaler for coordinate updates. If pos_scale is
0, the penultimate layer of a coordinate update network will
use a linear activation and omit the scaling factor.</li>
<li><strong>norm:</strong>  Whether to use normalization within a block and whether to use
normalization after a block. If only one value is given, then
normalization within and after a block will be applied
accordingly. If two values are given, then the first determines
whether to apply normalization after a block and the second
whether to apply normalization within a block.</li>
<li><strong>clamp:</strong>  Threshold for clamping coordinate updates (between <code>-clamp</code>
and <code>clamp</code>). Unclamped if 0.</li>
<li><strong>dropout:</strong>  Dropout probabilities for inputs and within network layers
of a block. If only one probability is given, then this will be
used for the inputs and in-between layers. Dropout is omitted if
0.</li>
<li><strong>activation:</strong>  Activation function that is used in-between network
layers.</li>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
The default non-linearity should adhere to whatever is used for
<code>activation</code>. See <code><a href="../egnn.html#parameter_init">bpp.model.egnn.parameter_init()</a></code>.</li>
<li><strong>norm_cls:</strong>  Class instance of normalization module.</li>
<li><strong>dropout_cls:</strong>  Class instance of dropout module.</li>
<li><strong>disable:</strong>  Whether to disable reversible computations and use
conventional back-propagation method. Used primarily for
debugging.</li>
<li><strong>free_inputs:</strong>  Whether to free inputs. Disabled by default due to
numerical issues.</li>
<li><strong>free_outputs:</strong>  Whether to free outputs. Disabled by default due to
numerical issues.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ReversibleEGNN">ReversibleEGNN</a></dt>
                                <dd id="SimplifiedReversibleEGNN.init" class="variable"><a href="#ReversibleEGNN.init">init</a></dd>
                <dd id="SimplifiedReversibleEGNN.deterministic_contexts" class="variable"><a href="#ReversibleEGNN.deterministic_contexts">deterministic_contexts</a></dd>
                <dd id="SimplifiedReversibleEGNN.blocks" class="variable"><a href="#ReversibleEGNN.blocks">blocks</a></dd>
                <dd id="SimplifiedReversibleEGNN.reset_parameters" class="function"><a href="#ReversibleEGNN.reset_parameters">reset_parameters</a></dd>

            </div>
            <div><dt><a href="../_reversible.html#ReversibleModule">bpp.model._reversible.ReversibleModule</a></dt>
                                <dd id="SimplifiedReversibleEGNN.disable" class="variable"><a href="../_reversible.html#ReversibleModule.disable">disable</a></dd>
                <dd id="SimplifiedReversibleEGNN.free_inputs" class="variable"><a href="../_reversible.html#ReversibleModule.free_inputs">free_inputs</a></dd>
                <dd id="SimplifiedReversibleEGNN.free_outputs" class="variable"><a href="../_reversible.html#ReversibleModule.free_outputs">free_outputs</a></dd>
                <dd id="SimplifiedReversibleEGNN.preserve_rng_state" class="variable"><a href="../_reversible.html#ReversibleModule.preserve_rng_state">preserve_rng_state</a></dd>
                <dd id="SimplifiedReversibleEGNN.forward_has_only_one_output" class="variable"><a href="../_reversible.html#ReversibleModule.forward_has_only_one_output">forward_has_only_one_output</a></dd>
                <dd id="SimplifiedReversibleEGNN.forward" class="function"><a href="../_reversible.html#ReversibleModule.forward">forward</a></dd>
                <dd id="SimplifiedReversibleEGNN.reverse" class="function"><a href="../_reversible.html#ReversibleModule.reverse">reverse</a></dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="SimplifiedReversibleEGNN.dump_patches" class="variable">dump_patches</dd>
                <dd id="SimplifiedReversibleEGNN.training" class="variable">training</dd>
                <dd id="SimplifiedReversibleEGNN.call_super_init" class="variable">call_super_init</dd>
                <dd id="SimplifiedReversibleEGNN.register_buffer" class="function">register_buffer</dd>
                <dd id="SimplifiedReversibleEGNN.register_parameter" class="function">register_parameter</dd>
                <dd id="SimplifiedReversibleEGNN.add_module" class="function">add_module</dd>
                <dd id="SimplifiedReversibleEGNN.register_module" class="function">register_module</dd>
                <dd id="SimplifiedReversibleEGNN.get_submodule" class="function">get_submodule</dd>
                <dd id="SimplifiedReversibleEGNN.get_parameter" class="function">get_parameter</dd>
                <dd id="SimplifiedReversibleEGNN.get_buffer" class="function">get_buffer</dd>
                <dd id="SimplifiedReversibleEGNN.get_extra_state" class="function">get_extra_state</dd>
                <dd id="SimplifiedReversibleEGNN.set_extra_state" class="function">set_extra_state</dd>
                <dd id="SimplifiedReversibleEGNN.apply" class="function">apply</dd>
                <dd id="SimplifiedReversibleEGNN.cuda" class="function">cuda</dd>
                <dd id="SimplifiedReversibleEGNN.ipu" class="function">ipu</dd>
                <dd id="SimplifiedReversibleEGNN.xpu" class="function">xpu</dd>
                <dd id="SimplifiedReversibleEGNN.cpu" class="function">cpu</dd>
                <dd id="SimplifiedReversibleEGNN.type" class="function">type</dd>
                <dd id="SimplifiedReversibleEGNN.float" class="function">float</dd>
                <dd id="SimplifiedReversibleEGNN.double" class="function">double</dd>
                <dd id="SimplifiedReversibleEGNN.half" class="function">half</dd>
                <dd id="SimplifiedReversibleEGNN.bfloat16" class="function">bfloat16</dd>
                <dd id="SimplifiedReversibleEGNN.to_empty" class="function">to_empty</dd>
                <dd id="SimplifiedReversibleEGNN.to" class="function">to</dd>
                <dd id="SimplifiedReversibleEGNN.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="SimplifiedReversibleEGNN.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="SimplifiedReversibleEGNN.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="SimplifiedReversibleEGNN.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="SimplifiedReversibleEGNN.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="SimplifiedReversibleEGNN.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="SimplifiedReversibleEGNN.state_dict" class="function">state_dict</dd>
                <dd id="SimplifiedReversibleEGNN.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="SimplifiedReversibleEGNN.load_state_dict" class="function">load_state_dict</dd>
                <dd id="SimplifiedReversibleEGNN.parameters" class="function">parameters</dd>
                <dd id="SimplifiedReversibleEGNN.named_parameters" class="function">named_parameters</dd>
                <dd id="SimplifiedReversibleEGNN.buffers" class="function">buffers</dd>
                <dd id="SimplifiedReversibleEGNN.named_buffers" class="function">named_buffers</dd>
                <dd id="SimplifiedReversibleEGNN.children" class="function">children</dd>
                <dd id="SimplifiedReversibleEGNN.named_children" class="function">named_children</dd>
                <dd id="SimplifiedReversibleEGNN.modules" class="function">modules</dd>
                <dd id="SimplifiedReversibleEGNN.named_modules" class="function">named_modules</dd>
                <dd id="SimplifiedReversibleEGNN.train" class="function">train</dd>
                <dd id="SimplifiedReversibleEGNN.eval" class="function">eval</dd>
                <dd id="SimplifiedReversibleEGNN.requires_grad_" class="function">requires_grad_</dd>
                <dd id="SimplifiedReversibleEGNN.zero_grad" class="function">zero_grad</dd>
                <dd id="SimplifiedReversibleEGNN.share_memory" class="function">share_memory</dd>
                <dd id="SimplifiedReversibleEGNN.extra_repr" class="function">extra_repr</dd>
                <dd id="SimplifiedReversibleEGNN.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DeepReversibleEGNN">
                            <input id="DeepReversibleEGNN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DeepReversibleEGNN</span><wbr>(<span class="base">torch.nn.modules.module.Module</span>):

                <label class="view-source-button" for="DeepReversibleEGNN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepReversibleEGNN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepReversibleEGNN-507"><a href="#DeepReversibleEGNN-507"><span class="linenos">507</span></a><span class="k">class</span> <span class="nc">DeepReversibleEGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN-508"><a href="#DeepReversibleEGNN-508"><span class="linenos">508</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deep Reversible E(n) Equivariant Graph Neural Network.</span>
</span><span id="DeepReversibleEGNN-509"><a href="#DeepReversibleEGNN-509"><span class="linenos">509</span></a>
</span><span id="DeepReversibleEGNN-510"><a href="#DeepReversibleEGNN-510"><span class="linenos">510</span></a><span class="sd">    Implementation of a Deep Reversible E(n) Equivariant Graph Neural Network</span>
</span><span id="DeepReversibleEGNN-511"><a href="#DeepReversibleEGNN-511"><span class="linenos">511</span></a><span class="sd">    that utilizes reversible layers for saving memory during back-propagation.</span>
</span><span id="DeepReversibleEGNN-512"><a href="#DeepReversibleEGNN-512"><span class="linenos">512</span></a>
</span><span id="DeepReversibleEGNN-513"><a href="#DeepReversibleEGNN-513"><span class="linenos">513</span></a><span class="sd">    Please refer to :class:`bpp.model.egnn.DeepEGNN` for further details on how</span>
</span><span id="DeepReversibleEGNN-514"><a href="#DeepReversibleEGNN-514"><span class="linenos">514</span></a><span class="sd">    to use this module.</span>
</span><span id="DeepReversibleEGNN-515"><a href="#DeepReversibleEGNN-515"><span class="linenos">515</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN-516"><a href="#DeepReversibleEGNN-516"><span class="linenos">516</span></a>
</span><span id="DeepReversibleEGNN-517"><a href="#DeepReversibleEGNN-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN-518"><a href="#DeepReversibleEGNN-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-519"><a href="#DeepReversibleEGNN-519"><span class="linenos">519</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
</span><span id="DeepReversibleEGNN-520"><a href="#DeepReversibleEGNN-520"><span class="linenos">520</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
</span><span id="DeepReversibleEGNN-521"><a href="#DeepReversibleEGNN-521"><span class="linenos">521</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="DeepReversibleEGNN-522"><a href="#DeepReversibleEGNN-522"><span class="linenos">522</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="DeepReversibleEGNN-523"><a href="#DeepReversibleEGNN-523"><span class="linenos">523</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-524"><a href="#DeepReversibleEGNN-524"><span class="linenos">524</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-525"><a href="#DeepReversibleEGNN-525"><span class="linenos">525</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-526"><a href="#DeepReversibleEGNN-526"><span class="linenos">526</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-527"><a href="#DeepReversibleEGNN-527"><span class="linenos">527</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-528"><a href="#DeepReversibleEGNN-528"><span class="linenos">528</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-529"><a href="#DeepReversibleEGNN-529"><span class="linenos">529</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-530"><a href="#DeepReversibleEGNN-530"><span class="linenos">530</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-531"><a href="#DeepReversibleEGNN-531"><span class="linenos">531</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-532"><a href="#DeepReversibleEGNN-532"><span class="linenos">532</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-533"><a href="#DeepReversibleEGNN-533"><span class="linenos">533</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-534"><a href="#DeepReversibleEGNN-534"><span class="linenos">534</span></a>        <span class="n">layer_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReversibleEGNN</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-535"><a href="#DeepReversibleEGNN-535"><span class="linenos">535</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-536"><a href="#DeepReversibleEGNN-536"><span class="linenos">536</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-537"><a href="#DeepReversibleEGNN-537"><span class="linenos">537</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-538"><a href="#DeepReversibleEGNN-538"><span class="linenos">538</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-539"><a href="#DeepReversibleEGNN-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN-540"><a href="#DeepReversibleEGNN-540"><span class="linenos">540</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepReversibleEGNN-541"><a href="#DeepReversibleEGNN-541"><span class="linenos">541</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="DeepReversibleEGNN-542"><a href="#DeepReversibleEGNN-542"><span class="linenos">542</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="DeepReversibleEGNN-543"><a href="#DeepReversibleEGNN-543"><span class="linenos">543</span></a><span class="sd">                features and all remaining dimensions describing the number of</span>
</span><span id="DeepReversibleEGNN-544"><a href="#DeepReversibleEGNN-544"><span class="linenos">544</span></a><span class="sd">                features in the hidden layers. Note that the number of output</span>
</span><span id="DeepReversibleEGNN-545"><a href="#DeepReversibleEGNN-545"><span class="linenos">545</span></a><span class="sd">                features will always be the same as the number of input features</span>
</span><span id="DeepReversibleEGNN-546"><a href="#DeepReversibleEGNN-546"><span class="linenos">546</span></a><span class="sd">                for this variant of an EGNN model. Alternatively, `dims_node`</span>
</span><span id="DeepReversibleEGNN-547"><a href="#DeepReversibleEGNN-547"><span class="linenos">547</span></a><span class="sd">                can also be a sequence of sequences of integers, describing the</span>
</span><span id="DeepReversibleEGNN-548"><a href="#DeepReversibleEGNN-548"><span class="linenos">548</span></a><span class="sd">                aforementioned properties for each layer individually. In this</span>
</span><span id="DeepReversibleEGNN-549"><a href="#DeepReversibleEGNN-549"><span class="linenos">549</span></a><span class="sd">                case, only the number of input features in the definition of the</span>
</span><span id="DeepReversibleEGNN-550"><a href="#DeepReversibleEGNN-550"><span class="linenos">550</span></a><span class="sd">                first layer must be provided and for all other layers the number</span>
</span><span id="DeepReversibleEGNN-551"><a href="#DeepReversibleEGNN-551"><span class="linenos">551</span></a><span class="sd">                of input features is omitted, since it is derived from the</span>
</span><span id="DeepReversibleEGNN-552"><a href="#DeepReversibleEGNN-552"><span class="linenos">552</span></a><span class="sd">                the previous layer.</span>
</span><span id="DeepReversibleEGNN-553"><a href="#DeepReversibleEGNN-553"><span class="linenos">553</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="DeepReversibleEGNN-554"><a href="#DeepReversibleEGNN-554"><span class="linenos">554</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="DeepReversibleEGNN-555"><a href="#DeepReversibleEGNN-555"><span class="linenos">555</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="DeepReversibleEGNN-556"><a href="#DeepReversibleEGNN-556"><span class="linenos">556</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="DeepReversibleEGNN-557"><a href="#DeepReversibleEGNN-557"><span class="linenos">557</span></a><span class="sd">                gating is disabled.</span>
</span><span id="DeepReversibleEGNN-558"><a href="#DeepReversibleEGNN-558"><span class="linenos">558</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="DeepReversibleEGNN-559"><a href="#DeepReversibleEGNN-559"><span class="linenos">559</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="DeepReversibleEGNN-560"><a href="#DeepReversibleEGNN-560"><span class="linenos">560</span></a><span class="sd">                update is disabled.</span>
</span><span id="DeepReversibleEGNN-561"><a href="#DeepReversibleEGNN-561"><span class="linenos">561</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="DeepReversibleEGNN-562"><a href="#DeepReversibleEGNN-562"><span class="linenos">562</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="DeepReversibleEGNN-563"><a href="#DeepReversibleEGNN-563"><span class="linenos">563</span></a><span class="sd">                least two blocks are required and the number of node input</span>
</span><span id="DeepReversibleEGNN-564"><a href="#DeepReversibleEGNN-564"><span class="linenos">564</span></a><span class="sd">                features must be divisible by the number of blocks.</span>
</span><span id="DeepReversibleEGNN-565"><a href="#DeepReversibleEGNN-565"><span class="linenos">565</span></a><span class="sd">            layers: Number of layers.</span>
</span><span id="DeepReversibleEGNN-566"><a href="#DeepReversibleEGNN-566"><span class="linenos">566</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="DeepReversibleEGNN-567"><a href="#DeepReversibleEGNN-567"><span class="linenos">567</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="DeepReversibleEGNN-568"><a href="#DeepReversibleEGNN-568"><span class="linenos">568</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="DeepReversibleEGNN-569"><a href="#DeepReversibleEGNN-569"><span class="linenos">569</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If `pos_scale` is</span>
</span><span id="DeepReversibleEGNN-570"><a href="#DeepReversibleEGNN-570"><span class="linenos">570</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="DeepReversibleEGNN-571"><a href="#DeepReversibleEGNN-571"><span class="linenos">571</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="DeepReversibleEGNN-572"><a href="#DeepReversibleEGNN-572"><span class="linenos">572</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="DeepReversibleEGNN-573"><a href="#DeepReversibleEGNN-573"><span class="linenos">573</span></a><span class="sd">                normalization after a block. If a single boolean or a list of</span>
</span><span id="DeepReversibleEGNN-574"><a href="#DeepReversibleEGNN-574"><span class="linenos">574</span></a><span class="sd">                single booleans, then normalization will be applied within and</span>
</span><span id="DeepReversibleEGNN-575"><a href="#DeepReversibleEGNN-575"><span class="linenos">575</span></a><span class="sd">                after the corresponding blocks of a layer according to the</span>
</span><span id="DeepReversibleEGNN-576"><a href="#DeepReversibleEGNN-576"><span class="linenos">576</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="DeepReversibleEGNN-577"><a href="#DeepReversibleEGNN-577"><span class="linenos">577</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="DeepReversibleEGNN-578"><a href="#DeepReversibleEGNN-578"><span class="linenos">578</span></a><span class="sd">                normalization after a block and the second will determine</span>
</span><span id="DeepReversibleEGNN-579"><a href="#DeepReversibleEGNN-579"><span class="linenos">579</span></a><span class="sd">                whether to use normalization within that block.</span>
</span><span id="DeepReversibleEGNN-580"><a href="#DeepReversibleEGNN-580"><span class="linenos">580</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="DeepReversibleEGNN-581"><a href="#DeepReversibleEGNN-581"><span class="linenos">581</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="DeepReversibleEGNN-582"><a href="#DeepReversibleEGNN-582"><span class="linenos">582</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="DeepReversibleEGNN-583"><a href="#DeepReversibleEGNN-583"><span class="linenos">583</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="DeepReversibleEGNN-584"><a href="#DeepReversibleEGNN-584"><span class="linenos">584</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="DeepReversibleEGNN-585"><a href="#DeepReversibleEGNN-585"><span class="linenos">585</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="DeepReversibleEGNN-586"><a href="#DeepReversibleEGNN-586"><span class="linenos">586</span></a><span class="sd">                omitted if 0.</span>
</span><span id="DeepReversibleEGNN-587"><a href="#DeepReversibleEGNN-587"><span class="linenos">587</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="DeepReversibleEGNN-588"><a href="#DeepReversibleEGNN-588"><span class="linenos">588</span></a><span class="sd">                layers.</span>
</span><span id="DeepReversibleEGNN-589"><a href="#DeepReversibleEGNN-589"><span class="linenos">589</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="DeepReversibleEGNN-590"><a href="#DeepReversibleEGNN-590"><span class="linenos">590</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="DeepReversibleEGNN-591"><a href="#DeepReversibleEGNN-591"><span class="linenos">591</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="DeepReversibleEGNN-592"><a href="#DeepReversibleEGNN-592"><span class="linenos">592</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="DeepReversibleEGNN-593"><a href="#DeepReversibleEGNN-593"><span class="linenos">593</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="DeepReversibleEGNN-594"><a href="#DeepReversibleEGNN-594"><span class="linenos">594</span></a><span class="sd">            layer_cls: Class instance of the reversible layer.</span>
</span><span id="DeepReversibleEGNN-595"><a href="#DeepReversibleEGNN-595"><span class="linenos">595</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="DeepReversibleEGNN-596"><a href="#DeepReversibleEGNN-596"><span class="linenos">596</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="DeepReversibleEGNN-597"><a href="#DeepReversibleEGNN-597"><span class="linenos">597</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="DeepReversibleEGNN-598"><a href="#DeepReversibleEGNN-598"><span class="linenos">598</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="DeepReversibleEGNN-599"><a href="#DeepReversibleEGNN-599"><span class="linenos">599</span></a><span class="sd">                debugging.</span>
</span><span id="DeepReversibleEGNN-600"><a href="#DeepReversibleEGNN-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN-601"><a href="#DeepReversibleEGNN-601"><span class="linenos">601</span></a>
</span><span id="DeepReversibleEGNN-602"><a href="#DeepReversibleEGNN-602"><span class="linenos">602</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="DeepReversibleEGNN-603"><a href="#DeepReversibleEGNN-603"><span class="linenos">603</span></a>
</span><span id="DeepReversibleEGNN-604"><a href="#DeepReversibleEGNN-604"><span class="linenos">604</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN-605"><a href="#DeepReversibleEGNN-605"><span class="linenos">605</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepReversibleEGNN-606"><a href="#DeepReversibleEGNN-606"><span class="linenos">606</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="DeepReversibleEGNN-607"><a href="#DeepReversibleEGNN-607"><span class="linenos">607</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-608"><a href="#DeepReversibleEGNN-608"><span class="linenos">608</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepReversibleEGNN-609"><a href="#DeepReversibleEGNN-609"><span class="linenos">609</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="DeepReversibleEGNN-610"><a href="#DeepReversibleEGNN-610"><span class="linenos">610</span></a>
</span><span id="DeepReversibleEGNN-611"><a href="#DeepReversibleEGNN-611"><span class="linenos">611</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="DeepReversibleEGNN-612"><a href="#DeepReversibleEGNN-612"><span class="linenos">612</span></a>
</span><span id="DeepReversibleEGNN-613"><a href="#DeepReversibleEGNN-613"><span class="linenos">613</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-614"><a href="#DeepReversibleEGNN-614"><span class="linenos">614</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-615"><a href="#DeepReversibleEGNN-615"><span class="linenos">615</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-616"><a href="#DeepReversibleEGNN-616"><span class="linenos">616</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-617"><a href="#DeepReversibleEGNN-617"><span class="linenos">617</span></a>        <span class="n">blocks</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-618"><a href="#DeepReversibleEGNN-618"><span class="linenos">618</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-619"><a href="#DeepReversibleEGNN-619"><span class="linenos">619</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-620"><a href="#DeepReversibleEGNN-620"><span class="linenos">620</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-621"><a href="#DeepReversibleEGNN-621"><span class="linenos">621</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-622"><a href="#DeepReversibleEGNN-622"><span class="linenos">622</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-623"><a href="#DeepReversibleEGNN-623"><span class="linenos">623</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-624"><a href="#DeepReversibleEGNN-624"><span class="linenos">624</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-625"><a href="#DeepReversibleEGNN-625"><span class="linenos">625</span></a>        <span class="n">layer_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;layer_cls&quot;</span><span class="p">,</span> <span class="n">layer_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-626"><a href="#DeepReversibleEGNN-626"><span class="linenos">626</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-627"><a href="#DeepReversibleEGNN-627"><span class="linenos">627</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-628"><a href="#DeepReversibleEGNN-628"><span class="linenos">628</span></a>        <span class="n">disable</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;disable&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN-629"><a href="#DeepReversibleEGNN-629"><span class="linenos">629</span></a>
</span><span id="DeepReversibleEGNN-630"><a href="#DeepReversibleEGNN-630"><span class="linenos">630</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepReversibleEGNN-631"><a href="#DeepReversibleEGNN-631"><span class="linenos">631</span></a>            
</span><span id="DeepReversibleEGNN-632"><a href="#DeepReversibleEGNN-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-633"><a href="#DeepReversibleEGNN-633"><span class="linenos">633</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN-634"><a href="#DeepReversibleEGNN-634"><span class="linenos">634</span></a>                    <span class="sa">f</span><span class="s2">&quot;minimum number of blocks is 2, but got </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s2"> for number &quot;</span>
</span><span id="DeepReversibleEGNN-635"><a href="#DeepReversibleEGNN-635"><span class="linenos">635</span></a>                    <span class="sa">f</span><span class="s2">&quot;of blocks&quot;</span>
</span><span id="DeepReversibleEGNN-636"><a href="#DeepReversibleEGNN-636"><span class="linenos">636</span></a>                <span class="p">)</span>
</span><span id="DeepReversibleEGNN-637"><a href="#DeepReversibleEGNN-637"><span class="linenos">637</span></a>
</span><span id="DeepReversibleEGNN-638"><a href="#DeepReversibleEGNN-638"><span class="linenos">638</span></a>            <span class="k">if</span> <span class="n">features_node</span> <span class="o">%</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-639"><a href="#DeepReversibleEGNN-639"><span class="linenos">639</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN-640"><a href="#DeepReversibleEGNN-640"><span class="linenos">640</span></a>                    <span class="sa">f</span><span class="s2">&quot;number of input features for a node must be divisible by &quot;</span>
</span><span id="DeepReversibleEGNN-641"><a href="#DeepReversibleEGNN-641"><span class="linenos">641</span></a>                    <span class="sa">f</span><span class="s2">&quot;the number of blocks, but got </span><span class="si">{</span><span class="n">features_node</span><span class="si">}</span><span class="s2"> for input &quot;</span>
</span><span id="DeepReversibleEGNN-642"><a href="#DeepReversibleEGNN-642"><span class="linenos">642</span></a>                    <span class="sa">f</span><span class="s2">&quot;features and </span><span class="si">{</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> for the number of blocks in &quot;</span>
</span><span id="DeepReversibleEGNN-643"><a href="#DeepReversibleEGNN-643"><span class="linenos">643</span></a>                    <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DeepReversibleEGNN-644"><a href="#DeepReversibleEGNN-644"><span class="linenos">644</span></a>                <span class="p">)</span>
</span><span id="DeepReversibleEGNN-645"><a href="#DeepReversibleEGNN-645"><span class="linenos">645</span></a>            
</span><span id="DeepReversibleEGNN-646"><a href="#DeepReversibleEGNN-646"><span class="linenos">646</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DeepReversibleEGNN-647"><a href="#DeepReversibleEGNN-647"><span class="linenos">647</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-648"><a href="#DeepReversibleEGNN-648"><span class="linenos">648</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-649"><a href="#DeepReversibleEGNN-649"><span class="linenos">649</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-650"><a href="#DeepReversibleEGNN-650"><span class="linenos">650</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN-651"><a href="#DeepReversibleEGNN-651"><span class="linenos">651</span></a>
</span><span id="DeepReversibleEGNN-652"><a href="#DeepReversibleEGNN-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-653"><a href="#DeepReversibleEGNN-653"><span class="linenos">653</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="DeepReversibleEGNN-654"><a href="#DeepReversibleEGNN-654"><span class="linenos">654</span></a>
</span><span id="DeepReversibleEGNN-655"><a href="#DeepReversibleEGNN-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="DeepReversibleEGNN-656"><a href="#DeepReversibleEGNN-656"><span class="linenos">656</span></a>
</span><span id="DeepReversibleEGNN-657"><a href="#DeepReversibleEGNN-657"><span class="linenos">657</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN-658"><a href="#DeepReversibleEGNN-658"><span class="linenos">658</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">layer_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span>
</span><span id="DeepReversibleEGNN-659"><a href="#DeepReversibleEGNN-659"><span class="linenos">659</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-660"><a href="#DeepReversibleEGNN-660"><span class="linenos">660</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-661"><a href="#DeepReversibleEGNN-661"><span class="linenos">661</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-662"><a href="#DeepReversibleEGNN-662"><span class="linenos">662</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-663"><a href="#DeepReversibleEGNN-663"><span class="linenos">663</span></a>                <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-664"><a href="#DeepReversibleEGNN-664"><span class="linenos">664</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-665"><a href="#DeepReversibleEGNN-665"><span class="linenos">665</span></a>                <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-666"><a href="#DeepReversibleEGNN-666"><span class="linenos">666</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-667"><a href="#DeepReversibleEGNN-667"><span class="linenos">667</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-668"><a href="#DeepReversibleEGNN-668"><span class="linenos">668</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-669"><a href="#DeepReversibleEGNN-669"><span class="linenos">669</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-670"><a href="#DeepReversibleEGNN-670"><span class="linenos">670</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-671"><a href="#DeepReversibleEGNN-671"><span class="linenos">671</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-672"><a href="#DeepReversibleEGNN-672"><span class="linenos">672</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-673"><a href="#DeepReversibleEGNN-673"><span class="linenos">673</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-674"><a href="#DeepReversibleEGNN-674"><span class="linenos">674</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-675"><a href="#DeepReversibleEGNN-675"><span class="linenos">675</span></a>                <span class="n">disable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN-676"><a href="#DeepReversibleEGNN-676"><span class="linenos">676</span></a>                <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-677"><a href="#DeepReversibleEGNN-677"><span class="linenos">677</span></a>                <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-678"><a href="#DeepReversibleEGNN-678"><span class="linenos">678</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN-679"><a href="#DeepReversibleEGNN-679"><span class="linenos">679</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span><span id="DeepReversibleEGNN-680"><a href="#DeepReversibleEGNN-680"><span class="linenos">680</span></a>
</span><span id="DeepReversibleEGNN-681"><a href="#DeepReversibleEGNN-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN-682"><a href="#DeepReversibleEGNN-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN-683"><a href="#DeepReversibleEGNN-683"><span class="linenos">683</span></a>
</span><span id="DeepReversibleEGNN-684"><a href="#DeepReversibleEGNN-684"><span class="linenos">684</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-685"><a href="#DeepReversibleEGNN-685"><span class="linenos">685</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span><span id="DeepReversibleEGNN-686"><a href="#DeepReversibleEGNN-686"><span class="linenos">686</span></a>
</span><span id="DeepReversibleEGNN-687"><a href="#DeepReversibleEGNN-687"><span class="linenos">687</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN-688"><a href="#DeepReversibleEGNN-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-689"><a href="#DeepReversibleEGNN-689"><span class="linenos">689</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-690"><a href="#DeepReversibleEGNN-690"><span class="linenos">690</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-691"><a href="#DeepReversibleEGNN-691"><span class="linenos">691</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-692"><a href="#DeepReversibleEGNN-692"><span class="linenos">692</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-693"><a href="#DeepReversibleEGNN-693"><span class="linenos">693</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-694"><a href="#DeepReversibleEGNN-694"><span class="linenos">694</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="DeepReversibleEGNN-695"><a href="#DeepReversibleEGNN-695"><span class="linenos">695</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="DeepReversibleEGNN-696"><a href="#DeepReversibleEGNN-696"><span class="linenos">696</span></a>
</span><span id="DeepReversibleEGNN-697"><a href="#DeepReversibleEGNN-697"><span class="linenos">697</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepReversibleEGNN-698"><a href="#DeepReversibleEGNN-698"><span class="linenos">698</span></a><span class="sd">            x: Node features.</span>
</span><span id="DeepReversibleEGNN-699"><a href="#DeepReversibleEGNN-699"><span class="linenos">699</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="DeepReversibleEGNN-700"><a href="#DeepReversibleEGNN-700"><span class="linenos">700</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="DeepReversibleEGNN-701"><a href="#DeepReversibleEGNN-701"><span class="linenos">701</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="DeepReversibleEGNN-702"><a href="#DeepReversibleEGNN-702"><span class="linenos">702</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="DeepReversibleEGNN-703"><a href="#DeepReversibleEGNN-703"><span class="linenos">703</span></a>
</span><span id="DeepReversibleEGNN-704"><a href="#DeepReversibleEGNN-704"><span class="linenos">704</span></a><span class="sd">        Returns:</span>
</span><span id="DeepReversibleEGNN-705"><a href="#DeepReversibleEGNN-705"><span class="linenos">705</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="DeepReversibleEGNN-706"><a href="#DeepReversibleEGNN-706"><span class="linenos">706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN-707"><a href="#DeepReversibleEGNN-707"><span class="linenos">707</span></a>
</span><span id="DeepReversibleEGNN-708"><a href="#DeepReversibleEGNN-708"><span class="linenos">708</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="DeepReversibleEGNN-709"><a href="#DeepReversibleEGNN-709"><span class="linenos">709</span></a>        <span class="n">pos_a</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="DeepReversibleEGNN-710"><a href="#DeepReversibleEGNN-710"><span class="linenos">710</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="DeepReversibleEGNN-711"><a href="#DeepReversibleEGNN-711"><span class="linenos">711</span></a>
</span><span id="DeepReversibleEGNN-712"><a href="#DeepReversibleEGNN-712"><span class="linenos">712</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN-713"><a href="#DeepReversibleEGNN-713"><span class="linenos">713</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN-714"><a href="#DeepReversibleEGNN-714"><span class="linenos">714</span></a>                <span class="n">s</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-715"><a href="#DeepReversibleEGNN-715"><span class="linenos">715</span></a>                <span class="n">pos_a</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-716"><a href="#DeepReversibleEGNN-716"><span class="linenos">716</span></a>                <span class="n">pos_b</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-717"><a href="#DeepReversibleEGNN-717"><span class="linenos">717</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-718"><a href="#DeepReversibleEGNN-718"><span class="linenos">718</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-719"><a href="#DeepReversibleEGNN-719"><span class="linenos">719</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN-720"><a href="#DeepReversibleEGNN-720"><span class="linenos">720</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN-721"><a href="#DeepReversibleEGNN-721"><span class="linenos">721</span></a>
</span><span id="DeepReversibleEGNN-722"><a href="#DeepReversibleEGNN-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span>
</span></pre></div>


            <div class="docstring"><p>Deep Reversible E(n) Equivariant Graph Neural Network.</p>

<p>Implementation of a Deep Reversible E(n) Equivariant Graph Neural Network
that utilizes reversible layers for saving memory during back-propagation.</p>

<p>Please refer to <code><a href="../egnn.html#DeepEGNN">bpp.model.egnn.DeepEGNN</a></code> for further details on how
to use this module.</p>
</div>


                            <div id="DeepReversibleEGNN.__init__" class="classattr">
                                        <input id="DeepReversibleEGNN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DeepReversibleEGNN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dims_node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>,</span><span class="param">	<span class="n">dims_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>,</span><span class="param">	<span class="n">dims_gate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">dims_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">blocks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">num_encode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">norm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">dropout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">activation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]],</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]],</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	layer_cls: Union[Sequence[torch.nn.modules.module.Module], torch.nn.modules.module.Module] = &lt;class &#x27;<a href="#ReversibleEGNN">ReversibleEGNN</a>&#x27;&gt;,</span><span class="param">	norm_cls: Union[Sequence[type[torch.nn.modules.module.Module]], type[torch.nn.modules.module.Module]] = &lt;class &#x27;torch.nn.modules.batchnorm.BatchNorm1d&#x27;&gt;,</span><span class="param">	dropout_cls: Union[Sequence[type[torch.nn.modules.module.Module]], type[torch.nn.modules.module.Module]] = &lt;class &#x27;torch.nn.modules.dropout.Dropout&#x27;&gt;,</span><span class="param">	<span class="n">disable</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="DeepReversibleEGNN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepReversibleEGNN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepReversibleEGNN.__init__-517"><a href="#DeepReversibleEGNN.__init__-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN.__init__-518"><a href="#DeepReversibleEGNN.__init__-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-519"><a href="#DeepReversibleEGNN.__init__-519"><span class="linenos">519</span></a>        <span class="n">dims_node</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
</span><span id="DeepReversibleEGNN.__init__-520"><a href="#DeepReversibleEGNN.__init__-520"><span class="linenos">520</span></a>        <span class="n">dims_edge</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
</span><span id="DeepReversibleEGNN.__init__-521"><a href="#DeepReversibleEGNN.__init__-521"><span class="linenos">521</span></a>        <span class="n">dims_gate</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="DeepReversibleEGNN.__init__-522"><a href="#DeepReversibleEGNN.__init__-522"><span class="linenos">522</span></a>        <span class="n">dims_pos</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="DeepReversibleEGNN.__init__-523"><a href="#DeepReversibleEGNN.__init__-523"><span class="linenos">523</span></a>        <span class="n">blocks</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-524"><a href="#DeepReversibleEGNN.__init__-524"><span class="linenos">524</span></a>        <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-525"><a href="#DeepReversibleEGNN.__init__-525"><span class="linenos">525</span></a>        <span class="n">num_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-526"><a href="#DeepReversibleEGNN.__init__-526"><span class="linenos">526</span></a>        <span class="n">dim_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-527"><a href="#DeepReversibleEGNN.__init__-527"><span class="linenos">527</span></a>        <span class="n">num_encode</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-528"><a href="#DeepReversibleEGNN.__init__-528"><span class="linenos">528</span></a>        <span class="n">pos_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-529"><a href="#DeepReversibleEGNN.__init__-529"><span class="linenos">529</span></a>        <span class="n">norm</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-530"><a href="#DeepReversibleEGNN.__init__-530"><span class="linenos">530</span></a>        <span class="n">clamp</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-531"><a href="#DeepReversibleEGNN.__init__-531"><span class="linenos">531</span></a>        <span class="n">dropout</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-532"><a href="#DeepReversibleEGNN.__init__-532"><span class="linenos">532</span></a>        <span class="n">activation</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-533"><a href="#DeepReversibleEGNN.__init__-533"><span class="linenos">533</span></a>        <span class="n">init</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-534"><a href="#DeepReversibleEGNN.__init__-534"><span class="linenos">534</span></a>        <span class="n">layer_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReversibleEGNN</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-535"><a href="#DeepReversibleEGNN.__init__-535"><span class="linenos">535</span></a>        <span class="n">norm_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-536"><a href="#DeepReversibleEGNN.__init__-536"><span class="linenos">536</span></a>        <span class="n">dropout_cls</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-537"><a href="#DeepReversibleEGNN.__init__-537"><span class="linenos">537</span></a>        <span class="n">disable</span><span class="p">:</span> <span class="n">Broadcast</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-538"><a href="#DeepReversibleEGNN.__init__-538"><span class="linenos">538</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.__init__-539"><a href="#DeepReversibleEGNN.__init__-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN.__init__-540"><a href="#DeepReversibleEGNN.__init__-540"><span class="linenos">540</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepReversibleEGNN.__init__-541"><a href="#DeepReversibleEGNN.__init__-541"><span class="linenos">541</span></a><span class="sd">            dims_node: Dimensions for the node networks. This can be a sequence</span>
</span><span id="DeepReversibleEGNN.__init__-542"><a href="#DeepReversibleEGNN.__init__-542"><span class="linenos">542</span></a><span class="sd">                of integers with `dims_node[0]` describing the number of input</span>
</span><span id="DeepReversibleEGNN.__init__-543"><a href="#DeepReversibleEGNN.__init__-543"><span class="linenos">543</span></a><span class="sd">                features and all remaining dimensions describing the number of</span>
</span><span id="DeepReversibleEGNN.__init__-544"><a href="#DeepReversibleEGNN.__init__-544"><span class="linenos">544</span></a><span class="sd">                features in the hidden layers. Note that the number of output</span>
</span><span id="DeepReversibleEGNN.__init__-545"><a href="#DeepReversibleEGNN.__init__-545"><span class="linenos">545</span></a><span class="sd">                features will always be the same as the number of input features</span>
</span><span id="DeepReversibleEGNN.__init__-546"><a href="#DeepReversibleEGNN.__init__-546"><span class="linenos">546</span></a><span class="sd">                for this variant of an EGNN model. Alternatively, `dims_node`</span>
</span><span id="DeepReversibleEGNN.__init__-547"><a href="#DeepReversibleEGNN.__init__-547"><span class="linenos">547</span></a><span class="sd">                can also be a sequence of sequences of integers, describing the</span>
</span><span id="DeepReversibleEGNN.__init__-548"><a href="#DeepReversibleEGNN.__init__-548"><span class="linenos">548</span></a><span class="sd">                aforementioned properties for each layer individually. In this</span>
</span><span id="DeepReversibleEGNN.__init__-549"><a href="#DeepReversibleEGNN.__init__-549"><span class="linenos">549</span></a><span class="sd">                case, only the number of input features in the definition of the</span>
</span><span id="DeepReversibleEGNN.__init__-550"><a href="#DeepReversibleEGNN.__init__-550"><span class="linenos">550</span></a><span class="sd">                first layer must be provided and for all other layers the number</span>
</span><span id="DeepReversibleEGNN.__init__-551"><a href="#DeepReversibleEGNN.__init__-551"><span class="linenos">551</span></a><span class="sd">                of input features is omitted, since it is derived from the</span>
</span><span id="DeepReversibleEGNN.__init__-552"><a href="#DeepReversibleEGNN.__init__-552"><span class="linenos">552</span></a><span class="sd">                the previous layer.</span>
</span><span id="DeepReversibleEGNN.__init__-553"><a href="#DeepReversibleEGNN.__init__-553"><span class="linenos">553</span></a><span class="sd">            dims_edge: Dimensions for the edge networks. Follows the same</span>
</span><span id="DeepReversibleEGNN.__init__-554"><a href="#DeepReversibleEGNN.__init__-554"><span class="linenos">554</span></a><span class="sd">                broadcasting scheme as `dims_node`.</span>
</span><span id="DeepReversibleEGNN.__init__-555"><a href="#DeepReversibleEGNN.__init__-555"><span class="linenos">555</span></a><span class="sd">            dims_gate: Dimensions for the message gating network. Follows the</span>
</span><span id="DeepReversibleEGNN.__init__-556"><a href="#DeepReversibleEGNN.__init__-556"><span class="linenos">556</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, message</span>
</span><span id="DeepReversibleEGNN.__init__-557"><a href="#DeepReversibleEGNN.__init__-557"><span class="linenos">557</span></a><span class="sd">                gating is disabled.</span>
</span><span id="DeepReversibleEGNN.__init__-558"><a href="#DeepReversibleEGNN.__init__-558"><span class="linenos">558</span></a><span class="sd">            dims_pos: Dimensions for the coordinate update network. Follows the</span>
</span><span id="DeepReversibleEGNN.__init__-559"><a href="#DeepReversibleEGNN.__init__-559"><span class="linenos">559</span></a><span class="sd">                same broadcasting scheme as `dims_node`. If empty, coordinate</span>
</span><span id="DeepReversibleEGNN.__init__-560"><a href="#DeepReversibleEGNN.__init__-560"><span class="linenos">560</span></a><span class="sd">                update is disabled.</span>
</span><span id="DeepReversibleEGNN.__init__-561"><a href="#DeepReversibleEGNN.__init__-561"><span class="linenos">561</span></a><span class="sd">            blocks: Number of blocks in the auto-regressive reversible layer;</span>
</span><span id="DeepReversibleEGNN.__init__-562"><a href="#DeepReversibleEGNN.__init__-562"><span class="linenos">562</span></a><span class="sd">                i.e., individual instances of :class:`bpp.model.egnn.EGNN`. At</span>
</span><span id="DeepReversibleEGNN.__init__-563"><a href="#DeepReversibleEGNN.__init__-563"><span class="linenos">563</span></a><span class="sd">                least two blocks are required and the number of node input</span>
</span><span id="DeepReversibleEGNN.__init__-564"><a href="#DeepReversibleEGNN.__init__-564"><span class="linenos">564</span></a><span class="sd">                features must be divisible by the number of blocks.</span>
</span><span id="DeepReversibleEGNN.__init__-565"><a href="#DeepReversibleEGNN.__init__-565"><span class="linenos">565</span></a><span class="sd">            layers: Number of layers.</span>
</span><span id="DeepReversibleEGNN.__init__-566"><a href="#DeepReversibleEGNN.__init__-566"><span class="linenos">566</span></a><span class="sd">            num_pos: Number of node positions.</span>
</span><span id="DeepReversibleEGNN.__init__-567"><a href="#DeepReversibleEGNN.__init__-567"><span class="linenos">567</span></a><span class="sd">            dim_pos: Number of coordinate dimensions.</span>
</span><span id="DeepReversibleEGNN.__init__-568"><a href="#DeepReversibleEGNN.__init__-568"><span class="linenos">568</span></a><span class="sd">            num_encode: Number of fourier-encoded features.</span>
</span><span id="DeepReversibleEGNN.__init__-569"><a href="#DeepReversibleEGNN.__init__-569"><span class="linenos">569</span></a><span class="sd">            pos_scale: Initial scaler for coordinate updates. If `pos_scale` is</span>
</span><span id="DeepReversibleEGNN.__init__-570"><a href="#DeepReversibleEGNN.__init__-570"><span class="linenos">570</span></a><span class="sd">                0, the penultimate layer of a coordinate update network will</span>
</span><span id="DeepReversibleEGNN.__init__-571"><a href="#DeepReversibleEGNN.__init__-571"><span class="linenos">571</span></a><span class="sd">                use a linear activation and omit the scaling factor.</span>
</span><span id="DeepReversibleEGNN.__init__-572"><a href="#DeepReversibleEGNN.__init__-572"><span class="linenos">572</span></a><span class="sd">            norm: Whether to use normalization within a block and whether to use</span>
</span><span id="DeepReversibleEGNN.__init__-573"><a href="#DeepReversibleEGNN.__init__-573"><span class="linenos">573</span></a><span class="sd">                normalization after a block. If a single boolean or a list of</span>
</span><span id="DeepReversibleEGNN.__init__-574"><a href="#DeepReversibleEGNN.__init__-574"><span class="linenos">574</span></a><span class="sd">                single booleans, then normalization will be applied within and</span>
</span><span id="DeepReversibleEGNN.__init__-575"><a href="#DeepReversibleEGNN.__init__-575"><span class="linenos">575</span></a><span class="sd">                after the corresponding blocks of a layer according to the</span>
</span><span id="DeepReversibleEGNN.__init__-576"><a href="#DeepReversibleEGNN.__init__-576"><span class="linenos">576</span></a><span class="sd">                boolean value. If a tuple of booleans or a list of tuples of</span>
</span><span id="DeepReversibleEGNN.__init__-577"><a href="#DeepReversibleEGNN.__init__-577"><span class="linenos">577</span></a><span class="sd">                booleans, then the first boolean will determine whether to use</span>
</span><span id="DeepReversibleEGNN.__init__-578"><a href="#DeepReversibleEGNN.__init__-578"><span class="linenos">578</span></a><span class="sd">                normalization after a block and the second will determine</span>
</span><span id="DeepReversibleEGNN.__init__-579"><a href="#DeepReversibleEGNN.__init__-579"><span class="linenos">579</span></a><span class="sd">                whether to use normalization within that block.</span>
</span><span id="DeepReversibleEGNN.__init__-580"><a href="#DeepReversibleEGNN.__init__-580"><span class="linenos">580</span></a><span class="sd">            clamp: Threshold for clamping coordinate updates (between `-clamp`</span>
</span><span id="DeepReversibleEGNN.__init__-581"><a href="#DeepReversibleEGNN.__init__-581"><span class="linenos">581</span></a><span class="sd">                and `clamp`). Unclamped if 0.</span>
</span><span id="DeepReversibleEGNN.__init__-582"><a href="#DeepReversibleEGNN.__init__-582"><span class="linenos">582</span></a><span class="sd">            dropout: Dropout probabilities for in-between layers and within</span>
</span><span id="DeepReversibleEGNN.__init__-583"><a href="#DeepReversibleEGNN.__init__-583"><span class="linenos">583</span></a><span class="sd">                layers. Values will be broadcasted to all layers, if only two</span>
</span><span id="DeepReversibleEGNN.__init__-584"><a href="#DeepReversibleEGNN.__init__-584"><span class="linenos">584</span></a><span class="sd">                probabilities are given, or to all layers and in-between and</span>
</span><span id="DeepReversibleEGNN.__init__-585"><a href="#DeepReversibleEGNN.__init__-585"><span class="linenos">585</span></a><span class="sd">                within layers, if only one probability is given. Dropout is</span>
</span><span id="DeepReversibleEGNN.__init__-586"><a href="#DeepReversibleEGNN.__init__-586"><span class="linenos">586</span></a><span class="sd">                omitted if 0.</span>
</span><span id="DeepReversibleEGNN.__init__-587"><a href="#DeepReversibleEGNN.__init__-587"><span class="linenos">587</span></a><span class="sd">            activation: Activation function that is used for the :class:`EGNN`</span>
</span><span id="DeepReversibleEGNN.__init__-588"><a href="#DeepReversibleEGNN.__init__-588"><span class="linenos">588</span></a><span class="sd">                layers.</span>
</span><span id="DeepReversibleEGNN.__init__-589"><a href="#DeepReversibleEGNN.__init__-589"><span class="linenos">589</span></a><span class="sd">            init: Initializer that is used for network layers. First argument is</span>
</span><span id="DeepReversibleEGNN.__init__-590"><a href="#DeepReversibleEGNN.__init__-590"><span class="linenos">590</span></a><span class="sd">                the module that should be initialized, the second is the</span>
</span><span id="DeepReversibleEGNN.__init__-591"><a href="#DeepReversibleEGNN.__init__-591"><span class="linenos">591</span></a><span class="sd">                non-linearity, in case of a linear module, that should be used.</span>
</span><span id="DeepReversibleEGNN.__init__-592"><a href="#DeepReversibleEGNN.__init__-592"><span class="linenos">592</span></a><span class="sd">                The default non-linearity should adhere to whatever is used for</span>
</span><span id="DeepReversibleEGNN.__init__-593"><a href="#DeepReversibleEGNN.__init__-593"><span class="linenos">593</span></a><span class="sd">                `activation`. See :func:`parameter_init`.</span>
</span><span id="DeepReversibleEGNN.__init__-594"><a href="#DeepReversibleEGNN.__init__-594"><span class="linenos">594</span></a><span class="sd">            layer_cls: Class instance of the reversible layer.</span>
</span><span id="DeepReversibleEGNN.__init__-595"><a href="#DeepReversibleEGNN.__init__-595"><span class="linenos">595</span></a><span class="sd">            norm_cls: Class instance of normalization module.</span>
</span><span id="DeepReversibleEGNN.__init__-596"><a href="#DeepReversibleEGNN.__init__-596"><span class="linenos">596</span></a><span class="sd">            dropout_cls: Class instance of dropout module.</span>
</span><span id="DeepReversibleEGNN.__init__-597"><a href="#DeepReversibleEGNN.__init__-597"><span class="linenos">597</span></a><span class="sd">            disable: Whether to disable reversible computations and use</span>
</span><span id="DeepReversibleEGNN.__init__-598"><a href="#DeepReversibleEGNN.__init__-598"><span class="linenos">598</span></a><span class="sd">                conventional back-propagation method. Used primarily for</span>
</span><span id="DeepReversibleEGNN.__init__-599"><a href="#DeepReversibleEGNN.__init__-599"><span class="linenos">599</span></a><span class="sd">                debugging.</span>
</span><span id="DeepReversibleEGNN.__init__-600"><a href="#DeepReversibleEGNN.__init__-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN.__init__-601"><a href="#DeepReversibleEGNN.__init__-601"><span class="linenos">601</span></a>
</span><span id="DeepReversibleEGNN.__init__-602"><a href="#DeepReversibleEGNN.__init__-602"><span class="linenos">602</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="DeepReversibleEGNN.__init__-603"><a href="#DeepReversibleEGNN.__init__-603"><span class="linenos">603</span></a>
</span><span id="DeepReversibleEGNN.__init__-604"><a href="#DeepReversibleEGNN.__init__-604"><span class="linenos">604</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN.__init__-605"><a href="#DeepReversibleEGNN.__init__-605"><span class="linenos">605</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepReversibleEGNN.__init__-606"><a href="#DeepReversibleEGNN.__init__-606"><span class="linenos">606</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="DeepReversibleEGNN.__init__-607"><a href="#DeepReversibleEGNN.__init__-607"><span class="linenos">607</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.__init__-608"><a href="#DeepReversibleEGNN.__init__-608"><span class="linenos">608</span></a>            <span class="n">features_node</span> <span class="o">=</span> <span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DeepReversibleEGNN.__init__-609"><a href="#DeepReversibleEGNN.__init__-609"><span class="linenos">609</span></a>            <span class="n">dims_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="DeepReversibleEGNN.__init__-610"><a href="#DeepReversibleEGNN.__init__-610"><span class="linenos">610</span></a>
</span><span id="DeepReversibleEGNN.__init__-611"><a href="#DeepReversibleEGNN.__init__-611"><span class="linenos">611</span></a>        <span class="n">update_is_broadcasted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_pos</span><span class="p">)</span>
</span><span id="DeepReversibleEGNN.__init__-612"><a href="#DeepReversibleEGNN.__init__-612"><span class="linenos">612</span></a>
</span><span id="DeepReversibleEGNN.__init__-613"><a href="#DeepReversibleEGNN.__init__-613"><span class="linenos">613</span></a>        <span class="n">dims_node</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_node&quot;</span><span class="p">,</span> <span class="n">dims_node</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-614"><a href="#DeepReversibleEGNN.__init__-614"><span class="linenos">614</span></a>        <span class="n">dims_edge</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_edge&quot;</span><span class="p">,</span> <span class="n">dims_edge</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-615"><a href="#DeepReversibleEGNN.__init__-615"><span class="linenos">615</span></a>        <span class="n">dims_gate</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_gate&quot;</span><span class="p">,</span> <span class="n">dims_gate</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-616"><a href="#DeepReversibleEGNN.__init__-616"><span class="linenos">616</span></a>        <span class="n">dims_pos</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dims_pos&quot;</span><span class="p">,</span> <span class="n">dims_pos</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-617"><a href="#DeepReversibleEGNN.__init__-617"><span class="linenos">617</span></a>        <span class="n">blocks</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-618"><a href="#DeepReversibleEGNN.__init__-618"><span class="linenos">618</span></a>        <span class="n">num_encode</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;num_encode&quot;</span><span class="p">,</span> <span class="n">num_encode</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-619"><a href="#DeepReversibleEGNN.__init__-619"><span class="linenos">619</span></a>        <span class="n">pos_scale</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;pos_scale&quot;</span><span class="p">,</span> <span class="n">pos_scale</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-620"><a href="#DeepReversibleEGNN.__init__-620"><span class="linenos">620</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-621"><a href="#DeepReversibleEGNN.__init__-621"><span class="linenos">621</span></a>        <span class="n">clamp</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-622"><a href="#DeepReversibleEGNN.__init__-622"><span class="linenos">622</span></a>        <span class="n">dropout</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-623"><a href="#DeepReversibleEGNN.__init__-623"><span class="linenos">623</span></a>        <span class="n">activation</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-624"><a href="#DeepReversibleEGNN.__init__-624"><span class="linenos">624</span></a>        <span class="n">init</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-625"><a href="#DeepReversibleEGNN.__init__-625"><span class="linenos">625</span></a>        <span class="n">layer_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;layer_cls&quot;</span><span class="p">,</span> <span class="n">layer_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-626"><a href="#DeepReversibleEGNN.__init__-626"><span class="linenos">626</span></a>        <span class="n">norm_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;norm_cls&quot;</span><span class="p">,</span> <span class="n">norm_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-627"><a href="#DeepReversibleEGNN.__init__-627"><span class="linenos">627</span></a>        <span class="n">dropout_cls</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;dropout_cls&quot;</span><span class="p">,</span> <span class="n">dropout_cls</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-628"><a href="#DeepReversibleEGNN.__init__-628"><span class="linenos">628</span></a>        <span class="n">disable</span> <span class="o">=</span> <span class="n">broadcast_arg</span><span class="p">(</span><span class="s2">&quot;disable&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="p">,</span> <span class="p">[</span><span class="n">layers</span><span class="p">])</span>
</span><span id="DeepReversibleEGNN.__init__-629"><a href="#DeepReversibleEGNN.__init__-629"><span class="linenos">629</span></a>
</span><span id="DeepReversibleEGNN.__init__-630"><a href="#DeepReversibleEGNN.__init__-630"><span class="linenos">630</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_node</span><span class="p">)):</span>
</span><span id="DeepReversibleEGNN.__init__-631"><a href="#DeepReversibleEGNN.__init__-631"><span class="linenos">631</span></a>            
</span><span id="DeepReversibleEGNN.__init__-632"><a href="#DeepReversibleEGNN.__init__-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.__init__-633"><a href="#DeepReversibleEGNN.__init__-633"><span class="linenos">633</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN.__init__-634"><a href="#DeepReversibleEGNN.__init__-634"><span class="linenos">634</span></a>                    <span class="sa">f</span><span class="s2">&quot;minimum number of blocks is 2, but got </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s2"> for number &quot;</span>
</span><span id="DeepReversibleEGNN.__init__-635"><a href="#DeepReversibleEGNN.__init__-635"><span class="linenos">635</span></a>                    <span class="sa">f</span><span class="s2">&quot;of blocks&quot;</span>
</span><span id="DeepReversibleEGNN.__init__-636"><a href="#DeepReversibleEGNN.__init__-636"><span class="linenos">636</span></a>                <span class="p">)</span>
</span><span id="DeepReversibleEGNN.__init__-637"><a href="#DeepReversibleEGNN.__init__-637"><span class="linenos">637</span></a>
</span><span id="DeepReversibleEGNN.__init__-638"><a href="#DeepReversibleEGNN.__init__-638"><span class="linenos">638</span></a>            <span class="k">if</span> <span class="n">features_node</span> <span class="o">%</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.__init__-639"><a href="#DeepReversibleEGNN.__init__-639"><span class="linenos">639</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN.__init__-640"><a href="#DeepReversibleEGNN.__init__-640"><span class="linenos">640</span></a>                    <span class="sa">f</span><span class="s2">&quot;number of input features for a node must be divisible by &quot;</span>
</span><span id="DeepReversibleEGNN.__init__-641"><a href="#DeepReversibleEGNN.__init__-641"><span class="linenos">641</span></a>                    <span class="sa">f</span><span class="s2">&quot;the number of blocks, but got </span><span class="si">{</span><span class="n">features_node</span><span class="si">}</span><span class="s2"> for input &quot;</span>
</span><span id="DeepReversibleEGNN.__init__-642"><a href="#DeepReversibleEGNN.__init__-642"><span class="linenos">642</span></a>                    <span class="sa">f</span><span class="s2">&quot;features and </span><span class="si">{</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> for the number of blocks in &quot;</span>
</span><span id="DeepReversibleEGNN.__init__-643"><a href="#DeepReversibleEGNN.__init__-643"><span class="linenos">643</span></a>                    <span class="sa">f</span><span class="s2">&quot;layer </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DeepReversibleEGNN.__init__-644"><a href="#DeepReversibleEGNN.__init__-644"><span class="linenos">644</span></a>                <span class="p">)</span>
</span><span id="DeepReversibleEGNN.__init__-645"><a href="#DeepReversibleEGNN.__init__-645"><span class="linenos">645</span></a>            
</span><span id="DeepReversibleEGNN.__init__-646"><a href="#DeepReversibleEGNN.__init__-646"><span class="linenos">646</span></a>            <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DeepReversibleEGNN.__init__-647"><a href="#DeepReversibleEGNN.__init__-647"><span class="linenos">647</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-648"><a href="#DeepReversibleEGNN.__init__-648"><span class="linenos">648</span></a>                <span class="o">*</span><span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-649"><a href="#DeepReversibleEGNN.__init__-649"><span class="linenos">649</span></a>                <span class="n">features_node</span> <span class="o">//</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-650"><a href="#DeepReversibleEGNN.__init__-650"><span class="linenos">650</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN.__init__-651"><a href="#DeepReversibleEGNN.__init__-651"><span class="linenos">651</span></a>
</span><span id="DeepReversibleEGNN.__init__-652"><a href="#DeepReversibleEGNN.__init__-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="n">update_is_broadcasted</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.__init__-653"><a href="#DeepReversibleEGNN.__init__-653"><span class="linenos">653</span></a>            <span class="n">dims_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="DeepReversibleEGNN.__init__-654"><a href="#DeepReversibleEGNN.__init__-654"><span class="linenos">654</span></a>
</span><span id="DeepReversibleEGNN.__init__-655"><a href="#DeepReversibleEGNN.__init__-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span><span id="DeepReversibleEGNN.__init__-656"><a href="#DeepReversibleEGNN.__init__-656"><span class="linenos">656</span></a>
</span><span id="DeepReversibleEGNN.__init__-657"><a href="#DeepReversibleEGNN.__init__-657"><span class="linenos">657</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layers</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN.__init__-658"><a href="#DeepReversibleEGNN.__init__-658"><span class="linenos">658</span></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">layer_cls</span><span class="p">[</span><span class="n">i</span><span class="p">](</span>
</span><span id="DeepReversibleEGNN.__init__-659"><a href="#DeepReversibleEGNN.__init__-659"><span class="linenos">659</span></a>                <span class="n">dims_node</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-660"><a href="#DeepReversibleEGNN.__init__-660"><span class="linenos">660</span></a>                <span class="n">dims_edge</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-661"><a href="#DeepReversibleEGNN.__init__-661"><span class="linenos">661</span></a>                <span class="n">dims_gate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-662"><a href="#DeepReversibleEGNN.__init__-662"><span class="linenos">662</span></a>                <span class="n">dims_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-663"><a href="#DeepReversibleEGNN.__init__-663"><span class="linenos">663</span></a>                <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-664"><a href="#DeepReversibleEGNN.__init__-664"><span class="linenos">664</span></a>                <span class="n">num_pos</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-665"><a href="#DeepReversibleEGNN.__init__-665"><span class="linenos">665</span></a>                <span class="n">dim_pos</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-666"><a href="#DeepReversibleEGNN.__init__-666"><span class="linenos">666</span></a>                <span class="n">num_encode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-667"><a href="#DeepReversibleEGNN.__init__-667"><span class="linenos">667</span></a>                <span class="n">pos_scale</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-668"><a href="#DeepReversibleEGNN.__init__-668"><span class="linenos">668</span></a>                <span class="n">norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-669"><a href="#DeepReversibleEGNN.__init__-669"><span class="linenos">669</span></a>                <span class="n">clamp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-670"><a href="#DeepReversibleEGNN.__init__-670"><span class="linenos">670</span></a>                <span class="n">dropout</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-671"><a href="#DeepReversibleEGNN.__init__-671"><span class="linenos">671</span></a>                <span class="n">activation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-672"><a href="#DeepReversibleEGNN.__init__-672"><span class="linenos">672</span></a>                <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-673"><a href="#DeepReversibleEGNN.__init__-673"><span class="linenos">673</span></a>                <span class="n">norm_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-674"><a href="#DeepReversibleEGNN.__init__-674"><span class="linenos">674</span></a>                <span class="n">dropout_cls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-675"><a href="#DeepReversibleEGNN.__init__-675"><span class="linenos">675</span></a>                <span class="n">disable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="DeepReversibleEGNN.__init__-676"><a href="#DeepReversibleEGNN.__init__-676"><span class="linenos">676</span></a>                <span class="n">free_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-677"><a href="#DeepReversibleEGNN.__init__-677"><span class="linenos">677</span></a>                <span class="n">free_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.__init__-678"><a href="#DeepReversibleEGNN.__init__-678"><span class="linenos">678</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN.__init__-679"><a href="#DeepReversibleEGNN.__init__-679"><span class="linenos">679</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dims_node:</strong>  Dimensions for the node networks. This can be a sequence
of integers with <code>dims_node[0]</code> describing the number of input
features and all remaining dimensions describing the number of
features in the hidden layers. Note that the number of output
features will always be the same as the number of input features
for this variant of an EGNN model. Alternatively, <code>dims_node</code>
can also be a sequence of sequences of integers, describing the
aforementioned properties for each layer individually. In this
case, only the number of input features in the definition of the
first layer must be provided and for all other layers the number
of input features is omitted, since it is derived from the
the previous layer.</li>
<li><strong>dims_edge:</strong>  Dimensions for the edge networks. Follows the same
broadcasting scheme as <code>dims_node</code>.</li>
<li><strong>dims_gate:</strong>  Dimensions for the message gating network. Follows the
same broadcasting scheme as <code>dims_node</code>. If empty, message
gating is disabled.</li>
<li><strong>dims_pos:</strong>  Dimensions for the coordinate update network. Follows the
same broadcasting scheme as <code>dims_node</code>. If empty, coordinate
update is disabled.</li>
<li><strong>blocks:</strong>  Number of blocks in the auto-regressive reversible layer;
i.e., individual instances of <code><a href="../egnn.html#EGNN">bpp.model.egnn.EGNN</a></code>. At
least two blocks are required and the number of node input
features must be divisible by the number of blocks.</li>
<li><strong>layers:</strong>  Number of layers.</li>
<li><strong>num_pos:</strong>  Number of node positions.</li>
<li><strong>dim_pos:</strong>  Number of coordinate dimensions.</li>
<li><strong>num_encode:</strong>  Number of fourier-encoded features.</li>
<li><strong>pos_scale:</strong>  Initial scaler for coordinate updates. If <code>pos_scale</code> is
0, the penultimate layer of a coordinate update network will
use a linear activation and omit the scaling factor.</li>
<li><strong>norm:</strong>  Whether to use normalization within a block and whether to use
normalization after a block. If a single boolean or a list of
single booleans, then normalization will be applied within and
after the corresponding blocks of a layer according to the
boolean value. If a tuple of booleans or a list of tuples of
booleans, then the first boolean will determine whether to use
normalization after a block and the second will determine
whether to use normalization within that block.</li>
<li><strong>clamp:</strong>  Threshold for clamping coordinate updates (between <code>-clamp</code>
and <code>clamp</code>). Unclamped if 0.</li>
<li><strong>dropout:</strong>  Dropout probabilities for in-between layers and within
layers. Values will be broadcasted to all layers, if only two
probabilities are given, or to all layers and in-between and
within layers, if only one probability is given. Dropout is
omitted if 0.</li>
<li><strong>activation:</strong>  Activation function that is used for the <code>EGNN</code>
layers.</li>
<li><strong>init:</strong>  Initializer that is used for network layers. First argument is
the module that should be initialized, the second is the
non-linearity, in case of a linear module, that should be used.
The default non-linearity should adhere to whatever is used for
<code>activation</code>. See <code>parameter_init()</code>.</li>
<li><strong>layer_cls:</strong>  Class instance of the reversible layer.</li>
<li><strong>norm_cls:</strong>  Class instance of normalization module.</li>
<li><strong>dropout_cls:</strong>  Class instance of dropout module.</li>
<li><strong>disable:</strong>  Whether to disable reversible computations and use
conventional back-propagation method. Used primarily for
debugging.</li>
</ul>
</div>


                            </div>
                            <div id="DeepReversibleEGNN.layers" class="classattr">
                                <div class="attr variable">
            <span class="name">layers</span>

        
    </div>
    <a class="headerlink" href="#DeepReversibleEGNN.layers"></a>
    
    

                            </div>
                            <div id="DeepReversibleEGNN.reset_parameters" class="classattr">
                                        <input id="DeepReversibleEGNN.reset_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DeepReversibleEGNN.reset_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepReversibleEGNN.reset_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepReversibleEGNN.reset_parameters-681"><a href="#DeepReversibleEGNN.reset_parameters-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DeepReversibleEGNN.reset_parameters-682"><a href="#DeepReversibleEGNN.reset_parameters-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reset parameters.&quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN.reset_parameters-683"><a href="#DeepReversibleEGNN.reset_parameters-683"><span class="linenos">683</span></a>
</span><span id="DeepReversibleEGNN.reset_parameters-684"><a href="#DeepReversibleEGNN.reset_parameters-684"><span class="linenos">684</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.reset_parameters-685"><a href="#DeepReversibleEGNN.reset_parameters-685"><span class="linenos">685</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Reset parameters.</p>
</div>


                            </div>
                            <div id="DeepReversibleEGNN.forward" class="classattr">
                                        <input id="DeepReversibleEGNN.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">pos</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">edge_index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch_geometric</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DeepReversibleEGNN.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeepReversibleEGNN.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeepReversibleEGNN.forward-687"><a href="#DeepReversibleEGNN.forward-687"><span class="linenos">687</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN.forward-688"><a href="#DeepReversibleEGNN.forward-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-689"><a href="#DeepReversibleEGNN.forward-689"><span class="linenos">689</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-690"><a href="#DeepReversibleEGNN.forward-690"><span class="linenos">690</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-691"><a href="#DeepReversibleEGNN.forward-691"><span class="linenos">691</span></a>        <span class="n">edge_index</span><span class="p">:</span> <span class="n">Adj</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-692"><a href="#DeepReversibleEGNN.forward-692"><span class="linenos">692</span></a>        <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-693"><a href="#DeepReversibleEGNN.forward-693"><span class="linenos">693</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Adj</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-694"><a href="#DeepReversibleEGNN.forward-694"><span class="linenos">694</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</span><span id="DeepReversibleEGNN.forward-695"><a href="#DeepReversibleEGNN.forward-695"><span class="linenos">695</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute forward pass.</span>
</span><span id="DeepReversibleEGNN.forward-696"><a href="#DeepReversibleEGNN.forward-696"><span class="linenos">696</span></a>
</span><span id="DeepReversibleEGNN.forward-697"><a href="#DeepReversibleEGNN.forward-697"><span class="linenos">697</span></a><span class="sd">        Arguments:</span>
</span><span id="DeepReversibleEGNN.forward-698"><a href="#DeepReversibleEGNN.forward-698"><span class="linenos">698</span></a><span class="sd">            x: Node features.</span>
</span><span id="DeepReversibleEGNN.forward-699"><a href="#DeepReversibleEGNN.forward-699"><span class="linenos">699</span></a><span class="sd">            pos: Node coordinates.</span>
</span><span id="DeepReversibleEGNN.forward-700"><a href="#DeepReversibleEGNN.forward-700"><span class="linenos">700</span></a><span class="sd">            edge_index: Graph connectivity.</span>
</span><span id="DeepReversibleEGNN.forward-701"><a href="#DeepReversibleEGNN.forward-701"><span class="linenos">701</span></a><span class="sd">            edge_attr: Edge features.</span>
</span><span id="DeepReversibleEGNN.forward-702"><a href="#DeepReversibleEGNN.forward-702"><span class="linenos">702</span></a><span class="sd">            batch: Node to batch mapping.</span>
</span><span id="DeepReversibleEGNN.forward-703"><a href="#DeepReversibleEGNN.forward-703"><span class="linenos">703</span></a>
</span><span id="DeepReversibleEGNN.forward-704"><a href="#DeepReversibleEGNN.forward-704"><span class="linenos">704</span></a><span class="sd">        Returns:</span>
</span><span id="DeepReversibleEGNN.forward-705"><a href="#DeepReversibleEGNN.forward-705"><span class="linenos">705</span></a><span class="sd">            Tuple of updated node features and updated coordinates.</span>
</span><span id="DeepReversibleEGNN.forward-706"><a href="#DeepReversibleEGNN.forward-706"><span class="linenos">706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DeepReversibleEGNN.forward-707"><a href="#DeepReversibleEGNN.forward-707"><span class="linenos">707</span></a>
</span><span id="DeepReversibleEGNN.forward-708"><a href="#DeepReversibleEGNN.forward-708"><span class="linenos">708</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="DeepReversibleEGNN.forward-709"><a href="#DeepReversibleEGNN.forward-709"><span class="linenos">709</span></a>        <span class="n">pos_a</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="DeepReversibleEGNN.forward-710"><a href="#DeepReversibleEGNN.forward-710"><span class="linenos">710</span></a>        <span class="n">pos_b</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="DeepReversibleEGNN.forward-711"><a href="#DeepReversibleEGNN.forward-711"><span class="linenos">711</span></a>
</span><span id="DeepReversibleEGNN.forward-712"><a href="#DeepReversibleEGNN.forward-712"><span class="linenos">712</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="DeepReversibleEGNN.forward-713"><a href="#DeepReversibleEGNN.forward-713"><span class="linenos">713</span></a>            <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span>
</span><span id="DeepReversibleEGNN.forward-714"><a href="#DeepReversibleEGNN.forward-714"><span class="linenos">714</span></a>                <span class="n">s</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-715"><a href="#DeepReversibleEGNN.forward-715"><span class="linenos">715</span></a>                <span class="n">pos_a</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-716"><a href="#DeepReversibleEGNN.forward-716"><span class="linenos">716</span></a>                <span class="n">pos_b</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-717"><a href="#DeepReversibleEGNN.forward-717"><span class="linenos">717</span></a>                <span class="n">edge_index</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-718"><a href="#DeepReversibleEGNN.forward-718"><span class="linenos">718</span></a>                <span class="n">edge_attr</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-719"><a href="#DeepReversibleEGNN.forward-719"><span class="linenos">719</span></a>                <span class="n">batch</span><span class="p">,</span>
</span><span id="DeepReversibleEGNN.forward-720"><a href="#DeepReversibleEGNN.forward-720"><span class="linenos">720</span></a>            <span class="p">)</span>
</span><span id="DeepReversibleEGNN.forward-721"><a href="#DeepReversibleEGNN.forward-721"><span class="linenos">721</span></a>
</span><span id="DeepReversibleEGNN.forward-722"><a href="#DeepReversibleEGNN.forward-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos_a</span>
</span></pre></div>


            <div class="docstring"><p>Compute forward pass.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x:</strong>  Node features.</li>
<li><strong>pos:</strong>  Node coordinates.</li>
<li><strong>edge_index:</strong>  Graph connectivity.</li>
<li><strong>edge_attr:</strong>  Edge features.</li>
<li><strong>batch:</strong>  Node to batch mapping.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Tuple of updated node features and updated coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="DeepReversibleEGNN.dump_patches" class="variable">dump_patches</dd>
                <dd id="DeepReversibleEGNN.training" class="variable">training</dd>
                <dd id="DeepReversibleEGNN.call_super_init" class="variable">call_super_init</dd>
                <dd id="DeepReversibleEGNN.register_buffer" class="function">register_buffer</dd>
                <dd id="DeepReversibleEGNN.register_parameter" class="function">register_parameter</dd>
                <dd id="DeepReversibleEGNN.add_module" class="function">add_module</dd>
                <dd id="DeepReversibleEGNN.register_module" class="function">register_module</dd>
                <dd id="DeepReversibleEGNN.get_submodule" class="function">get_submodule</dd>
                <dd id="DeepReversibleEGNN.get_parameter" class="function">get_parameter</dd>
                <dd id="DeepReversibleEGNN.get_buffer" class="function">get_buffer</dd>
                <dd id="DeepReversibleEGNN.get_extra_state" class="function">get_extra_state</dd>
                <dd id="DeepReversibleEGNN.set_extra_state" class="function">set_extra_state</dd>
                <dd id="DeepReversibleEGNN.apply" class="function">apply</dd>
                <dd id="DeepReversibleEGNN.cuda" class="function">cuda</dd>
                <dd id="DeepReversibleEGNN.ipu" class="function">ipu</dd>
                <dd id="DeepReversibleEGNN.xpu" class="function">xpu</dd>
                <dd id="DeepReversibleEGNN.cpu" class="function">cpu</dd>
                <dd id="DeepReversibleEGNN.type" class="function">type</dd>
                <dd id="DeepReversibleEGNN.float" class="function">float</dd>
                <dd id="DeepReversibleEGNN.double" class="function">double</dd>
                <dd id="DeepReversibleEGNN.half" class="function">half</dd>
                <dd id="DeepReversibleEGNN.bfloat16" class="function">bfloat16</dd>
                <dd id="DeepReversibleEGNN.to_empty" class="function">to_empty</dd>
                <dd id="DeepReversibleEGNN.to" class="function">to</dd>
                <dd id="DeepReversibleEGNN.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="DeepReversibleEGNN.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="DeepReversibleEGNN.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="DeepReversibleEGNN.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="DeepReversibleEGNN.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="DeepReversibleEGNN.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="DeepReversibleEGNN.state_dict" class="function">state_dict</dd>
                <dd id="DeepReversibleEGNN.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="DeepReversibleEGNN.load_state_dict" class="function">load_state_dict</dd>
                <dd id="DeepReversibleEGNN.parameters" class="function">parameters</dd>
                <dd id="DeepReversibleEGNN.named_parameters" class="function">named_parameters</dd>
                <dd id="DeepReversibleEGNN.buffers" class="function">buffers</dd>
                <dd id="DeepReversibleEGNN.named_buffers" class="function">named_buffers</dd>
                <dd id="DeepReversibleEGNN.children" class="function">children</dd>
                <dd id="DeepReversibleEGNN.named_children" class="function">named_children</dd>
                <dd id="DeepReversibleEGNN.modules" class="function">modules</dd>
                <dd id="DeepReversibleEGNN.named_modules" class="function">named_modules</dd>
                <dd id="DeepReversibleEGNN.train" class="function">train</dd>
                <dd id="DeepReversibleEGNN.eval" class="function">eval</dd>
                <dd id="DeepReversibleEGNN.requires_grad_" class="function">requires_grad_</dd>
                <dd id="DeepReversibleEGNN.zero_grad" class="function">zero_grad</dd>
                <dd id="DeepReversibleEGNN.share_memory" class="function">share_memory</dd>
                <dd id="DeepReversibleEGNN.extra_repr" class="function">extra_repr</dd>
                <dd id="DeepReversibleEGNN.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>